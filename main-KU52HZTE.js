import{$ as xE,$a as yi,$b as ec,A as gE,Aa as N_,Ab as wo,Ac as Pu,B as fl,Ba as CE,Bb as lr,C as eo,Ca as B_,Cb as Ea,D as V0,Da as TE,Db as cr,E as gd,Ea as Rc,Eb as bn,F as Tu,Fa as xo,Fb as yn,G as Hh,Ga as ef,Gb as Ss,H as j0,Ha as Zh,Hb as hn,I as vo,Ia as Yh,Ib as Co,J as _E,Ja as EE,Jb as Ms,K as F_,Ka as IE,Kb as gl,L as _d,La as SE,Lb as _l,M as bd,Ma as ME,Mb as bl,N as U0,Na as AE,Nb as Fr,O as bE,Oa as DE,Ob as Pn,P as yE,Pa as kE,Pb as W0,Q as vE,Qa as as,Qb as Z0,R as G0,Ra as RE,Rb as NE,S as $h,Sa as tf,Sb as U_,T as Es,Ta as Ft,Tb as G_,U as Ta,Ua as Oe,Ub as Y0,V as Wr,Va as Su,Vb as Kh,W as Zr,Wa as PE,Wb as X0,X as fr,Xa as nf,Xb as BE,Y as os,Ya as V_,Yb as Pr,Z as Qt,Za as Xh,Zb as VE,_ as cn,_a as $0,_b as pn,a as Ht,aa as hi,ab as Pc,ac as jE,b as Ar,ba as H0,bb as q0,bc as Qh,c as O0,ca as bt,cb as so,cc as UE,d as hE,da as $t,db as xr,dc as GE,e as pE,ea as Qm,eb as OE,ec as rn,f as qr,fa as L_,fb as FE,fc as K0,g as mE,ga as Jm,gb as j_,gc as Jh,h as rs,ha as Jt,hb as Xn,hc as H_,i as F0,ia as kn,ib as Fn,ic as Q0,j as L0,ja as dn,jb as Ni,jc as $_,k as Gi,ka as Qi,kb as Jl,kc as HE,l as ua,la as Eu,lb as Tn,lc as $E,m as Cs,ma as wE,mb as ss,mc as qE,n as ha,na as qh,nb as Ur,nc as ku,o as ui,oa as kc,ob as Mu,oc as WE,p as wu,pa as jr,pb as Au,pc as ZE,q as z0,qa as Ji,qb as Du,qc as q_,r as fE,ra as en,rb as vt,rc as W_,s as ln,sa as Wh,sb as wt,t as Km,ta as z_,tb as nn,u as Ts,ua as Ql,ub as Ho,uc as rf,v as N0,va as Is,vb as Oc,vc as Ru,w as P_,wa as yd,wb as LE,x as B0,xa as Iu,xb as Vi,xc as yl,y as O_,ya as zi,yb as zE,yc as of,z as Cu,za as fi,zb as Rn,zc as J0}from"./chunk-HIOY5CUJ.js";var KI=hE((ex,tx)=>{"use strict";(function(g,l){typeof ex=="object"&&typeof tx<"u"?tx.exports=l():typeof define=="function"&&define.amd?define(l):(g=typeof globalThis<"u"?globalThis:g||self,g.mapboxgl=l())})(ex,function(){"use strict";var g,l,w;function c(r,M){if(!g)g=M;else if(!l)l=M;else{var z="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+g+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",ie={};g(ie),w=M(ie),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(w.workerUrl=window.URL.createObjectURL(new Blob([z],{type:"text/javascript"})))}}c(["exports"],function(r){"use strict";var M="3.3.0";let z,ie={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(z==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{z=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{z=t}}return z},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ie.API_URL)return null;try{let t=new URL(ie.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function ue(t){return ie.API_URL_REGEX.test(t)}function ye(t){return t.indexOf("mapbox:")===0}function Je(t){return ie.API_CDN_URL_REGEX.test(t)}function It(t){return ie.API_SPRITE_REGEX.test(t)}function st(t){return ie.API_STYLE_REGEX.test(t)&&!It(t)}let Xt={create:"create",load:"load",fullLoad:"fullLoad"};function Oi(t){let e=t.name.split("?")[0];return Je(e)&&e.includes("mapbox-gl.js")?"javascript":Je(e)&&e.includes("mapbox-gl.css")?"css":function(i){return ie.API_FONTS_REGEX.test(i)}(e)?"fontRange":It(e)?"sprite":st(e)?"style":function(i){return ie.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}function vi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ti=xn;function xn(t,e,i,o){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=o}xn.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,o=0;o<8;o++){var s=this.sampleCurveX(i)-t;if(Math.abs(s)<e)return i;var d=this.sampleCurveDerivativeX(i);if(Math.abs(d)<1e-6)break;i-=s/d}var p=0,_=1;for(i=t,o=0;o<20&&(s=this.sampleCurveX(i),!(Math.abs(s-t)<e));o++)t>s?p=i:_=i,i=.5*(_-p)+p;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Wo=vi(Ti),ur=Lo;function Lo(t,e){this.x=t,this.y=e}Lo.prototype={clone:function(){return new Lo(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround:function(t,e){var i=Math.cos(t),o=Math.sin(t),s=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=s,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Lo.convert=function(t){return t instanceof Lo?t:Array.isArray(t)?new Lo(t[0],t[1]):t};var dt=vi(ur);let ja=Math.PI/180,Cl=180/Math.PI;function Fi(t){return t*ja}function qn(t){return t*Cl}let Nc=[[0,0],[1,0],[1,1],[0,1]];function yt(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function Zo(t,e,i,o){let s=new Wo(t,e,i,o);return function(d){return s.solve(d)}}let Yr=Zo(.25,.1,.25,1);function gi(t,e,i){return Math.min(i,Math.max(e,t))}function us(t,e,i){return(i=gi((i-t)/(e-t),0,1))*i*(3-2*i)}function Ia(t,e,i){let o=i-e,s=((t-e)%o+o)%o+e;return s===e?i:s}function Yo(t,e,i){if(!t.length)return i(null,[]);let o=t.length,s=new Array(t.length),d=null;t.forEach((p,_)=>{e(p,(y,v)=>{y&&(d=y),s[_]=v,--o==0&&i(d,s)})})}function Gr(t,...e){for(let i of e)for(let o in i)t[o]=i[o];return t}let Ua=1;function Lr(){return Ua++}function ma(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function zo(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function co(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Ps(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Xo(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Bn(t,e,i){let o={};for(let s in t)o[s]=e.call(i||this,t[s],s,t);return o}function Mi(t,e,i){let o={};for(let s in t)e.call(i||this,t[s],s,t)&&(o[s]=t[s]);return o}function Ao(t){return Array.isArray(t)?t.map(Ao):typeof t=="object"&&t?Bn(t,Ao):t}let Bc={};function er(t){Bc[t]||(typeof console<"u"&&console.warn(t),Bc[t]=!0)}function uo(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function Os(t){let e=0;for(let i,o,s=0,d=t.length,p=d-1;s<d;p=s++)i=t[s],o=t[p],e+=(o.x-i.x)*(i.y+o.y);return e}function Sn([t,e,i]){let o=Fi(e+90),s=Fi(i);return{x:t*Math.cos(o)*Math.sin(s),y:t*Math.sin(o)*Math.sin(s),z:t*Math.cos(s),azimuthal:e,polar:i}}function fa(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Fs(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,s,d)=>{let p=s||d;return e[o]=!p||p.toLowerCase(),""}),e["max-age"]){let i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Cr,No,Tl,Ko,Sa,ga,Ue=null;function Y(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function ae(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function fe(t,e,i,o){for(;e<i;){let s=e+i>>1;t[s]<o?e=s+1:i=s}return e}function Be(t,e,i,o){for(;e<i;){let s=e+i>>1;t[s]<=o?e=s+1:i=s}return e}function Ge(){return Cr==null&&(Cr=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Cr}let et={now:()=>Ko!==void 0?Ko:performance.now(),setNow(t){Ko=t},restoreNow(){Ko=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:i,height:o}=t;Sa||(Sa=document.createElement("canvas"));let s=Sa.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return(i>Sa.width||o>Sa.height)&&(Sa.width=i,Sa.height=o),s.clearRect(-e,-e,i+2*e,o+2*e),s.drawImage(t,0,0,i,o),s.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:t=>(No||(No=document.createElement("a")),No.href=t,No.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Tl==null&&(Tl=window.matchMedia("(prefers-reduced-motion: reduce)")),Tl.matches)},hasCanvasFingerprintNoise(){if(ga!==void 0)return ga;if(!Ge())return ga=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),i=0;for(let s=0;s<t.width;++s)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(s,0,1,1);let o=e.getImageData(0,0,t.width,t.height);i=0;for(let s=0;s<o.data.length;++s)if(s%4!=3&&i++!==o.data[s])return ga=!0,!0;return ga=!1,!1}},St="mapbox-tiles",Ve=500,Pt=50,Tt,Dt;function Ei(){try{return caches}catch{}}function mn(){let t=Ei();t&&!Tt&&(Tt=t.open(St))}function En(t){let e=t.indexOf("?");if(e<0)return t;let i=["language","worldview"],o=new URLSearchParams,s=new URLSearchParams(t.slice(e));for(let d of i){let p=s.get(d);p&&o.set(d,p)}return`${t.slice(0,e)}?${o.toString()}`}function gn(t,e){let i=t.indexOf("?");if(i<0)return`${t}?${new URLSearchParams(e).toString()}`;let o=new URLSearchParams(t.slice(i));for(let s in e)o.set(s,e[s]);return`${t.slice(0,i)}?${o.toString()}`}let $i=1/0,Ii={supported:!1,testSupport:function(t){!zr&&Mn&&(Ln?ho(t):on=t)}},on,Mn,zr=!1,Ln=!1,To=typeof self<"u"?self:{};function ho(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Mn),t.isContextLost())return;Ii.supported=!0}catch{}t.deleteTexture(e),zr=!0}To.document&&(Mn=To.document.createElement("img"),Mn.onload=function(){on&&ho(on),on=null,Ln=!0},Mn.onerror=function(){zr=!0,on=null},Mn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let to={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(to);class kr extends Error{constructor(e,i,o){i===401&&ue(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let gr=fa()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ne=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(gr())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,s){let d=new AbortController,p=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:gr(),referrerPolicy:o.referrerPolicy,signal:d.signal}),_=!1,y=!1,v=(C=p.url).indexOf("sku=")>0&&ue(C);var C;o.type==="json"&&p.headers.set("Accept","application/json");let E=(R,O,F)=>{if(y)return;if(R&&R.message!=="SecurityError"&&er(R.toString()),O&&F)return S(O);let V=Date.now();fetch(p).then(U=>{if(U.ok){let Z=v?U.clone():null;return S(U,Z,V)}return s(new kr(U.statusText,U.status,o.url))}).catch(U=>{U.name!=="AbortError"&&s(new Error(`${U.message} ${o.url}`))})},S=(R,O,F)=>{(o.type==="arrayBuffer"?R.arrayBuffer():o.type==="json"?R.json():R.text()).then(V=>{y||(O&&F&&function(U,Z,Q){if(mn(),!Tt)return;let K=Fs(Z.headers.get("Cache-Control")||"");if(K["no-store"])return;let se={status:Z.status,statusText:Z.statusText,headers:new Headers};Z.headers.forEach((_e,xe)=>se.headers.set(xe,_e)),K["max-age"]&&se.headers.set("Expires",new Date(Q+1e3*K["max-age"]).toUTCString());let oe=se.headers.get("Expires");if(!oe||new Date(oe).getTime()-Q<42e4)return;let de=En(U.url);if(Z.status===206){let _e=U.headers.get("Range");if(!_e)return;se.status=200,de=gn(de,{range:_e})}(function(_e,xe){if(Dt===void 0)try{new Response(new ReadableStream),Dt=!0}catch{Dt=!1}Dt?xe(_e.body):_e.blob().then(xe)})(Z,_e=>{let xe=new Response(_e,se);mn(),Tt&&Tt.then(Se=>Se.put(de,xe)).catch(Se=>er(Se.message))})}(p,O,F),_=!0,s(null,V,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(V=>{y||s(new Error(V.message))})};return v?function(R,O){if(mn(),!Tt)return O(null);Tt.then(F=>{let V=En(R.url),U=R.headers.get("Range");U&&(V=gn(V,{range:U})),F.match(V).then(Z=>{let Q=function(K){if(!K)return!1;let se=new Date(K.headers.get("Expires")||0),oe=Fs(K.headers.get("Cache-Control")||"");return se>Date.now()&&!oe["no-cache"]}(Z);F.delete(V),Q&&F.put(V,Z.clone()),O(null,Z,Q)}).catch(O)}).catch(O)}(p,E):E(null,null),{cancel:()=>{y=!0,_||d.abort()}}}(t,e);if(fa()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(o,s){let d=new XMLHttpRequest;d.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(let p in o.headers)d.setRequestHeader(p,o.headers[p]);return o.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=o.credentials==="include",d.onerror=()=>{s(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let p=d.response;if(o.type==="json")try{p=JSON.parse(d.response)}catch(_){return s(_)}s(null,p,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else s(new kr(d.statusText,d.status,o.url))},d.send(o.body),{cancel:()=>d.abort()}}(t,e)},Le=function(t,e){return Ne(Gr(t,{type:"arrayBuffer"}),e)};function tt(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",it,ht;it=[],ht=0;let gt=function(t,e){if(Ii.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ht>=ie.MAX_PARALLEL_IMAGE_REQUESTS){let d={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return it.push(d),d}ht++;let i=!1,o=()=>{if(!i)for(i=!0,ht--;it.length&&ht<ie.MAX_PARALLEL_IMAGE_REQUESTS;){let d=it.shift(),{requestParameters:p,callback:_,cancelled:y}=d;y||(d.cancel=gt(p,_).cancel)}},s=Le(t,(d,p,_,y)=>{o(),d?e(d):p&&(self.createImageBitmap?function(v,C){let E=new Blob([new Uint8Array(v)],{type:"image/png"});createImageBitmap(E).then(S=>{C(null,S)}).catch(S=>{C(new Error(`Could not load image because of ${S.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(v,C)=>e(v,C,_,y)):function(v,C){let E=new Image;E.onload=()=>{C(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=lt})},E.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let S=new Blob([new Uint8Array(v)],{type:"image/png"});E.src=v.byteLength?URL.createObjectURL(S):lt}(p,(v,C)=>e(v,C,_,y)))});return{cancel:()=>{s.cancel(),o()}}},rt="01",xt="NO_ACCESS_TOKEN",pt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ti(t){let e=t.match(pt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ni(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let Bt="mapbox.eventData";function In(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Gn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let i=In(ie.ACCESS_TOKEN),o="";return o=i&&i.u?btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(s,d)=>String.fromCharCode(+("0x"+d)))):ie.ACCESS_TOKEN||"",e?`${Bt}.${e}:${o}`:`${Bt}:${o}`}fetchEventData(){let e=Y("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{let s=localStorage.getItem(i);s&&(this.eventData=JSON.parse(s));let d=localStorage.getItem(o);d&&(this.anonId=d)}catch{er("Unable to read from LocalStorage")}}saveEventData(){let e=Y("localStorage"),i=this.getStorageKey(),o=this.getStorageKey("uuid"),s=this.anonId;if(e&&s)try{localStorage.setItem(o,s),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{er("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,o,s){if(!ie.EVENTS_URL)return;let d=ti(ie.EVENTS_URL);d.params.push(`access_token=${s||ie.ACCESS_TOKEN||""}`);let p={event:this.type,created:new Date(e).toISOString()},_=i?Gr(p,i):p,y={url:ni(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([_])};this.pendingRequest=function(v,C){return Ne(Gr(v,{method:"POST"}),C)}(y,v=>{this.pendingRequest=null,o(v),this.saveEventData(),this.processRequests(s)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}let Wn=new class extends Gn{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){ie.EVENTS_URL&&ie.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>ye(i)||ue(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=In(ie.ACCESS_TOKEN),i=e?e.u:ie.ACCESS_TOKEN,o=i!==this.eventData.tokenU;co(this.anonId)||(this.anonId=ma(),o=!0);let s=this.queue.shift();if(this.eventData.lastSuccess){let d=new Date(this.eventData.lastSuccess),p=new Date(s),_=(s-this.eventData.lastSuccess)/864e5;o=o||_>=1||_<-1||d.getDate()!==p.getDate()}else o=!0;o?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:rt,"enabled.telemetry":!1,userId:this.anonId},d=>{d||(this.eventData.lastSuccess=s,this.eventData.tokenU=i)},t):this.processRequests()}},Rr=Wn.postTurnstileEvent.bind(Wn),Nr=new class extends Gn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,o){this.skuToken=e,this.errorCb=o,ie.EVENTS_URL&&(i||ie.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(xt)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),co(this.anonId)||(this.anonId=ma()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:rt,skuToken:this.skuToken,userId:this.anonId},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},Zi=Nr.postMapLoadEvent.bind(Nr),po=new class extends Gn{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){ie.EVENTS_URL&&(t||ie.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:i}=this.queue.shift(),o=function(s){let d=performance.getEntriesByType("resource"),p=performance.getEntriesByType("mark"),_=function(R){let O={};if(R){for(let F in R)if(F!=="other")for(let V of R[F]){let U=`${F}ResolveRangeMin`,Z=`${F}ResolveRangeMax`,Q=`${F}RequestCount`,K=`${F}RequestCachedCount`;O[U]=Math.min(O[U]||1/0,V.startTime),O[Z]=Math.max(O[Z]||-1/0,V.responseEnd);let se=oe=>{O[oe]===void 0&&(O[oe]=0),++O[oe]};V.transferSize!==void 0&&V.transferSize===0&&se(K),se(Q)}}return O}(function(R,O){let F={};if(R)for(let V of R){let U=O(V);F[U]===void 0&&(F[U]=[]),F[U].push(V)}return F}(d,Oi)),y=window.devicePixelRatio,v=navigator.connection||navigator.mozConnection||navigator.webkitConnection,C=v?v.effectiveType:void 0,E={counters:[],metadata:[],attributes:[]},S=(R,O,F)=>{F!=null&&R.push({name:O,value:F.toString()})};for(let R in _)S(E.counters,R,_[R]);if(s.interactionRange[0]!==1/0&&s.interactionRange[1]!==-1/0&&(S(E.counters,"interactionRangeMin",s.interactionRange[0]),S(E.counters,"interactionRangeMax",s.interactionRange[1])),p)for(let R of Object.keys(Xt)){let O=Xt[R],F=p.find(V=>V.name===O);F&&S(E.counters,O,F.startTime)}return S(E.counters,"visibilityHidden",s.visibilityHidden),S(E.attributes,"style",function(R){if(R)for(let O of R){let F=O.name.split("?")[0];if(st(F)){let V=F.split("/").slice(-2);if(V.length===2)return`mapbox://styles/${V[0]}/${V[1]}`}}}(d)),S(E.attributes,"terrainEnabled",s.terrainEnabled?"true":"false"),S(E.attributes,"fogEnabled",s.fogEnabled?"true":"false"),S(E.attributes,"projection",s.projection),S(E.attributes,"zoom",s.zoom),S(E.metadata,"devicePixelRatio",y),S(E.metadata,"connectionEffectiveType",C),S(E.metadata,"navigatorUserAgent",navigator.userAgent),S(E.metadata,"screenWidth",window.screen.width),S(E.metadata,"screenHeight",window.screen.height),S(E.metadata,"windowWidth",window.innerWidth),S(E.metadata,"windowHeight",window.innerHeight),S(E.metadata,"mapWidth",s.width/y),S(E.metadata,"mapHeight",s.height/y),S(E.metadata,"webglRenderer",s.renderer),S(E.metadata,"webglVendor",s.vendor),S(E.metadata,"sdkVersion",M),S(E.metadata,"sdkIdentifier","mapbox-gl-js"),E}(i);for(let s of o.metadata);for(let s of o.counters);for(let s of o.attributes);this.postEvent(e,o,()=>{},t)}},Bo=po.postPerformanceEvent.bind(po),Br=new class extends Gn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,o){if(!ie.API_URL||!ie.SESSION_PATH)return;let s=ti(ie.API_URL+ie.SESSION_PATH);s.params.push(`sku=${e||""}`),s.params.push(`access_token=${o||ie.ACCESS_TOKEN||""}`);let d={url:ni(s),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(p,_){return Ne(Gr(p,{method:"GET"}),_)}(d,p=>{this.pendingRequest=null,i(p),this.saveEventData(),this.processRequests(o)})}getSessionAPI(t,e,i,o){this.skuToken=e,this.errorCb=o,ie.SESSION_PATH&&ie.API_URL&&(i||ie.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(xt)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},Tr=Br.getSessionAPI.bind(Br),Ga=new Set;function Ls(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function Ma(t,e,i){if(i&&i[t]){let o=i[t].indexOf(e);o!==-1&&i[t].splice(o,1)}}class mo{constructor(e,i={}){Gr(this,i),this.type=e}}class El extends mo{constructor(e,i={}){super("error",Gr({error:e},i))}}class Qo{on(e,i){return this._listeners=this._listeners||{},Ls(e,i,this._listeners),this}off(e,i){return Ma(e,i,this._listeners),Ma(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Ls(e,i,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,i){typeof e=="string"&&(e=new mo(e,i||{}));let o=e.type;if(this.listens(o)){e.target=this;let s=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(let _ of s)_.call(this,e);let d=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(let _ of d)Ma(o,_,this._oneTimeListeners),_.call(this,e);let p=this._eventedParent;p&&(Gr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof El&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}r.y=void 0;var hs={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ac(t){return(t=Math.round(t))<0?0:t>255?255:t}function Ad(t){return ac(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Vc(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Dd(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{r.y={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in hs)return hs[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var o=i.indexOf("("),s=i.indexOf(")");if(o!==-1&&s+1===i.length){var d=i.substr(0,o),p=i.substr(o+1,s-(o+1)).split(","),_=1;switch(d){case"rgba":if(p.length!==4)return null;_=Vc(p.pop());case"rgb":return p.length!==3?null:[Ad(p[0]),Ad(p[1]),Ad(p[2]),_];case"hsla":if(p.length!==4)return null;_=Vc(p.pop());case"hsl":if(p.length!==3)return null;var y=(parseFloat(p[0])%360+360)%360/360,v=Vc(p[1]),C=Vc(p[2]),E=C<=.5?C*(v+1):C+v-C*v,S=2*C-E;return[ac(255*Dd(S,E,y+1/3)),ac(255*Dd(S,E,y)),ac(255*Dd(S,E,y-1/3)),_];default:return null}}return null}}catch{}class Eo{constructor(e,i,o,s=1){this.r=e,this.g=i,this.b=o,this.a=s}static parse(e){if(!e)return;if(e instanceof Eo)return e;if(typeof e!="string")return;let i=r.y(e);return i?new Eo(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){let[e,i,o,s]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(o)},${s})`}toArray(){let{r:e,g:i,b:o,a:s}=this;return s===0?[0,0,0,0]:[255*e/s,255*i/s,255*o/s,s]}toArray01(){let{r:e,g:i,b:o,a:s}=this;return s===0?[0,0,0,0]:[e/s,i/s,o/s,s]}toArray01Scaled(e){let{r:i,g:o,b:s,a:d}=this;return d===0?[0,0,0]:[i/d*e,o/d*e,s/d*e]}toArray01PremultipliedAlpha(){let{r:e,g:i,b:o,a:s}=this;return[e,i,o,s]}toArray01Linear(){let{r:e,g:i,b:o,a:s}=this;return s===0?[0,0,0,0]:[Math.pow(e/s,2.2),Math.pow(i/s,2.2),Math.pow(o/s,2.2),s]}}Eo.black=new Eo(0,0,0,1),Eo.white=new Eo(1,1,1,1),Eo.transparent=new Eo(0,0,0,0),Eo.red=new Eo(1,0,0,1),Eo.blue=new Eo(0,0,1,1);var hr=Eo;function Ai(t,e,i){return t*(1-i)+e*i}function kd(t,e,i){return t.map((o,s)=>Ai(o,e[s],i))}var jc=Object.freeze({__proto__:null,array:kd,color:function(t,e,i){return new hr(Ai(t.r,e.r,i),Ai(t.g,e.g,i),Ai(t.b,e.b,i),Ai(t.a,e.a,i))},number:Ai});function Rd(t,...e){for(let i of e)for(let o in i)t[o]=i[o];return t}class Sp extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var Vo=Sp;class D{constructor(e,i=[]){this.parent=e,this.bindings={};for(let[o,s]of i)this.bindings[o]=s}concat(e){return new D(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var N=D;let J={kind:"null"},re={kind:"number"},pe={kind:"string"},ge={kind:"boolean"},Ee={kind:"color"},ft={kind:"object"},Ze={kind:"value"},Vt={kind:"collator"},zt={kind:"formatted"},Mt={kind:"resolvedImage"};function oi(t,e){return{kind:"array",itemType:t,N:e}}function ji(t){if(t.kind==="array"){let e=ji(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let ot=[J,re,pe,ge,Ee,zt,ft,oi(Ze),Mt];function tr(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!tr(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let i of ot)if(!tr(i,e))return null}}return`Expected ${ji(t)} but found ${ji(e)} instead.`}function ke(t,e){return e.some(i=>i.kind===t.kind)}function Kt(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}class Gt{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Er{constructor(e,i,o,s,d){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=s,this.textColor=d}}class _n{constructor(e){this.sections=e}static fromString(e){return new _n([new Er(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof _n?e:_n.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);let o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(o)}return e}}class qt{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new qt({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Ku(t,e,i,o){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[t,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[t,e,i,o]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function zn(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof hr||t instanceof Gt||t instanceof _n||t instanceof qt)return!0;if(Array.isArray(t)){for(let e of t)if(!zn(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!zn(t[e]))return!1;return!0}return!1}function Ir(t){if(t===null)return J;if(typeof t=="string")return pe;if(typeof t=="boolean")return ge;if(typeof t=="number")return re;if(t instanceof hr)return Ee;if(t instanceof Gt)return Vt;if(t instanceof _n)return zt;if(t instanceof qt)return Mt;if(Array.isArray(t)){let e=t.length,i;for(let o of t){let s=Ir(o);if(i){if(i===s)continue;i=Ze;break}i=s}return oi(i||Ze,e)}return ft}function Jo(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof hr||t instanceof _n||t instanceof qt?t.toString():JSON.stringify(t)}class fo{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!zn(e[1]))return i.error("invalid value");let o=e[1],s=Ir(o),d=i.expectedType;return s.kind!=="array"||s.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(s=d),new fo(s,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof hr?["rgba"].concat(this.value.toArray()):this.value instanceof _n?this.value.serialize():this.value}}var Aa=fo,Sr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};let Uc={string:pe,number:re,boolean:ge,object:ft};class sc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,s=1,d=e[0];if(d==="array"){let _,y;if(e.length>2){let v=e[1];if(typeof v!="string"||!(v in Uc)||v==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);_=Uc[v],s++}else _=Ze;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);y=e[2],s++}o=oi(_,y)}else o=Uc[d];let p=[];for(;s<e.length;s++){let _=i.parse(e[s],s,Ze);if(!_)return null;p.push(_)}return new sc(o,p)}evaluate(e){for(let i=0;i<this.args.length;i++){let o=this.args[i].evaluate(e);if(!tr(this.type,Ir(o)))return o;if(i===this.args.length-1)throw new Sr(`Expected value to be of type ${ji(this.type)}, but found ${ji(Ir(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,i=[e.kind];if(e.kind==="array"){let o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);let s=e.N;(typeof s=="number"||this.args.length>1)&&i.push(s)}}return i.concat(this.args.map(o=>o.serialize()))}}var Da=sc;class zs{constructor(e){this.type=zt,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");let s=[],d=!1;for(let p=1;p<=e.length-1;++p){let _=e[p];if(d&&typeof _=="object"&&!Array.isArray(_)){d=!1;let y=null;if(_["font-scale"]&&(y=i.parse(_["font-scale"],1,re),!y))return null;let v=null;if(_["text-font"]&&(v=i.parse(_["text-font"],1,oi(pe)),!v))return null;let C=null;if(_["text-color"]&&(C=i.parse(_["text-color"],1,Ee),!C))return null;let E=s[s.length-1];E.scale=y,E.font=v,E.textColor=C}else{let y=i.parse(e[p],1,Ze);if(!y)return null;let v=y.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,s.push({content:y,scale:null,font:null,textColor:null})}}return new zs(s)}evaluate(e){return new _n(this.sections.map(i=>{let o=i.content.evaluate(e);return Ir(o)===Mt?new Er("",o,null,null,null):new Er(Jo(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(let i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let i of this.sections){e.push(i.content.serialize());let o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class Ns{constructor(e,i){this.type=Mt,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let o=i.parse(e[1],1,pe);if(!o)return i.error("No image name provided.");if(e.length===2)return new Ns(o);let s=i.parse(e[2],1,pe);return s?new Ns(o,s):i.error("Secondary image variant is not a string.")}evaluate(e){let i=qt.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Il(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let _a={"to-boolean":ge,"to-color":Ee,"to-number":re,"to-string":pe};class lc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o=e[0],s=[],d=J;if(o==="to-array"){if(!Array.isArray(e[1]))return null;let p=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);d=oi(i.expectedType.itemType,p)}else{if(!(p>0&&zn(e[1][0])))return null;d=oi(Ir(e[1][0]),p)}for(let _=0;_<p;_++){let y=e[1][_],v;if(Il(y)==="array")v=i.parse(y,void 0,d.itemType);else{let C=Il(y);if(C!==d.itemType.kind)return i.error(`Expected ${d.itemType.kind} but found ${C}.`);v=i.registry.literal.parse(["literal",y===void 0?null:y],i)}if(!v)return null;s.push(v)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");d=_a[o];for(let p=1;p<e.length;p++){let _=i.parse(e[p],p,Ze);if(!_)return null;s.push(_)}}return new lc(d,s)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(let s of this.args){if(i=s.evaluate(e),o=null,i instanceof hr)return i;if(typeof i=="string"){let d=e.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Ku(i[0],i[1],i[2],i[3]),!o))return new hr(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Sr(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(let o of this.args){if(i=o.evaluate(e),i===null)return 0;let s=Number(i);if(!isNaN(s))return s}throw new Sr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?_n.fromString(Jo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?qt.fromString(Jo(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Jo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new zs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ns(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ka=lc;let Sl=["Unknown","Point","LineString","Polygon"];var Qu=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Sl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:o}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(o*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=hr.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class Bs{constructor(e,i,o,s,d){this.name=e,this.type=i,this._evaluate=o,this.args=s,this._overloadIndex=d}evaluate(e){if(!this._evaluate){let i=Bs.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){let o=e[0],s=Bs.definitions[o];if(!s)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);let d=Array.isArray(s)?s[0]:s.type,p=Array.isArray(s)?[[s[1],s[2]]]:s.overloads,_=[],y=null,v=-1;for(let[C,E]of p){if(Array.isArray(C)&&C.length!==e.length-1)continue;_.push(C),v++,y=new go(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);let S=[],R=!1;for(let O=1;O<e.length;O++){let F=e[O],V=Array.isArray(C)?C[O-1]:C.type,U=y.parse(F,1+S.length,V);if(!U){R=!0;break}S.push(U)}if(!R)if(Array.isArray(C)&&C.length!==S.length)y.error(`Expected ${C.length} arguments, but found ${S.length} instead.`);else{for(let O=0;O<S.length;O++){let F=Array.isArray(C)?C[O]:C.type,V=S[O];y.concat(O+1).checkSubtype(F,V.type)}if(y.errors.length===0)return new Bs(o,d,E,S,v)}}if(_.length===1)i.errors.push(...y.errors);else{let C=(_.length?_:p.map(([S])=>S)).map(cc).join(" | "),E=[];for(let S=1;S<e.length;S++){let R=i.parse(e[S],1+E.length);if(!R)return null;E.push(ji(R.type))}i.error(`Expected arguments of type ${C}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){Bs.definitions=i;for(let o in i)e[o]=Bs}}function cc(t){return Array.isArray(t)?`(${t.map(ji).join(", ")})`:`(${ji(t.type)}...)`}var Di=Bs;class Ml{constructor(e,i,o){this.type=Vt,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");let o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");let s=i.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,ge);if(!s)return null;let d=i.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,ge);if(!d)return null;let p=null;return o.locale&&(p=i.parse(o.locale,1,pe),!p)?null:new Ml(s,d,p)}evaluate(e){return new Gt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var ea={exports:{}};ea.exports=function(){function t(o,s,d,p,_){for(;p>d;){if(p-d>600){var y=p-d+1,v=s-d+1,C=Math.log(y),E=.5*Math.exp(2*C/3),S=.5*Math.sqrt(C*E*(y-E)/y)*(v-y/2<0?-1:1);t(o,s,Math.max(d,Math.floor(s-v*E/y+S)),Math.min(p,Math.floor(s+(y-v)*E/y+S)),_)}var R=o[s],O=d,F=p;for(e(o,d,s),_(o[p],R)>0&&e(o,d,p);O<F;){for(e(o,O,F),O++,F--;_(o[O],R)<0;)O++;for(;_(o[F],R)>0;)F--}_(o[d],R)===0?e(o,d,F):e(o,++F,p),F<=s&&(d=F+1),s<=F&&(p=F-1)}}function e(o,s,d){var p=o[s];o[s]=o[d],o[d]=p}function i(o,s){return o<s?-1:o>s?1:0}return function(o,s,d,p,_){t(o,s,d||0,p||o.length-1,_||i)}}();var Ju=vi(ea.exports);function eh(t){let e=0;for(let i,o,s=0,d=t.length,p=d-1;s<d;p=s++)i=t[s],o=t[p],e+=(o.x-i.x)*(i.y+o.y);return e}function ps(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ha(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Vs(t,e,i){let o=t[0]-e[0],s=t[1]-e[1],d=t[0]-i[0],p=t[1]-i[1];return o*p-d*s==0&&o*d<=0&&s*p<=0}function js(t,e,i=!1){let o=!1;for(let _=0,y=e.length;_<y;_++){let v=e[_];for(let C=0,E=v.length,S=E-1;C<E;S=C++){let R=v[S],O=v[C];if(Vs(t,R,O))return i;(d=R)[1]>(s=t)[1]!=(p=O)[1]>s[1]&&s[0]<(p[0]-d[0])*(s[1]-d[1])/(p[1]-d[1])+d[0]&&(o=!o)}}var s,d,p;return o}function Gc(t,e,i,o){let s=o[0]-i[0],d=o[1]-i[1],p=(t[0]-i[0])*d-s*(t[1]-i[1]),_=(e[0]-i[0])*d-s*(e[1]-i[1]);return p>0&&_<0||p<0&&_>0}function $a(t,e,i,o){return(s=[o[0]-i[0],o[1]-i[1]])[0]*(d=[e[0]-t[0],e[1]-t[1]])[1]-s[1]*d[0]!=0&&!(!Gc(t,e,i,o)||!Gc(i,o,t,e));var s,d}let Do=8192;function Al(t,e){let i=(180+t[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,s=Math.pow(2,e.z);return[Math.round(i*s*Do),Math.round(o*s*Do)]}function Pd(t,e){for(let i=0;i<e.length;i++)if(js(t,e[i]))return!0;return!1}function Od(t,e,i){for(let o of i)for(let s=0,d=o.length,p=d-1;s<d;p=s++)if($a(t,e,o[p],o[s]))return!0;return!1}function ko(t,e){for(let i=0;i<t.length;++i)if(!js(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Od(t[i],t[i+1],e))return!1;return!0}function Dl(t,e){for(let i=0;i<e.length;i++)if(ko(t,e[i]))return!0;return!1}function dc(t,e,i){let o=[];for(let s=0;s<t.length;s++){let d=[];for(let p=0;p<t[s].length;p++){let _=Al(t[s][p],i);ps(e,_),d.push(_)}o.push(d)}return o}function uc(t,e,i){let o=[];for(let s=0;s<t.length;s++){let d=dc(t[s],e,i);o.push(d)}return o}function hc(t,e,i,o){if(t[0]<i[0]||t[0]>i[2]){let s=.5*o,d=t[0]-i[0]>s?-o:i[0]-t[0]>s?o:0;d===0&&(d=t[0]-i[2]>s?-o:i[2]-t[0]>s?o:0),t[0]+=d}ps(e,t)}function Us(t,e,i,o){let s=Math.pow(2,o.z)*Do,d=[o.x*Do,o.y*Do],p=[];if(!t)return p;for(let _ of t)for(let y of _){let v=[y.x+d[0],y.y+d[1]];hc(v,e,i,s),p.push(v)}return p}function Fd(t,e,i,o){let s=Math.pow(2,o.z)*Do,d=[o.x*Do,o.y*Do],p=[];if(!t)return p;for(let y of t){let v=[];for(let C of y){let E=[C.x+d[0],C.y+d[1]];ps(e,E),v.push(E)}p.push(v)}if(e[2]-e[0]<=s/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(let y of p)for(let v of y)hc(v,e,i,s)}var _;return p}class kl{constructor(e,i){this.type=ge,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(zn(e[1])){let o=e[1];if(o.type==="FeatureCollection")for(let s=0;s<o.features.length;++s){let d=o.features[s].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new kl(o,o.features[s].geometry)}else if(o.type==="Feature"){let s=o.geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new kl(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new kl(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){let s=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(o.type==="Polygon"){let _=dc(o.coordinates,d,p),y=Us(i.geometry(),s,d,p);if(!Ha(s,d))return!1;for(let v of y)if(!js(v,_))return!1}if(o.type==="MultiPolygon"){let _=uc(o.coordinates,d,p),y=Us(i.geometry(),s,d,p);if(!Ha(s,d))return!1;for(let v of y)if(!Pd(v,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){let s=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(o.type==="Polygon"){let _=dc(o.coordinates,d,p),y=Fd(i.geometry(),s,d,p);if(!Ha(s,d))return!1;for(let v of y)if(!ko(v,_))return!1}if(o.type==="MultiPolygon"){let _=uc(o.coordinates,d,p),y=Fd(i.geometry(),s,d,p);if(!Ha(s,d))return!1;for(let v of y)if(!Dl(v,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Hc=kl,pc={exports:{}};pc.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,i=e*(2-e),o=Math.PI/180,s=function(v,C){if(v===void 0)throw new Error("No latitude given.");if(C&&!t[C])throw new Error("Unknown unit "+C+". Use one of: "+Object.keys(t).join(", "));var E=6378.137*o*(C?t[C]:1),S=Math.cos(v*o),R=1/(1-i*(1-S*S)),O=Math.sqrt(R);this.kx=E*O*S,this.ky=E*O*R*(1-i)},d={units:{configurable:!0}};function p(v,C){return v[0]===C[0]&&v[1]===C[1]}function _(v,C,E){var S=y(C[0]-v[0]);return[v[0]+S*E,v[1]+(C[1]-v[1])*E]}function y(v){for(;v<-180;)v+=360;for(;v>180;)v-=360;return v}return s.fromTile=function(v,C,E){var S=Math.PI*(1-2*(v+.5)/Math.pow(2,C)),R=Math.atan(.5*(Math.exp(S)-Math.exp(-S)))/o;return new s(R,E)},d.units.get=function(){return t},s.prototype.distance=function(v,C){var E=y(v[0]-C[0])*this.kx,S=(v[1]-C[1])*this.ky;return Math.sqrt(E*E+S*S)},s.prototype.bearing=function(v,C){var E=y(C[0]-v[0])*this.kx;return Math.atan2(E,(C[1]-v[1])*this.ky)/o},s.prototype.destination=function(v,C,E){var S=E*o;return this.offset(v,Math.sin(S)*C,Math.cos(S)*C)},s.prototype.offset=function(v,C,E){return[v[0]+C/this.kx,v[1]+E/this.ky]},s.prototype.lineDistance=function(v){for(var C=0,E=0;E<v.length-1;E++)C+=this.distance(v[E],v[E+1]);return C},s.prototype.area=function(v){for(var C=0,E=0;E<v.length;E++)for(var S=v[E],R=0,O=S.length,F=O-1;R<O;F=R++)C+=y(S[R][0]-S[F][0])*(S[R][1]+S[F][1])*(E?-1:1);return Math.abs(C)/2*this.kx*this.ky},s.prototype.along=function(v,C){var E=0;if(C<=0)return v[0];for(var S=0;S<v.length-1;S++){var R=v[S],O=v[S+1],F=this.distance(R,O);if((E+=F)>C)return _(R,O,(C-(E-F))/F)}return v[v.length-1]},s.prototype.pointToSegmentDistance=function(v,C,E){var S=C[0],R=C[1],O=y(E[0]-S)*this.kx,F=(E[1]-R)*this.ky,V=0;return O===0&&F===0||((V=(y(v[0]-S)*this.kx*O+(v[1]-R)*this.ky*F)/(O*O+F*F))>1?(S=E[0],R=E[1]):V>0&&(S+=O/this.kx*V,R+=F/this.ky*V)),O=y(v[0]-S)*this.kx,F=(v[1]-R)*this.ky,Math.sqrt(O*O+F*F)},s.prototype.pointOnLine=function(v,C){for(var E,S,R,O,F=1/0,V=0;V<v.length-1;V++){var U=v[V][0],Z=v[V][1],Q=y(v[V+1][0]-U)*this.kx,K=(v[V+1][1]-Z)*this.ky,se=0;Q===0&&K===0||((se=(y(C[0]-U)*this.kx*Q+(C[1]-Z)*this.ky*K)/(Q*Q+K*K))>1?(U=v[V+1][0],Z=v[V+1][1]):se>0&&(U+=Q/this.kx*se,Z+=K/this.ky*se));var oe=(Q=y(C[0]-U)*this.kx)*Q+(K=(C[1]-Z)*this.ky)*K;oe<F&&(F=oe,E=U,S=Z,R=V,O=se)}return{point:[E,S],index:R,t:Math.max(0,Math.min(1,O))}},s.prototype.lineSlice=function(v,C,E){var S=this.pointOnLine(E,v),R=this.pointOnLine(E,C);if(S.index>R.index||S.index===R.index&&S.t>R.t){var O=S;S=R,R=O}var F=[S.point],V=S.index+1,U=R.index;!p(E[V],F[0])&&V<=U&&F.push(E[V]);for(var Z=V+1;Z<=U;Z++)F.push(E[Z]);return p(E[U],R.point)||F.push(R.point),F},s.prototype.lineSliceAlong=function(v,C,E){for(var S=0,R=[],O=0;O<E.length-1;O++){var F=E[O],V=E[O+1],U=this.distance(F,V);if((S+=U)>v&&R.length===0&&R.push(_(F,V,(v-(S-U))/U)),S>=C)return R.push(_(F,V,(C-(S-U))/U)),R;S>v&&R.push(V)}return R},s.prototype.bufferPoint=function(v,C){var E=C/this.ky,S=C/this.kx;return[v[0]-S,v[1]-E,v[0]+S,v[1]+E]},s.prototype.bufferBBox=function(v,C){var E=C/this.ky,S=C/this.kx;return[v[0]-S,v[1]-E,v[2]+S,v[3]+E]},s.prototype.insideBBox=function(v,C){return y(v[0]-C[0])>=0&&y(v[0]-C[2])<=0&&v[1]>=C[1]&&v[1]<=C[3]},Object.defineProperties(s,d),s}();var ms=vi(pc.exports),$c={exports:{}};$c.exports=function(){var t=function(i,o){if(i===void 0&&(i=[]),o===void 0&&(o=e),this.data=i,this.length=this.data.length,this.compare=o,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function e(i,o){return i<o?-1:i>o?1:0}return t.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var i=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),i}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(i){for(var o=this.data,s=this.compare,d=o[i];i>0;){var p=i-1>>1,_=o[p];if(s(d,_)>=0)break;o[i]=_,i=p}o[i]=d},t.prototype._down=function(i){for(var o=this.data,s=this.compare,d=this.length>>1,p=o[i];i<d;){var _=1+(i<<1),y=o[_],v=_+1;if(v<this.length&&s(o[v],y)<0&&(_=v,y=o[v]),s(y,p)>=0)break;o[i]=y,i=_}o[i]=p},t}();var Ro=vi($c.exports),mt=8192;function ta(t,e){return e.dist-t.dist}let qa=100,fs=50;function Ra(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function gs(t){return t[1]-t[0]+1}function Po(t,e){let i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Gs(t,e){if(t[0]>t[1])return[null,null];let i=gs(t);if(e){if(i===2)return[t,null];let o=Math.floor(i/2);return[[t[0],t[0]+o],[t[0]+o,t[1]]]}{if(i===1)return[t,null];let o=Math.floor(i/2)-1;return[[t[0],t[0]+o],[t[0]+o+1,t[1]]]}}function _s(t,e){let i=[1/0,1/0,-1/0,-1/0];if(!Po(e,t.length))return i;for(let o=e[0];o<=e[1];++o)ps(i,t[o]);return i}function mc(t){let e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let o=0;o<t[i].length;++o)ps(e,t[i][o]);return e}function Hs(t,e,i){if(Ra(t)||Ra(e))return NaN;let o=0,s=0;return t[2]<e[0]&&(o=e[0]-t[2]),t[0]>e[2]&&(o=t[0]-e[2]),t[1]>e[3]&&(s=t[1]-e[3]),t[3]<e[1]&&(s=e[1]-t[3]),i.distance([0,0],[o,s])}function Ld(t){return 360*t-180}function th(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function $s(t,e){let i=Math.pow(2,e.z),o=(t.y/mt+e.y)/i;return[Ld((t.x/mt+e.x)/i),th(o)]}function qc(t,e){let i=[];for(let o=0;o<t.length;++o)i.push($s(t[o],e));return i}function qs(t,e,i){let o=i.pointOnLine(e,t).point;return i.distance(t,o)}function ih(t,e,i,o,s){let d=i.slice(o[0],o[1]+1),p=1/0;for(let _=e[0];_<=e[1];++_)if((p=Math.min(p,qs(t[_],d,s)))===0)return 0;return p}function Pa(t,e,i,o,s){let d=Math.min(s.pointToSegmentDistance(t,i,o),s.pointToSegmentDistance(e,i,o)),p=Math.min(s.pointToSegmentDistance(i,t,e),s.pointToSegmentDistance(o,t,e));return Math.min(d,p)}function Mp(t,e,i,o,s){if(!Po(e,t.length)||!Po(o,i.length))return NaN;let d=1/0;for(let p=e[0];p<e[1];++p)for(let _=o[0];_<o[1];++_){if($a(t[p],t[p+1],i[_],i[_+1]))return 0;d=Math.min(d,Pa(t[p],t[p+1],i[_],i[_+1],s))}return d}function Ws(t,e,i,o,s){if(!Po(e,t.length)||!Po(o,i.length))return NaN;let d=1/0;for(let p=e[0];p<=e[1];++p)for(let _=o[0];_<=o[1];++_)if((d=Math.min(d,s.distance(t[p],i[_])))===0)return d;return d}function nh(t,e,i){if(js(t,e,!0))return 0;let o=1/0;for(let s of e){let d=s.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(s[0]!==s[d-1]&&(o=Math.min(o,i.pointToSegmentDistance(t,s[d-1],s[0])))===0||(o=Math.min(o,qs(t,s,i)))===0)return o}return o}function rh(t,e,i,o){if(!Po(e,t.length))return NaN;for(let d=e[0];d<=e[1];++d)if(js(t[d],i,!0))return 0;let s=1/0;for(let d=e[0];d<e[1];++d)for(let p of i)for(let _=0,y=p.length,v=y-1;_<y;v=_++){if($a(t[d],t[d+1],p[v],p[_]))return 0;s=Math.min(s,Pa(t[d],t[d+1],p[v],p[_],o))}return s}function bs(t,e){for(let i of t)for(let o=0;o<=i.length-1;++o)if(js(i[o],e,!0))return!0;return!1}function zd(t,e,i,o=1/0){let s=mc(t),d=mc(e);if(o!==1/0&&Hs(s,d,i)>=o)return o;if(Ha(s,d)){if(bs(t,e))return 0}else if(bs(e,t))return 0;let p=o;for(let _ of t)for(let y=0,v=_.length,C=v-1;y<v;C=y++)for(let E of e)for(let S=0,R=E.length,O=R-1;S<R;O=S++){if($a(_[C],_[y],E[O],E[S]))return 0;p=Math.min(p,Pa(_[C],_[y],E[O],E[S],i))}return p}function fc(t,e,i,o,s,d,p){if(d===null||p===null)return;let _=Hs(_s(o,d),_s(s,p),i);_<e&&t.push({dist:_,range1:d,range2:p})}function Wc(t,e,i,o,s=1/0){let d=Math.min(o.distance(t[0],i[0][0]),s);if(d===0)return d;let p=new Ro([{dist:0,range1:[0,t.length-1],range2:[0,0]}],ta),_=e?fs:qa,y=mc(i);for(;p.length;){let v=p.pop();if(v.dist>=d)continue;let C=v.range1;if(gs(C)<=_){if(!Po(C,t.length))return NaN;if(e){let E=rh(t,C,i,o);if((d=Math.min(d,E))===0)return d}else for(let E=C[0];E<=C[1];++E){let S=nh(t[E],i,o);if((d=Math.min(d,S))===0)return d}}else{let E=Gs(C,e);if(E[0]!==null){let S=Hs(_s(t,E[0]),y,o);S<d&&p.push({dist:S,range1:E[0],range2:[0,0]})}if(E[1]!==null){let S=Hs(_s(t,E[1]),y,o);S<d&&p.push({dist:S,range1:E[1],range2:[0,0]})}}}return d}function Nd(t,e,i,o,s,d=1/0){let p=Math.min(d,s.distance(t[0],i[0]));if(p===0)return p;let _=new Ro([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],ta),y=e?fs:qa,v=o?fs:qa;for(;_.length;){let C=_.pop();if(C.dist>=p)continue;let E=C.range1,S=C.range2;if(gs(E)<=y&&gs(S)<=v){if(!Po(E,t.length)||!Po(S,i.length))return NaN;if(e&&o?p=Math.min(p,Mp(t,E,i,S,s)):e||o?e&&!o?p=Math.min(p,ih(i,S,t,E,s)):!e&&o&&(p=Math.min(p,ih(t,E,i,S,s))):p=Math.min(p,Ws(t,E,i,S,s)),p===0)return p}else{let R=Gs(E,e),O=Gs(S,o);fc(_,p,s,t,i,R[0],O[0]),fc(_,p,s,t,i,R[0],O[1]),fc(_,p,s,t,i,R[1],O[0]),fc(_,p,s,t,i,R[1],O[1])}}return p}function Zs(t,e,i,o,s=1/0){let d=s,p=_s(t,[0,t.length-1]);for(let _ of i)if(!(d!==1/0&&Hs(p,_s(_,[0,_.length-1]),o)>=d)&&(d=Math.min(d,Nd(t,e,_,!0,o,d)),d===0))return d;return d}function gc(t,e,i,o,s=1/0){let d=s,p=_s(t,[0,t.length-1]);for(let _ of i){if(d!==1/0&&Hs(p,mc(_),o)>=d)continue;let y=Wc(t,e,_,o,d);if(isNaN(y))return y;if((d=Math.min(d,y))===0)return d}return d}function Bd(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Me{constructor(e,i){this.type=re,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(zn(e[1])){let o=e[1];if(o.type==="FeatureCollection"){for(let s=0;s<o.features.length;++s)if(Bd(o.features[s].geometry.type))return new Me(o,o.features[s].geometry)}else if(o.type==="Feature"){if(Bd(o.geometry.type))return new Me(o,o.geometry)}else if(Bd(o.type))return new Me(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(s,d,p){let _=[];for(let v of s)for(let C of v)_.push($s(C,d));let y=new ms(_[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?Nd(_,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",y):p.type==="MultiLineString"?Zs(_,!1,p.coordinates,y):p.type==="Polygon"||p.type==="MultiPolygon"?gc(_,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,y):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(s,d,p){let _=[];for(let v of s){let C=[];for(let E of v)C.push($s(E,d));_.push(C)}let y=new ms(_[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Zs(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",_,y);if(p.type==="MultiLineString"){let v=1/0;for(let C=0;C<p.coordinates.length;C++){let E=Zs(p.coordinates[C],!0,_,y,v);if(isNaN(E))return E;if((v=Math.min(v,E))===0)return v}return v}if(p.type==="Polygon"||p.type==="MultiPolygon"){let v=1/0;for(let C=0;C<_.length;C++){let E=gc(_[C],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,y,v);if(isNaN(E))return E;if((v=Math.min(v,E))===0)return v}return v}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(s,d,p){let _=[];for(let v of function(C,E){let S=C.length;if(S<=1)return[C];let R=[],O,F;for(let V=0;V<S;V++){let U=eh(C[V]);U!==0&&(C[V].area=Math.abs(U),F===void 0&&(F=U<0),F===U<0?(O&&R.push(O),O=[C[V]]):O.push(C[V]))}return O&&R.push(O),R}(s)){let C=[];for(let E=0;E<v.length;++E)C.push(qc(v[E],d));_.push(C)}let y=new ms(_[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return gc(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",_,y);if(p.type==="MultiLineString"){let v=1/0;for(let C=0;C<p.coordinates.length;C++){let E=gc(p.coordinates[C],!0,_,y,v);if(isNaN(E))return E;if((v=Math.min(v,E))===0)return v}return v}return p.type==="Polygon"||p.type==="MultiPolygon"?function(v,C,E){let S=1/0;for(let R of v)for(let O of C){let F=zd(R,O,E,S);if(isNaN(F))return F;if((S=Math.min(S,F))===0)return S}return S}(p.type==="Polygon"?[p.coordinates]:p.coordinates,_,y):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var We=Me;function Lt(t,e){switch(t){case"string":return Jo(e);case"number":return+e;case"boolean":return!!e;case"color":return hr.parse(e);case"formatted":return _n.fromString(Jo(e));case"resolvedImage":return qt.fromString(Jo(e))}return e}function si(t,e,i,o){return o!==void 0&&(t=o*Math.round(t/o)),e!==void 0&&t<e&&(t=e),i!==void 0&&t>i&&(t=i),t}class Hn{constructor(e,i,o){this.type=e,this.key=i,this.scope=o}static parse(e,i){let o=i.expectedType;if(o==null&&(o=Ze),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");let s=i.parse(e[1],1);if(!(s instanceof Aa))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let d=i.parse(e[2],2);return d instanceof Aa?new Hn(o,Jo(s.value),Jo(d.value)):i.error("Scope of 'config' expression must be a string literal.")}return new Hn(o,Jo(s.value))}evaluate(e){let i=[this.key,this.scope,e.scope].filter(Boolean).join(""),o=e.getConfig(i);if(!o)return null;let{type:s,value:d,values:p,minValue:_,maxValue:y,stepValue:v}=o,C=o.default.evaluate(e),E=C;if(d){let S=e.scope;e.scope=(S||"").split("").slice(1).join(""),E=d.evaluate(e),e.scope=S}return s&&(E=Lt(s,E)),E===void 0||_===void 0&&y===void 0&&v===void 0||(typeof E=="number"?E=si(E,_,y,v):Array.isArray(E)&&(E=E.map(S=>typeof S=="number"?si(S,_,y,v):S))),d!==void 0&&E!==void 0&&p&&!p.includes(E)&&(E=C,s&&(E=Lt(s,E))),(s&&s!==this.type||E!==void 0&&Ir(E)!==this.type)&&(E=Lt(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}var an=Hn;function Kn(t){if(t instanceof Di&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Hc||t instanceof We)return!1;let e=!0;return t.eachChild(i=>{e&&!Kn(i)&&(e=!1)}),e}function _r(t){if(t instanceof Di&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!_r(i)&&(e=!1)}),e}function Io(t){if(t instanceof an)return!1;let e=!0;return t.eachChild(i=>{e&&!Io(i)&&(e=!1)}),e}function wn(t,e){if(t instanceof Di&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(o=>{i&&!wn(o,e)&&(i=!1)}),i}class ir{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");let o=e[1];return i.scope.has(o)?new ir(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var br=ir;class ba{constructor(e,i=[],o,s=new N,d=[],p,_){this.registry=e,this.path=i,this.key=i.map(y=>`[${y}]`).join(""),this.scope=s,this.errors=d,this.expectedType=o,this._scope=p,this.options=_}parse(e,i,o,s,d={}){return i||o?this.concat(i,o,s)._parse(e,d):this._parse(e,d)}_parse(e,i){function o(s,d,p){return p==="assert"?new Da(d,[s]):p==="coerce"?new ka(d,[s]):s}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let s=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(s){let d=s.parse(e,this);if(!d)return null;if(this.expectedType){let p=this.expectedType,_=d.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||_.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(p,_))return null}else d=o(d,p,i.typeAnnotation||"coerce");else d=o(d,p,i.typeAnnotation||"assert")}if(!(d instanceof Aa)&&d.type.kind!=="resolvedImage"&&ya(d)){let p=new Qu(this._scope,this.options);try{d=new Aa(d.type,d.evaluate(p))}catch(_){return this.error(_.message),null}}return d}return ka.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o){let s=typeof e=="number"?this.path.concat(e):this.path,d=o?this.scope.concat(o):this.scope;return new ba(this.registry,s,i||null,d,this.errors,this._scope,this.options)}error(e,...i){let o=`${this.key}${i.map(s=>`[${s}]`).join("")}`;this.errors.push(new Vo(o,e))}checkSubtype(e,i){let o=tr(e,i);return o&&this.error(o),o}}var go=ba;function ya(t){if(t instanceof br)return ya(t.boundExpression);if(t instanceof Di&&t.name==="error"||t instanceof Ml||t instanceof Hc||t instanceof We||t instanceof an)return!1;let e=t instanceof ka||t instanceof Da,i=!0;return t.eachChild(o=>{i=e?i&&ya(o):i&&o instanceof Aa}),!!i&&Kn(t)&&wn(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function ia(t,e){let i=t.length-1,o,s,d=0,p=i,_=0;for(;d<=p;)if(_=Math.floor((d+p)/2),o=t[_],s=t[_+1],o<=e){if(_===i||e<s)return _;d=_+1}else{if(!(o>e))throw new Sr("Input is not a number.");p=_-1}return 0}class Ys{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(let[s,d]of o)this.labels.push(s),this.outputs.push(d)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");let o=i.parse(e[1],1,re);if(!o)return null;let s=[],d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let p=1;p<e.length;p+=2){let _=p===1?-1/0:e[p],y=e[p+1],v=p,C=p+1;if(typeof _!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(s.length&&s[s.length-1][0]>=_)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);let E=i.parse(y,C,d);if(!E)return null;d=d||E.type,s.push([_,E])}return new Ys(d,o,s)}evaluate(e){let i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);let s=this.input.evaluate(e);if(s<=i[0])return o[0].evaluate(e);let d=i.length;return s>=i[d-1]?o[d-1].evaluate(e):o[ia(i,s)].evaluate(e)}eachChild(e){e(this.input);for(let i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Oa=Ys;let Rl=.95047,Wa=1.08883,oh=4/29,Pl=6/29,$n=3*Pl*Pl,Vn=Pl*Pl*Pl,Zc=Math.PI/180,Xr=180/Math.PI;function Ol(t){return t>Vn?Math.pow(t,1/3):t/$n+oh}function So(t){return t>Pl?t*t*t:$n*(t-oh)}function na(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function va(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Xs(t){let e=va(t.r),i=va(t.g),o=va(t.b),s=Ol((.4124564*e+.3575761*i+.1804375*o)/Rl),d=Ol((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*d-16,a:500*(s-d),b:200*(d-Ol((.0193339*e+.119192*i+.9503041*o)/Wa)),alpha:t.a}}function Fl(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,o=isNaN(t.b)?e:e-t.b/200;return e=1*So(e),i=Rl*So(i),o=Wa*So(o),new hr(na(3.2404542*i-1.5371385*e-.4985314*o),na(-.969266*i+1.8760108*e+.041556*o),na(.0556434*i-.2040259*e+1.0572252*o),t.alpha)}function Ks(t,e,i){let o=e-t;return t+i*(o>180||o<-180?o-360*Math.round(o/360):o)}let ra={forward:Xs,reverse:Fl,interpolate:function(t,e,i){return{l:Ai(t.l,e.l,i),a:Ai(t.a,e.a,i),b:Ai(t.b,e.b,i),alpha:Ai(t.alpha,e.alpha,i)}}},Qs={forward:function(t){let{l:e,a:i,b:o}=Xs(t),s=Math.atan2(o,i)*Xr;return{h:s<0?s+360:s,c:Math.sqrt(i*i+o*o),l:e,alpha:t.a}},reverse:function(t){let e=t.h*Zc,i=t.c;return Fl({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Ks(t.h,e.h,i),c:Ai(t.c,e.c,i),l:Ai(t.l,e.l,i),alpha:Ai(t.alpha,e.alpha,i)}}};var Ll=Object.freeze({__proto__:null,hcl:Qs,lab:ra});class Js{constructor(e,i,o,s,d){this.type=e,this.operator=i,this.interpolation=o,this.input=s,this.labels=[],this.outputs=[];for(let[p,_]of d)this.labels.push(p),this.outputs.push(_)}static interpolationFactor(e,i,o,s){let d=0;if(e.name==="exponential")d=Za(i,e.base,o,s);else if(e.name==="linear")d=Za(i,1,o,s);else if(e.name==="cubic-bezier"){let p=e.controlPoints;d=new Wo(p[0],p[1],p[2],p[3]).solve(Za(i,1,o,s))}return d}static parse(e,i){let[o,s,d,...p]=e;if(!Array.isArray(s)||s.length===0)return i.error("Expected an interpolation type expression.",1);if(s[0]==="linear")s={name:"linear"};else if(s[0]==="exponential"){let v=s[1];if(typeof v!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);s={name:"exponential",base:v}}else{if(s[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(s[0])}`,1,0);{let v=s.slice(1);if(v.length!==4||v.some(C=>typeof C!="number"||C<0||C>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);s={name:"cubic-bezier",controlPoints:v}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,re),!d)return null;let _=[],y=null;o==="interpolate-hcl"||o==="interpolate-lab"?y=Ee:i.expectedType&&i.expectedType.kind!=="value"&&(y=i.expectedType);for(let v=0;v<p.length;v+=2){let C=p[v],E=p[v+1],S=v+3,R=v+4;if(typeof C!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(_.length&&_[_.length-1][0]>=C)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',S);let O=i.parse(E,R,y);if(!O)return null;y=y||O.type,_.push([C,O])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Js(y,o,s,d,_):i.error(`Type ${ji(y)} is not interpolatable.`)}evaluate(e){let i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);let s=this.input.evaluate(e);if(s<=i[0])return o[0].evaluate(e);let d=i.length;if(s>=i[d-1])return o[d-1].evaluate(e);let p=ia(i,s),_=Js.interpolationFactor(this.interpolation,s,i[p],i[p+1]),y=o[p].evaluate(e),v=o[p+1].evaluate(e);return this.operator==="interpolate"?jc[this.type.kind.toLowerCase()](y,v,_):this.operator==="interpolate-hcl"?Qs.reverse(Qs.interpolate(Qs.forward(y),Qs.forward(v),_)):ra.reverse(ra.interpolate(ra.forward(y),ra.forward(v),_))}eachChild(e){e(this.input);for(let i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function Za(t,e,i,o){let s=o-i,d=t-i;return s===0?0:e===1?d/s:(Math.pow(e,d)-1)/(Math.pow(e,s)-1)}var _o=Js;class el{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null,s=i.expectedType;s&&s.kind!=="value"&&(o=s);let d=[];for(let _ of e.slice(1)){let y=i.parse(_,1+d.length,o,void 0,{typeAnnotation:"omit"});if(!y)return null;o=o||y.type,d.push(y)}let p=s&&d.some(_=>tr(s,_.type));return new el(p?Ze:o,d)}evaluate(e){let i,o=null,s=0;for(let d of this.args){if(s++,o=d.evaluate(e),o&&o instanceof qt&&!o.available&&(i||(i=o),o=null,s===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var zl=el;class tl{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let o=[];for(let d=1;d<e.length-1;d+=2){let p=e[d];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);let _=i.parse(e[d+1],d+1);if(!_)return null;o.push([p,_])}let s=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return s?new tl(o,s):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}var Ap=tl;class Nl{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=i.parse(e[1],1,re),s=i.parse(e[2],2,oi(i.expectedType||Ze));return o&&s?new Nl(s.type.itemType,o,s):null}evaluate(e){let i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Sr(`Array index out of bounds: ${i} < 0.`);if(i>=o.length)throw new Sr(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i!==Math.floor(i))throw new Sr(`Array index must be an integer, but found ${i} instead.`);return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var qi=Nl;class Dp{constructor(e,i){this.type=ge,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let o=i.parse(e[1],1,Ze),s=i.parse(e[2],2,Ze);return o&&s?ke(o.type,[ge,pe,re,J,Ze])?new Dp(o,s):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ji(o.type)} instead`):null}evaluate(e){let i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!Kt(i,["boolean","string","number","null"]))throw new Sr(`Expected first argument to be of type boolean, string, number or null, but found ${ji(Ir(i))} instead.`);if(!Kt(o,["string","array"]))throw new Sr(`Expected second argument to be of type array or string, but found ${ji(Ir(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Jb=Dp;class ah{constructor(e,i,o){this.type=re,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=i.parse(e[1],1,Ze),s=i.parse(e[2],2,Ze);if(!o||!s)return null;if(!ke(o.type,[ge,pe,re,J,Ze]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ji(o.type)} instead`);if(e.length===4){let d=i.parse(e[3],3,re);return d?new ah(o,s,d):null}return new ah(o,s)}evaluate(e){let i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!Kt(i,["boolean","string","number","null"]))throw new Sr(`Expected first argument to be of type boolean, string, number or null, but found ${ji(Ir(i))} instead.`);if(!Kt(o,["string","array"]))throw new Sr(`Expected second argument to be of type array or string, but found ${ji(Ir(o))} instead.`);if(this.fromIndex){let s=this.fromIndex.evaluate(e);return o.indexOf(i,s)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ig=ah;class kp{constructor(e,i,o,s,d,p){this.inputType=e,this.type=i,this.input=o,this.cases=s,this.outputs=d,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);let d={},p=[];for(let v=2;v<e.length-1;v+=2){let C=e[v],E=e[v+1];Array.isArray(C)||(C=[C]);let S=i.concat(v);if(C.length===0)return S.error("Expected at least one branch label.");for(let O of C){if(typeof O!="number"&&typeof O!="string")return S.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return S.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return S.error("Numeric branch labels must be integer values.");if(o){if(S.checkSubtype(o,Ir(O)))return null}else o=Ir(O);if(d[String(O)]!==void 0)return S.error("Branch labels must be unique.");d[String(O)]=p.length}let R=i.parse(E,v,s);if(!R)return null;s=s||R.type,p.push(R)}let _=i.parse(e[1],1,Ze);if(!_)return null;let y=i.parse(e[e.length-1],e.length-1,s);return y?_.type.kind!=="value"&&i.concat(1).checkSubtype(o,_.type)?null:new kp(o,s,_,d,p,y):null}evaluate(e){let i=this.input.evaluate(e);return(Ir(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],s={};for(let p of i){let _=s[this.cases[p]];_===void 0?(s[this.cases[p]]=o.length,o.push([this.cases[p],[p]])):o[_][1].push(p)}let d=p=>this.inputType.kind==="number"?Number(p):p;for(let[p,_]of o)e.push(_.length===1?d(_[0]):_.map(d)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}var ng=kp;class sh{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);let s=[];for(let p=1;p<e.length-1;p+=2){let _=i.parse(e[p],p,ge);if(!_)return null;let y=i.parse(e[p+1],p+1,o);if(!y)return null;s.push([_,y]),o=o||y.type}let d=i.parse(e[e.length-1],e.length-1,o);return d?new sh(o,s,d):null}evaluate(e){for(let[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var rg=sh;class Vd{constructor(e,i,o,s){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let o=i.parse(e[1],1,Ze),s=i.parse(e[2],2,re);if(!o||!s)return null;if(!ke(o.type,[oi(Ze),pe,Ze]))return i.error(`Expected first argument to be of type array or string, but found ${ji(o.type)} instead`);if(e.length===4){let d=i.parse(e[3],3,re);return d?new Vd(o.type,o,s,d):null}return new Vd(o.type,o,s)}evaluate(e){let i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!Kt(i,["string","array"]))throw new Sr(`Expected first argument to be of type array or string, but found ${ji(Ir(i))} instead.`);if(this.endIndex){let s=this.endIndex.evaluate(e);return i.slice(o,s)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Yc=Vd;function Rp(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Pp(t,e,i,o){return o.compare(e,i)===0}function Xc(t,e,i){let o=t!=="=="&&t!=="!=";return class XI{constructor(d,p,_){this.type=ge,this.lhs=d,this.rhs=p,this.collator=_,this.hasUntypedArgument=d.type.kind==="value"||p.type.kind==="value"}static parse(d,p){if(d.length!==3&&d.length!==4)return p.error("Expected two or three arguments.");let _=d[0],y=p.parse(d[1],1,Ze);if(!y)return null;if(!Rp(_,y.type))return p.concat(1).error(`"${_}" comparisons are not supported for type '${ji(y.type)}'.`);let v=p.parse(d[2],2,Ze);if(!v)return null;if(!Rp(_,v.type))return p.concat(2).error(`"${_}" comparisons are not supported for type '${ji(v.type)}'.`);if(y.type.kind!==v.type.kind&&y.type.kind!=="value"&&v.type.kind!=="value")return p.error(`Cannot compare types '${ji(y.type)}' and '${ji(v.type)}'.`);o&&(y.type.kind==="value"&&v.type.kind!=="value"?y=new Da(v.type,[y]):y.type.kind!=="value"&&v.type.kind==="value"&&(v=new Da(y.type,[v])));let C=null;if(d.length===4){if(y.type.kind!=="string"&&v.type.kind!=="string"&&y.type.kind!=="value"&&v.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(C=p.parse(d[3],3,Vt),!C)return null}return new XI(y,v,C)}evaluate(d){let p=this.lhs.evaluate(d),_=this.rhs.evaluate(d);if(o&&this.hasUntypedArgument){let y=Ir(p),v=Ir(_);if(y.kind!==v.kind||y.kind!=="string"&&y.kind!=="number")throw new Sr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${v.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){let y=Ir(p),v=Ir(_);if(y.kind!=="string"||v.kind!=="string")return e(d,p,_)}return this.collator?i(d,p,_,this.collator.evaluate(d)):e(d,p,_)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){let d=[t];return this.eachChild(p=>{d.push(p.serialize())}),d}}}let Op=Xc("==",function(t,e,i){return e===i},Pp),Fp=Xc("!=",function(t,e,i){return e!==i},function(t,e,i,o){return!Pp(0,e,i,o)}),ey=Xc("<",function(t,e,i){return e<i},function(t,e,i,o){return o.compare(e,i)<0}),ty=Xc(">",function(t,e,i){return e>i},function(t,e,i,o){return o.compare(e,i)>0}),og=Xc("<=",function(t,e,i){return e<=i},function(t,e,i,o){return o.compare(e,i)<=0}),iy=Xc(">=",function(t,e,i){return e>=i},function(t,e,i,o){return o.compare(e,i)>=0});class Lp{constructor(e,i,o,s,d,p){this.type=pe,this.number=e,this.locale=i,this.currency=o,this.unit=s,this.minFractionDigits=d,this.maxFractionDigits=p}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");let o=i.parse(e[1],1,re);if(!o)return null;let s=e[2];if(typeof s!="object"||Array.isArray(s))return i.error("NumberFormat options argument must be an object.");let d=null;if(s.locale&&(d=i.parse(s.locale,1,pe),!d))return null;let p=null;if(s.currency&&(p=i.parse(s.currency,1,pe),!p))return null;let _=null;if(s.unit&&(_=i.parse(s.unit,1,pe),!_))return null;let y=null;if(s["min-fraction-digits"]&&(y=i.parse(s["min-fraction-digits"],1,re),!y))return null;let v=null;return s["max-fraction-digits"]&&(v=i.parse(s["max-fraction-digits"],1,re),!v)?null:new Lp(o,d,p,_,y,v)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class zp{constructor(e){this.type=re,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);let o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${ji(o.type)} instead.`):new zp(o):null}evaluate(e){let i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Sr(`Expected value to be of type string or array, but found ${ji(Ir(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function ag(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Np={"==":Op,"!=":Fp,">":ty,"<":ey,">=":iy,"<=":og,array:Da,at:qi,boolean:Da,case:rg,coalesce:zl,collator:Ml,format:zs,image:Ns,in:Jb,"index-of":ig,interpolate:_o,"interpolate-hcl":_o,"interpolate-lab":_o,length:zp,let:Ap,literal:Aa,match:ng,number:Da,"number-format":Lp,object:Da,slice:Yc,step:Oa,string:Da,"to-boolean":ka,"to-color":ka,"to-number":ka,"to-string":ka,var:br,within:Hc,distance:We,config:an};function Bp(t,[e,i,o,s]){e=e.evaluate(t),i=i.evaluate(t),o=o.evaluate(t);let d=s?s.evaluate(t):1,p=Ku(e,i,o,d);if(p)throw new Sr(p);return new hr(e/255*d,i/255*d,o/255*d,d)}function sg(t,[e,i,o,s]){e=e.evaluate(t),i=i.evaluate(t),o=o.evaluate(t);let d=s?s.evaluate(t):1,p=function(v,C,E,S){return typeof v=="number"&&v>=0&&v<=360?typeof C=="number"&&C>=0&&C<=100&&typeof E=="number"&&E>=0&&E<=100?S===void 0||typeof S=="number"&&S>=0&&S<=1?null:`Invalid hsla value [${[v,C,E,S].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof S=="number"?[v,C,E,S]:[v,C,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof S=="number"?[v,C,E,S]:[v,C,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,d);if(p)throw new Sr(p);let _=`hsla(${e}, ${i}%, ${o}%, ${d})`,y=hr.parse(_);if(!y)throw new Sr(`Failed to parse HSLA color: ${_}`);return y}function Vp(t,e){return t in e}function jp(t,e){let i=e[t];return i===void 0?null:i}function _c(t){return{type:t}}Di.register(Np,{error:[{kind:"error"},[pe],(t,[e])=>{throw new Sr(e.evaluate(t))}],typeof:[pe,[Ze],(t,[e])=>ji(Ir(e.evaluate(t)))],"to-rgba":[oi(re,4),[Ee],(t,[e])=>e.evaluate(t).toArray()],rgb:[Ee,[re,re,re],Bp],rgba:[Ee,[re,re,re,re],Bp],hsl:[Ee,[re,re,re],sg],hsla:[Ee,[re,re,re,re],sg],has:{type:ge,overloads:[[[pe],(t,[e])=>Vp(e.evaluate(t),t.properties())],[[pe,ft],(t,[e,i])=>Vp(e.evaluate(t),i.evaluate(t))]]},get:{type:Ze,overloads:[[[pe],(t,[e])=>jp(e.evaluate(t),t.properties())],[[pe,ft],(t,[e,i])=>jp(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Ze,[pe],(t,[e])=>jp(e.evaluate(t),t.featureState||{})],properties:[ft,[],t=>t.properties()],"geometry-type":[pe,[],t=>t.geometryType()],id:[Ze,[],t=>t.id()],zoom:[re,[],t=>t.globals.zoom],pitch:[re,[],t=>t.globals.pitch||0],"distance-from-center":[re,[],t=>t.distanceFromCenter()],"measure-light":[re,[pe],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[re,[],t=>t.globals.heatmapDensity||0],"line-progress":[re,[],t=>t.globals.lineProgress||0],"raster-value":[re,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[re,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[re,[],t=>t.globals.skyRadialProgress||0],accumulated:[Ze,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[re,_c(re),(t,e)=>{let i=0;for(let o of e)i+=o.evaluate(t);return i}],"*":[re,_c(re),(t,e)=>{let i=1;for(let o of e)i*=o.evaluate(t);return i}],"-":{type:re,overloads:[[[re,re],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[re],(t,[e])=>-e.evaluate(t)]]},"/":[re,[re,re],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[re,[re,re],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[re,[],()=>Math.LN2],pi:[re,[],()=>Math.PI],e:[re,[],()=>Math.E],"^":[re,[re,re],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[re,[re],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[re,[re],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[re,[re],(t,[e])=>Math.log(e.evaluate(t))],log2:[re,[re],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[re,[re],(t,[e])=>Math.sin(e.evaluate(t))],cos:[re,[re],(t,[e])=>Math.cos(e.evaluate(t))],tan:[re,[re],(t,[e])=>Math.tan(e.evaluate(t))],asin:[re,[re],(t,[e])=>Math.asin(e.evaluate(t))],acos:[re,[re],(t,[e])=>Math.acos(e.evaluate(t))],atan:[re,[re],(t,[e])=>Math.atan(e.evaluate(t))],min:[re,_c(re),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[re,_c(re),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[re,[re],(t,[e])=>Math.abs(e.evaluate(t))],round:[re,[re],(t,[e])=>{let i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[re,[re],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[re,[re],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ge,[pe,Ze],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[ge,[Ze],(t,[e])=>t.id()===e.value],"filter-type-==":[ge,[pe],(t,[e])=>t.geometryType()===e.value],"filter-<":[ge,[pe,Ze],(t,[e,i])=>{let o=t.properties()[e.value],s=i.value;return typeof o==typeof s&&o<s}],"filter-id-<":[ge,[Ze],(t,[e])=>{let i=t.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[ge,[pe,Ze],(t,[e,i])=>{let o=t.properties()[e.value],s=i.value;return typeof o==typeof s&&o>s}],"filter-id->":[ge,[Ze],(t,[e])=>{let i=t.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[ge,[pe,Ze],(t,[e,i])=>{let o=t.properties()[e.value],s=i.value;return typeof o==typeof s&&o<=s}],"filter-id-<=":[ge,[Ze],(t,[e])=>{let i=t.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[ge,[pe,Ze],(t,[e,i])=>{let o=t.properties()[e.value],s=i.value;return typeof o==typeof s&&o>=s}],"filter-id->=":[ge,[Ze],(t,[e])=>{let i=t.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[ge,[Ze],(t,[e])=>e.value in t.properties()],"filter-has-id":[ge,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[ge,[oi(pe)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ge,[oi(Ze)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ge,[pe,oi(Ze)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ge,[pe,oi(Ze)],(t,[e,i])=>function(o,s,d,p){for(;d<=p;){let _=d+p>>1;if(s[_]===o)return!0;s[_]>o?p=_-1:d=_+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ge,overloads:[[[ge,ge],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[_c(ge),(t,e)=>{for(let i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:ge,overloads:[[[ge,ge],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[_c(ge),(t,e)=>{for(let i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[ge,[ge],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ge,[pe],(t,[e])=>{let i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[pe,[pe],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[pe,[pe],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[pe,_c(Ze),(t,e)=>e.map(i=>Jo(i.evaluate(t))).join("")],"resolved-locale":[pe,[Vt],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[re,[re,re,Ze],(t,e)=>{let[i,o,s]=e.map(p=>p.evaluate(t));if(i>o||i===o)return i;let d;if(typeof s=="string")d=function(p){let _=0;if(p.length===0)return _;for(let y=0;y<p.length;y++)_=(_<<5)-_+p.charCodeAt(y),_|=0;return _}(s);else{if(typeof s!="number")throw new Sr(`Invalid seed input: ${s}`);d=s}return i+ag(d)()*(o-i)}]});var Kc=Np;function Up(t){return{result:"success",value:t}}function bc(t){return{result:"error",value:t}}function lg(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function lh(t){return t["property-type"]==="data-driven"}function Gp(t){return lg(t.expression,"measure-light")}function cg(t){return lg(t.expression,"zoom")}function Hp(t){return!!t.expression&&t.expression.interpolated}function ch(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function dg(t){return t}function $p(t,e){let i=e.type==="color",o=t.stops&&typeof t.stops[0][0]=="object",s=o||!(o||t.property!==void 0),d=t.type||(Hp(e)?"exponential":"interval");if(i&&((t=Rd({},t)).stops&&(t.stops=t.stops.map(v=>[v[0],hr.parse(v[1])])),t.default=hr.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Ll[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let p,_,y;if(d==="exponential")p=ug;else if(d==="interval")p=ry;else if(d==="categorical"){p=ny,_=Object.create(null);for(let v of t.stops)_[v[0]]=v[1];y=typeof t.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);p=hg}if(o){let v={},C=[];for(let R=0;R<t.stops.length;R++){let O=t.stops[R],F=O[0].zoom;v[F]===void 0&&(v[F]={zoom:F,type:t.type,property:t.property,default:t.default,stops:[]},C.push(F)),v[F].stops.push([O[0].value,O[1]])}let E=[];for(let R of C)E.push([v[R].zoom,$p(v[R],e)]);let S={name:"linear"};return{kind:"composite",interpolationType:S,interpolationFactor:_o.interpolationFactor.bind(void 0,S),zoomStops:E.map(R=>R[0]),evaluate:({zoom:R},O)=>ug({stops:E,base:t.base},e,R).evaluate(R,O)}}if(s){let v=d==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:v,interpolationFactor:_o.interpolationFactor.bind(void 0,v),zoomStops:t.stops.map(C=>C[0]),evaluate:({zoom:C})=>p(t,e,C,_,y)}}return{kind:"source",evaluate(v,C){let E=C&&C.properties?C.properties[t.property]:void 0;return E===void 0?jd(t.default,e.default):p(t,e,E,_,y)}}}function jd(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function ny(t,e,i,o,s){return jd(typeof i===s?o[i]:void 0,t.default,e.default)}function ry(t,e,i){if(Il(i)!=="number")return jd(t.default,e.default);let o=t.stops.length;if(o===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[o-1][0])return t.stops[o-1][1];let s=ia(t.stops.map(d=>d[0]),i);return t.stops[s][1]}function ug(t,e,i){let o=t.base!==void 0?t.base:1;if(Il(i)!=="number")return jd(t.default,e.default);let s=t.stops.length;if(s===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[s-1][0])return t.stops[s-1][1];let d=ia(t.stops.map(C=>C[0]),i),p=function(C,E,S,R){let O=R-S,F=C-S;return O===0?0:E===1?F/O:(Math.pow(E,F)-1)/(Math.pow(E,O)-1)}(i,o,t.stops[d][0],t.stops[d+1][0]),_=t.stops[d][1],y=t.stops[d+1][1],v=jc[e.type]||dg;if(t.colorSpace&&t.colorSpace!=="rgb"){let C=Ll[t.colorSpace];v=(E,S)=>C.reverse(C.interpolate(C.forward(E),C.forward(S),p))}return typeof _.evaluate=="function"?{evaluate(...C){let E=_.evaluate.apply(void 0,C),S=y.evaluate.apply(void 0,C);if(E!==void 0&&S!==void 0)return v(E,S,p)}}:v(_,y,p)}function hg(t,e,i){return e.type==="color"?i=hr.parse(i):e.type==="formatted"?i=_n.fromString(i.toString()):e.type==="resolvedImage"?i=qt.fromString(i.toString()):Il(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),jd(i,t.default,e.default)}class dh{constructor(e,i,o,s){this.expression=e,this._warningHistory={},this._evaluator=new Qu(o,s),this._defaultValue=i?function(d){return d.type==="color"&&(ch(d.default)||Array.isArray(d.default))?new hr(0,0,0,0):d.type==="color"?hr.parse(d.default)||null:d.default===void 0?null:d.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,o,s,d,p,_,y){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=s||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,s,d,p,_,y){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=s||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=y||null;try{let v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Sr(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Ud(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Kc}function uh(t,e,i,o){let s=new go(Kc,[],e?function(p){let _={color:Ee,string:pe,number:re,enum:pe,boolean:ge,formatted:zt,resolvedImage:Mt};return p.type==="array"?oi(_[p.value]||Ze,p.length):_[p.type]}(e):void 0,void 0,void 0,i,o),d=s.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Up(new dh(d,e,i,o)):bc(s.errors)}class qp{constructor(e,i,o){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isStateDependent=e!=="constant"&&!_r(i.expression),this.isConfigDependent=!Io(i.expression)}evaluateWithoutErrorHandling(e,i,o,s,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,s,d,p)}evaluate(e,i,o,s,d,p){return this._styleExpression.evaluate(e,i,o,s,d,p)}}class Gd{constructor(e,i,o,s,d){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!_r(i.expression),this.isLightConstant=d,this.isConfigDependent=!Io(i.expression),this.interpolationType=s}evaluateWithoutErrorHandling(e,i,o,s,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,s,d,p)}evaluate(e,i,o,s,d,p){return this._styleExpression.evaluate(e,i,o,s,d,p)}interpolationFactor(e,i,o){return this.interpolationType?_o.interpolationFactor(this.interpolationType,e,i,o):0}}function hh(t,e,i,o){if((t=uh(t,e,i,o)).result==="error")return t;let s=t.value.expression,d=Kn(s);if(!d&&!lh(e))return bc([new Vo("","data expressions not supported")]);let p=wn(s,["zoom","pitch","distance-from-center"]);if(!p&&!cg(e))return bc([new Vo("","zoom expressions not supported")]);let _=wn(s,["measure-light"]);if(!_&&!Gp(e))return bc([new Vo("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,v=$d(s);return v||p||y?v instanceof Vo?bc([v]):v instanceof _o&&!Hp(e)?bc([new Vo("",'"interpolate" expressions cannot be used with this property')]):Up(v?new Gd(d?"camera":"composite",t.value,v.labels,v instanceof _o?v.interpolation:void 0,_):new qp(d?"constant":"source",t.value,_)):bc([new Vo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Hd{constructor(e,i){this._parameters=e,this._specification=i,Rd(this,$p(this._parameters,this._specification))}static deserialize(e){return new Hd(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function $d(t){let e=null;if(t instanceof Ap)e=$d(t.result);else if(t instanceof zl){for(let i of t.args)if(e=$d(i),e)break}else(t instanceof Oa||t instanceof _o)&&t.input instanceof Di&&t.input.name==="zoom"&&(e=t);return e instanceof Vo||t.eachChild(i=>{let o=$d(i);o instanceof Vo?e=o:e&&o&&e!==o&&(e=new Vo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var oy=Xa,Ya=3;function Xa(t,e,i){var o=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var s=new Int32Array(this.arrayBuffer);t=s[0],this.d=(e=s[1])+2*(i=s[2]);for(var d=0;d<this.d*this.d;d++){var p=s[Ya+d],_=s[Ya+d+1];o.push(p===_?null:s.subarray(p,_))}var y=s[Ya+o.length+1];this.keys=s.subarray(s[Ya+o.length],y),this.bboxes=s.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var v=0;v<this.d*this.d;v++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var C=i/e*t;this.min=-C,this.max=t+C}Xa.prototype.insert=function(t,e,i,o,s){this._forEachCell(e,i,o,s,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(s)},Xa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Xa.prototype._insertCell=function(t,e,i,o,s,d){this.cells[s].push(d)},Xa.prototype.query=function(t,e,i,o,s){var d=this.min,p=this.max;if(t<=d&&e<=d&&p<=i&&p<=o&&!s)return Array.prototype.slice.call(this.keys);var _=[];return this._forEachCell(t,e,i,o,this._queryCell,_,{},s),_},Xa.prototype._queryCell=function(t,e,i,o,s,d,p,_){var y=this.cells[s];if(y!==null)for(var v=this.keys,C=this.bboxes,E=0;E<y.length;E++){var S=y[E];if(p[S]===void 0){var R=4*S;(_?_(C[R+0],C[R+1],C[R+2],C[R+3]):t<=C[R+2]&&e<=C[R+3]&&i>=C[R+0]&&o>=C[R+1])?(p[S]=!0,d.push(v[S])):p[S]=!1}}},Xa.prototype._forEachCell=function(t,e,i,o,s,d,p,_){for(var y=this._convertToCellCoord(t),v=this._convertToCellCoord(e),C=this._convertToCellCoord(i),E=this._convertToCellCoord(o),S=y;S<=C;S++)for(var R=v;R<=E;R++){var O=this.d*R+S;if((!_||_(this._convertFromCellCoord(S),this._convertFromCellCoord(R),this._convertFromCellCoord(S+1),this._convertFromCellCoord(R+1)))&&s.call(this,t,e,i,o,O,d,p,_))return}},Xa.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Xa.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Xa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Ya+this.cells.length+1+1,i=0,o=0;o<this.cells.length;o++)i+=this.cells[o].length;var s=new Int32Array(e+i+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;for(var d=e,p=0;p<t.length;p++){var _=t[p];s[Ya+p]=d,s.set(_,d),d+=_.length}return s[Ya+t.length]=d,s.set(this.keys,d),s[Ya+t.length+1]=d+=this.keys.length,s.set(this.bboxes,d),d+=this.bboxes.length,s.buffer};var il=vi(oy);let qd={};function Et(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),qd[e]={klass:t,omit:i.omit||[]}}Et(Object,"Object"),il.serialize=function(t,e){let i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},il.deserialize=function(t){return new il(t.buffer)},Object.defineProperty(il,"name",{value:"Grid"}),Et(il,"Grid"),Et(hr,"Color"),Et(Error,"Error"),Et(_n,"Formatted"),Et(Er,"FormattedSection"),Et(kr,"AJAXError"),Et(qt,"ResolvedImage"),Et(Hd,"StylePropertyFunction"),Et(dh,"StyleExpression",{omit:["_evaluator"]}),Et(Gd,"ZoomDependentExpression"),Et(qp,"ZoomConstantExpression"),Et(Di,"CompoundExpression",{omit:["_evaluate"]});for(let t in Kc)qd[Kc[t]._classRegistryKey]||Et(Kc[t],`Expression${t}`);function pg(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function ph(t){return self.ImageBitmap&&t instanceof ImageBitmap}function Bl(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(pg(t)||ph(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let i=t;return e&&e.add(i.buffer),i}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let i=[];for(let o of t)i.push(Bl(o,e));return i}if(t instanceof Map){let i={$name:"Map"};for(let[o,s]of t.entries())i[o]=Bl(s);return i}if(typeof t=="object"){let i=t.constructor,o=i._classRegistryKey;if(!o)throw new Error(`can't serialize object of unregistered class ${o}`);let s=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(let d in t)t.hasOwnProperty(d)&&(qd[o].omit.indexOf(d)>=0||(s[d]=Bl(t[d],e)));t instanceof Error&&(s.message=t.message)}if(s.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(s.$name=o),s}throw new Error("can't serialize object of type "+typeof t)}function yc(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||pg(t)||ph(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(yc);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let s=new Map;for(let d of Object.keys(t))d!=="$name"&&s.set(d,yc(t[d]));return s}let{klass:i}=qd[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);let o=Object.create(i.prototype);for(let s of Object.keys(t))s!=="$name"&&(o[s]=yc(t[s]));return o}throw new Error("can't deserialize object of type "+typeof t)}let Ot={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Vl(t){for(let e of t)if(Wp(e.charCodeAt(0)))return!0;return!1}function ay(t){for(let e of t)if(!sy(e.charCodeAt(0)))return!1;return!0}function sy(t){return!(Ot.Arabic(t)||Ot["Arabic Supplement"](t)||Ot["Arabic Extended-A"](t)||Ot["Arabic Presentation Forms-A"](t)||Ot["Arabic Presentation Forms-B"](t))}function Wp(t){return!(t!==746&&t!==747&&(t<4352||!(Ot["Bopomofo Extended"](t)||Ot.Bopomofo(t)||Ot["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Ot["CJK Compatibility Ideographs"](t)||Ot["CJK Compatibility"](t)||Ot["CJK Radicals Supplement"](t)||Ot["CJK Strokes"](t)||!(!Ot["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Ot["CJK Unified Ideographs Extension A"](t)||Ot["CJK Unified Ideographs"](t)||Ot["Enclosed CJK Letters and Months"](t)||Ot["Hangul Compatibility Jamo"](t)||Ot["Hangul Jamo Extended-A"](t)||Ot["Hangul Jamo Extended-B"](t)||Ot["Hangul Jamo"](t)||Ot["Hangul Syllables"](t)||Ot.Hiragana(t)||Ot["Ideographic Description Characters"](t)||Ot.Kanbun(t)||Ot["Kangxi Radicals"](t)||Ot["Katakana Phonetic Extensions"](t)||Ot.Katakana(t)&&t!==12540||!(!Ot["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Ot["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Ot["Unified Canadian Aboriginal Syllabics"](t)||Ot["Unified Canadian Aboriginal Syllabics Extended"](t)||Ot["Vertical Forms"](t)||Ot["Yijing Hexagram Symbols"](t)||Ot["Yi Syllables"](t)||Ot["Yi Radicals"](t))))}function mg(t){return!(Wp(t)||function(e){return!!(Ot["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ot["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ot["Letterlike Symbols"](e)||Ot["Number Forms"](e)||Ot["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ot["Control Pictures"](e)&&e!==9251||Ot["Optical Character Recognition"](e)||Ot["Enclosed Alphanumerics"](e)||Ot["Geometric Shapes"](e)||Ot["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ot["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ot["CJK Symbols and Punctuation"](e)||Ot.Katakana(e)||Ot["Private Use Area"](e)||Ot["CJK Compatibility Forms"](e)||Ot["Small Form Variants"](e)||Ot["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function fg(t){return t>=1424&&t<=2303||Ot["Arabic Presentation Forms-A"](t)||Ot["Arabic Presentation Forms-B"](t)}function gg(t,e){return!(!e&&fg(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Ot.Khmer(t))}function Zp(t){for(let e of t)if(fg(e.charCodeAt(0)))return!0;return!1}let Yp="deferred",Xp="loading",Kp="loaded",Qp=null,oa="unavailable",jl=null,_g=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(oa="error"),Qp&&Qp(t)};function Jp(){em.fire(new mo("pluginStateChange",{pluginStatus:oa,pluginURL:jl}))}let em=new Qo,Ul=function(){return oa},tm=function(){if(oa!==Yp||!jl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");oa=Xp,Jp(),jl&&Le({url:jl},t=>{t?_g(t):(oa=Kp,Jp())})},xa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>oa===Kp||xa.applyArabicShaping!=null,isLoading:()=>oa===Xp,setState(t){oa=t.pluginStatus,jl=t.pluginURL},isParsed:()=>xa.applyArabicShaping!=null&&xa.processBidirectionalText!=null&&xa.processStyledBidirectionalText!=null,getPluginURL:()=>jl};class nr{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(let s of i)if(!gg(s.charCodeAt(0),o))return!1;return!0}(e,xa.isLoaded())}}class mh{constructor(e,i,o,s){this.property=e,this.value=i,this.expression=function(d,p,_,y){if(ch(d))return new Hd(d,p);if(Ud(d)||Array.isArray(d)&&d.length>0){let v=hh(d,p,_,y);if(v.result==="error")throw new Error(v.value.map(C=>`${C.key}: ${C.message}`).join(", "));return v.value}{let v=d;return typeof d=="string"&&p.type==="color"&&(v=hr.parse(d)),{kind:"constant",isConfigDependent:!1,evaluate:()=>v}}}(i===void 0?e.specification.default:i,e.specification,o,s)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o){return this.property.possiblyEvaluate(this,e,i,o)}}class im{constructor(e,i,o){this.property=e,this.value=new mh(e,void 0,i,o)}transitioned(e,i){return new nm(this.property,this.value,i,Gr({},e.transition,this.transition),e.now)}untransitioned(){return new nm(this.property,this.value,null,{},0)}}class nl{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this.isConfigDependent=!1}getValue(e){return Ao(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new im(this._values[e].property,this._scope,this._options)),this._values[e].value=new mh(this._values[e].property,i===null?void 0:Ao(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,i){i&&(this._options=i);let o=this._properties.properties;if(e)for(let s in e){let d=e[s];if(Xo(s,"-transition")){let p=s.slice(0,-11);o[p]&&this.setTransition(p,d)}else o[s]&&this.setValue(s,d)}}getTransition(e){return Ao(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new im(this._values[e].property)),this._values[e].transition=Ao(i)||void 0}serialize(){let e={};for(let i of Object.keys(this._values)){let o=this.getValue(i);o!==void 0&&(e[i]=o);let s=this.getTransition(i);s!==void 0&&(e[`${i}-transition`]=s)}return e}transitioned(e,i){let o=new vc(this._properties);for(let s of Object.keys(this._values))o._values[s]=this._values[s].transitioned(e,i._values[s]);return o}untransitioned(){let e=new vc(this._properties);for(let i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class nm{constructor(e,i,o,s,d){let p=s.delay||0,_=s.duration||0;d=d||0,this.property=e,this.value=i,this.begin=d+p,this.end=this.begin+_,e.specification.transition&&(s.delay||s.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){let s=e.now||0,d=this.value.possiblyEvaluate(e,i,o),p=this.prior;if(p){if(s>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(s<this.begin)return p.possiblyEvaluate(e,i,o);{let _=(s-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,o),d,yt(_))}}return d}}class vc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){let s=new Wd(this._properties);for(let d of Object.keys(this._values))s._values[d]=this._values[d].possiblyEvaluate(e,i,o);return s}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ly{constructor(e,i,o){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this.isConfigDependent=!1}getValue(e){return Ao(this._values[e].value)}setValue(e,i){this._values[e]=new mh(this._values[e].property,i===null?void 0:Ao(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let i of Object.keys(this._values)){let o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o){let s=new Wd(this._properties);for(let d of Object.keys(this._values))s._values[d]=this._values[d].possiblyEvaluate(e,i,o);return s}}class Qc{constructor(e,i,o){this.property=e,this.value=i,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,s){return this.property.evaluate(this.value,this.parameters,e,i,o,s)}}class Wd{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ct{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){let s=jc[this.specification.type];return s?s(e,i,o):e}}class Zt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,s){return new Qc(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},o,s)}:e.expression,i)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Qc(this,{kind:"constant",value:void 0},e.parameters);let s=jc[this.specification.type];return s?new Qc(this,{kind:"constant",value:s(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,s,d,p){return e.kind==="constant"?e.value:e.evaluate(i,o,s,d,p)}}class xc{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,s){return!!e.expression.evaluate(i,null,{},o,s)}interpolate(){return!1}}class rr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let i=new nr(0,{});for(let o in e){let s=e[o];s.specification.overridable&&this.overridableProperties.push(o);let d=this.defaultPropertyValues[o]=new mh(s,void 0),p=this.defaultTransitionablePropertyValues[o]=new im(s);this.defaultTransitioningPropertyValues[o]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=d.possiblyEvaluate(i)}}}function Zd(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Yd(t){if(Array.isArray(t))return t.map(Yd);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let i in t)e[i]=Yd(t[i]);return e}return Zd(t)}Et(Zt,"DataDrivenProperty"),Et(ct,"DataConstantProperty"),Et(xc,"ColorRampProperty");var Te=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function rm(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!rm(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function wa(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};rm(t)||(t=Xd(t));let i=t,o=!0;try{o=function(v){if(!Jc(v))return v;let C=Yd(v);return om(C),C=bg(C),C}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}let s=Te[`filter_${e}`],d=uh(o,s),p=null;if(d.result==="error")throw new Error(d.value.map(v=>`${v.key}: ${v.message}`).join(", "));p=(v,C,E)=>d.value.evaluate(v,C,{},E);let _=null,y=null;if(o!==i){let v=uh(i,s);if(v.result==="error")throw new Error(v.value.map(C=>`${C.key}: ${C.message}`).join(", "));_=(C,E,S,R,O)=>v.value.evaluate(C,E,{},S,void 0,void 0,R,O),y=!Kn(v.value.expression)}return{filter:p,dynamicFilter:_||void 0,needGeometry:yg(o),needFeature:!!y}}function bg(t){if(!Array.isArray(t))return t;let e=function(i){if(cy.has(i[0])){for(let o=1;o<i.length;o++)if(Jc(i[o]))return!0}return i}(t);return e===!0?e:e.map(i=>bg(i))}function om(t){let e=!1,i=[];if(t[0]==="case"){for(let o=1;o<t.length-1;o+=2)e=e||Jc(t[o]),i.push(t[o+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||Jc(t[1]);for(let o=2;o<t.length-1;o+=2)i.push(t[o+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||Jc(t[1]);for(let o=1;o<t.length-1;o+=2)i.push(t[o+1])}e&&(t.length=0,t.push("any",...i));for(let o=1;o<t.length;o++)om(t[o])}function Jc(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(Jc(t[i]))return!0;return!1}let cy=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function dy(t,e){return t<e?-1:t>e?1:0}function yg(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(yg(t[e]))return!0;return!1}function Xd(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?Kd(t[1],t[2],"=="):e==="!="?Qd(Kd(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Kd(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(Xd))):e==="all"?["all"].concat(t.slice(1).map(Xd)):e==="none"?["all"].concat(t.slice(1).map(Xd).map(Qd)):e==="in"?am(t[1],t.slice(2)):e==="!in"?Qd(am(t[1],t.slice(2))):e==="has"?vg(t[1]):e!=="!has"||Qd(vg(t[1]));var i}function Kd(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function am(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(dy)]]:["filter-in-small",t,["literal",e]]}}function vg(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Qd(t){return["!",t]}let fh="";function sm(t,e){return e?`${t}${fh}${e}`:t}let Jd="-transition";class aa extends Qo{constructor(e,i,o,s){if(super(),this.id=e.id,this.fqid=sm(this.id,o),this.type=e.type,this.scope=o,this.options=s,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new ly(i.layout,this.scope,s),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new nl(i.paint,this.scope,s);for(let d in e.paint)this.setPaintProperty(d,e.paint[d]);for(let d in e.layout)this.setLayoutProperty(d,e.layout[d]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Wd(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);let o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Xo(e,Jd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){let o=this._transitionablePaint,s=o._properties.properties;if(Xo(e,Jd)){let E=e.slice(0,-11);return s[E]&&o.setTransition(E,i||void 0),!1}if(!s[e])return!1;let d=o._values[e],p=d.value.isDataDriven(),_=d.value;o.setValue(e,i),this.isConfigDependent=this.isConfigDependent||o.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let y=o._values[e].value,v=y.isDataDriven(),C=Xo(e,"pattern")||e==="line-dasharray";return v||p||C||this._handleOverridablePaintPropertyUpdate(e,_,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Mi({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let i=this.paint.get(e);if(i instanceof Qc&&lh(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=wa(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}let uy={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class gh{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Zn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function fn(t,e=1){let i=0,o=0;return{members:t.map(s=>{let d=uy[s.type].BYTES_PER_ELEMENT,p=i=eu(i,Math.max(e,d)),_=s.components||1;return o=Math.max(o,d),i+=d*_,{name:s.name,type:s.type,components:_,offset:p}}),size:eu(i,Math.max(o,e)),alignment:e}}function eu(t,e){return Math.ceil(t/e)*e}class Ka extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){let o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){let s=2*e;return this.int16[s+0]=i,this.int16[s+1]=o,e}}Ka.prototype.bytesPerElement=4,Et(Ka,"StructArrayLayout2i4");class jo extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){let s=this.length;return this.resize(s+1),this.emplace(s,e,i,o)}emplace(e,i,o,s){let d=3*e;return this.int16[d+0]=i,this.int16[d+1]=o,this.int16[d+2]=s,e}}jo.prototype.bytesPerElement=6,Et(jo,"StructArrayLayout3i6");class rl extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s){let d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,s)}emplace(e,i,o,s,d){let p=4*e;return this.int16[p+0]=i,this.int16[p+1]=o,this.int16[p+2]=s,this.int16[p+3]=d,e}}rl.prototype.bytesPerElement=8,Et(rl,"StructArrayLayout4i8");class lm extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,s,d)}emplace(e,i,o,s,d,p){let _=5*e;return this.int16[_+0]=i,this.int16[_+1]=o,this.int16[_+2]=s,this.int16[_+3]=d,this.int16[_+4]=p,e}}lm.prototype.bytesPerElement=10,Et(lm,"StructArrayLayout5i10");class cm extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,s,d,p,_)}emplace(e,i,o,s,d,p,_,y){let v=6*e,C=12*e,E=3*e;return this.int16[v+0]=i,this.int16[v+1]=o,this.uint8[C+4]=s,this.uint8[C+5]=d,this.uint8[C+6]=p,this.uint8[C+7]=_,this.float32[E+2]=y,e}}cm.prototype.bytesPerElement=12,Et(cm,"StructArrayLayout2i4ub1f12");class Gl extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s){let d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,s)}emplace(e,i,o,s,d){let p=4*e;return this.float32[p+0]=i,this.float32[p+1]=o,this.float32[p+2]=s,this.float32[p+3]=d,e}}Gl.prototype.bytesPerElement=16,Et(Gl,"StructArrayLayout4f16");class Hl extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,s,d)}emplace(e,i,o,s,d,p){let _=6*e,y=3*e;return this.uint16[_+0]=i,this.uint16[_+1]=o,this.uint16[_+2]=s,this.uint16[_+3]=d,this.float32[y+2]=p,e}}Hl.prototype.bytesPerElement=12,Et(Hl,"StructArrayLayout4ui1f12");class ed extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,s){let d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,s)}emplace(e,i,o,s,d){let p=4*e;return this.uint16[p+0]=i,this.uint16[p+1]=o,this.uint16[p+2]=s,this.uint16[p+3]=d,e}}ed.prototype.bytesPerElement=8,Et(ed,"StructArrayLayout4ui8");class _h extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d,p){let _=this.length;return this.resize(_+1),this.emplace(_,e,i,o,s,d,p)}emplace(e,i,o,s,d,p,_){let y=6*e;return this.int16[y+0]=i,this.int16[y+1]=o,this.int16[y+2]=s,this.int16[y+3]=d,this.int16[y+4]=p,this.int16[y+5]=_,e}}_h.prototype.bytesPerElement=12,Et(_h,"StructArrayLayout6i12");class tu extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d,p,_,y,v,C,E,S){let R=this.length;return this.resize(R+1),this.emplace(R,e,i,o,s,d,p,_,y,v,C,E,S)}emplace(e,i,o,s,d,p,_,y,v,C,E,S,R){let O=12*e;return this.int16[O+0]=i,this.int16[O+1]=o,this.int16[O+2]=s,this.int16[O+3]=d,this.uint16[O+4]=p,this.uint16[O+5]=_,this.uint16[O+6]=y,this.uint16[O+7]=v,this.int16[O+8]=C,this.int16[O+9]=E,this.int16[O+10]=S,this.int16[O+11]=R,e}}tu.prototype.bytesPerElement=24,Et(tu,"StructArrayLayout4i4ui4i24");class dm extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d,p){let _=this.length;return this.resize(_+1),this.emplace(_,e,i,o,s,d,p)}emplace(e,i,o,s,d,p,_){let y=10*e,v=5*e;return this.int16[y+0]=i,this.int16[y+1]=o,this.int16[y+2]=s,this.float32[v+2]=d,this.float32[v+3]=p,this.float32[v+4]=_,e}}dm.prototype.bytesPerElement=20,Et(dm,"StructArrayLayout3i3f20");class um extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}um.prototype.bytesPerElement=4,Et(um,"StructArrayLayout1ul4");class ys extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){let o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){let s=2*e;return this.uint16[s+0]=i,this.uint16[s+1]=o,e}}ys.prototype.bytesPerElement=4,Et(ys,"StructArrayLayout2ui4");class hm extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d,p,_,y,v,C,E,S,R){let O=this.length;return this.resize(O+1),this.emplace(O,e,i,o,s,d,p,_,y,v,C,E,S,R)}emplace(e,i,o,s,d,p,_,y,v,C,E,S,R,O){let F=20*e,V=10*e;return this.int16[F+0]=i,this.int16[F+1]=o,this.int16[F+2]=s,this.int16[F+3]=d,this.int16[F+4]=p,this.float32[V+3]=_,this.float32[V+4]=y,this.float32[V+5]=v,this.float32[V+6]=C,this.int16[F+14]=E,this.uint32[V+8]=S,this.uint16[F+18]=R,this.uint16[F+19]=O,e}}hm.prototype.bytesPerElement=40,Et(hm,"StructArrayLayout5i4f1i1ul2ui40");class iu extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,s,d,p,_)}emplace(e,i,o,s,d,p,_,y){let v=8*e;return this.int16[v+0]=i,this.int16[v+1]=o,this.int16[v+2]=s,this.int16[v+4]=d,this.int16[v+5]=p,this.int16[v+6]=_,this.int16[v+7]=y,e}}iu.prototype.bytesPerElement=16,Et(iu,"StructArrayLayout3i2i2i16");class bh extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,s,d)}emplace(e,i,o,s,d,p){let _=4*e,y=8*e;return this.float32[_+0]=i,this.float32[_+1]=o,this.float32[_+2]=s,this.int16[y+6]=d,this.int16[y+7]=p,e}}bh.prototype.bytesPerElement=16,Et(bh,"StructArrayLayout2f1f2i16");class pm extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s){let d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,s)}emplace(e,i,o,s,d){let p=12*e,_=3*e;return this.uint8[p+0]=i,this.uint8[p+1]=o,this.float32[_+1]=s,this.float32[_+2]=d,e}}pm.prototype.bytesPerElement=12,Et(pm,"StructArrayLayout2ub2f12");class Kr extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){let s=this.length;return this.resize(s+1),this.emplace(s,e,i,o)}emplace(e,i,o,s){let d=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=o,this.uint16[d+2]=s,e}}Kr.prototype.bytesPerElement=6,Et(Kr,"StructArrayLayout3ui6");class td extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d,p,_,y,v,C,E,S,R,O,F,V,U,Z,Q,K,se){let oe=this.length;return this.resize(oe+1),this.emplace(oe,e,i,o,s,d,p,_,y,v,C,E,S,R,O,F,V,U,Z,Q,K,se)}emplace(e,i,o,s,d,p,_,y,v,C,E,S,R,O,F,V,U,Z,Q,K,se,oe){let de=30*e,_e=15*e,xe=60*e;return this.int16[de+0]=i,this.int16[de+1]=o,this.int16[de+2]=s,this.float32[_e+2]=d,this.float32[_e+3]=p,this.uint16[de+8]=_,this.uint16[de+9]=y,this.uint32[_e+5]=v,this.uint32[_e+6]=C,this.uint32[_e+7]=E,this.uint16[de+16]=S,this.uint16[de+17]=R,this.uint16[de+18]=O,this.float32[_e+10]=F,this.float32[_e+11]=V,this.uint8[xe+48]=U,this.uint8[xe+49]=Z,this.uint8[xe+50]=Q,this.uint32[_e+13]=K,this.int16[de+28]=se,this.uint8[xe+58]=oe,e}}td.prototype.bytesPerElement=60,Et(td,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class yh extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d,p,_,y,v,C,E,S,R,O,F,V,U,Z,Q,K,se,oe,de,_e,xe,Se,we,ze,$e,Pe,He,De){let je=this.length;return this.resize(je+1),this.emplace(je,e,i,o,s,d,p,_,y,v,C,E,S,R,O,F,V,U,Z,Q,K,se,oe,de,_e,xe,Se,we,ze,$e,Pe,He,De)}emplace(e,i,o,s,d,p,_,y,v,C,E,S,R,O,F,V,U,Z,Q,K,se,oe,de,_e,xe,Se,we,ze,$e,Pe,He,De,je){let ut=20*e,qe=40*e,kt=80*e;return this.float32[ut+0]=i,this.float32[ut+1]=o,this.int16[qe+4]=s,this.int16[qe+5]=d,this.int16[qe+6]=p,this.int16[qe+7]=_,this.int16[qe+8]=y,this.int16[qe+9]=v,this.int16[qe+10]=C,this.int16[qe+11]=E,this.int16[qe+12]=S,this.uint16[qe+13]=R,this.uint16[qe+14]=O,this.uint16[qe+15]=F,this.uint16[qe+16]=V,this.uint16[qe+17]=U,this.uint16[qe+18]=Z,this.uint16[qe+19]=Q,this.uint16[qe+20]=K,this.uint16[qe+21]=se,this.uint16[qe+22]=oe,this.uint16[qe+23]=de,this.uint16[qe+24]=_e,this.uint16[qe+25]=xe,this.uint16[qe+26]=Se,this.uint16[qe+27]=we,this.uint32[ut+14]=ze,this.float32[ut+15]=$e,this.float32[ut+16]=Pe,this.float32[ut+17]=He,this.float32[ut+18]=De,this.uint8[kt+76]=je,e}}yh.prototype.bytesPerElement=80,Et(yh,"StructArrayLayout2f9i15ui1ul4f1ub80");class nu extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}nu.prototype.bytesPerElement=4,Et(nu,"StructArrayLayout1f4");class $l extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d){let p=this.length;return this.resize(p+1),this.emplace(p,e,i,o,s,d)}emplace(e,i,o,s,d,p){let _=5*e;return this.float32[_+0]=i,this.float32[_+1]=o,this.float32[_+2]=s,this.float32[_+3]=d,this.float32[_+4]=p,e}}$l.prototype.bytesPerElement=20,Et($l,"StructArrayLayout5f20");class mm extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,s,d,p,_)}emplace(e,i,o,s,d,p,_,y){let v=7*e;return this.float32[v+0]=i,this.float32[v+1]=o,this.float32[v+2]=s,this.float32[v+3]=d,this.float32[v+4]=p,this.float32[v+5]=_,this.float32[v+6]=y,e}}mm.prototype.bytesPerElement=28,Et(mm,"StructArrayLayout7f28");class ru extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,s){let d=this.length;return this.resize(d+1),this.emplace(d,e,i,o,s)}emplace(e,i,o,s,d){let p=6*e;return this.uint32[3*e+0]=i,this.uint16[p+2]=o,this.uint16[p+3]=s,this.uint16[p+4]=d,e}}ru.prototype.bytesPerElement=12,Et(ru,"StructArrayLayout1ul3ui12");class fm extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}fm.prototype.bytesPerElement=2,Et(fm,"StructArrayLayout1ui2");class wc extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){let s=this.length;return this.resize(s+1),this.emplace(s,e,i,o)}emplace(e,i,o,s){let d=3*e;return this.float32[d+0]=i,this.float32[d+1]=o,this.float32[d+2]=s,e}}wc.prototype.bytesPerElement=12,Et(wc,"StructArrayLayout3f12");class ou extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){let o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){let s=2*e;return this.float32[s+0]=i,this.float32[s+1]=o,e}}ou.prototype.bytesPerElement=8,Et(ou,"StructArrayLayout2f8");class gm extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d,p,_,y,v,C,E,S,R,O,F,V){let U=this.length;return this.resize(U+1),this.emplace(U,e,i,o,s,d,p,_,y,v,C,E,S,R,O,F,V)}emplace(e,i,o,s,d,p,_,y,v,C,E,S,R,O,F,V,U){let Z=16*e;return this.float32[Z+0]=i,this.float32[Z+1]=o,this.float32[Z+2]=s,this.float32[Z+3]=d,this.float32[Z+4]=p,this.float32[Z+5]=_,this.float32[Z+6]=y,this.float32[Z+7]=v,this.float32[Z+8]=C,this.float32[Z+9]=E,this.float32[Z+10]=S,this.float32[Z+11]=R,this.float32[Z+12]=O,this.float32[Z+13]=F,this.float32[Z+14]=V,this.float32[Z+15]=U,e}}gm.prototype.bytesPerElement=64,Et(gm,"StructArrayLayout16f64");class au extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,s,d,p,_){let y=this.length;return this.resize(y+1),this.emplace(y,e,i,o,s,d,p,_)}emplace(e,i,o,s,d,p,_,y){let v=10*e,C=5*e;return this.uint16[v+0]=i,this.uint16[v+1]=o,this.uint16[v+2]=s,this.uint16[v+3]=d,this.float32[C+2]=p,this.float32[C+3]=_,this.float32[C+4]=y,e}}au.prototype.bytesPerElement=20,Et(au,"StructArrayLayout4ui3f20");class _m extends Zn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}_m.prototype.bytesPerElement=1,Et(_m,"StructArrayLayout1ub1");class xg extends gh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}xg.prototype.size=40;class wg extends hm{get(e){return new xg(this,e)}}Et(wg,"CollisionBoxArray");class Cg extends gh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Cg.prototype.size=60;class Tg extends td{get(e){return new Cg(this,e)}}Et(Tg,"PlacedSymbolArray");class Eg extends gh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Eg.prototype.size=80;class Ig extends yh{get(e){return new Eg(this,e)}}Et(Ig,"SymbolInstanceArray");class Sg extends nu{getoffsetX(e){return this.float32[1*e+0]}}Et(Sg,"GlyphOffsetArray");class su extends Ka{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Et(su,"SymbolLineVertexArray");class Mg extends gh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Mg.prototype.size=12;class Ag extends ru{get(e){return new Mg(this,e)}}Et(Ag,"FeatureIndexArray");class lu extends ys{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Et(lu,"FillExtrusionCentroidArray");let hy=fn([{name:"a_pos",components:2,type:"Int16"}],4),Dg=fn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class yr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,s){let d=this.segments[this.segments.length-1];return e>yr.MAX_VERTEX_ARRAY_LENGTH&&er(`Max vertices per segment is ${yr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>yr.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==s)&&(d={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},s!==void 0&&(d.sortKey=s),this.segments.push(d)),d}prepareSegment(e,i,o,s){return this._prepareSegment(e,i.length,o.length,s)}get(){return this.segments}destroy(){for(let e of this.segments)for(let i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,s){return new yr([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:s,vaos:{},sortKey:0}])}}function bm(t,e){return 256*(t=gi(Math.floor(t),0,255))+gi(Math.floor(e),0,255)}yr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Et(yr,"SegmentVector");let kg=fn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Rg=fn([{name:"a_dash",components:4,type:"Uint16"}]);var cu={exports:{}},vh={exports:{}};(function(t){t.exports=function(e,i){var o,s,d,p,_,y,v,C;for(s=e.length-(o=3&e.length),d=i,_=3432918353,y=461845907,C=0;C<s;)v=255&e.charCodeAt(C)|(255&e.charCodeAt(++C))<<8|(255&e.charCodeAt(++C))<<16|(255&e.charCodeAt(++C))<<24,++C,d=27492+(65535&(p=5*(65535&(d=(d^=v=(65535&(v=(v=(65535&v)*_+(((v>>>16)*_&65535)<<16)&4294967295)<<15|v>>>17))*y+(((v>>>16)*y&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(v=0,o){case 3:v^=(255&e.charCodeAt(C+2))<<16;case 2:v^=(255&e.charCodeAt(C+1))<<8;case 1:d^=v=(65535&(v=(v=(65535&(v^=255&e.charCodeAt(C)))*_+(((v>>>16)*_&65535)<<16)&4294967295)<<15|v>>>17))*y+(((v>>>16)*y&65535)<<16)&4294967295}return d^=e.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}})(vh);var ym=vh.exports,Pg={exports:{}};(function(t){t.exports=function(e,i){for(var o,s=e.length,d=i^s,p=0;s>=4;)o=1540483477*(65535&(o=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(o>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),s-=4,++p;switch(s){case 3:d^=(255&e.charCodeAt(p+2))<<16;case 2:d^=(255&e.charCodeAt(p+1))<<8;case 1:d=1540483477*(65535&(d^=255&e.charCodeAt(p)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}})(Pg);var Og=ym,Fg=Pg.exports;cu.exports=Og,cu.exports.murmur3=Og,cu.exports.murmur2=Fg;var vm=vi(cu.exports);class du{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,s){this.ids.push(Lg(e)),this.positions.push(i,o,s)}eachPosition(e,i){let o=Lg(e),s=0,d=this.ids.length-1;for(;s<d;){let p=s+d>>1;this.ids[p]>=o?d=p:s=p+1}for(;this.ids[s]===o;)i(this.positions[3*s],this.positions[3*s+1],this.positions[3*s+2]),s++}static serialize(e,i){let o=new Float64Array(e.ids),s=new Uint32Array(e.positions);return xm(o,s,0,o.length-1),i&&(i.add(o.buffer),i.add(s.buffer)),{ids:o,positions:s}}static deserialize(e){let i=new du,o;i.ids=e.ids,i.positions=e.positions;for(let s of i.ids)s!==o&&i.uniqueIds.push(s),o=s;return i.indexed=!0,i}}function Lg(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:vm(String(t))}function xm(t,e,i,o){for(;i<o;){let s=t[i+o>>1],d=i-1,p=o+1;for(;;){do d++;while(t[d]<s);do p--;while(t[p]>s);if(d>=p)break;xh(t,d,p),xh(e,3*d,3*p),xh(e,3*d+1,3*p+1),xh(e,3*d+2,3*p+2)}p-i<o-p?(xm(t,e,i,p),i=p+1):(xm(t,e,p+1,o),o=p)}}function xh(t,e,i){let o=t[e];t[e]=t[i],t[i]=o}Et(du,"FeaturePositionMap");class ol{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class wh extends ol{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class Oo extends ol{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class ql extends ol{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class zg extends ol{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class u extends ol{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class n extends ol{constructor(e){super(e),this.current=hr.transparent}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}let a=new Float32Array(16);class h extends ol{constructor(e){super(e),this.current=a}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let s=1;s<16;s++)if(o[s]!==this.current[s]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}let f=new Float32Array(9),b=new Float32Array(4);class x extends ol{constructor(e){super(e),this.current=b}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let s=0;s<4;s++)if(o[s]!==this.current[s]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function T(t){return[bm(255*t.r,255*t.g),bm(255*t.b,255*t.a)]}class I{constructor(e,i,o){this.value=e,this.uniformNames=i.map(s=>`u_${s}`),this.type=o}setUniform(e,i,o,s,d){i.set(e,d,s.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new n(e):new Oo(e)}}class A{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,o,s,d){let p=d==="u_pattern"||d==="u_dash"?this.pattern:d==="u_pixel_ratio"?this.pixelRatio:null;p&&i.set(e,d,p)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new u(e):new Oo(e)}}class k{constructor(e,i,o,s){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new s}populatePaintArray(e,i,o,s,d,p,_){let y=this.paintVertexArray.length,v=this.expression.evaluate(new nr(0,{brightness:p}),i,{},d,s,_);this.paintVertexArray.resize(e),this._setPaintValue(y,e,v)}updatePaintArray(e,i,o,s,d,p,_){let y=this.expression.evaluate({zoom:0,brightness:_},o,s,void 0,d);this._setPaintValue(e,i,y)}_setPaintValue(e,i,o){if(this.type==="color"){let s=T(o);for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,s[0],s[1])}else{for(let s=e;s<i;s++)this.paintVertexArray.emplace(s,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class P{constructor(e,i,o,s,d,p){this.expression=e,this.uniformNames=i.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=s,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=i.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,i,o,s,d,p,_){let y=this.expression.evaluate(new nr(this.zoom,{brightness:p}),i,{},d,s,_),v=this.expression.evaluate(new nr(this.zoom+1,{brightness:p}),i,{},d,s,_),C=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(C,e,y,v)}updatePaintArray(e,i,o,s,d,p,_){let y=this.expression.evaluate({zoom:this.zoom,brightness:_},o,s,void 0,d),v=this.expression.evaluate({zoom:this.zoom+1,brightness:_},o,s,void 0,d);this._setPaintValue(e,i,y,v)}_setPaintValue(e,i,o,s){if(this.type==="color"){let d=T(o),p=T(s);for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,d[0],d[1],p[0],p[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,o,s);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,s,d){let p=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,_=gi(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);i.set(e,d,_)}getBinding(e,i){return new Oo(e)}}class L{constructor(e,i,o,s,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(o==="array"?Rg:kg).members;for(let p=0;p<i.length;++p);this.paintVertexArray=new s}populatePaintArray(e,i,o){let s=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(s,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,s,d,p,_){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],p)}_setPaintValues(e,i,o,s){if(!s||!o)return;let d=s[o];if(!d)return;let{tl:p,br:_,pixelRatio:y}=d;for(let v=e;v<i;v++)this.paintVertexArray.emplace(v,p[0],p[1],_[0],_[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class B{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[];let s=[];for(let d in e.paint._values){let p=e.paint.get(d);if(!o(d)||!(p instanceof Qc&&lh(p.property.specification)))continue;let _=$(d,e.type),y=p.value,v=p.property.specification.type,C=!!p.property.useIntegerZoom,E=d==="line-dasharray"||d.endsWith("pattern"),S=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||S)if(y.kind==="source"||S||E){let R=ee(d,v,"source");this.binders[d]=E?new L(y,_,v,R,e.id):new k(y,_,v,R),s.push(`/a_${d}`)}else{let R=ee(d,v,"composite");this.binders[d]=new P(y,_,v,C,i,R),s.push(`/z_${d}`)}else this.binders[d]=E?new A(y.value,_):new I(y.value,_,v),s.push(`/u_${d}`)}this.cacheKey=s.sort().join("")}getMaxValue(e){let i=this.binders[e];return i instanceof k||i instanceof P?i.maxValue:0}populatePaintArrays(e,i,o,s,d,p,_){for(let y in this.binders){let v=this.binders[y];(v instanceof k||v instanceof P||v instanceof L)&&v.populatePaintArray(e,i,o,s,d,p,_)}}setConstantPatternPositions(e){for(let i in this.binders){let o=this.binders[i];o instanceof A&&o.setConstantPatternPositions(e)}}updatePaintArrays(e,i,o,s,d,p,_,y){let v=!1,C=Object.keys(e),E=C.length!==0,S=E?C:i.uniqueIds;for(let R in this.binders){let O=this.binders[R];if((O instanceof k||O instanceof P||O instanceof L)&&(O.expression.isStateDependent===!0||O.expression.isLightConstant===!1)){let F=d.paint.get(R);O.expression=F.value;for(let V of S){let U=e[V.toString()];i.eachPosition(V,(Z,Q,K)=>{let se=s.feature(Z);O.updatePaintArray(Q,K,se,U,p,_,y)})}if(!E)for(let V of o.uniqueIds){let U=e[V.toString()];o.eachPosition(V,(Z,Q,K)=>{let se=s.feature(Z);O.updatePaintArray(Q,K,se,U,p,_,y)})}v=!0}}return v}defines(){let e=[];for(let i in this.binders){let o=this.binders[i];(o instanceof I||o instanceof A)&&e.push(...o.uniformNames.map(s=>`#define HAS_UNIFORM_${s}`))}return e}getBinderAttributes(){let e=[];for(let i in this.binders){let o=this.binders[i];if(o instanceof k||o instanceof P||o instanceof L)for(let s=0;s<o.paintVertexAttributes.length;s++)e.push(o.paintVertexAttributes[s].name)}return e}getBinderUniforms(){let e=[];for(let i in this.binders){let o=this.binders[i];if(o instanceof I||o instanceof A||o instanceof P)for(let s of o.uniformNames)e.push(s)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let i=[];for(let o in this.binders){let s=this.binders[o];if(s instanceof I||s instanceof A||s instanceof P)for(let d of s.uniformNames)i.push({name:d,property:o,binding:s.getBinding(e,d)})}return i}setUniforms(e,i,o,s,d){for(let{name:p,property:_,binding:y}of o)this.binders[_].setUniform(e,y,d,s.get(_),p)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let i=this.binders[e];(i instanceof k||i instanceof P||i instanceof L)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(let i in this.binders){let o=this.binders[i];(o instanceof k||o instanceof P||o instanceof L)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let i=this.binders[e];(i instanceof k||i instanceof P||i instanceof L)&&i.destroy()}}}class H{constructor(e,i,o=()=>!0){this.programConfigurations={};for(let s of e)this.programConfigurations[s.id]=new B(s,i,o);this.needsUpload=!1,this._featureMap=new du,this._featureMapWithoutIds=new du,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,s,d,p,_,y){for(let v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,i,s,d,p,_,y);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,s,d,p){for(let _ of o)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,_,s,d,p||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let G={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function $(t,e){return G[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let j={"line-pattern":{source:Hl,composite:Hl},"fill-pattern":{source:Hl,composite:Hl},"fill-extrusion-pattern":{source:Hl,composite:Hl},"line-dasharray":{source:ed,composite:ed}},W={color:{source:ou,composite:Gl},number:{source:nu,composite:ou}};function ee(t,e,i){let o=j[t];return o&&o[i]||W[e][i]}Et(I,"ConstantBinder"),Et(A,"PatternConstantBinder"),Et(k,"SourceExpressionBinder"),Et(L,"PatternCompositeBinder"),Et(P,"CompositeExpressionBinder"),Et(B,"ProgramConfiguration",{omit:["_buffers"]}),Et(H,"ProgramConfigurationSet");let X=mt/Math.PI/2,te=5,q=6,ne=16383,le=64,ce=[le,32,16],me=-X,Ie=X;function be(t,e,i,o=X){return i=Fi(i),[t*Math.sin(i)*o,-e*o,t*Math.cos(i)*o]}function Fe(t,e,i){return be(Math.cos(Fi(t)),Math.sin(Fi(t)),e,i)}let Re=63710088e-1,Ye=2*Math.PI*Re;class ve{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ve(Ia(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let i=Math.PI/180,o=this.lat*i,s=e.lat*i,d=Math.sin(o)*Math.sin(s)+Math.cos(o)*Math.cos(s)*Math.cos((e.lng-this.lng)*i);return Re*Math.acos(Math.min(d,1))}toBounds(e=0){let i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new Ae({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return Fe(this.lat,this.lng,X+e*X/Re)}static convert(e){if(e instanceof ve)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ve(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ve(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ae{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ve?new ve(e.lng,e.lat):ve.convert(e),this}setSouthWest(e){return this._sw=e instanceof ve?new ve(e.lng,e.lat):ve.convert(e),this}extend(e){let i=this._sw,o=this._ne,s,d;if(e instanceof ve)s=e,d=e;else{if(!(e instanceof Ae))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ae.convert(e)):this.extend(ve.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ve.convert(e)):this;if(s=e._sw,d=e._ne,!s||!d)return this}return i||o?(i.lng=Math.min(s.lng,i.lng),i.lat=Math.min(s.lat,i.lat),o.lng=Math.max(d.lng,o.lng),o.lat=Math.max(d.lat,o.lat)):(this._sw=new ve(s.lng,s.lat),this._ne=new ve(d.lng,d.lat)),this}getCenter(){return new ve((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ve(this.getWest(),this.getNorth())}getSouthEast(){return new ve(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:i,lat:o}=ve.convert(e),s=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(s=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&s}static convert(e){return!e||e instanceof Ae?e:new Ae(e)}}var he={};(function(t,e){(function(i){function o(d,p,_){var y=s(256*d,256*(p=Math.pow(2,_)-p-1),_),v=s(256*(d+1),256*(p+1),_);return y[0]+","+y[1]+","+v[0]+","+v[1]}function s(d,p,_){var y=2*Math.PI*6378137/256/Math.pow(2,_);return[d*y-2*Math.PI*6378137/2,p*y-2*Math.PI*6378137/2]}i.getURL=function(d,p,_,y,v,C){return C=C||{},d+"?"+["bbox="+o(_,y,v),"format="+(C.format||"image/png"),"service="+(C.service||"WMS"),"version="+(C.version||"1.1.1"),"request="+(C.request||"GetMap"),"srs="+(C.srs||"EPSG:3857"),"width="+(C.width||256),"height="+(C.height||256),"layers="+p].join("&")},i.getTileBBox=o,i.getMercCoords=s,Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,he);var Ce=he;class Xe{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=_t(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){let o=Ce.getTileBBox(this.x,this.y,this.z),s=function(d,p,_){let y,v="";for(let C=d;C>0;C--)y=1<<C-1,v+=(p&y?1:0)+(_&y?2:0);return v}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",s).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class at{constructor(e,i){this.wrap=e,this.canonical=i,this.key=_t(e,i.z,i.z,i.x,i.y)}}class nt{constructor(e,i,o,s,d){this.overscaledZ=e,this.wrap=i,this.canonical=new Xe(o,+s,+d),this.key=i===0&&e===o?this.canonical.key:_t(i,e,o,s,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let i=this.canonical.z-e;return e>this.canonical.z?new nt(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new nt(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return _t(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{let o=this.canonical.z-e;return _t(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new nt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let i=this.canonical.z+1,o=2*this.canonical.x,s=2*this.canonical.y;return[new nt(i,this.wrap,i,o,s),new nt(i,this.wrap,i,o+1,s),new nt(i,this.wrap,i,o,s+1),new nt(i,this.wrap,i,o+1,s+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new nt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new nt(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new at(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function _t(t,e,i,o,s){let d=1<<Math.min(i,22),p=d*(s%d)+o%d;return t&&i<22&&(p+=d*d*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*p+i)+(e-i)}let Rt=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new nt(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new nt(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new nt(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new nt(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Et(Xe,"CanonicalTileID"),Et(nt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let Wt=0,Nt=25.5;function Ut(t){return Ye*Math.cos(t*Math.PI/180)}function _i(t){return(180+t)/360}function ri(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ci(t,e){return t/Ut(e)}function li(t){return 360*t-180}function Ui(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function On(t,e){return t*Ut(Ui(e))}let ki=85.051129;function or(t){return Math.cos(Fi(gi(t,-ki,ki)))}function Ri(t,e){let i=gi(e,Wt,Nt),o=Math.pow(2,i);return or(t)*Ye/(512*o)}function Yi(t){return 1/Math.cos(t*Math.PI/180)}function Pi(t,e=0){let i=Math.exp(Math.PI*(1-(t.y+e/mt)/(1<<t.z)*2));return 80150034*i/(i*i+1)/mt/(1<<t.z)}class Wi{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){let o=ve.convert(e);return new Wi(_i(o.lng),ri(o.lat),ci(i,o.lat))}toLngLat(){return new ve(li(this.x),Ui(this.y))}toAltitude(){return On(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ye*Yi(Ui(this.y))}}function jn(t,e,i,o,s,d,p,_,y){let v=(e+o)/2,C=(i+s)/2,E=new dt(v,C);_(E),function(S,R,O,F,V,U){let Z=O-V,Q=F-U;return Math.abs((F-R)*Z-(O-S)*Q)/Math.hypot(Z,Q)}(E.x,E.y,d.x,d.y,p.x,p.y)>=y?(jn(t,e,i,v,C,d,E,_,y),jn(t,v,C,o,s,E,p,_,y)):t.push(p)}function sn(t,e,i){let o=t[0],s=o.x,d=o.y;e(o);let p=[o];for(let _=1;_<t.length;_++){let y=t[_],{x:v,y:C}=y;e(y),jn(p,s,d,v,C,o,y,e,i),s=v,d=C,o=y}return p}function Qr(t,e,i,o){if(o(e,i)){let s=e.add(i)._mult(.5);Qr(t,e,s,o),Qr(t,s,i,o)}else t.push(i)}function bo(t,e){let i=t[0],o=[i];for(let s=1;s<t.length;s++){let d=t[s];Qr(o,i,d,e),i=d}return o}let sa=Math.pow(2,14)-1,vs=-sa-1;function la(t,e){let i=Math.round(t.x*e),o=Math.round(t.y*e);return t.x=gi(i,vs,sa),t.y=gi(o,vs,sa),(i<t.x||i>t.x+1||o<t.y||o>t.y+1)&&er("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Jr(t,e,i){let o=t.loadGeometry(),s=t.extent,d=mt/s;if(e&&i&&i.projection.isReprojectedInTileSpace){let p=1<<e.z,{scale:_,x:y,y:v,projection:C}=i,E=S=>{let R=li((e.x+S.x/s)/p),O=Ui((e.y+S.y/s)/p),F=C.project(R,O);S.x=(F.x*_-y)*s,S.y=(F.y*_-v)*s};for(let S=0;S<o.length;S++)if(t.type!==1)o[S]=sn(o[S],E,1);else{let R=[];for(let O of o[S])O.x<0||O.x>=s||O.y<0||O.y>=s||(E(O),R.push(O));o[S]=R}}for(let p of o)for(let _ of p)la(_,d);return o}function Vr(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Jr(t):[]}}function Fo(t,e,i,o,s){t.emplaceBack(2*e+(o+1)/2,2*i+(s+1)/2)}function Uo(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class ca{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ka,this.indexArray=new Kr,this.segments=new yr,this.programConfigurations=new H(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o,s){let d=this.layers[0],p=[],_=null;d.type==="circle"&&(_=d.layout.get("circle-sort-key"));for(let{feature:v,id:C,index:E,sourceLayerIndex:S}of e){let R=this.layers[0]._featureFilter.needGeometry,O=Vr(v,R);if(!this.layers[0]._featureFilter.filter(new nr(this.zoom),O,o))continue;let F=_?_.evaluate(O,{},o):void 0,V={id:C,properties:v.properties,type:v.type,sourceLayerIndex:S,index:E,geometry:R?O.geometry:Jr(v,o,s),patterns:{},sortKey:F};p.push(V)}_&&p.sort((v,C)=>v.sortKey-C.sortKey);let y=null;s.projection.name==="globe"&&(this.globeExtVertexArray=new _h,y=s.projection);for(let v of p){let{geometry:C,index:E,sourceLayerIndex:S}=v,R=e[E].feature;this.addFeature(v,C,E,i.availableImages,o,y,i.brightness),i.featureIndex.insert(R,C,E,S,this.index)}}update(e,i,o,s,d){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,o,s,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Dg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,o,s,d,p,_){for(let y of i)for(let v of y){let C=v.x,E=v.y;if(C<0||C>=mt||E<0||E>=mt)continue;if(p){let O=p.projectTilePoint(C,E,d),F=p.upVector(d,C,E),V=this.globeExtVertexArray;Uo(V,O,F),Uo(V,O,F),Uo(V,O,F),Uo(V,O,F)}let S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=S.vertexLength;Fo(this.layoutVertexArray,C,E,-1,-1),Fo(this.layoutVertexArray,C,E,1,-1),Fo(this.layoutVertexArray,C,E,1,1),Fo(this.layoutVertexArray,C,E,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},s,d,_)}}function xs(t,e){for(let i=0;i<t.length;i++)if(al(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(al(t,e[i]))return!0;return!!hu(t,e)}function Wl(t,e,i){return!!al(t,e)||!!pu(e,t,i)}function Cc(t,e){if(t.length===1)return Ch(e,t[0]);for(let i=0;i<e.length;i++){let o=e[i];for(let s=0;s<o.length;s++)if(al(t,o[s]))return!0}for(let i=0;i<t.length;i++)if(Ch(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(hu(t,e[i]))return!0;return!1}function uu(t,e,i){if(t.length>1){if(hu(t,e))return!0;for(let o=0;o<e.length;o++)if(pu(e[o],t,i))return!0}for(let o=0;o<t.length;o++)if(pu(t[o],e,i))return!0;return!1}function hu(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){let o=t[i],s=t[i+1];for(let d=0;d<e.length-1;d++)if(wm(o,s,e[d],e[d+1]))return!0}return!1}function wm(t,e,i,o){return uo(t,i,o)!==uo(e,i,o)&&uo(t,e,i)!==uo(t,e,o)}function pu(t,e,i){let o=i*i;if(e.length===1)return t.distSqr(e[0])<o;for(let s=1;s<e.length;s++)if(id(t,e[s-1],e[s])<o)return!0;return!1}function id(t,e,i){let o=e.distSqr(i);if(o===0)return t.distSqr(e);let s=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/o;return t.distSqr(s<0?e:s>1?i:i.sub(e)._mult(s)._add(e))}function Ch(t,e){let i,o,s,d=!1;for(let p=0;p<t.length;p++){i=t[p];for(let _=0,y=i.length-1;_<i.length;y=_++)o=i[_],s=i[y],o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(d=!d)}return d}function al(t,e){let i=!1;for(let o=0,s=t.length-1;o<t.length;s=o++){let d=t[o],p=t[s];d.y>e.y!=p.y>e.y&&e.x<(p.x-d.x)*(e.y-d.y)/(p.y-d.y)+d.x&&(i=!i)}return i}function a1(t,e,i,o,s){for(let p of t)if(e<=p.x&&i<=p.y&&o>=p.x&&s>=p.y)return!0;let d=[new dt(e,i),new dt(e,s),new dt(o,s),new dt(o,i)];if(t.length>2){for(let p of d)if(al(t,p))return!0}for(let p=0;p<t.length-1;p++)if(bA(t[p],t[p+1],d))return!0;return!1}function bA(t,e,i){let o=i[0],s=i[2];if(t.x<o.x&&e.x<o.x||t.x>s.x&&e.x>s.x||t.y<o.y&&e.y<o.y||t.y>s.y&&e.y>s.y)return!1;let d=uo(t,e,i[0]);return d!==uo(t,e,i[1])||d!==uo(t,e,i[2])||d!==uo(t,e,i[3])}function Th(t,e,i,o,s,d){let p=e.y-t.y,_=t.x-e.x;if(d=d||0){let y=p*p+_*_;if(y===0)return!0;let v=Math.sqrt(y);p/=v,_/=v}return!((i.x-t.x)*p+(i.y-t.y)*_-d<0||(o.x-t.x)*p+(o.y-t.y)*_-d<0||(s.x-t.x)*p+(s.y-t.y)*_-d<0)}function py(t,e,i,o,s,d,p){return!(Th(t,e,o,s,d,p)||Th(e,i,o,s,d,p)||Th(i,t,o,s,d,p)||Th(o,s,t,e,i,p)||Th(s,d,t,e,i,p)||Th(d,o,t,e,i,p))}function Eh(t,e,i){let o=e.paint.get(t).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Ng(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function s1(t,e,i,o,s){if(!e[0]&&!e[1])return t;let d=dt.convert(e)._mult(s);i==="viewport"&&d._rotate(-o);let p=[];for(let _=0;_<t.length;_++)p.push(t[_].sub(d));return p}function l1(t,e,i,o){let s=dt.convert(t)._mult(o);return e==="viewport"&&s._rotate(-i),s}Et(ca,"CircleBucket",{omit:["layers"]});let yA=new rr({"circle-sort-key":new Zt(Te.layout_circle["circle-sort-key"]),visibility:new ct(Te.layout_circle.visibility)});var vA={paint:new rr({"circle-radius":new Zt(Te.paint_circle["circle-radius"]),"circle-color":new Zt(Te.paint_circle["circle-color"]),"circle-blur":new Zt(Te.paint_circle["circle-blur"]),"circle-opacity":new Zt(Te.paint_circle["circle-opacity"]),"circle-translate":new ct(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new ct(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ct(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ct(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Zt(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Zt(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Zt(Te.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ct(Te.paint_circle["circle-emissive-strength"])}),layout:yA},io={},no={};Object.defineProperty(no,"__esModule",{value:!0}),no.setMatrixArrayType=function(t){no.ARRAY_TYPE=d1=t},no.toRadian=function(t){return t*wA},no.equals=function(t,e){return Math.abs(t-e)<=c1*Math.max(1,Math.abs(t),Math.abs(e))},no.RANDOM=no.ARRAY_TYPE=no.EPSILON=void 0;var c1=1e-6;no.EPSILON=c1;var d1=typeof Float32Array<"u"?Float32Array:Array;no.ARRAY_TYPE=d1;var xA=Math.random;no.RANDOM=xA;var wA=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var ar={};function my(t){return my=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},my(t)}Object.defineProperty(ar,"__esModule",{value:!0}),ar.create=function(){var t=new nd.ARRAY_TYPE(4);return nd.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},ar.clone=function(t){var e=new nd.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ar.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ar.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},ar.fromValues=function(t,e,i,o){var s=new nd.ARRAY_TYPE(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=o,s},ar.set=function(t,e,i,o,s){return t[0]=e,t[1]=i,t[2]=o,t[3]=s,t},ar.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},ar.invert=function(t,e){var i=e[0],o=e[1],s=e[2],d=e[3],p=i*d-s*o;return p?(t[0]=d*(p=1/p),t[1]=-o*p,t[2]=-s*p,t[3]=i*p,t):null},ar.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},ar.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},ar.multiply=h1,ar.rotate=function(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3],_=Math.sin(i),y=Math.cos(i);return t[0]=o*y+d*_,t[1]=s*y+p*_,t[2]=o*-_+d*y,t[3]=s*-_+p*y,t},ar.scale=function(t,e,i){var o=e[1],s=e[2],d=e[3],p=i[0],_=i[1];return t[0]=e[0]*p,t[1]=o*p,t[2]=s*_,t[3]=d*_,t},ar.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=-i,t[3]=o,t},ar.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},ar.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},ar.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},ar.LDU=function(t,e,i,o){return t[2]=o[2]/o[0],i[0]=o[0],i[1]=o[1],i[3]=o[3]-t[2]*i[1],[t,e,i]},ar.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},ar.subtract=p1,ar.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},ar.equals=function(t,e){var i=t[0],o=t[1],s=t[2],d=t[3],p=e[0],_=e[1],y=e[2],v=e[3];return Math.abs(i-p)<=nd.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-_)<=nd.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(s-y)<=nd.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(d-v)<=nd.EPSILON*Math.max(1,Math.abs(d),Math.abs(v))},ar.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},ar.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t},ar.sub=ar.mul=void 0;var nd=function(t,e){if(t&&t.__esModule)return t;if(t===null||my(t)!=="object"&&typeof t!="function")return{default:t};var i=u1(void 0);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=s?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(o,d,p):o[d]=t[d]}return o.default=t,i&&i.set(t,o),o}(no);function u1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(u1=function(o){return o?i:e})(t)}function h1(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3],_=i[0],y=i[1],v=i[2],C=i[3];return t[0]=o*_+d*y,t[1]=s*_+p*y,t[2]=o*v+d*C,t[3]=s*v+p*C,t}function p1(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}ar.mul=h1,ar.sub=p1;var pr={};function fy(t){return fy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fy(t)}Object.defineProperty(pr,"__esModule",{value:!0}),pr.create=function(){var t=new Zl.ARRAY_TYPE(6);return Zl.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},pr.clone=function(t){var e=new Zl.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},pr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},pr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},pr.fromValues=function(t,e,i,o,s,d){var p=new Zl.ARRAY_TYPE(6);return p[0]=t,p[1]=e,p[2]=i,p[3]=o,p[4]=s,p[5]=d,p},pr.set=function(t,e,i,o,s,d,p){return t[0]=e,t[1]=i,t[2]=o,t[3]=s,t[4]=d,t[5]=p,t},pr.invert=function(t,e){var i=e[0],o=e[1],s=e[2],d=e[3],p=e[4],_=e[5],y=i*d-o*s;return y?(t[0]=d*(y=1/y),t[1]=-o*y,t[2]=-s*y,t[3]=i*y,t[4]=(s*_-d*p)*y,t[5]=(o*p-i*_)*y,t):null},pr.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},pr.multiply=f1,pr.rotate=function(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3],_=e[4],y=e[5],v=Math.sin(i),C=Math.cos(i);return t[0]=o*C+d*v,t[1]=s*C+p*v,t[2]=o*-v+d*C,t[3]=s*-v+p*C,t[4]=_,t[5]=y,t},pr.scale=function(t,e,i){var o=e[1],s=e[2],d=e[3],p=e[4],_=e[5],y=i[0],v=i[1];return t[0]=e[0]*y,t[1]=o*y,t[2]=s*v,t[3]=d*v,t[4]=p,t[5]=_,t},pr.translate=function(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3],_=e[4],y=e[5],v=i[0],C=i[1];return t[0]=o,t[1]=s,t[2]=d,t[3]=p,t[4]=o*v+d*C+_,t[5]=s*v+p*C+y,t},pr.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=-i,t[3]=o,t[4]=0,t[5]=0,t},pr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},pr.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},pr.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},pr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},pr.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},pr.subtract=g1,pr.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},pr.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t},pr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},pr.equals=function(t,e){var i=t[0],o=t[1],s=t[2],d=t[3],p=t[4],_=t[5],y=e[0],v=e[1],C=e[2],E=e[3],S=e[4],R=e[5];return Math.abs(i-y)<=Zl.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-v)<=Zl.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-C)<=Zl.EPSILON*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(d-E)<=Zl.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(p-S)<=Zl.EPSILON*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(_-R)<=Zl.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))},pr.sub=pr.mul=void 0;var Zl=function(t,e){if(t&&t.__esModule)return t;if(t===null||fy(t)!=="object"&&typeof t!="function")return{default:t};var i=m1(void 0);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=s?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(o,d,p):o[d]=t[d]}return o.default=t,i&&i.set(t,o),o}(no);function m1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(m1=function(o){return o?i:e})(t)}function f1(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3],_=e[4],y=e[5],v=i[0],C=i[1],E=i[2],S=i[3],R=i[4],O=i[5];return t[0]=o*v+d*C,t[1]=s*v+p*C,t[2]=o*E+d*S,t[3]=s*E+p*S,t[4]=o*R+d*O+_,t[5]=s*R+p*O+y,t}function g1(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}pr.mul=f1,pr.sub=g1;var An={};function gy(t){return gy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},gy(t)}Object.defineProperty(An,"__esModule",{value:!0}),An.create=function(){var t=new Qa.ARRAY_TYPE(9);return Qa.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},An.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},An.clone=function(t){var e=new Qa.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},An.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},An.fromValues=function(t,e,i,o,s,d,p,_,y){var v=new Qa.ARRAY_TYPE(9);return v[0]=t,v[1]=e,v[2]=i,v[3]=o,v[4]=s,v[5]=d,v[6]=p,v[7]=_,v[8]=y,v},An.set=function(t,e,i,o,s,d,p,_,y,v){return t[0]=e,t[1]=i,t[2]=o,t[3]=s,t[4]=d,t[5]=p,t[6]=_,t[7]=y,t[8]=v,t},An.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},An.transpose=function(t,e){if(t===e){var i=e[1],o=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=o,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},An.invert=function(t,e){var i=e[0],o=e[1],s=e[2],d=e[3],p=e[4],_=e[5],y=e[6],v=e[7],C=e[8],E=C*p-_*v,S=-C*d+_*y,R=v*d-p*y,O=i*E+o*S+s*R;return O?(t[0]=E*(O=1/O),t[1]=(-C*o+s*v)*O,t[2]=(_*o-s*p)*O,t[3]=S*O,t[4]=(C*i-s*y)*O,t[5]=(-_*i+s*d)*O,t[6]=R*O,t[7]=(-v*i+o*y)*O,t[8]=(p*i-o*d)*O,t):null},An.adjoint=function(t,e){var i=e[0],o=e[1],s=e[2],d=e[3],p=e[4],_=e[5],y=e[6],v=e[7],C=e[8];return t[0]=p*C-_*v,t[1]=s*v-o*C,t[2]=o*_-s*p,t[3]=_*y-d*C,t[4]=i*C-s*y,t[5]=s*d-i*_,t[6]=d*v-p*y,t[7]=o*y-i*v,t[8]=i*p-o*d,t},An.determinant=function(t){var e=t[3],i=t[4],o=t[5],s=t[6],d=t[7],p=t[8];return t[0]*(p*i-o*d)+t[1]*(-p*e+o*s)+t[2]*(d*e-i*s)},An.multiply=b1,An.translate=function(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3],_=e[4],y=e[5],v=e[6],C=e[7],E=e[8],S=i[0],R=i[1];return t[0]=o,t[1]=s,t[2]=d,t[3]=p,t[4]=_,t[5]=y,t[6]=S*o+R*p+v,t[7]=S*s+R*_+C,t[8]=S*d+R*y+E,t},An.rotate=function(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3],_=e[4],y=e[5],v=e[6],C=e[7],E=e[8],S=Math.sin(i),R=Math.cos(i);return t[0]=R*o+S*p,t[1]=R*s+S*_,t[2]=R*d+S*y,t[3]=R*p-S*o,t[4]=R*_-S*s,t[5]=R*y-S*d,t[6]=v,t[7]=C,t[8]=E,t},An.scale=function(t,e,i){var o=i[0],s=i[1];return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},An.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},An.fromRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=0,t[3]=-i,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},An.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},An.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},An.fromQuat=function(t,e){var i=e[0],o=e[1],s=e[2],d=e[3],p=i+i,_=o+o,y=s+s,v=i*p,C=o*p,E=o*_,S=s*p,R=s*_,O=s*y,F=d*p,V=d*_,U=d*y;return t[0]=1-E-O,t[3]=C-U,t[6]=S+V,t[1]=C+U,t[4]=1-v-O,t[7]=R-F,t[2]=S-V,t[5]=R+F,t[8]=1-v-E,t},An.normalFromMat4=function(t,e){var i=e[0],o=e[1],s=e[2],d=e[3],p=e[4],_=e[5],y=e[6],v=e[7],C=e[8],E=e[9],S=e[10],R=e[11],O=e[12],F=e[13],V=e[14],U=e[15],Z=i*_-o*p,Q=i*y-s*p,K=i*v-d*p,se=o*y-s*_,oe=o*v-d*_,de=s*v-d*y,_e=C*F-E*O,xe=C*V-S*O,Se=C*U-R*O,we=E*V-S*F,ze=E*U-R*F,$e=S*U-R*V,Pe=Z*$e-Q*ze+K*we+se*Se-oe*xe+de*_e;return Pe?(t[0]=(_*$e-y*ze+v*we)*(Pe=1/Pe),t[1]=(y*Se-p*$e-v*xe)*Pe,t[2]=(p*ze-_*Se+v*_e)*Pe,t[3]=(s*ze-o*$e-d*we)*Pe,t[4]=(i*$e-s*Se+d*xe)*Pe,t[5]=(o*Se-i*ze-d*_e)*Pe,t[6]=(F*de-V*oe+U*se)*Pe,t[7]=(V*K-O*de-U*Q)*Pe,t[8]=(O*oe-F*K+U*Z)*Pe,t):null},An.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},An.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},An.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},An.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},An.subtract=y1,An.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},An.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t[6]=e[6]+i[6]*o,t[7]=e[7]+i[7]*o,t[8]=e[8]+i[8]*o,t},An.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},An.equals=function(t,e){var i=t[0],o=t[1],s=t[2],d=t[3],p=t[4],_=t[5],y=t[6],v=t[7],C=t[8],E=e[0],S=e[1],R=e[2],O=e[3],F=e[4],V=e[5],U=e[6],Z=e[7],Q=e[8];return Math.abs(i-E)<=Qa.EPSILON*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(o-S)<=Qa.EPSILON*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(s-R)<=Qa.EPSILON*Math.max(1,Math.abs(s),Math.abs(R))&&Math.abs(d-O)<=Qa.EPSILON*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(p-F)<=Qa.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(_-V)<=Qa.EPSILON*Math.max(1,Math.abs(_),Math.abs(V))&&Math.abs(y-U)<=Qa.EPSILON*Math.max(1,Math.abs(y),Math.abs(U))&&Math.abs(v-Z)<=Qa.EPSILON*Math.max(1,Math.abs(v),Math.abs(Z))&&Math.abs(C-Q)<=Qa.EPSILON*Math.max(1,Math.abs(C),Math.abs(Q))},An.sub=An.mul=void 0;var Qa=function(t,e){if(t&&t.__esModule)return t;if(t===null||gy(t)!=="object"&&typeof t!="function")return{default:t};var i=_1(void 0);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=s?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(o,d,p):o[d]=t[d]}return o.default=t,i&&i.set(t,o),o}(no);function _1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(_1=function(o){return o?i:e})(t)}function b1(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3],_=e[4],y=e[5],v=e[6],C=e[7],E=e[8],S=i[0],R=i[1],O=i[2],F=i[3],V=i[4],U=i[5],Z=i[6],Q=i[7],K=i[8];return t[0]=S*o+R*p+O*v,t[1]=S*s+R*_+O*C,t[2]=S*d+R*y+O*E,t[3]=F*o+V*p+U*v,t[4]=F*s+V*_+U*C,t[5]=F*d+V*y+U*E,t[6]=Z*o+Q*p+K*v,t[7]=Z*s+Q*_+K*C,t[8]=Z*d+Q*y+K*E,t}function y1(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}An.mul=b1,An.sub=y1;var xi={};function _y(t){return _y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_y(t)}Object.defineProperty(xi,"__esModule",{value:!0}),xi.create=function(){var t=new Mr.ARRAY_TYPE(16);return Mr.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},xi.clone=function(t){var e=new Mr.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},xi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},xi.fromValues=function(t,e,i,o,s,d,p,_,y,v,C,E,S,R,O,F){var V=new Mr.ARRAY_TYPE(16);return V[0]=t,V[1]=e,V[2]=i,V[3]=o,V[4]=s,V[5]=d,V[6]=p,V[7]=_,V[8]=y,V[9]=v,V[10]=C,V[11]=E,V[12]=S,V[13]=R,V[14]=O,V[15]=F,V},xi.set=function(t,e,i,o,s,d,p,_,y,v,C,E,S,R,O,F,V){return t[0]=e,t[1]=i,t[2]=o,t[3]=s,t[4]=d,t[5]=p,t[6]=_,t[7]=y,t[8]=v,t[9]=C,t[10]=E,t[11]=S,t[12]=R,t[13]=O,t[14]=F,t[15]=V,t},xi.identity=x1,xi.transpose=function(t,e){if(t===e){var i=e[1],o=e[2],s=e[3],d=e[6],p=e[7],_=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=o,t[9]=d,t[11]=e[14],t[12]=s,t[13]=p,t[14]=_}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},xi.invert=function(t,e){var i=e[0],o=e[1],s=e[2],d=e[3],p=e[4],_=e[5],y=e[6],v=e[7],C=e[8],E=e[9],S=e[10],R=e[11],O=e[12],F=e[13],V=e[14],U=e[15],Z=i*_-o*p,Q=i*y-s*p,K=i*v-d*p,se=o*y-s*_,oe=o*v-d*_,de=s*v-d*y,_e=C*F-E*O,xe=C*V-S*O,Se=C*U-R*O,we=E*V-S*F,ze=E*U-R*F,$e=S*U-R*V,Pe=Z*$e-Q*ze+K*we+se*Se-oe*xe+de*_e;return Pe?(t[0]=(_*$e-y*ze+v*we)*(Pe=1/Pe),t[1]=(s*ze-o*$e-d*we)*Pe,t[2]=(F*de-V*oe+U*se)*Pe,t[3]=(S*oe-E*de-R*se)*Pe,t[4]=(y*Se-p*$e-v*xe)*Pe,t[5]=(i*$e-s*Se+d*xe)*Pe,t[6]=(V*K-O*de-U*Q)*Pe,t[7]=(C*de-S*K+R*Q)*Pe,t[8]=(p*ze-_*Se+v*_e)*Pe,t[9]=(o*Se-i*ze-d*_e)*Pe,t[10]=(O*oe-F*K+U*Z)*Pe,t[11]=(E*K-C*oe-R*Z)*Pe,t[12]=(_*xe-p*we-y*_e)*Pe,t[13]=(i*we-o*xe+s*_e)*Pe,t[14]=(F*Q-O*se-V*Z)*Pe,t[15]=(C*se-E*Q+S*Z)*Pe,t):null},xi.adjoint=function(t,e){var i=e[0],o=e[1],s=e[2],d=e[3],p=e[4],_=e[5],y=e[6],v=e[7],C=e[8],E=e[9],S=e[10],R=e[11],O=e[12],F=e[13],V=e[14],U=e[15];return t[0]=_*(S*U-R*V)-E*(y*U-v*V)+F*(y*R-v*S),t[1]=-(o*(S*U-R*V)-E*(s*U-d*V)+F*(s*R-d*S)),t[2]=o*(y*U-v*V)-_*(s*U-d*V)+F*(s*v-d*y),t[3]=-(o*(y*R-v*S)-_*(s*R-d*S)+E*(s*v-d*y)),t[4]=-(p*(S*U-R*V)-C*(y*U-v*V)+O*(y*R-v*S)),t[5]=i*(S*U-R*V)-C*(s*U-d*V)+O*(s*R-d*S),t[6]=-(i*(y*U-v*V)-p*(s*U-d*V)+O*(s*v-d*y)),t[7]=i*(y*R-v*S)-p*(s*R-d*S)+C*(s*v-d*y),t[8]=p*(E*U-R*F)-C*(_*U-v*F)+O*(_*R-v*E),t[9]=-(i*(E*U-R*F)-C*(o*U-d*F)+O*(o*R-d*E)),t[10]=i*(_*U-v*F)-p*(o*U-d*F)+O*(o*v-d*_),t[11]=-(i*(_*R-v*E)-p*(o*R-d*E)+C*(o*v-d*_)),t[12]=-(p*(E*V-S*F)-C*(_*V-y*F)+O*(_*S-y*E)),t[13]=i*(E*V-S*F)-C*(o*V-s*F)+O*(o*S-s*E),t[14]=-(i*(_*V-y*F)-p*(o*V-s*F)+O*(o*y-s*_)),t[15]=i*(_*S-y*E)-p*(o*S-s*E)+C*(o*y-s*_),t},xi.determinant=function(t){var e=t[0],i=t[1],o=t[2],s=t[3],d=t[4],p=t[5],_=t[6],y=t[7],v=t[8],C=t[9],E=t[10],S=t[11],R=t[12],O=t[13],F=t[14],V=t[15];return(e*p-i*d)*(E*V-S*F)-(e*_-o*d)*(C*V-S*O)+(e*y-s*d)*(C*F-E*O)+(i*_-o*p)*(v*V-S*R)-(i*y-s*p)*(v*F-E*R)+(o*y-s*_)*(v*O-C*R)},xi.multiply=w1,xi.translate=function(t,e,i){var o,s,d,p,_,y,v,C,E,S,R,O,F=i[0],V=i[1],U=i[2];return e===t?(t[12]=e[0]*F+e[4]*V+e[8]*U+e[12],t[13]=e[1]*F+e[5]*V+e[9]*U+e[13],t[14]=e[2]*F+e[6]*V+e[10]*U+e[14],t[15]=e[3]*F+e[7]*V+e[11]*U+e[15]):(s=e[1],d=e[2],p=e[3],_=e[4],y=e[5],v=e[6],C=e[7],E=e[8],S=e[9],R=e[10],O=e[11],t[0]=o=e[0],t[1]=s,t[2]=d,t[3]=p,t[4]=_,t[5]=y,t[6]=v,t[7]=C,t[8]=E,t[9]=S,t[10]=R,t[11]=O,t[12]=o*F+_*V+E*U+e[12],t[13]=s*F+y*V+S*U+e[13],t[14]=d*F+v*V+R*U+e[14],t[15]=p*F+C*V+O*U+e[15]),t},xi.scale=function(t,e,i){var o=i[0],s=i[1],d=i[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*d,t[9]=e[9]*d,t[10]=e[10]*d,t[11]=e[11]*d,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},xi.rotate=function(t,e,i,o){var s,d,p,_,y,v,C,E,S,R,O,F,V,U,Z,Q,K,se,oe,de,_e,xe,Se,we,ze=o[0],$e=o[1],Pe=o[2],He=Math.hypot(ze,$e,Pe);return He<Mr.EPSILON?null:(ze*=He=1/He,$e*=He,Pe*=He,s=Math.sin(i),d=Math.cos(i),y=e[1],v=e[2],C=e[3],S=e[5],R=e[6],O=e[7],V=e[9],U=e[10],Z=e[11],Q=ze*ze*(p=1-d)+d,oe=ze*$e*p-Pe*s,de=$e*$e*p+d,_e=Pe*$e*p+ze*s,xe=ze*Pe*p+$e*s,Se=$e*Pe*p-ze*s,we=Pe*Pe*p+d,t[0]=(_=e[0])*Q+(E=e[4])*(K=$e*ze*p+Pe*s)+(F=e[8])*(se=Pe*ze*p-$e*s),t[1]=y*Q+S*K+V*se,t[2]=v*Q+R*K+U*se,t[3]=C*Q+O*K+Z*se,t[4]=_*oe+E*de+F*_e,t[5]=y*oe+S*de+V*_e,t[6]=v*oe+R*de+U*_e,t[7]=C*oe+O*de+Z*_e,t[8]=_*xe+E*Se+F*we,t[9]=y*xe+S*Se+V*we,t[10]=v*xe+R*Se+U*we,t[11]=C*xe+O*Se+Z*we,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},xi.rotateX=function(t,e,i){var o=Math.sin(i),s=Math.cos(i),d=e[4],p=e[5],_=e[6],y=e[7],v=e[8],C=e[9],E=e[10],S=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=d*s+v*o,t[5]=p*s+C*o,t[6]=_*s+E*o,t[7]=y*s+S*o,t[8]=v*s-d*o,t[9]=C*s-p*o,t[10]=E*s-_*o,t[11]=S*s-y*o,t},xi.rotateY=function(t,e,i){var o=Math.sin(i),s=Math.cos(i),d=e[0],p=e[1],_=e[2],y=e[3],v=e[8],C=e[9],E=e[10],S=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*s-v*o,t[1]=p*s-C*o,t[2]=_*s-E*o,t[3]=y*s-S*o,t[8]=d*o+v*s,t[9]=p*o+C*s,t[10]=_*o+E*s,t[11]=y*o+S*s,t},xi.rotateZ=function(t,e,i){var o=Math.sin(i),s=Math.cos(i),d=e[0],p=e[1],_=e[2],y=e[3],v=e[4],C=e[5],E=e[6],S=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*s+v*o,t[1]=p*s+C*o,t[2]=_*s+E*o,t[3]=y*s+S*o,t[4]=v*s-d*o,t[5]=C*s-p*o,t[6]=E*s-_*o,t[7]=S*s-y*o,t},xi.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},xi.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xi.fromRotation=function(t,e,i){var o,s,d,p=i[0],_=i[1],y=i[2],v=Math.hypot(p,_,y);return v<Mr.EPSILON?null:(p*=v=1/v,_*=v,y*=v,o=Math.sin(e),s=Math.cos(e),t[0]=p*p*(d=1-s)+s,t[1]=_*p*d+y*o,t[2]=y*p*d-_*o,t[3]=0,t[4]=p*_*d-y*o,t[5]=_*_*d+s,t[6]=y*_*d+p*o,t[7]=0,t[8]=p*y*d+_*o,t[9]=_*y*d-p*o,t[10]=y*y*d+s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},xi.fromXRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xi.fromYRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xi.fromZRotation=function(t,e){var i=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xi.fromRotationTranslation=C1,xi.fromQuat2=function(t,e){var i=new Mr.ARRAY_TYPE(3),o=-e[0],s=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],v=e[6],C=e[7],E=o*o+s*s+d*d+p*p;return E>0?(i[0]=2*(_*p+C*o+y*d-v*s)/E,i[1]=2*(y*p+C*s+v*o-_*d)/E,i[2]=2*(v*p+C*d+_*s-y*o)/E):(i[0]=2*(_*p+C*o+y*d-v*s),i[1]=2*(y*p+C*s+v*o-_*d),i[2]=2*(v*p+C*d+_*s-y*o)),C1(t,e,i),t},xi.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},xi.getScaling=T1,xi.getRotation=function(t,e){var i=new Mr.ARRAY_TYPE(3);T1(i,e);var o=1/i[0],s=1/i[1],d=1/i[2],p=e[0]*o,_=e[1]*s,y=e[2]*d,v=e[4]*o,C=e[5]*s,E=e[6]*d,S=e[8]*o,R=e[9]*s,O=e[10]*d,F=p+C+O,V=0;return F>0?(V=2*Math.sqrt(F+1),t[3]=.25*V,t[0]=(E-R)/V,t[1]=(S-y)/V,t[2]=(_-v)/V):p>C&&p>O?(V=2*Math.sqrt(1+p-C-O),t[3]=(E-R)/V,t[0]=.25*V,t[1]=(_+v)/V,t[2]=(S+y)/V):C>O?(V=2*Math.sqrt(1+C-p-O),t[3]=(S-y)/V,t[0]=(_+v)/V,t[1]=.25*V,t[2]=(E+R)/V):(V=2*Math.sqrt(1+O-p-C),t[3]=(_-v)/V,t[0]=(S+y)/V,t[1]=(E+R)/V,t[2]=.25*V),t},xi.fromRotationTranslationScale=function(t,e,i,o){var s=e[0],d=e[1],p=e[2],_=e[3],y=s+s,v=d+d,C=p+p,E=s*y,S=s*v,R=s*C,O=d*v,F=d*C,V=p*C,U=_*y,Z=_*v,Q=_*C,K=o[0],se=o[1],oe=o[2];return t[0]=(1-(O+V))*K,t[1]=(S+Q)*K,t[2]=(R-Z)*K,t[3]=0,t[4]=(S-Q)*se,t[5]=(1-(E+V))*se,t[6]=(F+U)*se,t[7]=0,t[8]=(R+Z)*oe,t[9]=(F-U)*oe,t[10]=(1-(E+O))*oe,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},xi.fromRotationTranslationScaleOrigin=function(t,e,i,o,s){var d=e[0],p=e[1],_=e[2],y=e[3],v=d+d,C=p+p,E=_+_,S=d*v,R=d*C,O=d*E,F=p*C,V=p*E,U=_*E,Z=y*v,Q=y*C,K=y*E,se=o[0],oe=o[1],de=o[2],_e=s[0],xe=s[1],Se=s[2],we=(1-(F+U))*se,ze=(R+K)*se,$e=(O-Q)*se,Pe=(R-K)*oe,He=(1-(S+U))*oe,De=(V+Z)*oe,je=(O+Q)*de,ut=(V-Z)*de,qe=(1-(S+F))*de;return t[0]=we,t[1]=ze,t[2]=$e,t[3]=0,t[4]=Pe,t[5]=He,t[6]=De,t[7]=0,t[8]=je,t[9]=ut,t[10]=qe,t[11]=0,t[12]=i[0]+_e-(we*_e+Pe*xe+je*Se),t[13]=i[1]+xe-(ze*_e+He*xe+ut*Se),t[14]=i[2]+Se-($e*_e+De*xe+qe*Se),t[15]=1,t},xi.fromQuat=function(t,e){var i=e[0],o=e[1],s=e[2],d=e[3],p=i+i,_=o+o,y=s+s,v=i*p,C=o*p,E=o*_,S=s*p,R=s*_,O=s*y,F=d*p,V=d*_,U=d*y;return t[0]=1-E-O,t[1]=C+U,t[2]=S-V,t[3]=0,t[4]=C-U,t[5]=1-v-O,t[6]=R+F,t[7]=0,t[8]=S+V,t[9]=R-F,t[10]=1-v-E,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xi.frustum=function(t,e,i,o,s,d,p){var _=1/(i-e),y=1/(s-o),v=1/(d-p);return t[0]=2*d*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*d*y,t[6]=0,t[7]=0,t[8]=(i+e)*_,t[9]=(s+o)*y,t[10]=(p+d)*v,t[11]=-1,t[12]=0,t[13]=0,t[14]=p*d*2*v,t[15]=0,t},xi.perspectiveNO=E1,xi.perspectiveZO=function(t,e,i,o,s){var d,p=1/Math.tan(e/2);return t[0]=p/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(t[10]=s*(d=1/(o-s)),t[14]=s*o*d):(t[10]=-1,t[14]=-o),t},xi.perspectiveFromFieldOfView=function(t,e,i,o){var s=Math.tan(e.upDegrees*Math.PI/180),d=Math.tan(e.downDegrees*Math.PI/180),p=Math.tan(e.leftDegrees*Math.PI/180),_=Math.tan(e.rightDegrees*Math.PI/180),y=2/(p+_),v=2/(s+d);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=v,t[6]=0,t[7]=0,t[8]=-(p-_)*y*.5,t[9]=(s-d)*v*.5,t[10]=o/(i-o),t[11]=-1,t[12]=0,t[13]=0,t[14]=o*i/(i-o),t[15]=0,t},xi.orthoNO=I1,xi.orthoZO=function(t,e,i,o,s,d,p){var _=1/(e-i),y=1/(o-s),v=1/(d-p);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=v,t[11]=0,t[12]=(e+i)*_,t[13]=(s+o)*y,t[14]=d*v,t[15]=1,t},xi.lookAt=function(t,e,i,o){var s,d,p,_,y,v,C,E,S,R,O=e[0],F=e[1],V=e[2],U=o[0],Z=o[1],Q=o[2],K=i[0],se=i[1],oe=i[2];return Math.abs(O-K)<Mr.EPSILON&&Math.abs(F-se)<Mr.EPSILON&&Math.abs(V-oe)<Mr.EPSILON?x1(t):(C=O-K,E=F-se,S=V-oe,s=Z*(S*=R=1/Math.hypot(C,E,S))-Q*(E*=R),d=Q*(C*=R)-U*S,p=U*E-Z*C,(R=Math.hypot(s,d,p))?(s*=R=1/R,d*=R,p*=R):(s=0,d=0,p=0),_=E*p-S*d,y=S*s-C*p,v=C*d-E*s,(R=Math.hypot(_,y,v))?(_*=R=1/R,y*=R,v*=R):(_=0,y=0,v=0),t[0]=s,t[1]=_,t[2]=C,t[3]=0,t[4]=d,t[5]=y,t[6]=E,t[7]=0,t[8]=p,t[9]=v,t[10]=S,t[11]=0,t[12]=-(s*O+d*F+p*V),t[13]=-(_*O+y*F+v*V),t[14]=-(C*O+E*F+S*V),t[15]=1,t)},xi.targetTo=function(t,e,i,o){var s=e[0],d=e[1],p=e[2],_=o[0],y=o[1],v=o[2],C=s-i[0],E=d-i[1],S=p-i[2],R=C*C+E*E+S*S;R>0&&(C*=R=1/Math.sqrt(R),E*=R,S*=R);var O=y*S-v*E,F=v*C-_*S,V=_*E-y*C;return(R=O*O+F*F+V*V)>0&&(O*=R=1/Math.sqrt(R),F*=R,V*=R),t[0]=O,t[1]=F,t[2]=V,t[3]=0,t[4]=E*V-S*F,t[5]=S*O-C*V,t[6]=C*F-E*O,t[7]=0,t[8]=C,t[9]=E,t[10]=S,t[11]=0,t[12]=s,t[13]=d,t[14]=p,t[15]=1,t},xi.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},xi.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},xi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},xi.subtract=S1,xi.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},xi.multiplyScalarAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t[4]=e[4]+i[4]*o,t[5]=e[5]+i[5]*o,t[6]=e[6]+i[6]*o,t[7]=e[7]+i[7]*o,t[8]=e[8]+i[8]*o,t[9]=e[9]+i[9]*o,t[10]=e[10]+i[10]*o,t[11]=e[11]+i[11]*o,t[12]=e[12]+i[12]*o,t[13]=e[13]+i[13]*o,t[14]=e[14]+i[14]*o,t[15]=e[15]+i[15]*o,t},xi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},xi.equals=function(t,e){var i=t[0],o=t[1],s=t[2],d=t[3],p=t[4],_=t[5],y=t[6],v=t[7],C=t[8],E=t[9],S=t[10],R=t[11],O=t[12],F=t[13],V=t[14],U=t[15],Z=e[0],Q=e[1],K=e[2],se=e[3],oe=e[4],de=e[5],_e=e[6],xe=e[7],Se=e[8],we=e[9],ze=e[10],$e=e[11],Pe=e[12],He=e[13],De=e[14],je=e[15];return Math.abs(i-Z)<=Mr.EPSILON*Math.max(1,Math.abs(i),Math.abs(Z))&&Math.abs(o-Q)<=Mr.EPSILON*Math.max(1,Math.abs(o),Math.abs(Q))&&Math.abs(s-K)<=Mr.EPSILON*Math.max(1,Math.abs(s),Math.abs(K))&&Math.abs(d-se)<=Mr.EPSILON*Math.max(1,Math.abs(d),Math.abs(se))&&Math.abs(p-oe)<=Mr.EPSILON*Math.max(1,Math.abs(p),Math.abs(oe))&&Math.abs(_-de)<=Mr.EPSILON*Math.max(1,Math.abs(_),Math.abs(de))&&Math.abs(y-_e)<=Mr.EPSILON*Math.max(1,Math.abs(y),Math.abs(_e))&&Math.abs(v-xe)<=Mr.EPSILON*Math.max(1,Math.abs(v),Math.abs(xe))&&Math.abs(C-Se)<=Mr.EPSILON*Math.max(1,Math.abs(C),Math.abs(Se))&&Math.abs(E-we)<=Mr.EPSILON*Math.max(1,Math.abs(E),Math.abs(we))&&Math.abs(S-ze)<=Mr.EPSILON*Math.max(1,Math.abs(S),Math.abs(ze))&&Math.abs(R-$e)<=Mr.EPSILON*Math.max(1,Math.abs(R),Math.abs($e))&&Math.abs(O-Pe)<=Mr.EPSILON*Math.max(1,Math.abs(O),Math.abs(Pe))&&Math.abs(F-He)<=Mr.EPSILON*Math.max(1,Math.abs(F),Math.abs(He))&&Math.abs(V-De)<=Mr.EPSILON*Math.max(1,Math.abs(V),Math.abs(De))&&Math.abs(U-je)<=Mr.EPSILON*Math.max(1,Math.abs(U),Math.abs(je))},xi.sub=xi.mul=xi.ortho=xi.perspective=void 0;var Mr=function(t,e){if(t&&t.__esModule)return t;if(t===null||_y(t)!=="object"&&typeof t!="function")return{default:t};var i=v1(void 0);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=s?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(o,d,p):o[d]=t[d]}return o.default=t,i&&i.set(t,o),o}(no);function v1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(v1=function(o){return o?i:e})(t)}function x1(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function w1(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3],_=e[4],y=e[5],v=e[6],C=e[7],E=e[8],S=e[9],R=e[10],O=e[11],F=e[12],V=e[13],U=e[14],Z=e[15],Q=i[0],K=i[1],se=i[2],oe=i[3];return t[0]=Q*o+K*_+se*E+oe*F,t[1]=Q*s+K*y+se*S+oe*V,t[2]=Q*d+K*v+se*R+oe*U,t[3]=Q*p+K*C+se*O+oe*Z,t[4]=(Q=i[4])*o+(K=i[5])*_+(se=i[6])*E+(oe=i[7])*F,t[5]=Q*s+K*y+se*S+oe*V,t[6]=Q*d+K*v+se*R+oe*U,t[7]=Q*p+K*C+se*O+oe*Z,t[8]=(Q=i[8])*o+(K=i[9])*_+(se=i[10])*E+(oe=i[11])*F,t[9]=Q*s+K*y+se*S+oe*V,t[10]=Q*d+K*v+se*R+oe*U,t[11]=Q*p+K*C+se*O+oe*Z,t[12]=(Q=i[12])*o+(K=i[13])*_+(se=i[14])*E+(oe=i[15])*F,t[13]=Q*s+K*y+se*S+oe*V,t[14]=Q*d+K*v+se*R+oe*U,t[15]=Q*p+K*C+se*O+oe*Z,t}function C1(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3],_=o+o,y=s+s,v=d+d,C=o*_,E=o*y,S=o*v,R=s*y,O=s*v,F=d*v,V=p*_,U=p*y,Z=p*v;return t[0]=1-(R+F),t[1]=E+Z,t[2]=S-U,t[3]=0,t[4]=E-Z,t[5]=1-(C+F),t[6]=O+V,t[7]=0,t[8]=S+U,t[9]=O-V,t[10]=1-(C+R),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function T1(t,e){var i=e[4],o=e[5],s=e[6],d=e[8],p=e[9],_=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,o,s),t[2]=Math.hypot(d,p,_),t}function E1(t,e,i,o,s){var d,p=1/Math.tan(e/2);return t[0]=p/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(t[10]=(s+o)*(d=1/(o-s)),t[14]=2*s*o*d):(t[10]=-1,t[14]=-2*o),t}function I1(t,e,i,o,s,d,p){var _=1/(e-i),y=1/(o-s),v=1/(d-p);return t[0]=-2*_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*v,t[11]=0,t[12]=(e+i)*_,t[13]=(s+o)*y,t[14]=(p+d)*v,t[15]=1,t}function S1(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}xi.perspective=E1,xi.ortho=I1,xi.mul=w1,xi.sub=S1;var pi={},bi={};function by(t){return by=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},by(t)}Object.defineProperty(bi,"__esModule",{value:!0}),bi.create=A1,bi.clone=function(t){var e=new Tc.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},bi.length=D1,bi.fromValues=function(t,e,i){var o=new Tc.ARRAY_TYPE(3);return o[0]=t,o[1]=e,o[2]=i,o},bi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},bi.set=function(t,e,i,o){return t[0]=e,t[1]=i,t[2]=o,t},bi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},bi.subtract=k1,bi.multiply=R1,bi.divide=P1,bi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},bi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},bi.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},bi.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},bi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},bi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},bi.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t},bi.distance=O1,bi.squaredDistance=F1,bi.squaredLength=L1,bi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},bi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},bi.normalize=function(t,e){var i=e[0],o=e[1],s=e[2],d=i*i+o*o+s*s;return d>0&&(d=1/Math.sqrt(d)),t[0]=e[0]*d,t[1]=e[1]*d,t[2]=e[2]*d,t},bi.dot=z1,bi.cross=function(t,e,i){var o=e[0],s=e[1],d=e[2],p=i[0],_=i[1],y=i[2];return t[0]=s*y-d*_,t[1]=d*p-o*y,t[2]=o*_-s*p,t},bi.lerp=function(t,e,i,o){var s=e[0],d=e[1],p=e[2];return t[0]=s+o*(i[0]-s),t[1]=d+o*(i[1]-d),t[2]=p+o*(i[2]-p),t},bi.hermite=function(t,e,i,o,s,d){var p=d*d,_=p*(2*d-3)+1,y=p*(d-2)+d,v=p*(d-1),C=p*(3-2*d);return t[0]=e[0]*_+i[0]*y+o[0]*v+s[0]*C,t[1]=e[1]*_+i[1]*y+o[1]*v+s[1]*C,t[2]=e[2]*_+i[2]*y+o[2]*v+s[2]*C,t},bi.bezier=function(t,e,i,o,s,d){var p=1-d,_=p*p,y=d*d,v=_*p,C=3*d*_,E=3*y*p,S=y*d;return t[0]=e[0]*v+i[0]*C+o[0]*E+s[0]*S,t[1]=e[1]*v+i[1]*C+o[1]*E+s[1]*S,t[2]=e[2]*v+i[2]*C+o[2]*E+s[2]*S,t},bi.random=function(t,e){e=e||1;var i=2*Tc.RANDOM()*Math.PI,o=2*Tc.RANDOM()-1,s=Math.sqrt(1-o*o)*e;return t[0]=Math.cos(i)*s,t[1]=Math.sin(i)*s,t[2]=o*e,t},bi.transformMat4=function(t,e,i){var o=e[0],s=e[1],d=e[2],p=i[3]*o+i[7]*s+i[11]*d+i[15];return t[0]=(i[0]*o+i[4]*s+i[8]*d+i[12])/(p=p||1),t[1]=(i[1]*o+i[5]*s+i[9]*d+i[13])/p,t[2]=(i[2]*o+i[6]*s+i[10]*d+i[14])/p,t},bi.transformMat3=function(t,e,i){var o=e[0],s=e[1],d=e[2];return t[0]=o*i[0]+s*i[3]+d*i[6],t[1]=o*i[1]+s*i[4]+d*i[7],t[2]=o*i[2]+s*i[5]+d*i[8],t},bi.transformQuat=function(t,e,i){var o=i[0],s=i[1],d=i[2],p=e[0],_=e[1],y=e[2],v=s*y-d*_,C=d*p-o*y,E=o*_-s*p,S=s*E-d*C,R=d*v-o*E,O=o*C-s*v,F=2*i[3];return C*=F,E*=F,R*=2,O*=2,t[0]=p+(v*=F)+(S*=2),t[1]=_+C+R,t[2]=y+E+O,t},bi.rotateX=function(t,e,i,o){var s=[],d=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],d[0]=s[0],d[1]=s[1]*Math.cos(o)-s[2]*Math.sin(o),d[2]=s[1]*Math.sin(o)+s[2]*Math.cos(o),t[0]=d[0]+i[0],t[1]=d[1]+i[1],t[2]=d[2]+i[2],t},bi.rotateY=function(t,e,i,o){var s=[],d=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],d[0]=s[2]*Math.sin(o)+s[0]*Math.cos(o),d[1]=s[1],d[2]=s[2]*Math.cos(o)-s[0]*Math.sin(o),t[0]=d[0]+i[0],t[1]=d[1]+i[1],t[2]=d[2]+i[2],t},bi.rotateZ=function(t,e,i,o){var s=[],d=[];return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],d[0]=s[0]*Math.cos(o)-s[1]*Math.sin(o),d[1]=s[0]*Math.sin(o)+s[1]*Math.cos(o),d[2]=s[2],t[0]=d[0]+i[0],t[1]=d[1]+i[1],t[2]=d[2]+i[2],t},bi.angle=function(t,e){var i=t[0],o=t[1],s=t[2],d=e[0],p=e[1],_=e[2],y=Math.sqrt(i*i+o*o+s*s)*Math.sqrt(d*d+p*p+_*_),v=y&&z1(t,e)/y;return Math.acos(Math.min(Math.max(v,-1),1))},bi.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},bi.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},bi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},bi.equals=function(t,e){var i=t[0],o=t[1],s=t[2],d=e[0],p=e[1],_=e[2];return Math.abs(i-d)<=Tc.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-p)<=Tc.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-_)<=Tc.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))},bi.forEach=bi.sqrLen=bi.len=bi.sqrDist=bi.dist=bi.div=bi.mul=bi.sub=void 0;var Tc=function(t,e){if(t&&t.__esModule)return t;if(t===null||by(t)!=="object"&&typeof t!="function")return{default:t};var i=M1(void 0);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=s?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(o,d,p):o[d]=t[d]}return o.default=t,i&&i.set(t,o),o}(no);function M1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(M1=function(o){return o?i:e})(t)}function A1(){var t=new Tc.ARRAY_TYPE(3);return Tc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function D1(t){return Math.hypot(t[0],t[1],t[2])}function k1(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function R1(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function P1(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function O1(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function F1(t,e){var i=e[0]-t[0],o=e[1]-t[1],s=e[2]-t[2];return i*i+o*o+s*s}function L1(t){var e=t[0],i=t[1],o=t[2];return e*e+i*i+o*o}function z1(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}bi.sub=k1,bi.mul=R1,bi.div=P1,bi.dist=O1,bi.sqrDist=F1,bi.len=D1,bi.sqrLen=L1;var Ec,CA=(Ec=A1(),function(t,e,i,o,s,d){var p,_;for(e||(e=3),i||(i=0),_=o?Math.min(o*e+i,t.length):t.length,p=i;p<_;p+=e)Ec[0]=t[p],Ec[1]=t[p+1],Ec[2]=t[p+2],s(Ec,Ec,d),t[p]=Ec[0],t[p+1]=Ec[1],t[p+2]=Ec[2];return t});bi.forEach=CA;var Li={};function yy(t){return yy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yy(t)}Object.defineProperty(Li,"__esModule",{value:!0}),Li.create=B1,Li.clone=function(t){var e=new ws.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Li.fromValues=function(t,e,i,o){var s=new ws.ARRAY_TYPE(4);return s[0]=t,s[1]=e,s[2]=i,s[3]=o,s},Li.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Li.set=function(t,e,i,o,s){return t[0]=e,t[1]=i,t[2]=o,t[3]=s,t},Li.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Li.subtract=V1,Li.multiply=j1,Li.divide=U1,Li.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Li.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Li.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},Li.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},Li.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Li.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Li.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t[2]=e[2]+i[2]*o,t[3]=e[3]+i[3]*o,t},Li.distance=G1,Li.squaredDistance=H1,Li.length=$1,Li.squaredLength=q1,Li.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Li.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Li.normalize=function(t,e){var i=e[0],o=e[1],s=e[2],d=e[3],p=i*i+o*o+s*s+d*d;return p>0&&(p=1/Math.sqrt(p)),t[0]=i*p,t[1]=o*p,t[2]=s*p,t[3]=d*p,t},Li.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Li.cross=function(t,e,i,o){var s=i[0]*o[1]-i[1]*o[0],d=i[0]*o[2]-i[2]*o[0],p=i[0]*o[3]-i[3]*o[0],_=i[1]*o[2]-i[2]*o[1],y=i[1]*o[3]-i[3]*o[1],v=i[2]*o[3]-i[3]*o[2],C=e[0],E=e[1],S=e[2],R=e[3];return t[0]=E*v-S*y+R*_,t[1]=-C*v+S*p-R*d,t[2]=C*y-E*p+R*s,t[3]=-C*_+E*d-S*s,t},Li.lerp=function(t,e,i,o){var s=e[0],d=e[1],p=e[2],_=e[3];return t[0]=s+o*(i[0]-s),t[1]=d+o*(i[1]-d),t[2]=p+o*(i[2]-p),t[3]=_+o*(i[3]-_),t},Li.random=function(t,e){var i,o,s,d,p,_;e=e||1;do p=(i=2*ws.RANDOM()-1)*i+(o=2*ws.RANDOM()-1)*o;while(p>=1);do _=(s=2*ws.RANDOM()-1)*s+(d=2*ws.RANDOM()-1)*d;while(_>=1);var y=Math.sqrt((1-p)/_);return t[0]=e*i,t[1]=e*o,t[2]=e*s*y,t[3]=e*d*y,t},Li.transformMat4=function(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3];return t[0]=i[0]*o+i[4]*s+i[8]*d+i[12]*p,t[1]=i[1]*o+i[5]*s+i[9]*d+i[13]*p,t[2]=i[2]*o+i[6]*s+i[10]*d+i[14]*p,t[3]=i[3]*o+i[7]*s+i[11]*d+i[15]*p,t},Li.transformQuat=function(t,e,i){var o=e[0],s=e[1],d=e[2],p=i[0],_=i[1],y=i[2],v=i[3],C=v*o+_*d-y*s,E=v*s+y*o-p*d,S=v*d+p*s-_*o,R=-p*o-_*s-y*d;return t[0]=C*v+R*-p+E*-y-S*-_,t[1]=E*v+R*-_+S*-p-C*-y,t[2]=S*v+R*-y+C*-_-E*-p,t[3]=e[3],t},Li.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Li.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Li.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Li.equals=function(t,e){var i=t[0],o=t[1],s=t[2],d=t[3],p=e[0],_=e[1],y=e[2],v=e[3];return Math.abs(i-p)<=ws.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-_)<=ws.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(s-y)<=ws.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(d-v)<=ws.EPSILON*Math.max(1,Math.abs(d),Math.abs(v))},Li.forEach=Li.sqrLen=Li.len=Li.sqrDist=Li.dist=Li.div=Li.mul=Li.sub=void 0;var ws=function(t,e){if(t&&t.__esModule)return t;if(t===null||yy(t)!=="object"&&typeof t!="function")return{default:t};var i=N1(void 0);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=s?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(o,d,p):o[d]=t[d]}return o.default=t,i&&i.set(t,o),o}(no);function N1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(N1=function(o){return o?i:e})(t)}function B1(){var t=new ws.ARRAY_TYPE(4);return ws.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function V1(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function j1(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function U1(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function G1(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function H1(t,e){var i=e[0]-t[0],o=e[1]-t[1],s=e[2]-t[2],d=e[3]-t[3];return i*i+o*o+s*s+d*d}function $1(t){return Math.hypot(t[0],t[1],t[2],t[3])}function q1(t){var e=t[0],i=t[1],o=t[2],s=t[3];return e*e+i*i+o*o+s*s}Li.sub=V1,Li.mul=j1,Li.div=U1,Li.dist=G1,Li.sqrDist=H1,Li.len=$1,Li.sqrLen=q1;var TA=function(){var t=B1();return function(e,i,o,s,d,p){var _,y;for(i||(i=4),o||(o=0),y=s?Math.min(s*i+o,e.length):e.length,_=o;_<y;_+=i)t[0]=e[_],t[1]=e[_+1],t[2]=e[_+2],t[3]=e[_+3],d(t,t,p),e[_]=t[0],e[_+1]=t[1],e[_+2]=t[2],e[_+3]=t[3];return e}}();function vy(t){return vy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vy(t)}Li.forEach=TA,Object.defineProperty(pi,"__esModule",{value:!0}),pi.create=xy,pi.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},pi.setAxisAngle=Z1,pi.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),o=Math.sin(i/2);return o>mu.EPSILON?(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o):(t[0]=1,t[1]=0,t[2]=0),i},pi.getAngle=function(t,e){var i=ew(t,e);return Math.acos(2*i*i-1)},pi.multiply=Y1,pi.rotateX=function(t,e,i){i*=.5;var o=e[0],s=e[1],d=e[2],p=e[3],_=Math.sin(i),y=Math.cos(i);return t[0]=o*y+p*_,t[1]=s*y+d*_,t[2]=d*y-s*_,t[3]=p*y-o*_,t},pi.rotateY=function(t,e,i){i*=.5;var o=e[0],s=e[1],d=e[2],p=e[3],_=Math.sin(i),y=Math.cos(i);return t[0]=o*y-d*_,t[1]=s*y+p*_,t[2]=d*y+o*_,t[3]=p*y-s*_,t},pi.rotateZ=function(t,e,i){i*=.5;var o=e[0],s=e[1],d=e[2],p=e[3],_=Math.sin(i),y=Math.cos(i);return t[0]=o*y+s*_,t[1]=s*y-o*_,t[2]=d*y+p*_,t[3]=p*y-d*_,t},pi.calculateW=function(t,e){var i=e[0],o=e[1],s=e[2];return t[0]=i,t[1]=o,t[2]=s,t[3]=Math.sqrt(Math.abs(1-i*i-o*o-s*s)),t},pi.exp=X1,pi.ln=K1,pi.pow=function(t,e,i){return K1(t,e),J1(t,t,i),X1(t,t),t},pi.slerp=Vg,pi.random=function(t){var e=mu.RANDOM(),i=mu.RANDOM(),o=mu.RANDOM(),s=Math.sqrt(1-e),d=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*i),t[1]=s*Math.cos(2*Math.PI*i),t[2]=d*Math.sin(2*Math.PI*o),t[3]=d*Math.cos(2*Math.PI*o),t},pi.invert=function(t,e){var i=e[0],o=e[1],s=e[2],d=e[3],p=i*i+o*o+s*s+d*d,_=p?1/p:0;return t[0]=-i*_,t[1]=-o*_,t[2]=-s*_,t[3]=d*_,t},pi.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},pi.fromMat3=Q1,pi.fromEuler=function(t,e,i,o){var s=.5*Math.PI/180;e*=s,i*=s,o*=s;var d=Math.sin(e),p=Math.cos(e),_=Math.sin(i),y=Math.cos(i),v=Math.sin(o),C=Math.cos(o);return t[0]=d*y*C-p*_*v,t[1]=p*_*C+d*y*v,t[2]=p*y*v-d*_*C,t[3]=p*y*C+d*_*v,t},pi.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},pi.setAxes=pi.sqlerp=pi.rotationTo=pi.equals=pi.exactEquals=pi.normalize=pi.sqrLen=pi.squaredLength=pi.len=pi.length=pi.lerp=pi.dot=pi.scale=pi.mul=pi.add=pi.set=pi.copy=pi.fromValues=pi.clone=void 0;var mu=Bg(no),EA=Bg(An),Ic=Bg(bi),Ja=Bg(Li);function W1(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(W1=function(o){return o?i:e})(t)}function Bg(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||vy(t)!=="object"&&typeof t!="function")return{default:t};var i=W1(e);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=s?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(o,d,p):o[d]=t[d]}return o.default=t,i&&i.set(t,o),o}function xy(){var t=new mu.ARRAY_TYPE(4);return mu.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Z1(t,e,i){i*=.5;var o=Math.sin(i);return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=Math.cos(i),t}function Y1(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3],_=i[0],y=i[1],v=i[2],C=i[3];return t[0]=o*C+p*_+s*v-d*y,t[1]=s*C+p*y+d*_-o*v,t[2]=d*C+p*v+o*y-s*_,t[3]=p*C-o*_-s*y-d*v,t}function X1(t,e){var i=e[0],o=e[1],s=e[2],d=e[3],p=Math.sqrt(i*i+o*o+s*s),_=Math.exp(d),y=p>0?_*Math.sin(p)/p:0;return t[0]=i*y,t[1]=o*y,t[2]=s*y,t[3]=_*Math.cos(p),t}function K1(t,e){var i=e[0],o=e[1],s=e[2],d=e[3],p=Math.sqrt(i*i+o*o+s*s),_=p>0?Math.atan2(p,d)/p:0;return t[0]=i*_,t[1]=o*_,t[2]=s*_,t[3]=.5*Math.log(i*i+o*o+s*s+d*d),t}function Vg(t,e,i,o){var s,d,p,_,y,v=e[0],C=e[1],E=e[2],S=e[3],R=i[0],O=i[1],F=i[2],V=i[3];return(d=v*R+C*O+E*F+S*V)<0&&(d=-d,R=-R,O=-O,F=-F,V=-V),1-d>mu.EPSILON?(s=Math.acos(d),p=Math.sin(s),_=Math.sin((1-o)*s)/p,y=Math.sin(o*s)/p):(_=1-o,y=o),t[0]=_*v+y*R,t[1]=_*C+y*O,t[2]=_*E+y*F,t[3]=_*S+y*V,t}function Q1(t,e){var i,o=e[0]+e[4]+e[8];if(o>0)i=Math.sqrt(o+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);var d=(s+1)%3,p=(s+2)%3;i=Math.sqrt(e[3*s+s]-e[3*d+d]-e[3*p+p]+1),t[s]=.5*i,t[3]=(e[3*d+p]-e[3*p+d])*(i=.5/i),t[d]=(e[3*d+s]+e[3*s+d])*i,t[p]=(e[3*p+s]+e[3*s+p])*i}return t}pi.clone=Ja.clone,pi.fromValues=Ja.fromValues,pi.copy=Ja.copy,pi.set=Ja.set,pi.add=Ja.add,pi.mul=Y1;var J1=Ja.scale;pi.scale=J1;var ew=Ja.dot;pi.dot=ew,pi.lerp=Ja.lerp;var tw=Ja.length;pi.length=tw,pi.len=tw;var iw=Ja.squaredLength;pi.squaredLength=iw,pi.sqrLen=iw;var wy=Ja.normalize;pi.normalize=wy,pi.exactEquals=Ja.exactEquals,pi.equals=Ja.equals;var sl,nw,rw,IA=(sl=Ic.create(),nw=Ic.fromValues(1,0,0),rw=Ic.fromValues(0,1,0),function(t,e,i){var o=Ic.dot(e,i);return o<-.999999?(Ic.cross(sl,nw,e),Ic.len(sl)<1e-6&&Ic.cross(sl,rw,e),Ic.normalize(sl,sl),Z1(t,sl,Math.PI),t):o>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Ic.cross(sl,e,i),t[0]=sl[0],t[1]=sl[1],t[2]=sl[2],t[3]=1+o,wy(t,t))});pi.rotationTo=IA;var Cy,Ty,SA=(Cy=xy(),Ty=xy(),function(t,e,i,o,s,d){return Vg(Cy,e,s,d),Vg(Ty,i,o,d),Vg(t,Cy,Ty,2*d*(1-d)),t});pi.sqlerp=SA;var ll,MA=(ll=EA.create(),function(t,e,i,o){return ll[0]=i[0],ll[3]=i[1],ll[6]=i[2],ll[1]=o[0],ll[4]=o[1],ll[7]=o[2],ll[2]=-e[0],ll[5]=-e[1],ll[8]=-e[2],wy(t,Q1(t,ll))});pi.setAxes=MA;var Hi={};function Ey(t){return Ey=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ey(t)}Object.defineProperty(Hi,"__esModule",{value:!0}),Hi.create=function(){var t=new Ca.ARRAY_TYPE(8);return Ca.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Hi.clone=function(t){var e=new Ca.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Hi.fromValues=function(t,e,i,o,s,d,p,_){var y=new Ca.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=i,y[3]=o,y[4]=s,y[5]=d,y[6]=p,y[7]=_,y},Hi.fromRotationTranslationValues=function(t,e,i,o,s,d,p){var _=new Ca.ARRAY_TYPE(8);_[0]=t,_[1]=e,_[2]=i,_[3]=o;var y=.5*s,v=.5*d,C=.5*p;return _[4]=y*o+v*i-C*e,_[5]=v*o+C*t-y*i,_[6]=C*o+y*e-v*t,_[7]=-y*t-v*e-C*i,_},Hi.fromRotationTranslation=sw,Hi.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Hi.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Hi.fromMat4=function(t,e){var i=Sc.create();ow.getRotation(i,e);var o=new Ca.ARRAY_TYPE(3);return ow.getTranslation(o,e),sw(t,i,o),t},Hi.copy=lw,Hi.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Hi.set=function(t,e,i,o,s,d,p,_,y){return t[0]=e,t[1]=i,t[2]=o,t[3]=s,t[4]=d,t[5]=p,t[6]=_,t[7]=y,t},Hi.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Hi.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Hi.getTranslation=function(t,e){var i=e[4],o=e[5],s=e[6],d=e[7],p=-e[0],_=-e[1],y=-e[2],v=e[3];return t[0]=2*(i*v+d*p+o*y-s*_),t[1]=2*(o*v+d*_+s*p-i*y),t[2]=2*(s*v+d*y+i*_-o*p),t},Hi.translate=function(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3],_=.5*i[0],y=.5*i[1],v=.5*i[2],C=e[4],E=e[5],S=e[6],R=e[7];return t[0]=o,t[1]=s,t[2]=d,t[3]=p,t[4]=p*_+s*v-d*y+C,t[5]=p*y+d*_-o*v+E,t[6]=p*v+o*y-s*_+S,t[7]=-o*_-s*y-d*v+R,t},Hi.rotateX=function(t,e,i){var o=-e[0],s=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],v=e[6],C=e[7],E=_*p+C*o+y*d-v*s,S=y*p+C*s+v*o-_*d,R=v*p+C*d+_*s-y*o,O=C*p-_*o-y*s-v*d;return Sc.rotateX(t,e,i),t[4]=E*(p=t[3])+O*(o=t[0])+S*(d=t[2])-R*(s=t[1]),t[5]=S*p+O*s+R*o-E*d,t[6]=R*p+O*d+E*s-S*o,t[7]=O*p-E*o-S*s-R*d,t},Hi.rotateY=function(t,e,i){var o=-e[0],s=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],v=e[6],C=e[7],E=_*p+C*o+y*d-v*s,S=y*p+C*s+v*o-_*d,R=v*p+C*d+_*s-y*o,O=C*p-_*o-y*s-v*d;return Sc.rotateY(t,e,i),t[4]=E*(p=t[3])+O*(o=t[0])+S*(d=t[2])-R*(s=t[1]),t[5]=S*p+O*s+R*o-E*d,t[6]=R*p+O*d+E*s-S*o,t[7]=O*p-E*o-S*s-R*d,t},Hi.rotateZ=function(t,e,i){var o=-e[0],s=-e[1],d=-e[2],p=e[3],_=e[4],y=e[5],v=e[6],C=e[7],E=_*p+C*o+y*d-v*s,S=y*p+C*s+v*o-_*d,R=v*p+C*d+_*s-y*o,O=C*p-_*o-y*s-v*d;return Sc.rotateZ(t,e,i),t[4]=E*(p=t[3])+O*(o=t[0])+S*(d=t[2])-R*(s=t[1]),t[5]=S*p+O*s+R*o-E*d,t[6]=R*p+O*d+E*s-S*o,t[7]=O*p-E*o-S*s-R*d,t},Hi.rotateByQuatAppend=function(t,e,i){var o=i[0],s=i[1],d=i[2],p=i[3],_=e[0],y=e[1],v=e[2],C=e[3];return t[0]=_*p+C*o+y*d-v*s,t[1]=y*p+C*s+v*o-_*d,t[2]=v*p+C*d+_*s-y*o,t[3]=C*p-_*o-y*s-v*d,t[4]=(_=e[4])*p+(C=e[7])*o+(y=e[5])*d-(v=e[6])*s,t[5]=y*p+C*s+v*o-_*d,t[6]=v*p+C*d+_*s-y*o,t[7]=C*p-_*o-y*s-v*d,t},Hi.rotateByQuatPrepend=function(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3],_=i[0],y=i[1],v=i[2],C=i[3];return t[0]=o*C+p*_+s*v-d*y,t[1]=s*C+p*y+d*_-o*v,t[2]=d*C+p*v+o*y-s*_,t[3]=p*C-o*_-s*y-d*v,t[4]=o*(C=i[7])+p*(_=i[4])+s*(v=i[6])-d*(y=i[5]),t[5]=s*C+p*y+d*_-o*v,t[6]=d*C+p*v+o*y-s*_,t[7]=p*C-o*_-s*y-d*v,t},Hi.rotateAroundAxis=function(t,e,i,o){if(Math.abs(o)<Ca.EPSILON)return lw(t,e);var s=Math.hypot(i[0],i[1],i[2]);o*=.5;var d=Math.sin(o),p=d*i[0]/s,_=d*i[1]/s,y=d*i[2]/s,v=Math.cos(o),C=e[0],E=e[1],S=e[2],R=e[3];t[0]=C*v+R*p+E*y-S*_,t[1]=E*v+R*_+S*p-C*y,t[2]=S*v+R*y+C*_-E*p,t[3]=R*v-C*p-E*_-S*y;var O=e[4],F=e[5],V=e[6],U=e[7];return t[4]=O*v+U*p+F*y-V*_,t[5]=F*v+U*_+V*p-O*y,t[6]=V*v+U*y+O*_-F*p,t[7]=U*v-O*p-F*_-V*y,t},Hi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},Hi.multiply=cw,Hi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},Hi.lerp=function(t,e,i,o){var s=1-o;return dw(e,i)<0&&(o=-o),t[0]=e[0]*s+i[0]*o,t[1]=e[1]*s+i[1]*o,t[2]=e[2]*s+i[2]*o,t[3]=e[3]*s+i[3]*o,t[4]=e[4]*s+i[4]*o,t[5]=e[5]*s+i[5]*o,t[6]=e[6]*s+i[6]*o,t[7]=e[7]*s+i[7]*o,t},Hi.invert=function(t,e){var i=jg(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},Hi.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Hi.normalize=function(t,e){var i=jg(e);if(i>0){i=Math.sqrt(i);var o=e[0]/i,s=e[1]/i,d=e[2]/i,p=e[3]/i,_=e[4],y=e[5],v=e[6],C=e[7],E=o*_+s*y+d*v+p*C;t[0]=o,t[1]=s,t[2]=d,t[3]=p,t[4]=(_-o*E)/i,t[5]=(y-s*E)/i,t[6]=(v-d*E)/i,t[7]=(C-p*E)/i}return t},Hi.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Hi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Hi.equals=function(t,e){var i=t[0],o=t[1],s=t[2],d=t[3],p=t[4],_=t[5],y=t[6],v=t[7],C=e[0],E=e[1],S=e[2],R=e[3],O=e[4],F=e[5],V=e[6],U=e[7];return Math.abs(i-C)<=Ca.EPSILON*Math.max(1,Math.abs(i),Math.abs(C))&&Math.abs(o-E)<=Ca.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(s-S)<=Ca.EPSILON*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(d-R)<=Ca.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(p-O)<=Ca.EPSILON*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(_-F)<=Ca.EPSILON*Math.max(1,Math.abs(_),Math.abs(F))&&Math.abs(y-V)<=Ca.EPSILON*Math.max(1,Math.abs(y),Math.abs(V))&&Math.abs(v-U)<=Ca.EPSILON*Math.max(1,Math.abs(v),Math.abs(U))},Hi.sqrLen=Hi.squaredLength=Hi.len=Hi.length=Hi.dot=Hi.mul=Hi.setReal=Hi.getReal=void 0;var Ca=Iy(no),Sc=Iy(pi),ow=Iy(xi);function aw(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(aw=function(o){return o?i:e})(t)}function Iy(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||Ey(t)!=="object"&&typeof t!="function")return{default:t};var i=aw(e);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=s?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(o,d,p):o[d]=t[d]}return o.default=t,i&&i.set(t,o),o}function sw(t,e,i){var o=.5*i[0],s=.5*i[1],d=.5*i[2],p=e[0],_=e[1],y=e[2],v=e[3];return t[0]=p,t[1]=_,t[2]=y,t[3]=v,t[4]=o*v+s*y-d*_,t[5]=s*v+d*p-o*y,t[6]=d*v+o*_-s*p,t[7]=-o*p-s*_-d*y,t}function lw(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function cw(t,e,i){var o=e[0],s=e[1],d=e[2],p=e[3],_=i[4],y=i[5],v=i[6],C=i[7],E=e[4],S=e[5],R=e[6],O=e[7],F=i[0],V=i[1],U=i[2],Z=i[3];return t[0]=o*Z+p*F+s*U-d*V,t[1]=s*Z+p*V+d*F-o*U,t[2]=d*Z+p*U+o*V-s*F,t[3]=p*Z-o*F-s*V-d*U,t[4]=o*C+p*_+s*v-d*y+E*Z+O*F+S*U-R*V,t[5]=s*C+p*y+d*_-o*v+S*Z+O*V+R*F-E*U,t[6]=d*C+p*v+o*y-s*_+R*Z+O*U+E*V-S*F,t[7]=p*C-o*_-s*y-d*v+O*Z-E*F-S*V-R*U,t}Hi.getReal=Sc.copy,Hi.setReal=Sc.copy,Hi.mul=cw;var dw=Sc.dot;Hi.dot=dw;var uw=Sc.length;Hi.length=uw,Hi.len=uw;var jg=Sc.squaredLength;Hi.squaredLength=jg,Hi.sqrLen=jg;var Si={};function Sy(t){return Sy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Sy(t)}Object.defineProperty(Si,"__esModule",{value:!0}),Si.create=pw,Si.clone=function(t){var e=new fu.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Si.fromValues=function(t,e){var i=new fu.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},Si.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Si.set=function(t,e,i){return t[0]=e,t[1]=i,t},Si.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},Si.subtract=mw,Si.multiply=fw,Si.divide=gw,Si.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Si.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Si.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},Si.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},Si.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Si.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},Si.scaleAndAdd=function(t,e,i,o){return t[0]=e[0]+i[0]*o,t[1]=e[1]+i[1]*o,t},Si.distance=_w,Si.squaredDistance=bw,Si.length=yw,Si.squaredLength=vw,Si.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Si.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Si.normalize=function(t,e){var i=e[0],o=e[1],s=i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t},Si.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Si.cross=function(t,e,i){var o=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=o,t},Si.lerp=function(t,e,i,o){var s=e[0],d=e[1];return t[0]=s+o*(i[0]-s),t[1]=d+o*(i[1]-d),t},Si.random=function(t,e){e=e||1;var i=2*fu.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},Si.transformMat2=function(t,e,i){var o=e[0],s=e[1];return t[0]=i[0]*o+i[2]*s,t[1]=i[1]*o+i[3]*s,t},Si.transformMat2d=function(t,e,i){var o=e[0],s=e[1];return t[0]=i[0]*o+i[2]*s+i[4],t[1]=i[1]*o+i[3]*s+i[5],t},Si.transformMat3=function(t,e,i){var o=e[0],s=e[1];return t[0]=i[0]*o+i[3]*s+i[6],t[1]=i[1]*o+i[4]*s+i[7],t},Si.transformMat4=function(t,e,i){var o=e[0],s=e[1];return t[0]=i[0]*o+i[4]*s+i[12],t[1]=i[1]*o+i[5]*s+i[13],t},Si.rotate=function(t,e,i,o){var s=e[0]-i[0],d=e[1]-i[1],p=Math.sin(o),_=Math.cos(o);return t[0]=s*_-d*p+i[0],t[1]=s*p+d*_+i[1],t},Si.angle=function(t,e){var i=t[0],o=t[1],s=e[0],d=e[1],p=Math.sqrt(i*i+o*o)*Math.sqrt(s*s+d*d);return Math.acos(Math.min(Math.max(p&&(i*s+o*d)/p,-1),1))},Si.zero=function(t){return t[0]=0,t[1]=0,t},Si.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Si.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Si.equals=function(t,e){var i=t[0],o=t[1],s=e[0],d=e[1];return Math.abs(i-s)<=fu.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-d)<=fu.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))},Si.forEach=Si.sqrLen=Si.sqrDist=Si.dist=Si.div=Si.mul=Si.sub=Si.len=void 0;var fu=function(t,e){if(t&&t.__esModule)return t;if(t===null||Sy(t)!=="object"&&typeof t!="function")return{default:t};var i=hw(void 0);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=s?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(o,d,p):o[d]=t[d]}return o.default=t,i&&i.set(t,o),o}(no);function hw(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(hw=function(o){return o?i:e})(t)}function pw(){var t=new fu.ARRAY_TYPE(2);return fu.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function mw(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function fw(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function gw(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function _w(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function bw(t,e){var i=e[0]-t[0],o=e[1]-t[1];return i*i+o*o}function yw(t){return Math.hypot(t[0],t[1])}function vw(t){var e=t[0],i=t[1];return e*e+i*i}Si.len=yw,Si.sub=mw,Si.mul=fw,Si.div=gw,Si.dist=_w,Si.sqrDist=bw,Si.sqrLen=vw;var AA=function(){var t=pw();return function(e,i,o,s,d,p){var _,y;for(i||(i=2),o||(o=0),y=s?Math.min(s*i+o,e.length):e.length,_=o;_<y;_+=i)t[0]=e[_],t[1]=e[_+1],d(t,t,p),e[_]=t[0],e[_+1]=t[1];return e}}();function My(t){return My=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},My(t)}Si.forEach=AA,Object.defineProperty(io,"__esModule",{value:!0}),r.a7=io.vec4=r.N=io.vec3=io.vec2=io.quat2=r.bi=io.quat=r.a6=io.mat4=r.co=io.mat3=io.mat2d=r.b4=io.mat2=io.glMatrix=void 0;var DA=Yl(no);io.glMatrix=DA;var kA=Yl(ar);r.b4=io.mat2=kA;var RA=Yl(pr);io.mat2d=RA;var PA=Yl(An);r.co=io.mat3=PA;var OA=Yl(xi);r.a6=io.mat4=OA;var FA=Yl(pi);r.bi=io.quat=FA;var LA=Yl(Hi);io.quat2=LA;var zA=Yl(Si);io.vec2=zA;var NA=Yl(bi);r.N=io.vec3=NA;var BA=Yl(Li);function xw(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(xw=function(o){return o?i:e})(t)}function Yl(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||My(t)!=="object"&&typeof t!="function")return{default:t};var i=xw(e);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var d in t)if(d!=="default"&&Object.prototype.hasOwnProperty.call(t,d)){var p=s?Object.getOwnPropertyDescriptor(t,d):null;p&&(p.get||p.set)?Object.defineProperty(o,d,p):o[d]=t[d]}return o.default=t,i&&i.set(t,o),o}r.a7=io.vec4=BA;class Ay{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){let s=r.N.dot(i,this.dir);if(Math.abs(s)<1e-6)return!1;let d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/s;return o[0]=this.pos[0]+this.dir[0]*d,o[1]=this.pos[1]+this.dir[1]*d,o[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,i,o){if(r.N.equals(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;let[s,d,p]=this.dir,_=this.pos[0]-e[0],y=this.pos[1]-e[1],v=this.pos[2]-e[2],C=s*s+d*d+p*p,E=2*(_*s+y*d+v*p),S=E*E-4*C*(_*_+y*y+v*v-i*i);if(S<0){let R=Math.max(-E/2,0),O=_+s*R,F=y+d*R,V=v+p*R,U=Math.hypot(O,F,V);return o[0]=O*i/U,o[1]=F*i/U,o[2]=V*i/U,!1}{let R=(-E-Math.sqrt(S))/(2*C);if(R<0){let O=Math.hypot(_,y,v);return o[0]=_*i/O,o[1]=y*i/O,o[2]=v*i/O,!1}return o[0]=_+s*R,o[1]=y+d*R,o[2]=v+p*R,!0}}}class Dy{constructor(e,i,o,s,d){this.TL=e,this.TR=i,this.BR=o,this.BL=s,this.horizon=d}static fromInvProjectionMatrix(e,i,o){let s=[-1,1,1],d=[1,1,1],p=[1,-1,1],_=[-1,-1,1],y=r.N.transformMat4(s,s,e),v=r.N.transformMat4(d,d,e),C=r.N.transformMat4(p,p,e),E=r.N.transformMat4(_,_,e);return new Dy(y,v,C,E,i/o)}}function Cm(t,e,i){let o=1/0,s=-1/0,d=[];for(let p of t){r.N.sub(d,p,e);let _=r.N.dot(d,i);o=Math.min(o,_),s=Math.max(s,_)}return[o,s]}function ww(t,e){let i=!0;for(let o=0;o<t.planes.length;o++){let s=t.planes[o],d=0;for(let p=0;p<e.length;p++)d+=r.N.dot(s,e[p])+s[3]>=0;if(d===0)return 0;d!==e.length&&(i=!1)}return i?2:1}function Cw(t,e){for(let i of t.projections){let o=Cm(e,t.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function Tw(t,e){let i=0,o=[0,0,0,0];for(let s=0;s<t.length;s++)o[0]=t[s][0],o[1]=t[s][1],o[2]=t[s][2],o[3]=1,r.a7.dot(o,e)>=0&&i++;return i}class ky{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=mr.fromPoints(this.points),this.projections=[],this.frustumEdges=[r.N.sub([],this.points[2],this.points[3]),r.N.sub([],this.points[0],this.points[3]),r.N.sub([],this.points[4],this.points[0]),r.N.sub([],this.points[5],this.points[1]),r.N.sub([],this.points[6],this.points[2]),r.N.sub([],this.points[7],this.points[3])];for(let o of this.frustumEdges){let s=[0,-o[2],o[1]],d=[o[2],0,-o[0]];this.projections.push({axis:s,projection:Cm(this.points,this.points[0],s)}),this.projections.push({axis:d,projection:Cm(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,i,o,s){let d=Math.pow(2,o),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(v=>{let C=r.a7.transformMat4([],v,e),E=1/C[3]/i*d;return r.a7.mul(C,C,[E,E,s?1/C[3]:E,E])}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(v=>{let C=r.N.sub([],p[v[0]],p[v[1]]),E=r.N.sub([],p[v[2]],p[v[1]]),S=r.N.normalize([],r.N.cross([],C,E)),R=-r.N.dot(S,p[v[1]]);return S.concat(R)}),y=[];for(let v=0;v<p.length;v++)y.push([p[v][0],p[v][1],p[v][2]]);return new ky(y,_)}intersectsPrecise(e,i,o){for(let s=0;s<i.length;s++)if(!Tw(e,i[s]))return 0;for(let s=0;s<this.planes.length;s++)if(!Tw(e,this.planes[s]))return 0;for(let s of o)for(let d of this.frustumEdges){let p=r.N.cross([],s,d),_=r.N.length(p);if(_===0)continue;r.N.scale(p,p,1/_);let y=Cm(this.points,this.points[0],p),v=Cm(e,this.points[0],p);if(y[0]>v[1]||v[0]>y[1])return 0}return 1}}class mr{static fromPoints(e){let i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(let s of e)r.N.min(i,i,s),r.N.max(o,o,s);return new mr(i,o)}static fromTileIdAndHeight(e,i,o){let s=1<<e.canonical.z,d=e.canonical.x,p=e.canonical.y;return new mr([d/s,p/s,i],[(d+1)/s,(p+1)/s,o])}static applyTransform(e,i){let o=e.getCorners();for(let s=0;s<o.length;++s)r.N.transformMat4(o[s],o[s],i);return mr.fromPoints(o)}static projectAabbCorners(e,i){let o=e.getCorners();for(let s=0;s<o.length;++s)r.N.transformMat4(o[s],o[s],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=r.N.scale([],r.N.add([],this.min,this.max),.5)}quadrant(e){let i=[e%2==0,e<2],o=r.N.clone(this.min),s=r.N.clone(this.max);for(let d=0;d<i.length;d++)o[d]=i[d]?this.min[d]:this.center[d],s[d]=i[d]?this.center[d]:this.max[d];return s[2]=this.max[2],new mr(o,s)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?ww(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?ww(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Cw(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Cw(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Et(mr,"Aabb");let VA=fn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ug}=VA,jA=fn([{name:"a_pos_3",components:3,type:"Int16"}]);var Ew=fn([{name:"a_pos",type:"Int16",components:2}]);function Gg(t){return t*X/Re}let UA=[new mr([me,me,me],[Ie,Ie,Ie]),new mr([me,me,me],[0,0,Ie]),new mr([0,me,me],[Ie,0,Ie]),new mr([me,0,me],[0,Ie,Ie]),new mr([0,0,me],[Ie,Ie,Ie])];function Iw(t,e,i,o=!0){let s=r.N.scale([],t._camera.position,t.worldSize),d=[e,i,1,1];r.a7.transformMat4(d,d,t.pixelMatrixInverse),r.a7.scale(d,d,1/d[3]);let p=r.N.sub([],d,s),_=r.N.normalize([],p),y=t.globeMatrix,v=[y[12],y[13],y[14]],C=r.N.sub([],v,s),E=r.N.length(C),S=r.N.normalize([],C),R=t.worldSize/(2*Math.PI),O=r.N.dot(S,_),F=Math.asin(R/E);if(F<Math.acos(O)){if(!o)return null;let we=[],ze=[];r.N.scale(we,_,E/O),r.N.normalize(ze,r.N.sub(ze,we,C)),r.N.normalize(_,r.N.add(_,C,r.N.scale(_,ze,Math.tan(F)*E)))}let V=[];new Ay(s,_).closestPointOnSphere(v,R,V);let U=r.N.normalize([],ae(y,0)),Z=r.N.normalize([],ae(y,1)),Q=r.N.normalize([],ae(y,2)),K=r.N.dot(U,V),se=r.N.dot(Z,V),oe=r.N.dot(Q,V),de=qn(Math.asin(-se/R)),_e=qn(Math.atan2(K,oe));_e=t.center.lng+function(we,ze){let $e=(ze-we+180)%360-180;return $e<-180?$e+360:$e}(t.center.lng,_e);let xe=_i(_e),Se=gi(ri(de),0,1);return new Wi(xe,Se)}class GA{constructor(e,i,o){this.a=r.N.sub([],e,o),this.b=r.N.sub([],i,o),this.center=o;let s=r.N.normalize([],this.a),d=r.N.normalize([],this.b);this.angle=Math.acos(r.N.dot(s,d))}}function Ry(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(o,s,d,p){let _=Math.sin(d);return o*(Math.sin((1-p)*d)/_)+s*(Math.sin(p*d)/_)}(t.a[e],t.b[e],t.angle,gi(i,0,1))+t.center[e]}function Xl(t){if(t.z<=1)return UA[t.z+2*t.y+t.x];let e=Py(Hg(t));return mr.fromPoints(e)}function Mc(t,e,i){return r.N.scale(t,t,1-i),r.N.scaleAndAdd(t,t,e,i)}function Sw(t,e,i){for(let o of t)r.N.transformMat4(o,o,e),r.N.scale(o,o,i)}function Mw(t,e,i,o){let s=e/t.worldSize,d=t.globeMatrix;if(i.z<=1){let xe=Xl(i).getCorners();return Sw(xe,d,s),mr.fromPoints(xe)}let p=Hg(i,o),_=Py(p,X+Gg(t._tileCoverLift));Sw(_,d,s);let y=Number.MAX_VALUE,v=[-y,-y,-y],C=[y,y,y];if(p.contains(t.center)){for(let we of _)r.N.min(C,C,we),r.N.max(v,v,we);v[2]=0;let xe=t.point,Se=[xe.x*s,xe.y*s,0];return r.N.min(C,C,Se),r.N.max(v,v,Se),new mr(C,v)}if(t._tileCoverLift>0){for(let xe of _)r.N.min(C,C,xe),r.N.max(v,v,xe);return new mr(C,v)}let E=[d[12]*s,d[13]*s,d[14]*s],S=p.getCenter(),R=gi(t.center.lat,-ki,ki),O=gi(S.lat,-ki,ki),F=_i(t.center.lng),V=ri(R),U=F-_i(S.lng),Z=V-ri(O);U>.5?U-=1:U<-.5&&(U+=1);let Q=0;if(Math.abs(U)>Math.abs(Z))Q=U>=0?1:3;else{Q=Z>=0?0:2;let xe=[d[4]*s,d[5]*s,d[6]*s],Se=-Math.sin(Fi(Z>=0?p.getSouth():p.getNorth()))*X;r.N.scaleAndAdd(E,E,xe,Se)}let K=_[Q],se=_[(Q+1)%4],oe=new GA(K,se,E),de=[Ry(oe,0)||K[0],Ry(oe,1)||K[1],Ry(oe,2)||K[2]],_e=rd(t.zoom);if(_e>0){let xe=function({x:we,y:ze,z:$e},Pe,He,De,je){let ut=1/(1<<$e),qe=we*ut,kt=qe+ut,Ct=ze*ut,Ke=Ct+ut,ei=0,jt=(qe+kt)/2-De;return jt>.5?ei=-1:jt<-.5&&(ei=1),qe=((qe+ei)*Pe-(De*=Pe))*He+De,kt=((kt+ei)*Pe-De)*He+De,Ct=(Ct*Pe-(je*=Pe))*He+je,Ke=(Ke*Pe-je)*He+je,[[qe,Ke,0],[kt,Ke,0],[kt,Ct,0],[qe,Ct,0]]}(i,e,t._pixelsPerMercatorPixel,F,V);for(let we=0;we<_.length;we++)Mc(_[we],xe[we],_e);let Se=r.N.add([],xe[Q],xe[(Q+1)%4]);r.N.scale(Se,Se,.5),Mc(de,Se,_e)}for(let xe of _)r.N.min(C,C,xe),r.N.max(v,v,xe);return C[2]=Math.min(K[2],se[2]),r.N.min(C,C,de),r.N.max(v,v,de),new mr(C,v)}function Hg({x:t,y:e,z:i},o=!1){let s=1/(1<<i),d=new ve(li(t*s),e===(1<<i)-1&&o?-90:Ui((e+1)*s)),p=new ve(li((t+1)*s),e===0&&o?90:Ui(e*s));return new Ae(d,p)}function Py(t,e=X){let i=Fi(t.getNorth()),o=Fi(t.getSouth()),s=Math.cos(i),d=Math.cos(o),p=Math.sin(i),_=Math.sin(o),y=t.getWest(),v=t.getEast();return[be(d,_,y,e),be(d,_,v,e),be(s,p,v,e),be(s,p,y,e)]}function Tm(t,e,i,o){let s=1<<i.z,d=(t/mt+i.x)/s;return Fe(Ui((e/mt+i.y)/s),li(d),o)}function $g({min:t,max:e}){return ne/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let Aw=new Float64Array(16);function qg(t){let e=$g(t),i=r.a6.fromScaling(Aw,[e,e,e]);return r.a6.translate(i,i,r.N.negate([],t.min))}function Oy(t){let e=r.a6.fromTranslation(Aw,t.min),i=1/$g(t);return r.a6.scale(e,e,[i,i,i])}function Fy(t){let e=mt/(2*Math.PI);return t/(2*Math.PI)/e}function Dw(t,e){return mt/(512*Math.pow(2,t))*$g(Xl(e))}function kw(t,e,i,o,s){let d=Fy(i),p=[t,e,-i/(2*Math.PI)],_=r.a6.identity(new Float64Array(16));return r.a6.translate(_,_,p),r.a6.scale(_,_,[d,d,d]),r.a6.rotateX(_,_,Fi(-s)),r.a6.rotateY(_,_,Fi(-o)),_}function rd(t){return us(te,q,t)}function Rw(t,e){let i=Fe(e.lat,e.lng),o=function(d){let p=Fe(d._center.lat,d._center.lng),_=r.N.fromValues(0,1,0),y=r.N.cross([],_,p),v=r.a6.fromRotation([],-d.angle,p);y=r.N.transformMat4(y,y,v),r.a6.fromRotation(v,-d._pitch,y);let C=r.N.normalize([],p);return r.N.scale(C,C,Gg(d.cameraToCenterDistance/d.pixelsPerMeter)),r.N.transformMat4(C,C,v),r.N.add([],p,C)}(t),s=r.N.subtract([],o,i);return r.N.angle(s,i)}function Ly(t,e){return Rw(t,e)>Math.PI/2*1.01}let Pw=Fi(85),HA=Math.cos(Pw),$A=Math.sin(Pw),qA=r.a6.create(),Ow=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Fw(t,e,i,o,s,d,p,_,y){if(d&&t.queryGeometry.isAboveHorizon)return!1;d&&(y*=t.pixelToTileUnitsFactor);let v=t.tileID.canonical,C=i.projection.upVectorScale(v,i.center.lat,i.worldSize).metersToTile;for(let E of e)for(let S of E){let R=S.add(_),O=s&&i.elevation?i.elevation.exaggeration()*s.getElevationAt(R.x,R.y,!0):0,F=i.projection.projectTilePoint(R.x,R.y,v);if(O>0){let Q=i.projection.upVector(v,R.x,R.y);F.x+=Q[0]*C*O,F.y+=Q[1]*C*O,F.z+=Q[2]*C*O}let V=d?R:WA(F.x,F.y,F.z,o),U=d?t.tilespaceRays.map(Q=>YA(Q,O)):t.queryGeometry.screenGeometry,Z=r.a7.transformMat4([],[F.x,F.y,F.z,1],o);if(!p&&d?y*=Z[3]/i.cameraToCenterDistance:p&&!d&&(y*=i.cameraToCenterDistance/Z[3]),d){let Q=Ui((S.y/mt+v.y)/(1<<v.z));y/=i.projection.pixelsPerMeter(Q,1)/ci(1,Q)}if(Wl(U,V,y))return!0}return!1}function WA(t,e,i,o){let s=r.a7.transformMat4([],[t,e,i,1],o);return new dt(s[0]/s[3],s[1]/s[3])}let Lw=r.N.fromValues(0,0,0),ZA=r.N.fromValues(0,0,1);function YA(t,e){let i=r.N.create();return Lw[2]=e,t.intersectsPlane(Lw,ZA,i),new dt(i[0],i[1])}class zw extends ca{}function Nw(t,{width:e,height:i},o,s){if(s){if(s instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);else if(s.length!==e*i*o)throw new RangeError("mismatched image size")}else s=new Uint8Array(e*i*o);return t.width=e,t.height=i,t.data=s,t}function Bw(t,e,i){let{width:o,height:s}=e;o===t.width&&s===t.height||(zy(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,o),height:Math.min(t.height,s)},i),t.width=o,t.height=s,t.data=e.data)}function zy(t,e,i,o,s,d,p){if(s.width===0||s.height===0)return e;if(s.width>t.width||s.height>t.height||i.x>t.width-s.width||i.y>t.height-s.height)throw new RangeError("out of range source coordinates for image copy");if(s.width>e.width||s.height>e.height||o.x>e.width-s.width||o.y>e.height-s.height)throw new RangeError("out of range destination coordinates for image copy");let _=t.data,y=e.data,v=d===4&&p;for(let C=0;C<s.height;C++){let E=((i.y+C)*t.width+i.x)*d,S=((o.y+C)*e.width+o.x)*d;if(v)for(let R=0;R<s.width;R++){let O=E+R*d+3,F=S+R*d;y[F+0]=255,y[F+1]=255,y[F+2]=255,y[F+3]=_[O]}else for(let R=0;R<s.width*d;R++)y[S+R]=_[E+R]}return e}Et(zw,"HeatmapBucket",{omit:["layers"]});class od{constructor(e,i){Nw(this,e,1,i)}resize(e){Bw(this,new od(e),1)}clone(){return new od({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,s,d){zy(e,i,o,s,d,1)}}class es{constructor(e,i){Nw(this,e,4,i)}resize(e){Bw(this,new es(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new es({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,s,d,p){zy(e,i,o,s,d,4,p)}}class Vw{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}Et(od,"AlphaImage"),Et(es,"RGBAImage");let XA=new rr({visibility:new ct(Te.layout_heatmap.visibility)});var KA={paint:new rr({"heatmap-radius":new Zt(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Zt(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ct(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xc(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ct(Te.paint_heatmap["heatmap-opacity"])}),layout:XA};function Em(t){let e={},i=t.resolution||256,o=t.clips?t.clips.length:1,s=t.image||new es({width:i,height:o}),d=(p,_,y)=>{e[t.evaluationKey]=y;let v=t.expression.evaluate(e);v&&(s.data[p+_+0]=Math.floor(255*v.r/v.a),s.data[p+_+1]=Math.floor(255*v.g/v.a),s.data[p+_+2]=Math.floor(255*v.b/v.a),s.data[p+_+3]=Math.floor(255*v.a))};if(t.clips)for(let p=0,_=0;p<o;++p,_+=4*i)for(let y=0,v=0;y<i;y++,v+=4){let C=y/(i-1),{start:E,end:S}=t.clips[p];d(_,v,E*(1-C)+S*C)}else for(let p=0,_=0;p<i;p++,_+=4)d(0,_,p/(i-1));return s}let QA=new rr({visibility:new ct(Te.layout_hillshade.visibility)});var JA={paint:new rr({"hillshade-illumination-direction":new ct(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ct(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ct(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ct(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ct(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ct(Te.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ct(Te.paint_hillshade["hillshade-emissive-strength"])}),layout:QA};let eD=fn([{name:"a_pos",components:2,type:"Int16"}],4),{members:tD}=eD;var Ny={exports:{}};function Wg(t,e,i){i=i||2;var o,s,d,p,_,y,v,C=e&&e.length,E=C?e[0]*i:t.length,S=jw(t,0,E,i,!0),R=[];if(!S||S.next===S.prev)return R;if(C&&(S=function(F,V,U,Z){var Q,K,se,oe=[];for(Q=0,K=V.length;Q<K;Q++)(se=jw(F,V[Q]*Z,Q<K-1?V[Q+1]*Z:F.length,Z,!1))===se.next&&(se.steiner=!0),oe.push(cD(se));for(oe.sort(aD),Q=0;Q<oe.length;Q++)U=sD(oe[Q],U);return U}(t,e,S,i)),t.length>80*i){o=d=t[0],s=p=t[1];for(var O=i;O<E;O+=i)(_=t[O])<o&&(o=_),(y=t[O+1])<s&&(s=y),_>d&&(d=_),y>p&&(p=y);v=(v=Math.max(d-o,p-s))!==0?32767/v:0}return Im(S,R,i,o,s,v,0),R}function jw(t,e,i,o,s){var d,p;if(s===jy(t,e,i,o)>0)for(d=e;d<i;d+=o)p=Hw(d,t[d],t[d+1],p);else for(d=i-o;d>=e;d-=o)p=Hw(d,t[d],t[d+1],p);return p&&Zg(p,p.next)&&(Mm(p),p=p.next),p}function gu(t,e){if(!t)return t;e||(e=t);var i,o=t;do if(i=!1,o.steiner||!Zg(o,o.next)&&Hr(o.prev,o,o.next)!==0)o=o.next;else{if(Mm(o),(o=e=o.prev)===o.next)break;i=!0}while(i||o!==e);return e}function Im(t,e,i,o,s,d,p){if(t){!p&&d&&function(C,E,S,R){var O=C;do O.z===0&&(O.z=By(O.x,O.y,E,S,R)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==C);O.prevZ.nextZ=null,O.prevZ=null,function(F){var V,U,Z,Q,K,se,oe,de,_e=1;do{for(U=F,F=null,K=null,se=0;U;){for(se++,Z=U,oe=0,V=0;V<_e&&(oe++,Z=Z.nextZ);V++);for(de=_e;oe>0||de>0&&Z;)oe!==0&&(de===0||!Z||U.z<=Z.z)?(Q=U,U=U.nextZ,oe--):(Q=Z,Z=Z.nextZ,de--),K?K.nextZ=Q:F=Q,Q.prevZ=K,K=Q;U=Z}K.nextZ=null,_e*=2}while(se>1)}(O)}(t,o,s,d);for(var _,y,v=t;t.prev!==t.next;)if(_=t.prev,y=t.next,d?nD(t,o,s,d):iD(t))e.push(_.i/i|0),e.push(t.i/i|0),e.push(y.i/i|0),Mm(t),t=y.next,v=y.next;else if((t=y)===v){p?p===1?Im(t=rD(gu(t),e,i),e,i,o,s,d,2):p===2&&oD(t,e,i,o,s,d):Im(gu(t),e,i,o,s,d,1);break}}}function iD(t){var e=t.prev,i=t,o=t.next;if(Hr(e,i,o)>=0)return!1;for(var s=e.x,d=i.x,p=o.x,_=e.y,y=i.y,v=o.y,C=s<d?s<p?s:p:d<p?d:p,E=_<y?_<v?_:v:y<v?y:v,S=s>d?s>p?s:p:d>p?d:p,R=_>y?_>v?_:v:y>v?y:v,O=o.next;O!==e;){if(O.x>=C&&O.x<=S&&O.y>=E&&O.y<=R&&Ih(s,_,d,y,p,v,O.x,O.y)&&Hr(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function nD(t,e,i,o){var s=t.prev,d=t,p=t.next;if(Hr(s,d,p)>=0)return!1;for(var _=s.x,y=d.x,v=p.x,C=s.y,E=d.y,S=p.y,R=_<y?_<v?_:v:y<v?y:v,O=C<E?C<S?C:S:E<S?E:S,F=_>y?_>v?_:v:y>v?y:v,V=C>E?C>S?C:S:E>S?E:S,U=By(R,O,e,i,o),Z=By(F,V,e,i,o),Q=t.prevZ,K=t.nextZ;Q&&Q.z>=U&&K&&K.z<=Z;){if(Q.x>=R&&Q.x<=F&&Q.y>=O&&Q.y<=V&&Q!==s&&Q!==p&&Ih(_,C,y,E,v,S,Q.x,Q.y)&&Hr(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,K.x>=R&&K.x<=F&&K.y>=O&&K.y<=V&&K!==s&&K!==p&&Ih(_,C,y,E,v,S,K.x,K.y)&&Hr(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;Q&&Q.z>=U;){if(Q.x>=R&&Q.x<=F&&Q.y>=O&&Q.y<=V&&Q!==s&&Q!==p&&Ih(_,C,y,E,v,S,Q.x,Q.y)&&Hr(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;K&&K.z<=Z;){if(K.x>=R&&K.x<=F&&K.y>=O&&K.y<=V&&K!==s&&K!==p&&Ih(_,C,y,E,v,S,K.x,K.y)&&Hr(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function rD(t,e,i){var o=t;do{var s=o.prev,d=o.next.next;!Zg(s,d)&&Uw(s,o,o.next,d)&&Sm(s,d)&&Sm(d,s)&&(e.push(s.i/i|0),e.push(o.i/i|0),e.push(d.i/i|0),Mm(o),Mm(o.next),o=t=d),o=o.next}while(o!==t);return gu(o)}function oD(t,e,i,o,s,d){var p=t;do{for(var _=p.next.next;_!==p.prev;){if(p.i!==_.i&&dD(p,_)){var y=Gw(p,_);return p=gu(p,p.next),y=gu(y,y.next),Im(p,e,i,o,s,d,0),void Im(y,e,i,o,s,d,0)}_=_.next}p=p.next}while(p!==t)}function aD(t,e){return t.x-e.x}function sD(t,e){var i=function(s,d){var p,_=d,y=s.x,v=s.y,C=-1/0;do{if(v<=_.y&&v>=_.next.y&&_.next.y!==_.y){var E=_.x+(v-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(E<=y&&E>C&&(C=E,p=_.x<_.next.x?_:_.next,E===y))return p}_=_.next}while(_!==d);if(!p)return null;var S,R=p,O=p.x,F=p.y,V=1/0;_=p;do y>=_.x&&_.x>=O&&y!==_.x&&Ih(v<F?y:C,v,O,F,v<F?C:y,v,_.x,_.y)&&(S=Math.abs(v-_.y)/(y-_.x),Sm(_,s)&&(S<V||S===V&&(_.x>p.x||_.x===p.x&&lD(p,_)))&&(p=_,V=S)),_=_.next;while(_!==R);return p}(t,e);if(!i)return e;var o=Gw(i,t);return gu(o,o.next),gu(i,i.next)}function lD(t,e){return Hr(t.prev,t,e.prev)<0&&Hr(e.next,t,t.next)<0}function By(t,e,i,o,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function cD(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Ih(t,e,i,o,s,d,p,_){return(s-p)*(e-_)>=(t-p)*(d-_)&&(t-p)*(o-_)>=(i-p)*(e-_)&&(i-p)*(d-_)>=(s-p)*(o-_)}function dD(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,o){var s=i;do{if(s.i!==i.i&&s.next.i!==i.i&&s.i!==o.i&&s.next.i!==o.i&&Uw(s,s.next,i,o))return!0;s=s.next}while(s!==i);return!1}(t,e)&&(Sm(t,e)&&Sm(e,t)&&function(i,o){var s=i,d=!1,p=(i.x+o.x)/2,_=(i.y+o.y)/2;do s.y>_!=s.next.y>_&&s.next.y!==s.y&&p<(s.next.x-s.x)*(_-s.y)/(s.next.y-s.y)+s.x&&(d=!d),s=s.next;while(s!==i);return d}(t,e)&&(Hr(t.prev,t,e.prev)||Hr(t,e.prev,e))||Zg(t,e)&&Hr(t.prev,t,t.next)>0&&Hr(e.prev,e,e.next)>0)}function Hr(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Zg(t,e){return t.x===e.x&&t.y===e.y}function Uw(t,e,i,o){var s=Xg(Hr(t,e,i)),d=Xg(Hr(t,e,o)),p=Xg(Hr(i,o,t)),_=Xg(Hr(i,o,e));return s!==d&&p!==_||!(s!==0||!Yg(t,i,e))||!(d!==0||!Yg(t,o,e))||!(p!==0||!Yg(i,t,o))||!(_!==0||!Yg(i,e,o))}function Yg(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Xg(t){return t>0?1:t<0?-1:0}function Sm(t,e){return Hr(t.prev,t,t.next)<0?Hr(t,e,t.next)>=0&&Hr(t,t.prev,e)>=0:Hr(t,e,t.prev)<0||Hr(t,t.next,e)<0}function Gw(t,e){var i=new Vy(t.i,t.x,t.y),o=new Vy(e.i,e.x,e.y),s=t.next,d=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,o.next=i,i.prev=o,d.next=o,o.prev=d,o}function Hw(t,e,i,o){var s=new Vy(t,e,i);return o?(s.next=o.next,s.prev=o,o.next.prev=s,o.next=s):(s.prev=s,s.next=s),s}function Mm(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Vy(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function jy(t,e,i,o){for(var s=0,d=e,p=i-o;d<i;d+=o)s+=(t[p]-t[d])*(t[d+1]+t[p+1]),p=d;return s}Ny.exports=Wg,Ny.exports.default=Wg,Wg.deviation=function(t,e,i,o){var s=e&&e.length,d=Math.abs(jy(t,0,s?e[0]*i:t.length,i));if(s)for(var p=0,_=e.length;p<_;p++)d-=Math.abs(jy(t,e[p]*i,p<_-1?e[p+1]*i:t.length,i));var y=0;for(p=0;p<o.length;p+=3){var v=o[p]*i,C=o[p+1]*i,E=o[p+2]*i;y+=Math.abs((t[v]-t[E])*(t[C+1]-t[v+1])-(t[v]-t[C])*(t[E+1]-t[v+1]))}return d===0&&y===0?0:Math.abs((y-d)/d)},Wg.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},o=0,s=0;s<t.length;s++){for(var d=0;d<t[s].length;d++)for(var p=0;p<e;p++)i.vertices.push(t[s][d][p]);s>0&&i.holes.push(o+=t[s-1].length)}return i};var Kg=vi(Ny.exports);function Uy(t,e){let i=t.length;if(i<=1)return[t];let o=[],s,d;for(let p=0;p<i;p++){let _=Os(t[p]);_!==0&&(t[p].area=Math.abs(_),d===void 0&&(d=_<0),d===_<0?(s&&o.push(s),s=[t[p]]):s.push(t[p]))}if(s&&o.push(s),e>1)for(let p=0;p<o.length;p++)o[p].length<=e||(Ju(o[p],e,1,o[p].length-1,uD),o[p]=o[p].slice(0,e));return o}function uD(t,e){return e.area-t.area}function Gy(t,e,i){let o=i.patternDependencies,s=!1;for(let d of e){let p=d.paint.get(`${t}-pattern`);p.isConstant()||(s=!0);let _=p.constantOr(null);_&&(s=!0,o[_]=!0)}return s}function Hy(t,e,i,o,s){let d=s.patternDependencies;for(let p of e){let _=p.paint.get(`${t}-pattern`).value;if(_.kind!=="constant"){let y=_.evaluate({zoom:o},i,{},s.availableImages);y=y&&y.name?y.name:y,d[y]=!0,i.patterns[p.id]=y}}return i}class $y{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ka,this.indexArray=new Kr,this.indexArray2=new ys,this.programConfigurations=new H(e.layers,e.zoom),this.segments=new yr,this.segments2=new yr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,o,s){this.hasPattern=Gy("fill",this.layers,i);let d=this.layers[0].layout.get("fill-sort-key"),p=[];for(let{feature:_,id:y,index:v,sourceLayerIndex:C}of e){let E=this.layers[0]._featureFilter.needGeometry,S=Vr(_,E);if(!this.layers[0]._featureFilter.filter(new nr(this.zoom),S,o))continue;let R=d?d.evaluate(S,{},o,i.availableImages):void 0,O={id:y,properties:_.properties,type:_.type,sourceLayerIndex:C,index:v,geometry:E?S.geometry:Jr(_,o,s),patterns:{},sortKey:R};p.push(O)}d&&p.sort((_,y)=>_.sortKey-y.sortKey);for(let _ of p){let{geometry:y,index:v,sourceLayerIndex:C}=_;if(this.hasPattern){let E=Hy("fill",this.layers,_,this.zoom,i);this.patternFeatures.push(E)}else this.addFeature(_,y,v,o,{},i.availableImages,i.brightness);i.featureIndex.insert(e[v].feature,y,v,C,this.index)}}update(e,i,o,s,d){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,o,s,d)}addFeatures(e,i,o,s,d,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,i,o,s,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,tD),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,o,s,d,p=[],_){for(let y of Uy(i,500)){let v=0;for(let F of y)v+=F.length;let C=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),E=C.vertexLength,S=[],R=[];for(let F of y){if(F.length===0)continue;F!==y[0]&&R.push(S.length/2);let V=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),U=V.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(U+F.length-1,U),S.push(F[0].x),S.push(F[0].y);for(let Z=1;Z<F.length;Z++)this.layoutVertexArray.emplaceBack(F[Z].x,F[Z].y),this.indexArray2.emplaceBack(U+Z-1,U+Z),S.push(F[Z].x),S.push(F[Z].y);V.vertexLength+=F.length,V.primitiveLength+=F.length}let O=Kg(S,R);for(let F=0;F<O.length;F+=3)this.indexArray.emplaceBack(E+O[F],E+O[F+1],E+O[F+2]);C.vertexLength+=v,C.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,p,s,_)}}Et($y,"FillBucket",{omit:["layers","patternFeatures"]});let hD=new rr({"fill-sort-key":new Zt(Te.layout_fill["fill-sort-key"]),visibility:new ct(Te.layout_fill.visibility)});var pD={paint:new rr({"fill-antialias":new ct(Te.paint_fill["fill-antialias"]),"fill-opacity":new Zt(Te.paint_fill["fill-opacity"]),"fill-color":new Zt(Te.paint_fill["fill-color"]),"fill-outline-color":new Zt(Te.paint_fill["fill-outline-color"]),"fill-translate":new ct(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new ct(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Zt(Te.paint_fill["fill-pattern"]),"fill-emissive-strength":new ct(Te.paint_fill["fill-emissive-strength"])}),layout:hD};let mD=fn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),fD=fn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),gD=fn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),_D=fn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),bD=fn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:yD}=mD;var Qg={},vD=ur,$w=Sh;function Sh(t,e,i,o,s){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=o,this._values=s,t.readFields(xD,this,e)}function xD(t,e,i){t==1?e.id=i.readVarint():t==2?function(o,s){for(var d=o.readVarint()+o.pos;o.pos<d;){var p=s._keys[o.readVarint()],_=s._values[o.readVarint()];s.properties[p]=_}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function wD(t){for(var e,i,o=0,s=0,d=t.length,p=d-1;s<d;p=s++)o+=((i=t[p]).x-(e=t[s]).x)*(e.y+i.y);return o}Sh.types=["Unknown","Point","LineString","Polygon"],Sh.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,o=1,s=0,d=0,p=0,_=[];t.pos<i;){if(s<=0){var y=t.readVarint();o=7&y,s=y>>3}if(s--,o===1||o===2)d+=t.readSVarint(),p+=t.readSVarint(),o===1&&(e&&_.push(e),e=[]),e.push(new vD(d,p));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&_.push(e),_},Sh.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,o=0,s=0,d=0,p=1/0,_=-1/0,y=1/0,v=-1/0;t.pos<e;){if(o<=0){var C=t.readVarint();i=7&C,o=C>>3}if(o--,i===1||i===2)(s+=t.readSVarint())<p&&(p=s),s>_&&(_=s),(d+=t.readSVarint())<y&&(y=d),d>v&&(v=d);else if(i!==7)throw new Error("unknown command "+i)}return[p,y,_,v]},Sh.prototype.toGeoJSON=function(t,e,i){var o,s,d=this.extent*Math.pow(2,i),p=this.extent*t,_=this.extent*e,y=this.loadGeometry(),v=Sh.types[this.type];function C(R){for(var O=0;O<R.length;O++){var F=R[O];R[O]=[360*(F.x+p)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(F.y+_)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(o=0;o<y.length;o++)E[o]=y[o][0];C(y=E);break;case 2:for(o=0;o<y.length;o++)C(y[o]);break;case 3:for(y=function(R){var O=R.length;if(O<=1)return[R];for(var F,V,U=[],Z=0;Z<O;Z++){var Q=wD(R[Z]);Q!==0&&(V===void 0&&(V=Q<0),V===Q<0?(F&&U.push(F),F=[R[Z]]):F.push(R[Z]))}return F&&U.push(F),U}(y),o=0;o<y.length;o++)for(s=0;s<y[o].length;s++)C(y[o][s])}y.length===1?y=y[0]:v="Multi"+v;var S={type:"Feature",geometry:{type:v,coordinates:y},properties:this.properties};return"id"in this&&(S.id=this.id),S};var CD=$w,qw=Ww;function Ww(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(TD,this,e),this.length=this._features.length}function TD(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(o){for(var s=null,d=o.readVarint()+o.pos;o.pos<d;){var p=o.readVarint()>>3;s=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}return s}(i))}Ww.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new CD(this._pbf,e,this.extent,this._keys,this._values)};var ED=qw;function ID(t,e,i){if(t===3){var o=new ED(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}var qy=Qg.VectorTile=function(t,e){this.layers=t.readFields(ID,{},e)},Jg=Qg.VectorTileFeature=$w;function e_(t,e,i,o){let s=[],d=o===0?(p,_,y,v,C,E)=>{p.push(new dt(E,y+(E-_)/(v-_)*(C-y)))}:(p,_,y,v,C,E)=>{p.push(new dt(_+(E-y)/(C-y)*(v-_),E))};for(let p of t){let _=[];for(let y of p){if(y.length<=2)continue;let v=[];for(let S=0;S<y.length-1;S++){let R=y[S].x,O=y[S].y,F=y[S+1].x,V=y[S+1].y,U=o===0?R:O,Z=o===0?F:V;U<e?Z>e&&d(v,R,O,F,V,e):U>i?Z<i&&d(v,R,O,F,V,i):v.push(y[S]),Z<e&&U>=e&&d(v,R,O,F,V,e),Z>i&&U<=i&&d(v,R,O,F,V,i)}let C=y[y.length-1],E=o===0?C.x:C.y;E>=e&&E<=i&&v.push(C),v.length&&(C=v[v.length-1],v[0].x===C.x&&v[0].y===C.y||v.push(v[0]),_.push(v))}_.length&&s.push(_)}return s}function t_(t,e){return t.x-e.x||t.y-e.y}function Zw(t,e){return t_(t.min,e.min)===0&&t_(t.max,e.max)===0}function Yw(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function Xw(t,e,i){let o=1/mt,s=1/(1<<i.canonical.z),d=(e.x*o+i.canonical.x)*s+i.wrap,p=(e.y*o+i.canonical.y)*s;return{min:new dt((t.x*o+i.canonical.x)*s+i.wrap,(t.y*o+i.canonical.y)*s),max:new dt(d,p)}}function SD(t,e,i){let o=1<<i.canonical.z,s=((e.x-i.wrap)*o-i.canonical.x)*mt,d=(e.y*o-i.canonical.y)*mt;return{min:new dt(((t.x-i.wrap)*o-i.canonical.x)*mt,(t.y*o-i.canonical.y)*mt),max:new dt(s,d)}}function Kw(t,e,i,o,s,d,p){let _=t.indices,y=t.vertices,v=[];for(let C=o;C<o+s;C+=3){let E=e[i[C+0]+d],S=e[i[C+1]+d],R=e[i[C+2]+d],O=Math.min(E.x,S.x,R.x),F=Math.max(E.x,S.x,R.x),V=Math.min(E.y,S.y,R.y),U=Math.max(E.y,S.y,R.y);v.length=0,t.grid.query(new dt(O,V),new dt(F,U),v);for(let Z=0;Z<v.length;Z++){let Q=v[Z];if(py(y[_[3*Q+0]],y[_[3*Q+1]],y[_[3*Q+2]],E,S,R,p))return!0}}return!1}function Qw(t,e,i,o){if(!t||!i)return!1;let s=t.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<t.vertices.length)return Qw(i,o,t,e);let d=e.canonical,p=o.canonical,_=Math.pow(2,p.z-d.z);s=t.vertices.map(y=>new dt(y.x*d.x*mt*_-p.x*mt,y.y*d.y*mt*_-p.y*mt))}return Kw(i,s,t.indices,0,t.indices.length,0,0)}Qg.VectorTileLayer=qw;class Jw{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){let o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function eC(t,e,i,o){let s=0,d=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(o[p])<1e-15){if(i[p]<t[p]||i[p]>e[p])return null}else{let _=1/o[p],y=(t[p]-i[p])*_,v=(e[p]-i[p])*_;if(y>v){let C=y;y=v,v=C}if(y>s&&(s=y),v<d&&(d=v),s>d)return null}return s}function tC(t,e,i,o,s,d,p,_,y,v,C){let E=o-t,S=s-e,R=d-i,O=p-t,F=_-e,V=y-i,U=C[1]*V-C[2]*F,Z=C[2]*O-C[0]*V,Q=C[0]*F-C[1]*O,K=E*U+S*Z+R*Q;if(Math.abs(K)<1e-15)return null;let se=1/K,oe=v[0]-t,de=v[1]-e,_e=v[2]-i,xe=(oe*U+de*Z+_e*Q)*se;if(xe<0||xe>1)return null;let Se=de*R-_e*S,we=_e*E-oe*R,ze=oe*S-de*E,$e=(C[0]*Se+C[1]*we+C[2]*ze)*se;return $e<0||xe+$e>1?null:(O*Se+F*we+V*ze)*se}function iC(t,e,i){return(t-e)/(i-e)}function nC(t,e,i,o,s,d,p,_,y){let v=1<<i,C=d-o,E=p-s,S=(t+1)/v*C+o,R=(e+0)/v*E+s,O=(e+1)/v*E+s;_[0]=(t+0)/v*C+o,_[1]=R,y[0]=S,y[1]=O}class rC{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let i=function(d){let p=Math.ceil(Math.log2(d.dim/8)),_=[],y=Math.ceil(Math.pow(2,p)),v=1/y,C=(R,O,F,V,U)=>{let Z=V?1:0,Q=(R+1)*F-Z,K=O*F,se=(O+1)*F-Z;U[0]=R*F,U[1]=K,U[2]=Q,U[3]=se},E=new Jw(y),S=[];for(let R=0;R<y*y;R++){C(R%y,Math.floor(R/y),v,!1,S);let O=ad(S[0],S[1],d),F=ad(S[2],S[1],d),V=ad(S[2],S[3],d),U=ad(S[0],S[3],d);E.minimums.push(Math.min(O,F,V,U)),E.maximums.push(Math.max(O,F,V,U)),E.leaves.push(1)}for(_.push(E),y/=2;y>=1;y/=2){let R=_[_.length-1];E=new Jw(y);for(let O=0;O<y*y;O++){C(O%y,Math.floor(O/y),2,!0,S);let F=R.getElevation(S[0],S[1]),V=R.getElevation(S[2],S[1]),U=R.getElevation(S[2],S[3]),Z=R.getElevation(S[0],S[3]),Q=R.isLeaf(S[0],S[1]),K=R.isLeaf(S[2],S[1]),se=R.isLeaf(S[2],S[3]),oe=R.isLeaf(S[0],S[3]),de=Math.min(F.min,V.min,U.min,Z.min),_e=Math.max(F.max,V.max,U.max,Z.max),xe=Q&&K&&se&&oe;E.maximums.push(_e),E.minimums.push(de),E.leaves.push(_e-de<=5&&xe?1:0)}_.push(E)}return _}(this.dem),o=i.length-1,s=i[o];this._addNode(s.minimums[0],s.maximums[0],s.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,s,d,p,_=1){return eC([e,i,-100],[o,s,this.maximums[0]*_],d,p)}raycast(e,i,o,s,d,p,_=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,i,o,s,d,p,_);if(y==null)return null;let v=[],C=[],E=[],S=[],R=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;R.length>0;){let{idx:O,t:F,nodex:V,nodey:U,depth:Z}=R.pop();if(this.leaves[O]){nC(V,U,Z,e,i,o,s,E,S);let K=1<<Z,se=(V+0)/K,oe=(V+1)/K,de=(U+0)/K,_e=(U+1)/K,xe=ad(se,de,this.dem)*_,Se=ad(oe,de,this.dem)*_,we=ad(oe,_e,this.dem)*_,ze=ad(se,_e,this.dem)*_,$e=tC(E[0],E[1],xe,S[0],E[1],Se,S[0],S[1],we,d,p),Pe=tC(S[0],S[1],we,E[0],S[1],ze,E[0],E[1],xe,d,p),He=Math.min($e!==null?$e:Number.MAX_VALUE,Pe!==null?Pe:Number.MAX_VALUE);if(He!==Number.MAX_VALUE)return He;{let De=r.N.scaleAndAdd([],d,p,F);if(oC(xe,Se,ze,we,iC(De[0],E[0],S[0]),iC(De[1],E[1],S[1]))>=De[2])return F}continue}let Q=0;for(let K=0;K<this._siblingOffset.length;K++){nC((V<<1)+this._siblingOffset[K][0],(U<<1)+this._siblingOffset[K][1],Z+1,e,i,o,s,E,S),E[2]=-100,S[2]=this.maximums[this.childOffsets[O]+K]*_;let se=eC(E,S,d,p);if(se!=null){let oe=se;v[K]=oe;let de=!1;for(let _e=0;_e<Q&&!de;_e++)oe>=v[C[_e]]&&(C.splice(_e,0,K),de=!0);de||(C[Q]=K),Q++}}for(let K=0;K<Q;K++){let se=C[K];R.push({idx:this.childOffsets[O]+se,t:v[se],nodex:(V<<1)+this._siblingOffset[se][0],nodey:(U<<1)+this._siblingOffset[se][1],depth:Z+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,s,d){if(e[s].isLeaf(i,o)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);let p=s-1,_=e[p],y=0,v=0;for(let C=0;C<this._siblingOffset.length;C++){let E=2*i+this._siblingOffset[C][0],S=2*o+this._siblingOffset[C][1],R=_.getElevation(E,S),O=_.isLeaf(E,S),F=this._addNode(R.min,R.max,O);O&&(y|=1<<C),v||(v=F)}for(let C=0;C<this._siblingOffset.length;C++)y&1<<C||this._construct(e,2*i+this._siblingOffset[C][0],2*o+this._siblingOffset[C][1],p,v+C)}}function oC(t,e,i,o,s,d){return Ai(Ai(t,i,d),Ai(e,o,d),s)}function ad(t,e,i){let o=i.dim,s=gi(t*o-.5,0,o-1),d=gi(e*o-.5,0,o-1),p=Math.floor(s),_=Math.floor(d),y=Math.min(p+1,o-1),v=Math.min(_+1,o-1);return oC(i.get(p,_),i.get(y,_),i.get(p,v),i.get(y,v),s-p,d-_)}let MD={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function AD(t,e,i){return(256*t*256+256*e+i)/10-1e4}function DD(t,e,i){return 256*t+e+i/256-32768}class i_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,s=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return er(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;let d=this.dim=i.height-2,p=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=s,this._modifiedForSources={},!s){for(let y=0;y<d;y++)p[this._idx(-1,y)]=p[this._idx(0,y)],p[this._idx(d,y)]=p[this._idx(d-1,y)],p[this._idx(y,-1)]=p[this._idx(y,0)],p[this._idx(y,d)]=p[this._idx(y,d-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(d,-1)]=p[this._idx(d-1,0)],p[this._idx(-1,d)]=p[this._idx(0,d-1)],p[this._idx(d,d)]=p[this._idx(d-1,d-1)]}let _=o==="terrarium"?DD:AD;for(let y=0;y<p.length;++y){let v=4*y;this.floatView[y]=_(this.pixels[v],this.pixels[v+1],this.pixels[v+2])}this._timestamp=et.now()}_buildQuadTree(){this._tree=new rC(this)}get(e,i,o=!1){o&&(e=gi(e,-1,this.dim),i=gi(i,-1,this.dim));let s=this._idx(e,i);return this.floatView[s]}set(e,i,o){let s=this._idx(e,i),d=this.floatView[s];return this.floatView[s]=o,o-d}static getUnpackVector(e){return MD[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){let o=[0,0,0,0],s=i_.getUnpackVector(i),d=Math.floor((e+s[3])/s[2]);return o[2]=d%256,d=Math.floor(d/256),o[1]=d%256,d=Math.floor(d/256),o[0]=d,o}getPixels(){return new Vw({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let s=i*this.dim,d=i*this.dim+this.dim,p=o*this.dim,_=o*this.dim+this.dim;switch(i){case-1:s=d-1;break;case 1:d=s+1}switch(o){case-1:p=_-1;break;case 1:_=p+1}let y=-i*this.dim,v=-o*this.dim;for(let C=p;C<_;C++)for(let E=s;E<d;E++){let S=4*this._idx(E,C),R=4*this._idx(E+y,C+v);this.pixels[S+0]=e.pixels[R+0],this.pixels[S+1]=e.pixels[R+1],this.pixels[S+2]=e.pixels[R+2],this.pixels[S+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Et(i_,"DEMData"),Et(rC,"DemMinMaxQuadTree",{omit:["dem"]});class Mh{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){let s=o||e.findDEMTileFor(i);if(!s||!s.dem)return;let d=s.dem,p=s.tileID,_=1<<i.canonical.z-p.canonical.z;return new Mh(s,d.dim/mt/_,[(i.canonical.x/_-p.canonical.x)*d.dim,(i.canonical.y/_-p.canonical.y)*d.dim])}tileCoordToPixel(e,i){let o=i*this._scale+this._offset[1],s=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(o);return new dt(s,d)}getElevationAt(e,i,o,s){let d=e*this._scale+this._offset[0],p=i*this._scale+this._offset[1],_=Math.floor(d),y=Math.floor(p),v=this._dem;return s=!!s,o?Ai(Ai(v.get(_,y,s),v.get(_,y+1,s),p-y),Ai(v.get(_+1,y,s),v.get(_+1,y+1,s),p-y),d-_):v.get(_,y,s)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ci(1,e)*this._dem.stride}}let kD=Jg.types,RD=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],PD=["fill-extrusion-flood-light-ground-radius"],OD=Math.pow(2,13),FD=Math.pow(2,15)-1,aC=new dt(0,1),sd=2147483648;function Am(t,e,i,o,s,d,p,_){t.emplaceBack((e<<1)+p,(i<<1)+d,(Math.floor(o*OD)<<1)+s,Math.round(_))}function n_(t,e,i,o,s,d){t.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+s,d)}function Dm(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class sC{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class lC{constructor(){this.centroidXY=new dt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new dt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new dt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new dt(this.max.x-this.min.x,this.max.y-this.min.y)}}class cC{constructor(){this.acc=new dt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let s=!!this.borders;i.x<e.min.x?(e.min.x=i.x,s=!0):i.x>e.max.x&&(e.max.x=i.x,s=!0),i.y<e.min.y?(e.min.y=i.y,s=!0):i.y>e.max.y&&(e.max.y=i.y,s=!0),((i.x===0||i.x===mt)&&i.x===o.x)!=((i.y===0||i.y===mt)&&i.y===o.y)&&this.processBorderOverlap(i,o),s&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Ai(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>mt!=e.x>mt&&this.addBorderIntersection(1,Ai(i.y,e.y,(mt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Ai(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>mt!=e.y>mt&&this.addBorderIntersection(3,Ai(i.x,e.x,(mt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;let o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{let o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new dt(0,0):new dt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function dC(t,e){let i=t.add(e)._unit(),o=gi(t.x*i.x+t.y*i.y,-1,1);var s,d,p;return s=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(s)))/4*FD*((d=t).x*(p=e).y-d.y*p.x<0?-1:1)}let LD=[t=>t.x<0,t=>t.x>mt,t=>t.y<0,t=>t.y>mt];function zD(t,e,i,o){let s=[4];if(o===0)return s;i._mult(o);let d=t.sub(i),p=e.sub(i),_=[t,e,d,p];for(let y=0;y<4;y++)for(let v of _)if(LD[y](v)){s.push(y);break}return s}class uC{constructor(e){this.vertexArray=new lm,this.indexArray=new Kr,this.programConfigurations=new H(e.layers,e.zoom,i=>PD.includes(i)),this._segments=new yr,this.hiddenByLandmarkVertexArray=new _m,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new yr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,s=!1){let d=e.length;if(d>2){let p=Math.max(0,this._segments.get().length-1),_=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[p].length),y;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{let v=e[0],C=e[1];y=dC(v.sub(e[d-1])._perp()._unit(),C.sub(v)._perp()._unit())}for(let v=0;v<d;v++){let C=v===d-1?0:v+1,E=e[v],S=e[C],R=e[C===d-1?0:C+1],O=S.sub(E)._perp()._unit(),F=dC(O,R.sub(S)._perp()._unit()),V=y,U=F;if(Wy(E,S,i)||s&&mC(E,i)&&mC(S,i)){y=F;continue}let Z=_.vertexLength;n_(this.vertexArray,E,S,1,1,V),n_(this.vertexArray,E,S,1,0,V),n_(this.vertexArray,E,S,0,1,U),n_(this.vertexArray,E,S,0,0,U),_.vertexLength+=4;let Q=zD(E,S,O,o);for(let K of Q)this._segmentToGroundQuads[p].push({id:Z,region:K}),this._segmentToRegionTriCounts[p][K]+=2,_.primitiveLength+=2;y=F}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((s,d)=>s.region-d.region);for(let o=0;o<i;o++){let s=this._segmentToGroundQuads[o],d=e[o],p=this._segmentToRegionTriCounts[o];p.reduce((y,v)=>y+v,0);let _=0;for(let y=0;y<=4;y++){let v=p[y];if(v!==0){let C=this.regionSegments[y];C||(C=this.regionSegments[y]=new yr);let E={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+_,vertexLength:d.vertexLength,primitiveLength:v};C.get().push(E)}_+=v}for(let y=0;y<s.length;y++){let v=s[y].id;this.indexArray.emplaceBack(v,v+1,v+3),this.indexArray.emplaceBack(v,v+3,v+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,s,d,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,s,d,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,fD.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,s,d,p){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,s,d,p)}updateHiddenByLandmark(e){if(!this.hasData())return;let i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let o=e.flags&sd?1:0;for(let s=e.groundVertexArrayOffset;s<i;++s)this.hiddenByLandmarkVertexArray.emplace(s,o);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,_D.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let i=this.regionSegments[e];i&&i.destroy()}}}}class r_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Kr,this.footprintVertices=new Ka,this.footprintSegments=[],this.layoutVertexArray=new rl,this.centroidVertexArray=new lu,this.indexArray=new Kr,this.programConfigurations=new H(e.layers,e.zoom,i=>RD.includes(i)),this.segments=new yr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new uC(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,i,o,s){this.features=[],this.hasPattern=Gy("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Pi(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:d,id:p,index:_,sourceLayerIndex:y}of e){let v=this.layers[0]._featureFilter.needGeometry,C=Vr(d,v);if(!this.layers[0]._featureFilter.filter(new nr(this.zoom),C,o))continue;let E={id:p,sourceLayerIndex:y,index:_,geometry:v?C.geometry:Jr(d,o,s),properties:d.properties,type:d.type,patterns:{}},S=this.layoutVertexArray.length;this.hasPattern?this.features.push(Hy("fill-extrusion",this.layers,E,this.zoom,i)):this.addFeature(E,E.geometry,_,o,{},i.availableImages,s,i.brightness),i.featureIndex.insert(d,E.geometry,_,y,this.index,S)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,s,d,p){for(let _ of this.features){let{geometry:y}=_;this.addFeature(_,y,_.index,i,o,s,d,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,s,d){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let _=p?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,_,o,s,d),this.groundEffect.update(e,i,_,o,s,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yD),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,bD.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,gD.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,s,d,p,_,y){let v=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,C=[new dt(0,0),new dt(mt,mt)],E=_.projection,S=E.name==="globe",R=kD[e.type]==="Polygon",O=new cC;O.centroidDataIndex=this.centroidData.length;let F=new lC,V=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},s)<=0,U=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},s);F.height=U,F.vertexArrayOffset=this.layoutVertexArray.length,F.groundVertexArrayOffset=this.groundEffect.vertexArray.length,S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new _h);let Z=Uy(i,500);for(let _e=Z.length-1;_e>=0;_e--){let xe=Z[_e];(xe.length===0||(Q=xe[0]).every(Se=>Se.x<=0)||Q.every(Se=>Se.x>=mt)||Q.every(Se=>Se.y<=0)||Q.every(Se=>Se.y>=mt))&&Z.splice(_e,1)}var Q;let K;if(S)K=bC(Z,C,s);else{K=[];for(let _e of Z)K.push({polygon:_e,bounds:C})}let se=R?this.edgeRadius:0,oe=se>0&&this.zoom<17,de=(_e,xe)=>{if(_e.length===0)return!1;let Se=_e[_e.length-1];return xe.x===Se.x&&xe.y===Se.y};for(let{polygon:_e,bounds:xe}of K){let Se=0,we=0;for(let He of _e)R&&!He[0].equals(He[He.length-1])&&He.push(He[0]),we+=R?He.length-1:He.length;let ze=this.segments.prepareSegment((R?5:4)*we,this.layoutVertexArray,this.indexArray);F.footprintSegIdx<0&&(F.footprintSegIdx=this.footprintSegments.length),F.polygonSegIdx<0&&(F.polygonSegIdx=this.polygonSegments.length);let $e={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Pe=new sC;if(Pe.vertexOffset=this.footprintVertices.length,Pe.indexOffset=3*this.footprintIndices.length,Pe.ringIndices=[],R){let He=[],De=[];Se=ze.vertexLength;for(let ut=0;ut<_e.length;ut++){let qe=_e[ut];qe.length&&ut!==0&&De.push(He.length/2);let kt=[],Ct,Ke;Ct=qe[1].sub(qe[0])._perp()._unit(),Pe.ringIndices.push(qe.length-1);for(let ei=1;ei<qe.length;ei++){let jt=qe[ei],At=qe[ei===qe.length-1?1:ei+1],Qe=jt.clone();if(se){Ke=At.sub(jt)._perp()._unit();let Yt=Ct.add(Ke)._unit(),wi=se*Math.min(4,1/(Ct.x*Yt.x+Ct.y*Yt.y));Qe.x+=wi*Yt.x,Qe.y+=wi*Yt.y,Qe.x=Math.round(Qe.x),Qe.y=Math.round(Qe.y),Ct=Ke}!V||se!==0&&!oe||de(kt,Qe)||kt.push(Qe),Am(this.layoutVertexArray,Qe.x,Qe.y,0,0,1,1,0),ze.vertexLength++,this.footprintVertices.emplaceBack(jt.x,jt.y),He.push(jt.x,jt.y),S&&Dm(this.layoutVertexExtArray,E.projectTilePoint(Qe.x,Qe.y,s),E.upVector(s,Qe.x,Qe.y))}V&&(se===0||oe)&&(kt.length!==0&&de(kt,kt[0])&&kt.pop(),this.groundEffect.addData(kt,xe,v))}let je=Kg(He,De);for(let ut=0;ut<je.length;ut+=3)this.footprintIndices.emplaceBack(Pe.vertexOffset+je[ut+0],Pe.vertexOffset+je[ut+1],Pe.vertexOffset+je[ut+2]),this.indexArray.emplaceBack(Se+je[ut],Se+je[ut+2],Se+je[ut+1]),ze.primitiveLength++;Pe.indexCount+=je.length,Pe.vertexCount+=this.footprintVertices.length-Pe.vertexOffset}for(let He=0;He<_e.length;He++){let De=_e[He];O.startRing(F,De[0]);let je=De.length>4&&fC(De[De.length-2],De[0],De[1]),ut=se?ND(De[De.length-2],De[0],De[1],se):0,qe=[],kt,Ct,Ke;Ct=De[1].sub(De[0])._perp()._unit();let ei=!0;for(let jt=1,At=0;jt<De.length;jt++){let Qe=De[jt-1],Yt=De[jt],wi=De[jt===De.length-1?1:jt+1];if(O.appendEdge(F,Yt,Qe),Wy(Yt,Qe,xe)){se&&(Ct=wi.sub(Yt)._perp()._unit(),ei=!ei);continue}let ii=Yt.sub(Qe)._perp(),Ci=ii.x/(Math.abs(ii.x)+Math.abs(ii.y)),ai=ii.y>0?1:0,Bi=Qe.dist(Yt);if(At+Bi>32768&&(At=0),se){Ke=wi.sub(Yt)._perp()._unit();let tn=pC(Qe,Yt,wi,hC(Ct,Ke),se);isNaN(tn)&&(tn=0);let un=Yt.sub(Qe)._unit();Qe=Qe.add(un.mult(ut))._round(),Yt=Yt.add(un.mult(-tn))._round(),ut=tn,Ct=Ke,V&&this.zoom>=17&&(de(qe,Qe)||qe.push(Qe),de(qe,Yt)||qe.push(Yt))}let di=ze.vertexLength,Dn=De.length>4&&fC(Qe,Yt,wi),Xi=gC(At,je,ei);if(Am(this.layoutVertexArray,Qe.x,Qe.y,Ci,ai,0,0,Xi),Am(this.layoutVertexArray,Qe.x,Qe.y,Ci,ai,0,1,Xi),At+=Bi,Xi=gC(At,Dn,!ei),je=Dn,Am(this.layoutVertexArray,Yt.x,Yt.y,Ci,ai,0,0,Xi),Am(this.layoutVertexArray,Yt.x,Yt.y,Ci,ai,0,1,Xi),ze.vertexLength+=4,this.indexArray.emplaceBack(di+0,di+1,di+2),this.indexArray.emplaceBack(di+1,di+3,di+2),ze.primitiveLength+=2,se){let tn=Se+(jt===1?De.length-2:jt-2),un=jt===1?Se:tn+1;if(this.indexArray.emplaceBack(di+1,tn,di+3),this.indexArray.emplaceBack(tn,un,di+3),ze.primitiveLength+=2,kt===void 0&&(kt=di),!Wy(wi,De[jt],xe)){let Ki=jt===De.length-1?kt:ze.vertexLength;this.indexArray.emplaceBack(di+2,di+3,Ki),this.indexArray.emplaceBack(di+3,Ki+1,Ki),this.indexArray.emplaceBack(di+3,un,Ki+1),ze.primitiveLength+=3}ei=!ei}if(S){let tn=this.layoutVertexExtArray,un=E.projectTilePoint(Qe.x,Qe.y,s),Ki=E.projectTilePoint(Yt.x,Yt.y,s),Jn=E.upVector(s,Qe.x,Qe.y),Cn=E.upVector(s,Yt.x,Yt.y);Dm(tn,un,Jn),Dm(tn,un,Jn),Dm(tn,Ki,Cn),Dm(tn,Ki,Cn)}}R&&(Se+=De.length-1),V&&se&&this.zoom>=17&&(qe.length!==0&&de(qe,qe[0])&&qe.pop(),this.groundEffect.addData(qe,xe,v,se>0))}this.footprintSegments.push(Pe),$e.triangleCount=this.indexArray.length-$e.triangleArrayOffset,this.polygonSegments.push($e),++F.footprintSegLen,++F.polygonSegLen}if(F.vertexCount=this.layoutVertexArray.length-F.vertexArrayOffset,F.groundVertexCount=this.groundEffect.vertexArray.length-F.groundVertexArrayOffset,F.vertexCount!==0){if(F.centroidXY=O.borders?aC:this.encodeCentroid(O,F),this.centroidData.push(F),O.borders){this.featuresOnBorder.push(O);let _e=this.featuresOnBorder.length-1;for(let xe=0;xe<O.borders.length;xe++)O.borders[xe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[xe].push(_e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,p,s,y),this.groundEffect.addPaintPropertiesData(e,o,d,p,s,y),this.maxHeight=Math.max(this.maxHeight,U)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){let e=[];for(let _=0;_<this.centroidData.length;_++){let y=this.centroidData[_],v=+(y.min.y+y.max.y>mt),C=2*v+(+(y.min.x+y.max.x>mt)^v);for(let E=0;E<y.polygonSegLen;E++){let S=y.polygonSegIdx+E;e.push({centroidIdx:_,subtile:C,polygonSegmentIdx:S,triangleSegmentIdx:this.polygonSegments[S].triangleSegIdx})}}let i=new Kr;e.sort((_,y)=>_.triangleSegmentIdx===y.triangleSegmentIdx?_.subtile-y.subtile:_.triangleSegmentIdx-y.triangleSegmentIdx);let o=0,s=0,d=0;for(let _ of e){if(_.triangleSegmentIdx!==o)break;d++}let p=e.length;for(;s!==e.length;){o=e[s].triangleSegmentIdx;let _=0,y=s,v=s;for(let C=y;C<d&&e[C].subtile===_;C++)v++;for(;y!==d;){let C=e[y];_=C.subtile;let E=this.centroidData[C.centroidIdx].min.clone(),S=this.centroidData[C.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let O=y;O<v;O++){let F=e[O],V=this.polygonSegments[F.polygonSegmentIdx],U=this.centroidData[F.centroidIdx].min,Z=this.centroidData[F.centroidIdx].max,Q=this.indexArray.uint16;for(let K=V.triangleArrayOffset;K<V.triangleArrayOffset+V.triangleCount;K++)i.emplaceBack(Q[3*K],Q[3*K+1],Q[3*K+2]);R.primitiveLength+=V.triangleCount,E.x=Math.min(E.x,U.x),E.y=Math.min(E.y,U.y),S.x=Math.max(S.x,Z.x),S.y=Math.max(S.y,Z.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:E,max:S}),y=v;for(let O=y;O<d&&e[O].subtile===e[y].subtile;O++)v++}s=d;for(let C=s;C<p&&e[C].triangleSegmentIdx===e[s].triangleSegmentIdx;C++)d++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){let s=0,d=0,p=1<<e.canonical.z;if(i){let F=i.getMinMaxForTile(e);F&&(s=F.min,d=F.max)}d+=this.maxHeight;let _=e.toUnwrapped(),y,v=[_.canonical.x/p+_.wrap,_.canonical.y/p],C=[(_.canonical.x+1)/p+_.wrap,(_.canonical.y+1)/p],E=new yr,S=(F,V,U)=>[F[0]*(1-U[0])+V[0]*U[0],F[1]*(1-U[1])+V[1]*U[1]],R=[],O=[];for(let F of this.triangleSubSegments){R[0]=F.min.x/mt,R[1]=F.min.y/mt,O[0]=F.max.x/mt,O[1]=F.max.y/mt;let V=S(v,C,R),U=S(v,C,O);if(new mr([V[0],V[1],s],[U[0],U[1],d]).intersectsPrecise(o)===0){y&&(E.segments.push(y),y=void 0);continue}let Z=F.segment;y&&y.vertexOffset!==Z.vertexOffset&&(E.segments.push(y),y=void 0),y?(y.vertexLength+=Z.vertexLength,y.primitiveLength+=Z.primitiveLength):y={vertexOffset:Z.vertexOffset,primitiveLength:Z.primitiveLength,vertexLength:Z.vertexLength,primitiveOffset:Z.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&E.segments.push(y),E}encodeCentroid(e,i){let o=e.centroid(),s=i.span(),d=Math.min(7,Math.round(s.x*this.tileToMeter/10)),p=Math.min(7,Math.round(s.y*this.tileToMeter/10));return new dt(gi(o.x,1,mt-1)<<3|d,gi(o.y,1,mt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new dt(0,0);let i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){let s=i[0][0]!==o?0:1;return new dt(6|(i[0][0]!==o?0:65528),(i[s][0]+i[s][1])/2<<3|6)}{let s=i[2][0]!==o?2:3;return new dt((i[s][0]+i[s][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){let i=this.centroidData[e.centroidDataIndex];i.flags&=sd,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,s=e.flags&sd?aC:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==s.y||d!==s.x){for(let p=i;p<o;++p)this.centroidVertexArray.emplace(p,s.x,s.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let o=i.getReplacementRegionsForTile(e.toUnwrapped());if(function(d,p){if(d.length!==p.length)return!1;for(let _=0;_<d.length;_++)if(d[_].sourceId!==p[_].sourceId||!Zw(d[_],p[_]))return!1;return!0}(this.activeReplacements,o))return;if(this.activeReplacements=o,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let d of this.centroidData)d.flags&=2147483647;let s=[];for(let d of this.activeReplacements){let p=Math.pow(2,d.footprintTileId.canonical.z-e.canonical.z);for(let _ of this.centroidData)if(!(_.flags&sd||d.min.x>_.max.x||_.min.x>d.max.x||d.min.y>_.max.y||_.min.y>d.max.y))for(let y=0;y<_.footprintSegLen;y++){let v=this.footprintSegments[_.footprintSegIdx+y];if(s.length=0,BD(this.footprintVertices,v.vertexOffset,v.vertexCount,d.footprintTileId.canonical,e.canonical,s),Kw(d.footprint,s,this.footprintIndices.uint16,v.indexOffset,v.indexCount,-v.vertexOffset,-p)){_.flags|=sd;break}}}for(let d of this.centroidData)this.writeCentroidToBuffer(d);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let s=!1;for(let d=0;d<o.footprintSegLen;d++){let p=this.footprintSegments[o.footprintSegIdx+d],_=0;for(let y of p.ringIndices){for(let v=_,C=y+_-1;v<y+_;C=v++){let E=this.footprintVertices.int16[2*(v+p.vertexOffset)+0],S=this.footprintVertices.int16[2*(v+p.vertexOffset)+1],R=this.footprintVertices.int16[2*(C+p.vertexOffset)+1];S>i!=R>i&&e<(this.footprintVertices.int16[2*(C+p.vertexOffset)+0]-E)*(i-S)/(R-S)+E&&(s=!s)}_=y}}return s}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,s=!0,d=4*(e+mt)*mt+(i+mt);if(this.partLookup.hasOwnProperty(d)){let p=this.partLookup[d];return p?{height:p.height,hidden:!!(p.flags&sd)}:void 0}for(let p of this.centroidData)e>p.max.x||p.min.x>e||i>p.max.y||p.min.y>i||this.footprintContainsPoint(e,i,p)&&p&&p.height>o&&(o=p.height,this.partLookup[d]=p,s=!!(p.flags&sd));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:s};this.partLookup[d]=void 0}}function hC(t,e){let i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function ND(t,e,i,o){let s=e.sub(t)._perp()._unit(),d=i.sub(e)._perp()._unit();return pC(t,e,i,hC(s,d),o)}function pC(t,e,i,o,s){let d=Math.sqrt(1-o*o);return Math.min(t.dist(e)/3,e.dist(i)/3,s*d/o)}function Wy(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function mC(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function fC(t,e,i){if(t.x<0||t.x>=mt||e.x<0||e.x>=mt||i.x<0||i.x>=mt)return!1;let o=i.sub(e),s=o.perp(),d=t.sub(e);return(o.x*d.x+o.y*d.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(d.x*d.x+d.y*d.y))>-.866&&s.x*d.x+s.y*d.y<0}function gC(t,e,i){let o=e?2|t:-3&t;return i?1|o:-2&o}function _C(){let t=Math.PI/32,e=Math.tan(t),i=Re;return i*Math.sqrt(1+2*e*e)-i}function bC(t,e,i){let o=1<<i.z,s=li(i.x/o),d=li((i.x+1)/o),p=Ui(i.y/o),_=Ui((i.y+1)/o);return function(y,v,C,E,S=0,R){let O=[];if(!y.length||!C||!E)return O;let F=(oe,de)=>{for(let _e of oe)O.push({polygon:_e,bounds:de})},V=Math.ceil(Math.log2(C)),U=Math.ceil(Math.log2(E)),Z=V-U,Q=[];for(let oe=0;oe<Math.abs(Z);oe++)Q.push(Z>0?0:1);for(let oe=0;oe<Math.min(V,U);oe++)Q.push(0),Q.push(1);let K=y;if(K=e_(K,v[0].y-S,v[1].y+S,1),K=e_(K,v[0].x-S,v[1].x+S,0),!K.length)return O;let se=[];for(Q.length?se.push({polygons:K,bounds:v,depth:0}):F(K,v);se.length;){let oe=se.pop(),de=oe.depth,_e=Q[de],xe=oe.bounds[0],Se=oe.bounds[1],we=_e===0?xe.x:xe.y,ze=_e===0?Se.x:Se.y,$e=R?R(_e,we,ze):.5*(we+ze),Pe=e_(oe.polygons,we-S,$e+S,_e),He=e_(oe.polygons,$e-S,ze+S,_e);if(Pe.length){let De=[xe,new dt(_e===0?$e:Se.x,_e===1?$e:Se.y)];Q.length>de+1?se.push({polygons:Pe,bounds:De,depth:de+1}):F(Pe,De)}if(He.length){let De=[new dt(_e===0?$e:xe.x,_e===1?$e:xe.y),Se];Q.length>de+1?se.push({polygons:He,bounds:De,depth:de+1}):F(He,De)}}return O}(t,e,Math.ceil((d-s)/11.25),Math.ceil((p-_)/11.25),1,(y,v,C)=>{if(y===0)return .5*(v+C);{let E=Ui((i.y+v/mt)/o);return(ri(.5*(Ui((i.y+C/mt)/o)+E))*o-i.y)*mt}})}function BD(t,e,i,o,s,d){let p=Math.pow(2,o.z-s.z);for(let _=0;_<i;_++){let y=t.int16[2*(_+e)+0],v=t.int16[2*(_+e)+1];y=(y+s.x*mt)*p-o.x*mt,v=(v+s.y*mt)*p-o.y*mt,d.push(new dt(y,v))}}Et(r_,"FillExtrusionBucket",{omit:["layers","features"]}),Et(lC,"PartData"),Et(sC,"FootprintSegment"),Et(cC,"BorderCentroidData"),Et(uC,"GroundEffect");let VD=new rr({visibility:new ct(Te["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ct(Te["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var jD={paint:new rr({"fill-extrusion-opacity":new ct(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Zt(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ct(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ct(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Zt(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Zt(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Zt(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ct(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ct(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ct(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ct(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ct(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ct(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ct(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ct(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Zt(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Zt(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ct(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ct(Te["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ct(Te["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ct(Te["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ct(Te["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:VD};class Ah extends dt{constructor(e,i,o){super(e,i),this.z=o}}function km(t,e){return t.x*e.x+t.y*e.y}function yC(t,e){if(t.length===1){let i=0,o=e[i++],s;for(;!s||o.equals(s);)if(s=e[i++],!s)return 1/0;for(;i<e.length;i++){let d=e[i],p=t[0],_=s.sub(o),y=d.sub(o),v=p.sub(o),C=km(_,_),E=km(_,y),S=km(y,y),R=km(v,_),O=km(v,y),F=C*S-E*E,V=(S*R-E*O)/F,U=(C*O-E*R)/F,Z=o.z*(1-V-U)+s.z*V+d.z*U;if(isFinite(Z))return Z}return 1/0}{let i=1/0;for(let o of e)i=Math.min(i,o.z);return i}}function vC(t,e,i,o,s,d,p,_){let y=p*s.getElevationAt(t,e,!0,!0),v=d[0]!==0,C=v?d[1]===0?p*(d[0]/7-450):p*function(E,S,R){let O=Math.floor(S[0]/8),F=Math.floor(S[1]/8),V=10*(S[0]-8*O),U=10*(S[1]-8*F),Z=E.getElevationAt(O,F,!0,!0),Q=E.getMeterToDEM(R),K=Math.floor(.5*(V*Q-1)),se=Math.floor(.5*(U*Q-1)),oe=E.tileCoordToPixel(O,F),de=2*K+1,_e=2*se+1,xe=function(He,De,je,ut,qe){return[He.getElevationAtPixel(De,je,!0),He.getElevationAtPixel(De+qe,je,!0),He.getElevationAtPixel(De,je+qe,!0),He.getElevationAtPixel(De+ut,je+qe,!0)]}(E,oe.x-K,oe.y-se,de,_e),Se=Math.abs(xe[0]-xe[1]),we=Math.abs(xe[2]-xe[3]),ze=Math.abs(xe[0]-xe[2])+Math.abs(xe[1]-xe[3]),$e=Math.min(.25,.5*Q*(Se+we)/de),Pe=Math.min(.25,.5*Q*ze/_e);return Z+Math.max($e*V,Pe*U)}(s,d,_):y;return{base:y+(i===0)?-1:i,top:v?Math.max(C+o,y+i+2):y+o}}let UD=fn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:GD}=UD,HD=fn([{name:"a_packed",components:4,type:"Float32"}]),{members:$D}=HD;class xC{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new od({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){let o=this.getKey(e,i);return this.positions[o]}trim(){let e=this.width,i=this.height=zo(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){let s=[],d=e.length%2==1?-e[e.length-1]*o:0,p=e[0]*o,_=!0;s.push({left:d,right:p,isDash:_,zeroLength:e[0]===0});let y=e[0];for(let v=1;v<e.length;v++){_=!_;let C=e[v];d=y*o,y+=C,p=y*o,s.push({left:d,right:p,isDash:_,zeroLength:C===0})}return s}addRoundDash(e,i,o){let s=i/2;for(let d=-o;d<=o;d++){let p=this.width*(this.nextRow+o+d),_=0,y=e[_];for(let v=0;v<this.width;v++){v/y.right>1&&(y=e[++_]);let C=Math.abs(v-y.left),E=Math.abs(v-y.right),S=Math.min(C,E),R,O=d/o*(s+1);if(y.isDash){let F=s-Math.abs(O);R=Math.sqrt(S*S+F*F)}else R=s-Math.sqrt(S*S+O*O);this.image.data[p+v]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,i){for(let y=e.length-1;y>=0;--y){let v=e[y],C=e[y+1];v.zeroLength?e.splice(y,1):C&&C.isDash===v.isDash&&(C.left=v.left,e.splice(y,1))}let o=e[0],s=e[e.length-1];o.isDash===s.isDash&&(o.left=s.left-this.width,s.right=o.right+this.width);let d=this.width*this.nextRow,p=0,_=e[p];for(let y=0;y<this.width;y++){y/_.right>1&&(_=e[++p]);let v=Math.abs(y-_.left),C=Math.abs(y-_.right),E=Math.min(v,C);this.image.data[d+y]=Math.max(0,Math.min(255,(_.isDash?E:-E)+i+128))}}addDash(e,i){let o=this.getKey(e,i);if(this.positions[o])return this.positions[o];let s=i==="round",d=s?7:0,p=2*d+1;if(this.nextRow+p>this.height)return er("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let C=0;C<e.length;C++)e[C]<0&&(er("Negative value is found in line dasharray, replacing values with 0"),e[C]=0),_+=e[C];if(_!==0){let C=this.width/_,E=this.getDashRanges(e,this.width,C);s?this.addRoundDash(E,C,d):this.addRegularDash(E,i==="square"?.5*C:0)}let y=this.nextRow+d;this.nextRow+=p;let v={tl:[y,d],br:[_,0]};return this.positions[o]=v,v}}Et(xC,"LineAtlas");let qD=Jg.types,WD=Math.cos(Math.PI/180*37.5);class Zy{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new cm,this.layoutVertexArray2=new Gl,this.indexArray=new Kr,this.programConfigurations=new H(e.layers,e.zoom),this.segments=new yr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,o,s){this.hasPattern=Gy("line",this.layers,i);let d=this.layers[0].layout.get("line-sort-key"),p=[];for(let{feature:C,id:E,index:S,sourceLayerIndex:R}of e){let O=this.layers[0]._featureFilter.needGeometry,F=Vr(C,O);if(!this.layers[0]._featureFilter.filter(new nr(this.zoom),F,o))continue;let V=d?d.evaluate(F,{},o):void 0,U={id:E,properties:C.properties,type:C.type,sourceLayerIndex:R,index:S,geometry:O?F.geometry:Jr(C,o,s),patterns:{},sortKey:V};p.push(U)}d&&p.sort((C,E)=>C.sortKey-E.sortKey);let{lineAtlas:_,featureIndex:y}=i,v=this.addConstantDashes(_);for(let C of p){let{geometry:E,index:S,sourceLayerIndex:R}=C;if(v&&this.addFeatureDashes(C,_),this.hasPattern){let O=Hy("line",this.layers,C,this.zoom,i);this.patternFeatures.push(O)}else this.addFeature(C,E,S,o,_.positions,i.availableImages,i.brightness);y.insert(e[S].feature,E,S,R,this.index)}}addConstantDashes(e){let i=!1;for(let o of this.layers){let s=o.paint.get("line-dasharray").value,d=o.layout.get("line-cap").value;if(s.kind!=="constant"||d.kind!=="constant")i=!0;else{let p=d.value,_=s.value;if(!_)continue;e.addDash(_,p)}}return i}addFeatureDashes(e,i){let o=this.zoom;for(let s of this.layers){let d=s.paint.get("line-dasharray").value,p=s.layout.get("line-cap").value;if(d.kind==="constant"&&p.kind==="constant")continue;let _,y;if(d.kind==="constant"){if(_=d.value,!_)continue}else _=d.evaluate({zoom:o},e);y=p.kind==="constant"?p.value:p.evaluate({zoom:o},e),i.addDash(_,y),e.patterns[s.id]=i.getKey(_,y)}}update(e,i,o,s,d){let p=Object.keys(e).length!==0;p&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,p?this.stateDependentLayers:this.layers,o,s,d)}addFeatures(e,i,o,s,d,p){for(let _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,i,o,s,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,$D)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,GD),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,o,s,d,p,_){let y=this.layers[0].layout,v=y.get("line-join").evaluate(e,{}),C=y.get("line-cap").evaluate(e,{}),E=y.get("line-miter-limit"),S=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let R of i)this.addLine(R,e,v,C,E,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,p,s,_)}addLine(e,i,o,s,d,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let U=0;U<e.length-1;U++)this.totalDistance+=e[U].dist(e[U+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let _=qD[i.type]==="Polygon",y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let v=0;for(;v<y-1&&e[v].equals(e[v+1]);)v++;if(y<(_?3:2))return;o==="bevel"&&(d=1.05);let C=this.overscaling<=16?15*mt/(512*this.overscaling):0,E=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray),S,R,O,F,V;this.e1=this.e2=-1,_&&(S=e[y-2],V=e[v].sub(S)._unit()._perp());for(let U=v;U<y;U++){if(O=U===y-1?_?e[v+1]:void 0:e[U+1],O&&e[U].equals(O))continue;V&&(F=V),S&&(R=S),S=e[U],V=O?O.sub(S)._unit()._perp():F,F=F||V;let Z=F.add(V);Z.x===0&&Z.y===0||Z._unit();let Q=F.x*V.x+F.y*V.y,K=Z.x*V.x+Z.y*V.y,se=K!==0?1/K:1/0,oe=2*Math.sqrt(2-2*K),de=K<WD&&R&&O,_e=F.x*V.y-F.y*V.x>0;if(de&&U>v){let we=S.dist(R);if(we>2*C){let ze=S.sub(S.sub(R)._mult(C/we)._round());this.updateDistance(R,ze),this.addCurrentVertex(ze,F,0,0,E),R=ze}}let xe=R&&O,Se=xe?o:_?"butt":s;if(xe&&Se==="round"&&(se<p?Se="miter":se<=2&&(Se="fakeround")),Se==="miter"&&se>d&&(Se="bevel"),Se==="bevel"&&(se>2&&(Se="flipbevel"),se<d&&(Se="miter")),R&&this.updateDistance(R,S),Se==="miter")Z._mult(se),this.addCurrentVertex(S,Z,0,0,E);else if(Se==="flipbevel"){if(se>100)Z=V.mult(-1);else{let we=se*F.add(V).mag()/F.sub(V).mag();Z._perp()._mult(we*(_e?-1:1))}this.addCurrentVertex(S,Z,0,0,E),this.addCurrentVertex(S,Z.mult(-1),0,0,E)}else if(Se==="bevel"||Se==="fakeround"){let we=-Math.sqrt(se*se-1),ze=_e?we:0,$e=_e?0:we;if(R&&this.addCurrentVertex(S,F,ze,$e,E),Se==="fakeround"){let Pe=Math.round(180*oe/Math.PI/20);for(let He=1;He<Pe;He++){let De=He/Pe;if(De!==.5){let ut=De-.5;De+=De*ut*(De-1)*((1.0904+Q*(Q*(3.55645-1.43519*Q)-3.2452))*ut*ut+(.848013+Q*(.215638*Q-1.06021)))}let je=V.sub(F)._mult(De)._add(F)._unit()._mult(_e?-1:1);this.addHalfVertex(S,je.x,je.y,!1,_e,0,E)}}O&&this.addCurrentVertex(S,V,-ze,-$e,E)}else if(Se==="butt")this.addCurrentVertex(S,Z,0,0,E);else if(Se==="square"){let we=R?1:-1;R||this.addCurrentVertex(S,Z,we,we,E),this.addCurrentVertex(S,Z,0,0,E),R&&this.addCurrentVertex(S,Z,we,we,E)}else Se==="round"&&(R&&(this.addCurrentVertex(S,F,0,0,E),this.addCurrentVertex(S,F,1,1,E,!0)),O&&(this.addCurrentVertex(S,V,-1,-1,E,!0),this.addCurrentVertex(S,V,0,0,E)));if(de&&U<y-1){let we=S.dist(O);if(we>2*C){let ze=S.add(O.sub(S)._mult(C/we)._round());this.updateDistance(S,ze),this.addCurrentVertex(ze,V,0,0,E),S=ze}}}}addCurrentVertex(e,i,o,s,d,p=!1){let _=i.y*s-i.x,y=-i.y-i.x*s;this.addHalfVertex(e,i.x+i.y*o,i.y-i.x*o,p,!1,o,d),this.addHalfVertex(e,_,y,p,!0,-s,d)}addHalfVertex({x:e,y:i},o,s,d,p,_,y){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(i<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*s)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let v=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),y.primitiveLength++),p?this.e2=v:this.e1=v}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Et(Zy,"LineBucket",{omit:["layers","patternFeatures"]});let ZD=new rr({"line-cap":new Zt(Te.layout_line["line-cap"]),"line-join":new Zt(Te.layout_line["line-join"]),"line-miter-limit":new ct(Te.layout_line["line-miter-limit"]),"line-round-limit":new ct(Te.layout_line["line-round-limit"]),"line-sort-key":new Zt(Te.layout_line["line-sort-key"]),visibility:new ct(Te.layout_line.visibility)});var wC={paint:new rr({"line-opacity":new Zt(Te.paint_line["line-opacity"]),"line-color":new Zt(Te.paint_line["line-color"]),"line-translate":new ct(Te.paint_line["line-translate"]),"line-translate-anchor":new ct(Te.paint_line["line-translate-anchor"]),"line-width":new Zt(Te.paint_line["line-width"]),"line-gap-width":new Zt(Te.paint_line["line-gap-width"]),"line-offset":new Zt(Te.paint_line["line-offset"]),"line-blur":new Zt(Te.paint_line["line-blur"]),"line-dasharray":new Zt(Te.paint_line["line-dasharray"]),"line-pattern":new Zt(Te.paint_line["line-pattern"]),"line-gradient":new xc(Te.paint_line["line-gradient"]),"line-trim-offset":new ct(Te.paint_line["line-trim-offset"]),"line-emissive-strength":new ct(Te.paint_line["line-emissive-strength"]),"line-border-width":new Zt(Te.paint_line["line-border-width"]),"line-border-color":new Zt(Te.paint_line["line-border-color"])}),layout:ZD};function CC(t,e,i){return e*(mt/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}function TC(t,e){return 1/CC(t,1,e.tileZoom)}function EC(t,e,i,o){return t.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}let IC=t=>{let e=[];SC(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let i=t.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function SC(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let MC=new class extends Zt{possiblyEvaluate(t,e){return e=new nr(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,o){return e=Gr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,o)}}(wC.paint.properties["line-width"].specification);function AC(t,e){return e>0?e+2*t:t}MC.useIntegerZoom=!0;let YD=fn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),XD=fn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),KD=fn([{name:"a_projected_pos",components:4,type:"Float32"}],4);fn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let QD=fn([{name:"a_z_offset",components:1,type:"Float32"}],4),JD=fn([{name:"a_texb",components:2,type:"Uint16"}]),ek=fn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),tk=fn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);fn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let DC=fn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ik=fn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);fn([{name:"triangle",components:3,type:"Uint16"}]),fn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),fn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),fn([{type:"Float32",name:"offsetX"}]),fn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Mo=24;let cl=128;function Yy(t,e){let{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new nr(t+1))};if(i.kind==="source")return{kind:"source"};{let{zoomStops:o,interpolationType:s}=i,d=0;for(;d<o.length&&o[d]<=t;)d++;d=Math.max(0,d-1);let p=d;for(;p<o.length&&o[p]<t+1;)p++;p=Math.min(o.length-1,p);let _=o[d],y=o[p];return i.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:y,interpolationType:s}:{kind:"camera",minZoom:_,maxZoom:y,minSize:i.evaluate(new nr(_)),maxSize:i.evaluate(new nr(y)),interpolationType:s}}}function o_(t,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:s}){return t.kind==="source"?o/cl:t.kind==="composite"?Ai(o/cl,s/cl,i):e}function Dh(t,e){let i=0,o=0;if(t.kind==="constant")o=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:s,minZoom:d,maxZoom:p}=t,_=s?gi(_o.interpolationFactor(s,e,d,p),0,1):0;t.kind==="camera"?o=Ai(t.minSize,t.maxSize,_):i=_}return{uSizeT:i,uSize:o}}var nk=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:cl,evaluateSizeForFeature:o_,evaluateSizeForZoom:Dh,getSizeData:Yy});function rk(t,e,i){return t.sections.forEach(o=>{o.text=function(s,d,p){let _=d.layout.get("text-transform").evaluate(p,{});return _==="uppercase"?s=s.toLocaleUpperCase():_==="lowercase"&&(s=s.toLocaleLowerCase()),xa.applyArabicShaping&&(s=xa.applyArabicShaping(s)),s}(o.text,e,i)}),t}let Rm={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function ok(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function ak(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var sk={read:function(t,e,i,o,s){var d,p,_=8*s-o-1,y=(1<<_)-1,v=y>>1,C=-7,E=i?s-1:0,S=i?-1:1,R=t[e+E];for(E+=S,d=R&(1<<-C)-1,R>>=-C,C+=_;C>0;d=256*d+t[e+E],E+=S,C-=8);for(p=d&(1<<-C)-1,d>>=-C,C+=o;C>0;p=256*p+t[e+E],E+=S,C-=8);if(d===0)d=1-v;else{if(d===y)return p?NaN:1/0*(R?-1:1);p+=Math.pow(2,o),d-=v}return(R?-1:1)*p*Math.pow(2,d-o)},write:function(t,e,i,o,s,d){var p,_,y,v=8*d-s-1,C=(1<<v)-1,E=C>>1,S=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=o?0:d-1,O=o?1:-1,F=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(_=isNaN(e)?1:0,p=C):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+E>=1?S/y:S*Math.pow(2,1-E))*y>=2&&(p++,y/=2),p+E>=C?(_=0,p=C):p+E>=1?(_=(e*y-1)*Math.pow(2,s),p+=E):(_=e*Math.pow(2,E-1)*Math.pow(2,s),p=0));s>=8;t[i+R]=255&_,R+=O,_/=256,s-=8);for(p=p<<s|_,v+=s;v>0;t[i+R]=255&p,R+=O,p/=256,v-=8);t[i+R-O]|=128*F}},kC=Qn,a_=sk;function Qn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Qn.Varint=0,Qn.Fixed64=1,Qn.Bytes=2,Qn.Fixed32=5;var Xy=4294967296,RC=1/Xy,PC=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ac(t){return t.type===Qn.Bytes?t.readVarint()+t.pos:t.pos+1}function kh(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function OC(t,e,i){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(var s=i.pos-1;s>=t;s--)i.buf[s+o]=i.buf[s]}function lk(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function ck(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function dk(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function uk(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function hk(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function pk(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function mk(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function fk(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function gk(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function s_(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Rh(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function FC(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Qn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var o=this.readVarint(),s=o>>3,d=this.pos;this.type=7&o,t(s,e,this),this.pos===d&&this.skip(o)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=s_(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=FC(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=s_(this.buf,this.pos)+s_(this.buf,this.pos+4)*Xy;return this.pos+=8,t},readSFixed64:function(){var t=s_(this.buf,this.pos)+FC(this.buf,this.pos+4)*Xy;return this.pos+=8,t},readFloat:function(){var t=a_.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=a_.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,o=this.buf;return e=127&(i=o[this.pos++]),i<128?e:(e|=(127&(i=o[this.pos++]))<<7,i<128?e:(e|=(127&(i=o[this.pos++]))<<14,i<128?e:(e|=(127&(i=o[this.pos++]))<<21,i<128?e:function(s,d,p){var _,y,v=p.buf;if(_=(112&(y=v[p.pos++]))>>4,y<128||(_|=(127&(y=v[p.pos++]))<<3,y<128)||(_|=(127&(y=v[p.pos++]))<<10,y<128)||(_|=(127&(y=v[p.pos++]))<<17,y<128)||(_|=(127&(y=v[p.pos++]))<<24,y<128)||(_|=(1&(y=v[p.pos++]))<<31,y<128))return kh(s,_,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=o[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&PC?function(i,o,s){return PC.decode(i.subarray(o,s))}(this.buf,e,t):function(i,o,s){for(var d="",p=o;p<s;){var _,y,v,C=i[p],E=null,S=C>239?4:C>223?3:C>191?2:1;if(p+S>s)break;S===1?C<128&&(E=C):S===2?(192&(_=i[p+1]))==128&&(E=(31&C)<<6|63&_)<=127&&(E=null):S===3?(y=i[p+2],(192&(_=i[p+1]))==128&&(192&y)==128&&((E=(15&C)<<12|(63&_)<<6|63&y)<=2047||E>=55296&&E<=57343)&&(E=null)):S===4&&(y=i[p+2],v=i[p+3],(192&(_=i[p+1]))==128&&(192&y)==128&&(192&v)==128&&((E=(15&C)<<18|(63&_)<<12|(63&y)<<6|63&v)<=65535||E>=1114112)&&(E=null)),E===null?(E=65533,S=1):E>65535&&(E-=65536,d+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),d+=String.fromCharCode(E),p+=S}return d}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Qn.Bytes)return t.push(this.readVarint(e));var i=Ac(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Qn.Bytes)return t.push(this.readSVarint());var e=Ac(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Qn.Bytes)return t.push(this.readBoolean());var e=Ac(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Qn.Bytes)return t.push(this.readFloat());var e=Ac(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Qn.Bytes)return t.push(this.readDouble());var e=Ac(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Qn.Bytes)return t.push(this.readFixed32());var e=Ac(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Qn.Bytes)return t.push(this.readSFixed32());var e=Ac(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Qn.Bytes)return t.push(this.readFixed64());var e=Ac(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Qn.Bytes)return t.push(this.readSFixed64());var e=Ac(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Qn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Qn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Qn.Fixed32)this.pos+=4;else{if(e!==Qn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Rh(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Rh(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Rh(this.buf,-1&t,this.pos),Rh(this.buf,Math.floor(t*RC),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Rh(this.buf,-1&t,this.pos),Rh(this.buf,Math.floor(t*RC),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var o,s;if(e>=0?(o=e%4294967296|0,s=e/4294967296|0):(s=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,s=s+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(d,p,_){_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,d>>>=7,_.buf[_.pos++]=127&d|128,_.buf[_.pos]=127&(d>>>=7)}(o,0,i),function(d,p){var _=(7&d)<<4;p.buf[p.pos++]|=_|((d>>>=3)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d)))))}(s,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(o,s,d){for(var p,_,y=0;y<s.length;y++){if((p=s.charCodeAt(y))>55295&&p<57344){if(!_){p>56319||y+1===s.length?(o[d++]=239,o[d++]=191,o[d++]=189):_=p;continue}if(p<56320){o[d++]=239,o[d++]=191,o[d++]=189,_=p;continue}p=_-55296<<10|p-56320|65536,_=null}else _&&(o[d++]=239,o[d++]=191,o[d++]=189,_=null);p<128?o[d++]=p:(p<2048?o[d++]=p>>6|192:(p<65536?o[d++]=p>>12|224:(o[d++]=p>>18|240,o[d++]=p>>12&63|128),o[d++]=p>>6&63|128),o[d++]=63&p|128)}return d}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&OC(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),a_.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),a_.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var o=this.pos-i;o>=128&&OC(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o},writeMessage:function(t,e,i){this.writeTag(t,Qn.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,lk,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,ck,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,hk,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,dk,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,uk,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,pk,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,mk,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,fk,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,gk,e)},writeBytesField:function(t,e){this.writeTag(t,Qn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Qn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Qn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Qn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Qn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Qn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Qn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Qn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Qn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Qn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Ph=vi(kC);let Ky=3;function _k(t,e,i){e.glyphs=[],t===1&&i.readMessage(bk,e)}function bk(t,e,i){if(t===3){let{id:o,bitmap:s,width:d,height:p,left:_,top:y,advance:v}=i.readMessage(yk,{});e.glyphs.push({id:o,bitmap:new od({width:d+2*Ky,height:p+2*Ky},s),metrics:{width:d,height:p,left:_,top:y,advance:v}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function yk(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}let LC=Ky,ts={horizontal:1,vertical:2,horizontalOnly:3};class Pm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){let o=new Pm;return o.scale=e||1,o.fontStack=i,o}static forImage(e){let i=new Pm;return i.imageName=e,i}}class Oh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){let o=new Oh;for(let s=0;s<e.sections.length;s++){let d=e.sections[s];d.image?o.addImageSection(d):o.addTextSection(d,i)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let s="";for(let d=0;d<i.length;d++){let p=i.charCodeAt(d+1)||null,_=i.charCodeAt(d-1)||null;s+=!o&&(p&&mg(p)&&!Rm[i[d+1]]||_&&mg(_)&&!Rm[i[d-1]])||!Rm[i[d]]?i[d]:Rm[i[d]]}return s}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&l_[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&l_[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){let o=new Oh;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Pm.forText(e.scale,e.fontStack||i));let o=this.sections.length-1;for(let s=0;s<e.text.length;++s)this.sectionIndex.push(o)}addImageSection(e){let i=e.image?e.image.namePrimary:"";if(i.length===0)return void er("Can't add FormattedSection with an empty image.");let o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCodePoint(o),this.sections.push(Pm.forImage(i)),this.sectionIndex.push(this.sections.length-1)):er("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Qy(t,e,i,o,s,d,p,_,y,v,C,E,S,R,O){let F=Oh.fromFeature(t,s);E===ts.vertical&&F.verticalizePunctuation(S);let V=[],U=function(oe,de,_e,xe,Se,we){if(!oe)return[];let ze=[],$e=function(je,ut,qe,kt,Ct,Ke){let ei=0;for(let jt=0;jt<je.length();jt++){let At=je.getSection(jt);ei+=zC(je.getCodePoint(jt),At,kt,Ct,ut,Ke)}return ei/Math.max(1,Math.ceil(ei/qe))}(oe,de,_e,xe,Se,we),Pe=oe.text.indexOf("\u200B")>=0,He=0;for(let je=0;je<oe.length();je++){let ut=oe.getSection(je),qe=oe.getCodePoint(je);if(l_[qe]||(He+=zC(qe,ut,xe,Se,de,we)),je<oe.length()-1){let kt=!((De=qe)<11904||!(Ot["Bopomofo Extended"](De)||Ot.Bopomofo(De)||Ot["CJK Compatibility Forms"](De)||Ot["CJK Compatibility Ideographs"](De)||Ot["CJK Compatibility"](De)||Ot["CJK Radicals Supplement"](De)||Ot["CJK Strokes"](De)||Ot["CJK Symbols and Punctuation"](De)||Ot["CJK Unified Ideographs Extension A"](De)||Ot["CJK Unified Ideographs"](De)||Ot["Enclosed CJK Letters and Months"](De)||Ot["Halfwidth and Fullwidth Forms"](De)||Ot.Hiragana(De)||Ot["Ideographic Description Characters"](De)||Ot["Kangxi Radicals"](De)||Ot["Katakana Phonetic Extensions"](De)||Ot.Katakana(De)||Ot["Vertical Forms"](De)||Ot["Yi Radicals"](De)||Ot["Yi Syllables"](De)));(vk[qe]||kt||ut.imageName)&&ze.push(BC(je+1,He,$e,ze,xk(qe,oe.getCodePoint(je+1),kt&&Pe),!1))}}var De;return VC(BC(oe.length(),He,$e,ze,0,!0))}(F,v,d,e,o,R),{processBidirectionalText:Z,processStyledBidirectionalText:Q}=xa;if(Z&&F.sections.length===1){let oe=Z(F.toString(),U);for(let de of oe){let _e=new Oh;_e.text=de,_e.sections=F.sections;for(let xe=0;xe<de.length;xe++)_e.sectionIndex.push(0);V.push(_e)}}else if(Q){let oe=Q(F.text,F.sectionIndex,U);for(let de of oe){let _e=new Oh;_e.text=de[0],_e.sectionIndex=de[1],_e.sections=F.sections,V.push(_e)}}else V=function(oe,de){let _e=[],xe=oe.text,Se=0;for(let we of de)_e.push(oe.substring(Se,we)),Se=we;return Se<xe.length&&_e.push(oe.substring(Se,xe.length)),_e}(F,U);let K=[],se={positionedLines:K,text:F.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(oe,de,_e,xe,Se,we,ze,$e,Pe,He,De,je){let ut=0,qe=0,kt=0,Ct=$e==="right"?1:$e==="left"?0:.5,Ke=!1;for(let wi of Se){let ii=wi.getSections();for(let Ci of ii){if(Ci.imageName)continue;let ai=de[Ci.fontStack];if(ai&&(Ke=ai.ascender!==void 0&&ai.descender!==void 0,!Ke))break}if(!Ke)break}let ei=0;for(let wi of Se){wi.trim();let ii=wi.getMaxScale(),Ci=(ii-1)*Mo,ai={positionedGlyphs:[],lineOffset:0};oe.positionedLines[ei]=ai;let Bi=ai.positionedGlyphs,di=0;if(!wi.length()){qe+=we,++ei;continue}let Dn=0,Xi=0;for(let un=0;un<wi.length();un++){let Ki=wi.getSection(un),Jn=wi.getSectionIndex(un),Cn=wi.getCodePoint(un),vr=Ki.scale,$r=null,yo=null,Yn=null,sr=Mo,ro=0,oo=!(Pe===ts.horizontal||!De&&!Wp(Cn)||De&&(l_[Cn]||(jt=Cn,Ot.Arabic(jt)||Ot["Arabic Supplement"](jt)||Ot["Arabic Extended-A"](jt)||Ot["Arabic Presentation Forms-A"](jt)||Ot["Arabic Presentation Forms-B"](jt))));if(Ki.imageName){let ao=xe[Ki.imageName];if(!ao)continue;Yn=Ki.imageName,oe.iconsInText=oe.iconsInText||!0,yo=ao.paddedRect;let Un=ao.displaySize;vr=vr*Mo/je,$r={width:Un[0],height:Un[1],left:0,top:-LC,advance:oo?Un[1]:Un[0],localGlyph:!1},ro=Ke?-$r.height*vr:ii*Mo-17-Un[1]*vr,sr=$r.advance;let La=(oo?Un[0]:Un[1])*vr-Mo*ii;La>0&&La>di&&(di=La)}else{let ao=_e[Ki.fontStack];if(!ao)continue;ao[Cn]&&(yo=ao[Cn]);let Un=de[Ki.fontStack];if(!Un)continue;let La=Un.glyphs[Cn];if(!La)continue;if($r=La.metrics,sr=Cn!==8203?Mo:0,Ke){let md=Un.ascender!==void 0?Math.abs(Un.ascender):0,da=Un.descender!==void 0?Math.abs(Un.descender):0,Go=(md+da)*vr;Dn<Go&&(Dn=Go,Xi=(md-da)/2*vr),ro=-md*vr}else ro=(ii-vr)*Mo-17}oo?(oe.verticalizable=!0,Bi.push({glyph:Cn,imageName:Yn,x:ut,y:qe+ro,vertical:oo,scale:vr,localGlyph:$r.localGlyph,fontStack:Ki.fontStack,sectionIndex:Jn,metrics:$r,rect:yo}),ut+=sr*vr+He):(Bi.push({glyph:Cn,imageName:Yn,x:ut,y:qe+ro,vertical:oo,scale:vr,localGlyph:$r.localGlyph,fontStack:Ki.fontStack,sectionIndex:Jn,metrics:$r,rect:yo}),ut+=$r.advance*vr+He)}Bi.length!==0&&(kt=Math.max(ut-He,kt),Ke?jC(Bi,Ct,di,Xi,we*ii/2):jC(Bi,Ct,di,0,we/2)),ut=0;let tn=we*ii+di;ai.lineOffset=Math.max(di,Ci),qe+=tn,++ei}var jt;let At=qe,{horizontalAlign:Qe,verticalAlign:Yt}=Jy(ze);(function(wi,ii,Ci,ai,Bi,di){let Dn=(ii-Ci)*Bi,Xi=-di*ai;for(let tn of wi)for(let un of tn.positionedGlyphs)un.x+=Dn,un.y+=Xi})(oe.positionedLines,Ct,Qe,Yt,kt,At),oe.top+=-Yt*At,oe.bottom=oe.top+At,oe.left+=-Qe*kt,oe.right=oe.left+kt,oe.hasBaseline=Ke}(se,e,i,o,V,p,_,y,E,v,S,O),!function(oe){for(let de of oe)if(de.positionedGlyphs.length!==0)return!1;return!0}(K)&&se}let l_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},vk={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function zC(t,e,i,o,s,d){if(e.imageName){let p=o[e.imageName];return p?p.displaySize[0]*e.scale*Mo/d+s:0}{let p=i[e.fontStack],_=p&&p.glyphs[t];return _?_.metrics.advance*e.scale+s:0}}function NC(t,e,i,o){let s=Math.pow(t-e,2);return o?t<e?s/2:2*s:s+Math.abs(i)*i}function xk(t,e,i){let o=0;return t===10&&(o-=1e4),i&&(o+=150),t!==40&&t!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function BC(t,e,i,o,s,d){let p=null,_=NC(e,i,s,d);for(let y of o){let v=NC(e-y.x,i,s,d)+y.badness;v<=_&&(p=y,_=v)}return{index:t,x:e,priorBreak:p,badness:_}}function VC(t){return t?VC(t.priorBreak).concat(t.index):[]}function Jy(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function jC(t,e,i,o,s){if(!(e||i||o||s))return;let d=t.length-1,p=t[d],_=(p.x+p.metrics.advance*p.scale)*e;for(let y=0;y<=d;y++)t[y].x-=_,t[y].y+=i+o+s}function wk(t,e,i,o){let{horizontalAlign:s,verticalAlign:d}=Jy(o),p=i[0]-t.displaySize[0]*s,_=i[1]-t.displaySize[1]*d;return{imagePrimary:t,imageSecondary:e,top:_,bottom:_+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function UC(t,e,i,o,s,d){let p=t.imagePrimary,_;if(p.content){let V=p.content,U=p.pixelRatio||1;_=[V[0]/U,V[1]/U,p.displaySize[0]-V[2]/U,p.displaySize[1]-V[3]/U]}let y=e.left*d,v=e.right*d,C,E,S,R;i==="width"||i==="both"?(R=s[0]+y-o[3],E=s[0]+v+o[1]):(R=s[0]+(y+v-p.displaySize[0])/2,E=R+p.displaySize[0]);let O=e.top*d,F=e.bottom*d;return i==="height"||i==="both"?(C=s[1]+O-o[0],S=s[1]+F+o[2]):(C=s[1]+(O+F-p.displaySize[1])/2,S=C+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:C,right:E,bottom:S,left:R,collisionPadding:_}}class Dc extends dt{constructor(e,i,o,s,d){super(e,i),this.angle=s,this.z=o,d!==void 0&&(this.segment=d)}clone(){return new Dc(this.x,this.y,this.z,this.angle,this.segment)}}function GC(t,e,i,o,s){if(e.segment===void 0)return!0;let d=e,p=e.segment+1,_=0;for(;_>-i/2;){if(p--,p<0)return!1;_-=t[p].dist(d),d=t[p]}_+=t[p].dist(t[p+1]),p++;let y=[],v=0;for(;_<i/2;){let C=t[p],E=t[p+1];if(!E)return!1;let S=t[p-1].angleTo(C)-C.angleTo(E);for(S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:_,angleDelta:S}),v+=S;_-y[0].distance>o;)v-=y.shift().angleDelta;if(v>s)return!1;p++,_+=C.dist(E)}return!0}function HC(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function $C(t,e,i){return t?.6*e*i:0}function qC(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Ck(t,e,i,o,s,d){let p=$C(i,s,d),_=qC(i,o)*d,y=0,v=HC(t)/2;for(let C=0;C<t.length-1;C++){let E=t[C],S=t[C+1],R=E.dist(S);if(y+R>v){let O=(v-y)/R,F=Ai(E.x,S.x,O),V=Ai(E.y,S.y,O),U=new Dc(F,V,0,S.angleTo(E),C);return!p||GC(t,U,_,p,e)?U:void 0}y+=R}}function Tk(t,e,i,o,s,d,p,_,y){let v=$C(o,d,p),C=qC(o,s),E=C*p,S=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-E<e/4&&(e=E+e/4),WC(t,S?e/2*_%e:(C/2+2*d)*p*_%e,e,v,i,E,S,!1,y)}function WC(t,e,i,o,s,d,p,_,y){let v=d/2,C=HC(t),E=0,S=e-i,R=[];for(let O=0;O<t.length-1;O++){let F=t[O],V=t[O+1],U=F.dist(V),Z=V.angleTo(F);for(;S+i<E+U;){S+=i;let Q=(S-E)/U,K=Ai(F.x,V.x,Q),se=Ai(F.y,V.y,Q);if(K>=0&&K<y&&se>=0&&se<y&&S-v>=0&&S+v<=C){let oe=new Dc(K,se,0,Z,O);o&&!GC(t,oe,d,o,s)||R.push(oe)}}E+=U}return _||R.length||p||(R=WC(t,E/2,i,o,s,d,p,!0,y)),R}function ZC(t,e,i,o,s){let d=[];for(let p=0;p<t.length;p++){let _=t[p],y;for(let v=0;v<_.length-1;v++){let C=_[v],E=_[v+1];C.x<e&&E.x<e||(C.x<e?C=new dt(e,C.y+(e-C.x)/(E.x-C.x)*(E.y-C.y))._round():E.x<e&&(E=new dt(e,C.y+(e-C.x)/(E.x-C.x)*(E.y-C.y))._round()),C.y<i&&E.y<i||(C.y<i?C=new dt(C.x+(i-C.y)/(E.y-C.y)*(E.x-C.x),i)._round():E.y<i&&(E=new dt(C.x+(i-C.y)/(E.y-C.y)*(E.x-C.x),i)._round()),C.x>=o&&E.x>=o||(C.x>=o?C=new dt(o,C.y+(o-C.x)/(E.x-C.x)*(E.y-C.y))._round():E.x>=o&&(E=new dt(o,C.y+(o-C.x)/(E.x-C.x)*(E.y-C.y))._round()),C.y>=s&&E.y>=s||(C.y>=s?C=new dt(C.x+(s-C.y)/(E.y-C.y)*(E.x-C.x),s)._round():E.y>=s&&(E=new dt(C.x+(s-C.y)/(E.y-C.y)*(E.x-C.x),s)._round()),y&&C.equals(y[y.length-1])||(y=[C],d.push(y)),y.push(E)))))}}return d}function YC(t){let e=0,i=0;for(let p of t)e+=p.w*p.h,i=Math.max(i,p.w);t.sort((p,_)=>_.h-p.h);let o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}],s=0,d=0;for(let p of t)for(let _=o.length-1;_>=0;_--){let y=o[_];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,d=Math.max(d,p.y+p.h),s=Math.max(s,p.x+p.w),p.w===y.w&&p.h===y.h){let v=o.pop();_<o.length&&(o[_]=v)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(o.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:s,h:d,fill:e/(s*d)||0}}Et(Dc,"Anchor");let Fa=1;class e0{constructor(e,{pixelRatio:i,version:o,stretchX:s,stretchY:d,content:p}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=s,this.stretchY=d,this.content=p,this.version=o}get tl(){return[this.paddedRect.x+Fa,this.paddedRect.y+Fa]}get br(){return[this.paddedRect.x+this.paddedRect.w-Fa,this.paddedRect.y+this.paddedRect.h-Fa]}get displaySize(){return[(this.paddedRect.w-2*Fa)/this.pixelRatio,(this.paddedRect.h-2*Fa)/this.pixelRatio]}}class XC{constructor(e,i){let o={},s={};this.haveRenderCallbacks=[];let d=[];this.addImages(e,o,d),this.addImages(i,s,d);let{w:p,h:_}=YC(d),y=new es({width:p||1,height:_||1});for(let v in e){let C=e[v],E=o[v].paddedRect;es.copy(C.data,y,{x:0,y:0},{x:E.x+Fa,y:E.y+Fa},C.data,C.sdf)}for(let v in i){let C=i[v],E=s[v].paddedRect,S=E.x+Fa,R=E.y+Fa,O=C.data.width,F=C.data.height;es.copy(C.data,y,{x:0,y:0},{x:S,y:R},C.data),es.copy(C.data,y,{x:0,y:F-1},{x:S,y:R-1},{width:O,height:1}),es.copy(C.data,y,{x:0,y:0},{x:S,y:R+F},{width:O,height:1}),es.copy(C.data,y,{x:O-1,y:0},{x:S-1,y:R},{width:1,height:F}),es.copy(C.data,y,{x:0,y:0},{x:S+O,y:R},{width:1,height:F})}this.image=y,this.iconPositions=o,this.patternPositions=s}addImages(e,i,o){for(let s in e){let d=e[s],p={x:0,y:0,w:d.data.width+2*Fa,h:d.data.height+2*Fa};o.push(p),i[s]=new e0(p,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(s)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(let s in e.getUpdatedImages(o))this.patchUpdatedImage(this.iconPositions[s],e.getImage(s,o),i),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s,o),i)}patchUpdatedImage(e,i,o){if(!e||!i||e.version===i.version)return;e.version=i.version;let[s,d]=e.tl,p=!!Object.keys(this.patternPositions).length;o.update(i.data,{useMipmap:p},{x:s,y:d})}}Et(e0,"ImagePosition"),Et(XC,"ImageAtlas");let Om=1e20;function KC(t,e,i,o,s,d,p,_,y){for(let v=e;v<e+o;v++)QC(t,i*d+v,d,s,p,_,y);for(let v=i;v<i+s;v++)QC(t,v*d+e,1,o,p,_,y)}function QC(t,e,i,o,s,d,p){d[0]=0,p[0]=-Om,p[1]=Om,s[0]=t[e];for(let _=1,y=0,v=0;_<o;_++){s[_]=t[e+_*i];let C=_*_;do{let E=d[y];v=(s[_]-s[E]+C-E*E)/(_-E)/2}while(v<=p[y]&&--y>-1);y++,d[y]=_,p[y]=v,p[y+1]=Om}for(let _=0,y=0;_<o;_++){for(;p[y+1]<_;)y++;let v=d[y],C=_-v;t[e+_*i]=s[v]+C*C}}let dl=2,t0={none:0,ideographs:1,all:2};class Fh{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,o){let s=[],d=this.urls[i]||ie.GLYPHS_URL;for(let p in e)for(let _ of e[p])s.push({stack:p,id:_});Yo(s,({stack:p,id:_},y)=>{let v=this.entries[p];v||(v=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=v.glyphs[_];if(C!==void 0)return void y(null,{stack:p,id:_,glyph:C});if(C=this._tinySDF(v,p,_),C)return v.glyphs[_]=C,void y(null,{stack:p,id:_,glyph:C});let E=Math.floor(_/256);if(256*E>65535)return void y(new Error("glyphs > 65535 not supported"));if(v.ranges[E])return void y(null,{stack:p,id:_,glyph:C});let S=v.requests[E];S||(S=v.requests[E]=[],Fh.loadGlyphRange(p,E,d,this.requestManager,(R,O)=>{if(O){v.ascender=O.ascender,v.descender=O.descender;for(let F in O.glyphs)this._doesCharSupportLocalGlyph(+F)||(v.glyphs[+F]=O.glyphs[+F]);v.ranges[E]=!0}for(let F of S)F(R,O);delete v.requests[E]})),S.push((R,O)=>{R?y(R):O&&y(null,{stack:p,id:_,glyph:O.glyphs[_]||null})})},(p,_)=>{if(p)o(p);else if(_){let y={};for(let{stack:v,id:C,glyph:E}of _)y[v]===void 0&&(y[v]={}),y[v].glyphs===void 0&&(y[v].glyphs={}),y[v].glyphs[C]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},y[v].ascender=this.entries[v].ascender,y[v].descender=this.entries[v].descender;o(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==t0.none&&(this.localGlyphMode===t0.all?!!this.localFontFamily:!!this.localFontFamily&&(Ot["CJK Unified Ideographs"](e)||Ot["Hangul Syllables"](e)||Ot.Hiragana(e)||Ot.Katakana(e)||Ot["CJK Symbols and Punctuation"](e)||Ot["CJK Unified Ideographs Extension A"](e)||Ot["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,o){let s=this.localFontFamily;if(!s||!this._doesCharSupportLocalGlyph(o))return;let d=e.tinySDF;if(!d){let F="400";/bold/i.test(i)?F="900":/medium/i.test(i)?F="500":/light/i.test(i)&&(F="200"),d=e.tinySDF=new Fh.TinySDF({fontFamily:s,fontWeight:F,fontSize:24*dl,buffer:3*dl,radius:8*dl}),d.fontWeight=F}if(this.localGlyphs[d.fontWeight][o])return this.localGlyphs[d.fontWeight][o];let p=String.fromCodePoint(o),{data:_,width:y,height:v,glyphWidth:C,glyphHeight:E,glyphLeft:S,glyphTop:R,glyphAdvance:O}=d.draw(p);return this.localGlyphs[d.fontWeight][o]={id:o,bitmap:new od({width:y,height:v},_),metrics:{width:C/dl,height:E/dl,left:S/dl,top:R/dl-27,advance:O/dl,localGlyph:!0}}}}Fh.loadGlyphRange=function(t,e,i,o,s){let d=256*e,p=d+255,_=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${d}-${p}`),to.Glyphs);Le(_,(y,v)=>{if(y)s(y);else if(v){let C={},E=function(S){return new Ph(S).readFields(_k,{})}(v);for(let S of E.glyphs)C[S.id]=S;s(null,{glyphs:C,ascender:E.ascender,descender:E.descender})}})},Fh.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:s="sans-serif",fontWeight:d="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=o,this.radius=i;let _=this.size=t+4*e,y=this._createCanvas(_),v=this.ctx=y.getContext("2d",{willReadFrequently:!0});v.font=`${p} ${d} ${t}px ${s}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(_*_),this.gridInner=new Float64Array(_*_),this.f=new Float64Array(_),this.z=new Float64Array(_+1),this.v=new Uint16Array(_)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:s,actualBoundingBoxRight:d}=this.ctx.measureText(t),p=Math.ceil(i),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-s))),y=Math.min(this.size-this.buffer,p+Math.ceil(o)),v=_+2*this.buffer,C=y+2*this.buffer,E=Math.max(v*C,0),S=new Uint8ClampedArray(E),R={data:S,width:v,height:C,glyphWidth:_,glyphHeight:y,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(_===0||y===0)return R;let{ctx:O,buffer:F,gridInner:V,gridOuter:U}=this;O.clearRect(F,F,_,y),O.fillText(t,F,F+p);let Z=O.getImageData(F,F,_,y);U.fill(Om,0,E),V.fill(0,0,E);for(let Q=0;Q<y;Q++)for(let K=0;K<_;K++){let se=Z.data[4*(Q*_+K)+3]/255;if(se===0)continue;let oe=(Q+F)*v+K+F;if(se===1)U[oe]=0,V[oe]=Om;else{let de=.5-se;U[oe]=de>0?de*de:0,V[oe]=de<0?de*de:0}}KC(U,0,0,v,C,v,this.f,this.v,this.z),KC(V,F,F,_,y,v,this.f,this.v,this.z);for(let Q=0;Q<E;Q++){let K=Math.sqrt(U[Q])-Math.sqrt(V[Q]);S[Q]=Math.round(255-255*(K/this.radius+this.cutoff))}return R}};let ld=Fa;function JC(t,e,i,o){let s=[],d=t.imagePrimary,p=d.pixelRatio,_=d.paddedRect.w-2*ld,y=d.paddedRect.h-2*ld,v=t.right-t.left,C=t.bottom-t.top,E=d.stretchX||[[0,_]],S=d.stretchY||[[0,y]],R=(we,ze)=>we+ze[1]-ze[0],O=E.reduce(R,0),F=S.reduce(R,0),V=_-O,U=y-F,Z=0,Q=O,K=0,se=F,oe=0,de=V,_e=0,xe=U;if(d.content&&o){let we=d.content;Z=c_(E,0,we[0]),K=c_(S,0,we[1]),Q=c_(E,we[0],we[2]),se=c_(S,we[1],we[3]),oe=we[0]-Z,_e=we[1]-K,de=we[2]-we[0]-Q,xe=we[3]-we[1]-se}let Se=(we,ze,$e,Pe)=>{let He=d_(we.stretch-Z,Q,v,t.left),De=u_(we.fixed-oe,de,we.stretch,O),je=d_(ze.stretch-K,se,C,t.top),ut=u_(ze.fixed-_e,xe,ze.stretch,F),qe=d_($e.stretch-Z,Q,v,t.left),kt=u_($e.fixed-oe,de,$e.stretch,O),Ct=d_(Pe.stretch-K,se,C,t.top),Ke=u_(Pe.fixed-_e,xe,Pe.stretch,F),ei=new dt(He,je),jt=new dt(qe,je),At=new dt(qe,Ct),Qe=new dt(He,Ct),Yt=new dt(De/p,ut/p),wi=new dt(kt/p,Ke/p),ii=e*Math.PI/180;if(ii){let Xi=Math.sin(ii),tn=Math.cos(ii),un=[tn,-Xi,Xi,tn];ei._matMult(un),jt._matMult(un),Qe._matMult(un),At._matMult(un)}let Ci=we.stretch+we.fixed,ai=$e.stretch+$e.fixed,Bi=ze.stretch+ze.fixed,di=Pe.stretch+Pe.fixed,Dn=t.imageSecondary;return{tl:ei,tr:jt,bl:Qe,br:At,texPrimary:{x:d.paddedRect.x+ld+Ci,y:d.paddedRect.y+ld+Bi,w:ai-Ci,h:di-Bi},texSecondary:Dn?{x:Dn.paddedRect.x+ld+Ci,y:Dn.paddedRect.y+ld+Bi,w:ai-Ci,h:di-Bi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yt,pixelOffsetBR:wi,minFontScaleX:de/p/v,minFontScaleY:xe/p/C,isSDF:i}};if(o&&(d.stretchX||d.stretchY)){let we=eT(E,V,O),ze=eT(S,U,F);for(let $e=0;$e<we.length-1;$e++){let Pe=we[$e],He=we[$e+1];for(let De=0;De<ze.length-1;De++)s.push(Se(Pe,ze[De],He,ze[De+1]))}}else s.push(Se({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:y+1}));return s}function c_(t,e,i){let o=0;for(let s of t)o+=Math.max(e,Math.min(i,s[1]))-Math.max(e,Math.min(i,s[0]));return o}function eT(t,e,i){let o=[{fixed:-ld,stretch:0}];for(let[s,d]of t){let p=o[o.length-1];o.push({fixed:s-p.stretch,stretch:p.stretch}),o.push({fixed:s-p.stretch,stretch:p.stretch+(d-s)})}return o.push({fixed:e+ld,stretch:i}),o}function d_(t,e,i,o){return t/e*i+o}function u_(t,e,i,o){return t-e*i/o}function Ek(t,e,i,o){let s=e+t.positionedLines[o].lineOffset;return o===0?i+s/2:i+(s+(e+t.positionedLines[o-1].lineOffset))/2}function Ik(t,e=1,i=!1){let o=1/0,s=1/0,d=-1/0,p=-1/0,_=t[0];for(let R=0;R<_.length;R++){let O=_[R];(!R||O.x<o)&&(o=O.x),(!R||O.y<s)&&(s=O.y),(!R||O.x>d)&&(d=O.x),(!R||O.y>p)&&(p=O.y)}let y=Math.min(d-o,p-s),v=y/2,C=new Ro([],Sk);if(y===0)return new dt(o,s);for(let R=o;R<d;R+=y)for(let O=s;O<p;O+=y)C.push(new Lh(R+v,O+v,v,t));let E=function(R){let O=0,F=0,V=0,U=R[0];for(let Z=0,Q=U.length,K=Q-1;Z<Q;K=Z++){let se=U[Z],oe=U[K],de=se.x*oe.y-oe.x*se.y;F+=(se.x+oe.x)*de,V+=(se.y+oe.y)*de,O+=3*de}return new Lh(F/O,V/O,0,R)}(t),S=C.length;for(;C.length;){let R=C.pop();(R.d>E.d||!E.d)&&(E=R,i&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,S)),R.max-E.d<=e||(v=R.h/2,C.push(new Lh(R.p.x-v,R.p.y-v,v,t)),C.push(new Lh(R.p.x+v,R.p.y-v,v,t)),C.push(new Lh(R.p.x-v,R.p.y+v,v,t)),C.push(new Lh(R.p.x+v,R.p.y+v,v,t)),S+=4)}return i&&(console.log(`num probes: ${S}`),console.log(`best distance: ${E.d}`)),E.p}function Sk(t,e){return e.max-t.max}class Lh{constructor(e,i,o,s){this.p=new dt(e,i),this.h=o,this.d=function(d,p){let _=!1,y=1/0;for(let v=0;v<p.length;v++){let C=p[v];for(let E=0,S=C.length,R=S-1;E<S;R=E++){let O=C[E],F=C[R];O.y>d.y!=F.y>d.y&&d.x<(F.x-O.x)*(d.y-O.y)/(F.y-O.y)+O.x&&(_=!_),y=Math.min(y,id(d,O,F))}}return(_?1:-1)*Math.sqrt(y)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}}let i0=Number.POSITIVE_INFINITY,Mk=Math.sqrt(2);function tT(t,[e,i]){let o=0,s=0;if(i===i0){e<0&&(e=0);let d=e/Mk;switch(t){case"top-right":case"top-left":s=d-7;break;case"bottom-right":case"bottom-left":s=7-d;break;case"bottom":s=7-e;break;case"top":s=e-7}switch(t){case"top-right":case"bottom-right":o=-d;break;case"top-left":case"bottom-left":o=d;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":s=i-7;break;case"bottom-right":case"bottom-left":case"bottom":s=7-i}switch(t){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,s]}function n0(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ak(t,e,i,o,s,d,p,_,y,v,C,E,S,R,O){let F=d.textMaxSize.evaluate(e,{},E);F===void 0&&(F=p);let V=t.layers[0].layout,U=V.get("icon-offset").evaluate(e,{},E),Z=nT(i.horizontal)||i.vertical,Q=S.name==="globe",K=Mo,se=p/K,oe=t.tilePixelRatio*F/K,de=(He=t.overscaling,t.zoom>18&&He>2&&(He>>=1),Math.max(mt/(512*He),1)*V.get("symbol-spacing")),_e=V.get("text-padding")*t.tilePixelRatio,xe=V.get("icon-padding")*t.tilePixelRatio,Se=Fi(V.get("text-max-angle")),we=V.get("text-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",ze=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",$e=V.get("symbol-placement"),Pe=de/2;var He;let De=V.get("icon-text-fit").evaluate(e,{},E),je=V.get("icon-text-fit-padding").evaluate(e,{},E),ut=De!=="none",qe;t.hasAnyIconTextFit===!1&&ut&&(t.hasAnyIconTextFit=!0),o&&ut&&(t.allowVerticalPlacement&&i.vertical&&(qe=UC(o,i.vertical,De,je,U,se)),Z&&(o=UC(o,Z,De,je,U,se)));let kt=(Ct,Ke,ei)=>{if(Ke.x<0||Ke.x>=mt||Ke.y<0||Ke.y>=mt)return;let jt=null;if(Q){let{x:At,y:Qe,z:Yt}=S.projectTilePoint(Ke.x,Ke.y,ei);jt={anchor:new Dc(At,Qe,Yt,0,void 0),up:S.upVector(ei,Ke.x,Ke.y)}}(function(At,Qe,Yt,wi,ii,Ci,ai,Bi,di,Dn,Xi,tn,un,Ki,Jn,Cn,vr,$r,yo,Yn,sr,ro,oo,ao,Un,La,md){let da=At.addToLineVertexArray(Qe,wi),Go,ns,Xm,R_,nE,rE,oE,aE=0,sE=0,lE=0,cE=0,M0=-1,A0=-1,Kl={},dE=vm(""),vu=Yt?Yt.anchor:Qe,D0=di.layout.get("icon-text-fit").evaluate(sr,{},Un)!=="none",k0=0,R0=0;if(di._unevaluatedLayout.getValue("text-radial-offset")===void 0?[k0,R0]=di.layout.get("text-offset").evaluate(sr,{},Un).map(za=>za*Mo):(k0=di.layout.get("text-radial-offset").evaluate(sr,{},Un)*Mo,R0=i0),At.allowVerticalPlacement&&ii.vertical){let za=ii.vertical;if(Jn)rE=r0(za),Bi&&(oE=r0(Bi));else{let Na=di.layout.get("text-rotate").evaluate(sr,{},Un)+90;Xm=h_(Dn,vu,Qe,Xi,tn,un,za,Ki,Na,Cn),Bi&&(R_=h_(Dn,vu,Qe,Xi,tn,un,Bi,$r,Na))}}if(Ci){let za=di.layout.get("icon-rotate").evaluate(sr,{},Un),Na=JC(Ci,za,oo,D0),Gh=Bi?JC(Bi,za,oo,D0):void 0;ns=h_(Dn,vu,Qe,Xi,tn,un,Ci,$r,za),aE=4*Na.length;let uE=At.iconSizeData,xu=null;uE.kind==="source"?(xu=[cl*di.layout.get("icon-size").evaluate(sr,{},Un)],xu[0]>cd&&er(`${At.layerIds[0]}: Value for "icon-size" is >= ${Fm}. Reduce your "icon-size".`)):uE.kind==="composite"&&(xu=[cl*ro.compositeIconSizes[0].evaluate(sr,{},Un),cl*ro.compositeIconSizes[1].evaluate(sr,{},Un)],(xu[0]>cd||xu[1]>cd)&&er(`${At.layerIds[0]}: Value for "icon-size" is >= ${Fm}. Reduce your "icon-size".`)),At.addSymbols(At.icon,Na,xu,Yn,yo,sr,!1,Yt,Qe,da.lineStartIndex,da.lineLength,-1,ao,Un,La,md),M0=At.icon.placedSymbolArray.length-1,Gh&&(sE=4*Gh.length,At.addSymbols(At.icon,Gh,xu,Yn,yo,sr,ts.vertical,Yt,Qe,da.lineStartIndex,da.lineLength,-1,ao,Un,La,md),A0=At.icon.placedSymbolArray.length-1)}for(let za in ii.horizontal){let Na=ii.horizontal[za];Go||(dE=vm(Na.text),Jn?nE=r0(Na):Go=h_(Dn,vu,Qe,Xi,tn,un,Na,Ki,di.layout.get("text-rotate").evaluate(sr,{},Un),Cn));let Gh=Na.positionedLines.length===1;if(lE+=iT(At,Yt,Qe,Na,ai,di,Jn,sr,Cn,da,ii.vertical?ts.horizontal:ts.horizontalOnly,Gh?Object.keys(ii.horizontal):[za],Kl,M0,ro,ao,Un,La),Gh)break}ii.vertical&&(cE+=iT(At,Yt,Qe,ii.vertical,ai,di,Jn,sr,Cn,da,ts.vertical,["vertical"],Kl,A0,ro,ao,Un,La));let fd=-1,P0=(za,Na)=>za?Math.max(za,Na):Na;fd=P0(nE,fd),fd=P0(rE,fd),fd=P0(oE,fd);let W2=fd>-1?1:0;At.glyphOffsetArray.length>=65535&&er("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),sr.sortKey!==void 0&&At.addToSortKeyRanges(At.symbolInstances.length,sr.sortKey),At.symbolInstances.emplaceBack(Qe.x,Qe.y,vu.x,vu.y,vu.z,Kl.right>=0?Kl.right:-1,Kl.center>=0?Kl.center:-1,Kl.left>=0?Kl.left:-1,Kl.vertical>=0?Kl.vertical:-1,M0,A0,dE,Go!==void 0?Go:At.collisionBoxArray.length,Go!==void 0?Go+1:At.collisionBoxArray.length,Xm!==void 0?Xm:At.collisionBoxArray.length,Xm!==void 0?Xm+1:At.collisionBoxArray.length,ns!==void 0?ns:At.collisionBoxArray.length,ns!==void 0?ns+1:At.collisionBoxArray.length,R_||At.collisionBoxArray.length,R_?R_+1:At.collisionBoxArray.length,Xi,lE,cE,aE,sE,W2,0,k0,R0,fd,0,D0?1:0)})(t,Ke,jt,Ct,i,o,s,qe,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,_e,we,y,0,xe,ze,U,e,d,v,C,E,R,O)};if($e==="line")for(let Ct of ZC(e.geometry,0,0,mt,mt)){let Ke=Tk(Ct,de,Se,i.vertical||Z,o,K,oe,t.overscaling,mt);for(let ei of Ke)Z&&Dk(t,Z.text,Pe,ei)||kt(Ct,ei,E)}else if($e==="line-center"){for(let Ct of e.geometry)if(Ct.length>1){let Ke=Ck(Ct,Se,i.vertical||Z,o,K,oe);Ke&&kt(Ct,Ke,E)}}else if(e.type==="Polygon")for(let Ct of Uy(e.geometry,0)){let Ke=Ik(Ct,16);kt(Ct[0],new Dc(Ke.x,Ke.y,0,0,void 0),E)}else if(e.type==="LineString")for(let Ct of e.geometry)kt(Ct,new Dc(Ct[0].x,Ct[0].y,0,0,void 0),E);else if(e.type==="Point")for(let Ct of e.geometry)for(let Ke of Ct)kt([Ke],new Dc(Ke.x,Ke.y,0,0,void 0),E)}let Fm=255,cd=Fm*cl;function iT(t,e,i,o,s,d,p,_,y,v,C,E,S,R,O,F,V,U){let Z=function(se,oe,de,_e,xe,Se,we,ze){let $e=[];if(oe.positionedLines.length===0)return $e;let Pe=_e.layout.get("text-rotate").evaluate(Se,{})*Math.PI/180,He=function(kt){let Ct=kt[0],Ke=kt[1],ei=Ct*Ke;return ei>0?[Ct,-Ke]:ei<0?[-Ct,Ke]:Ct===0?[Ke,Ct]:[Ke,-Ct]}(de),De=Math.abs(oe.top-oe.bottom);for(let kt of oe.positionedLines)De-=kt.lineOffset;let je=oe.positionedLines.length,ut=De/je,qe=oe.top-de[1];for(let kt=0;kt<je;++kt){let Ct=oe.positionedLines[kt];qe=Ek(oe,ut,qe,kt);for(let Ke of Ct.positionedGlyphs){if(!Ke.rect)continue;let ei=Ke.rect||{},jt=LC+1,At=!0,Qe=1,Yt=0;if(Ke.imageName){let Yn=we[Ke.imageName];if(!Yn)continue;if(Yn.sdf){er("SDF images are not supported in formatted text and will be ignored.");continue}At=!1,Qe=Yn.pixelRatio,jt=Fa/Qe}let wi=(xe||ze)&&Ke.vertical,ii=Ke.metrics.advance*Ke.scale/2,Ci=Ke.metrics,ai=Ke.rect;if(ai===null)continue;ze&&oe.verticalizable&&(Yt=Ke.imageName?ii-Ke.metrics.width*Ke.scale/2:0);let Bi=xe?[Ke.x+ii,Ke.y]:[0,0],di=[0,0],Dn=[0,0],Xi=!1;xe||(wi?(Dn=[Ke.x+ii+He[0],Ke.y+He[1]-Yt],Xi=!0):di=[Ke.x+ii+de[0],Ke.y+de[1]-Yt]);let tn=ai.w*Ke.scale/(Qe*(Ke.localGlyph?dl:1)),un=ai.h*Ke.scale/(Qe*(Ke.localGlyph?dl:1)),Ki,Jn,Cn,vr;if(wi){let Yn=Ke.y-qe,sr=new dt(-ii,ii-Yn),ro=-Math.PI/2,oo=new dt(...Dn);Ki=new dt(-ii+di[0],di[1]),Ki._rotateAround(ro,sr)._add(oo),Ki.x+=-Yn+ii,Ki.y-=(Ci.left-jt)*Ke.scale;let ao=Ke.imageName?Ci.advance*Ke.scale:Mo*Ke.scale,Un=String.fromCodePoint(Ke.glyph);ok(Un)?Ki.x+=(1-jt)*Ke.scale:ak(Un)?Ki.x+=ao-Ci.height*Ke.scale+(-jt-1)*Ke.scale:Ki.x+=Ke.imageName||Ci.width+2*jt===ai.w&&Ci.height+2*jt===ai.h?(ao-un)/2:(ao-(Ci.height+2*jt)*Ke.scale)/2,Jn=new dt(Ki.x,Ki.y-tn),Cn=new dt(Ki.x+un,Ki.y),vr=new dt(Ki.x+un,Ki.y-tn)}else{let Yn=(Ci.left-jt)*Ke.scale-ii+di[0],sr=(-Ci.top-jt)*Ke.scale+di[1],ro=Yn+tn,oo=sr+un;Ki=new dt(Yn,sr),Jn=new dt(ro,sr),Cn=new dt(Yn,oo),vr=new dt(ro,oo)}if(Pe){let Yn;Yn=xe?new dt(0,0):Xi?new dt(He[0],He[1]):new dt(de[0],de[1]),Ki._rotateAround(Pe,Yn),Jn._rotateAround(Pe,Yn),Cn._rotateAround(Pe,Yn),vr._rotateAround(Pe,Yn)}let $r=new dt(0,0),yo=new dt(0,0);$e.push({tl:Ki,tr:Jn,bl:Cn,br:vr,texPrimary:ei,texSecondary:void 0,writingMode:oe.writingMode,glyphOffset:Bi,sectionIndex:Ke.sectionIndex,isSDF:At,pixelOffsetTL:$r,pixelOffsetBR:yo,minFontScaleX:0,minFontScaleY:0})}}return $e}(0,o,y,d,p,_,s,t.allowVerticalPlacement),Q=t.textSizeData,K=null;Q.kind==="source"?(K=[cl*d.layout.get("text-size").evaluate(_,{},V)],K[0]>cd&&er(`${t.layerIds[0]}: Value for "text-size" is >= ${Fm}. Reduce your "text-size".`)):Q.kind==="composite"&&(K=[cl*O.compositeTextSizes[0].evaluate(_,{},V),cl*O.compositeTextSizes[1].evaluate(_,{},V)],(K[0]>cd||K[1]>cd)&&er(`${t.layerIds[0]}: Value for "text-size" is >= ${Fm}. Reduce your "text-size".`)),t.addSymbols(t.text,Z,K,y,p,_,C,e,i,v.lineStartIndex,v.lineLength,R,F,V,U,!1);for(let se of E)S[se]=t.text.placedSymbolArray.length-1;return 4*Z.length}function nT(t){for(let e in t)return t[e];return null}function h_(t,e,i,o,s,d,p,_,y,v){let C=p.top,E=p.bottom,S=p.left,R=p.right,O=p.collisionPadding;if(O&&(S-=O[0],C-=O[1],R+=O[2],E+=O[3]),y){let F=new dt(S,C),V=new dt(R,C),U=new dt(S,E),Z=new dt(R,E),Q=Fi(y),K=new dt(0,0);v&&(K=new dt(v[0],v[1])),F._rotateAround(Q,K),V._rotateAround(Q,K),U._rotateAround(Q,K),Z._rotateAround(Q,K),S=Math.min(F.x,V.x,U.x,Z.x),R=Math.max(F.x,V.x,U.x,Z.x),C=Math.min(F.y,V.y,U.y,Z.y),E=Math.max(F.y,V.y,U.y,Z.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,S,C,R,E,_,o,s,d),t.length-1}function r0(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Dk(t,e,i,o){let s=t.compareText;if(e in s){let d=s[e];for(let p=d.length-1;p>=0;p--)if(o.dist(d[p])<i)return!0}else s[e]=[];return s[e].push(o),!1}function rT(t,e){let i=t.fovAboveCenter,o=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,s=(t._camera.position[2]*t.worldSize-o)/Math.cos(t._pitch),d=Math.sin(i)*s/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),p=Math.sin(t._pitch)*d+s;return Math.min(1.01*p,s*(1/t._horizonShift))}function Lm(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let i=Math.pow(2,-t.z),o=t.x*i,s=(t.x+1)*i,d=t.y*i,p=(t.y+1)*i,_=li(o),y=li(s),v=Ui(d),C=Ui(p),E=e.project(_,v),S=e.project(y,v),R=e.project(y,C),O=e.project(_,C),F=Math.min(E.x,S.x,R.x,O.x),V=Math.min(E.y,S.y,R.y,O.y),U=Math.max(E.x,S.x,R.x,O.x),Z=Math.max(E.y,S.y,R.y,O.y),Q=i/16;function K(oe,de,_e,xe,Se,we){let ze=(_e+Se)/2,$e=(xe+we)/2,Pe=e.project(li(ze),Ui($e)),He=Math.max(0,F-Pe.x,V-Pe.y,Pe.x-U,Pe.y-Z);F=Math.min(F,Pe.x),U=Math.max(U,Pe.x),V=Math.min(V,Pe.y),Z=Math.max(Z,Pe.y),He>Q&&(K(oe,Pe,_e,xe,ze,$e),K(Pe,de,ze,$e,Se,we))}K(E,S,o,d,s,d),K(S,R,s,d,s,p),K(R,O,s,p,o,p),K(O,E,o,p,o,d),F-=Q,V-=Q,U+=Q,Z+=Q;let se=1/Math.max(U-F,Z-V);return{scale:se,x:F*se,y:V*se,x2:U*se,y2:Z*se,projection:e}}function oT(t,{x:e,y:i},o=0){return new dt(((e-o)*t.scale-t.x)*mt,(i*t.scale-t.y)*mt)}let kk=r.a6.identity(new Float32Array(16));class dd{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new ve(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o=!0){return e._coordinatePoint(e.locationCoordinate(i),o)}pixelsPerMeter(e,i){return ci(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return rT(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,s){let d=e.horizonLineFromTop(!1),p=new dt(i,Math.max(d,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,s))}pointCoordinate3D(e,i,o){let s=new dt(i,o);if(e.elevation)return e.elevation.pointCoordinate(s);{let d=this.pointCoordinate(e,s.x,s.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);let o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return kk}createTileMatrix(e,i,o){let s,d,p,_=o.canonical,y=r.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let v=Lm(_,this);s=1,d=v.x+o.wrap*v.scale,p=v.y,r.a6.scale(y,y,[s/v.scale,s/v.scale,e.pixelsPerMeter/i])}else s=i/e.zoomScale(_.z),d=(_.x+Math.pow(2,_.z)*o.wrap)*s,p=_.y*s;return r.a6.translate(y,y,[d,p,0]),r.a6.scale(y,y,[s/mt,s/mt,1]),y}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class Rk extends dd{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[i,o]=this.parallels=e.parallels||[29.5,45.5],s=Math.sin(Fi(i));this.n=(s+Math.sin(Fi(o)))/2,this.c=1+s*(2*this.n-s),this.r0=Math.sqrt(this.c)/this.n}project(e,i){let{n:o,c:s,r0:d}=this,p=Fi(e-this.center[0]),_=Fi(i),y=Math.sqrt(s-2*o*Math.sin(_))/o;return{x:y*Math.sin(p*o),y:y*Math.cos(p*o)-d,z:0}}unproject(e,i){let{n:o,c:s,r0:d}=this,p=d+i,_=Math.atan2(e,Math.abs(p))*Math.sign(p);p*o<0&&(_-=Math.PI*Math.sign(e)*Math.sign(p));let y=Fi(this.center[0])*o;_=Ia(_,-Math.PI-y,Math.PI-y);let v=gi(qn(_/o)+this.center[0],-180,180),C=Math.asin(gi((s-(e*e+p*p)*o*o)/(2*o),-1,1)),E=gi(qn(C),-ki,ki);return new ve(v,E)}}let zm=1.340264,Nm=-.081106,Bm=893e-6,Vm=.003796,p_=Math.sqrt(3)/2;class Pk extends dd{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;let o=Math.asin(p_*Math.sin(i)),s=o*o,d=s*s*s;return{x:.5*(e*Math.cos(o)/(p_*(zm+3*Nm*s+d*(7*Bm+9*Vm*s)))/Math.PI+.5),y:1-.5*(o*(zm+Nm*s+d*(Bm+Vm*s))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,s=o*o,d=s*s*s;for(let C,E,S,R=0;R<12&&(E=o*(zm+Nm*s+d*(Bm+Vm*s))-i,S=zm+3*Nm*s+d*(7*Bm+9*Vm*s),C=E/S,o=gi(o-C,-Math.PI/3,Math.PI/3),s=o*o,d=s*s*s,!(Math.abs(C)<1e-12));++R);let p=p_*e*(zm+3*Nm*s+d*(7*Bm+9*Vm*s))/Math.cos(o),_=Math.asin(Math.sin(o)/p_),y=gi(180*p/Math.PI,-180,180),v=gi(180*_/Math.PI,-ki,ki);return new ve(y,v)}}class Ok extends dd{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){let o=360*(e-.5),s=gi(360*(.5-i),-ki,ki);return new ve(o,s)}}let zh=Math.PI/2;function m_(t){return Math.tan((zh+t)/2)}class Fk extends dd{constructor(e){super(e),this.center=e.center||[0,30];let[i,o]=this.parallels=e.parallels||[30,30],s=Fi(i),d=Fi(o);this.southernCenter=s+d<0,this.southernCenter&&(s=-s,d=-d);let p=Math.cos(s),_=m_(s);this.n=s===d?Math.sin(s):Math.log(p/Math.cos(d))/Math.log(m_(d)/_),this.f=p*Math.pow(m_(s),this.n)/this.n}project(e,i){i=Fi(i),this.southernCenter&&(i=-i),e=Fi(e-this.center[0]);let o=1e-6,{n:s,f:d}=this;d>0?i<-zh+o&&(i=-zh+o):i>zh-o&&(i=zh-o);let p=d/Math.pow(m_(i),s),_=p*Math.sin(s*e),y=d-p*Math.cos(s*e);return _=.5*(_/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:_,y:this.southernCenter?y:1-y,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;let{n:o,f:s}=this,d=s-i,p=Math.sign(d),_=Math.sign(o)*Math.sqrt(e*e+d*d),y=Math.atan2(e,Math.abs(d))*p;d*o<0&&(y-=Math.PI*Math.sign(e)*p);let v=gi(qn(y/o)+this.center[0],-180,180),C=gi(qn(2*Math.atan(Math.pow(s/_,1/o))-zh),-ki,ki);return new ve(v,this.southernCenter?-C:C)}}class aT extends dd{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:_i(e),y:ri(i),z:0}}unproject(e,i){let o=li(e),s=Ui(i);return new ve(o,s)}}let sT=Fi(ki);class Lk extends dd{project(e,i){let o=(i=Fi(i))*i,s=o*o;return{x:.5*((e=Fi(e))*(.8707-.131979*o+s*(s*(.003971*o-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+s*(.028874*o-.044475-.005916*s)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,s=25,d=0,p=o*o;do{p=o*o;let v=p*p;d=(o*(1.007226+p*(.015085+v*(.028874*p-.044475-.005916*v)))-i)/(1.007226+p*(.045255+v*(.259866*p-.311325-.005916*11*v))),o=gi(o-d,-sT,sT)}while(Math.abs(d)>1e-6&&--s>0);p=o*o;let _=gi(qn(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),y=qn(o);return new ve(_,y)}}let lT=Fi(ki);class zk extends dd{project(e,i){i=Fi(i),e=Fi(e);let o=Math.cos(i),s=2/Math.PI,d=Math.acos(o*Math.cos(e/2)),p=Math.sin(d)/d,_=.5*(e*s+2*o*Math.sin(e/2)/p)||0,y=.5*(i+Math.sin(i)/p)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,s=i=(2*(1-i)-1)*Math.PI,d=25,p=1e-6,_=0,y=0;do{let v=Math.cos(s),C=Math.sin(s),E=2*C*v,S=C*C,R=v*v,O=Math.cos(o/2),F=Math.sin(o/2),V=2*O*F,U=F*F,Z=1-R*O*O,Q=Z?1/Z:0,K=Z?Math.acos(v*O)*Math.sqrt(1/Z):0,se=.5*(2*K*v*F+2*o/Math.PI)-e,oe=.5*(K*C+s)-i,de=.5*Q*(R*U+K*v*O*S)+1/Math.PI,_e=Q*(V*E/4-K*C*F),xe=.125*Q*(E*F-K*C*R*V),Se=.5*Q*(S*O+K*U*v)+.5,we=_e*xe-Se*de;_=(oe*_e-se*Se)/we,y=(se*xe-oe*de)/we,o=gi(o-_,-Math.PI,Math.PI),s=gi(s-y,-lT,lT)}while((Math.abs(_)>p||Math.abs(y)>p)&&--d>0);return new ve(qn(o),qn(s))}}class cT extends dd{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Fi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){let{scale:o,cosPhi:s}=this;return{x:Fi(e)*s*o+.5,y:-Math.sin(Fi(i))/s*o+.5,z:0}}unproject(e,i){let{scale:o,cosPhi:s}=this,d=-(i-.5)/o,p=gi(qn((e-.5)/o)/s,-180,180),_=Math.asin(gi(d*s,-1,1)),y=gi(qn(_),-ki,ki);return new ve(p,y)}}class Nk extends aT{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){let s=Tm(e,i,o),d=qg(Xl(o));return r.N.transformMat4(s,s,d),{x:s[0],y:s[1],z:s[2]}}locationPoint(e,i){let o=Fe(i.lat,i.lng),s=r.N.normalize([],o),d=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,p=ci(1,0)*mt*d;r.N.scaleAndAdd(o,o,s,p);let _=r.a6.identity(new Float64Array(16));return r.a6.multiply(_,e.pixelMatrix,e.globeMatrix),r.N.transformMat4(o,o,_),new dt(o[0],o[1])}pixelsPerMeter(e,i){return ci(1,0)*i}pixelSpaceConversion(e,i,o){let s=ci(1,e)*i,d=Ai(ci(1,45)*i,s,o);return this.pixelsPerMeter(e,i)/d}createTileMatrix(e,i,o){let s=Oy(Xl(o.canonical));return r.a6.multiply(new Float64Array(16),e.globeMatrix,s)}createInversionMatrix(e,i){let{center:o}=e,s=qg(Xl(i));return r.a6.rotateY(s,s,Fi(o.lng)),r.a6.rotateX(s,s,Fi(o.lat)),r.a6.scale(s,s,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(s)}pointCoordinate(e,i,o,s){return Iw(e,i,o,!0)||new Wi(0,0)}pointCoordinate3D(e,i,o){let s=this.pointCoordinate(e,i,o,0);return[s.x,s.y,s.z]}isPointAboveHorizon(e,i){return!Iw(e,i.x,i.y,!1)}farthestPixelDistance(e){let i=function(s,d){let p=s.cameraToCenterDistance,_=s._centerAltitude*d,y=s._camera,v=s._camera.forward(),C=r.N.add([],r.N.scale([],v,-p),[0,0,_]),E=s.worldSize/(2*Math.PI),S=[0,0,-E],R=s.width/s.height,O=Math.tan(s.fovAboveCenter),F=r.N.scale([],y.up(),O),V=r.N.scale([],y.right(),O*R),U=r.N.normalize([],r.N.add([],r.N.add([],v,F),V)),Z=[],Q;if(new Ay(C,U).closestPointOnSphere(S,E,Z)){let K=r.N.add([],Z,S),se=r.N.sub([],K,C);Q=Math.cos(s.fovAboveCenter)*r.N.length(se)}else{let K=r.N.sub([],C,S),se=r.N.sub([],S,C);r.N.normalize(se,se);let oe=r.N.length(K)-E;Q=Math.sqrt(oe*(oe+2*E));let de=Math.acos(Q/(E+oe))-Math.acos(r.N.dot(v,se));Q*=Math.cos(de)}return 1.01*Q}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=rd(e.zoom);if(o>0){let s=rT(e,ci(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ai(i,s+d*(1-Math.cos(p)),Math.pow(o,10))}return i}upVector(e,i,o){return Tm(i,o,e,1)}upVectorScale(e){return{metersToTile:Gg($g(Xl(e)))}}}function dT(t){let e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new aT(t);case"equirectangular":return new Ok(t);case"naturalEarth":return new Lk(t);case"equalEarth":return new Pk(t);case"winkelTripel":return new zk(t);case"albers":return i?new cT(t):new Rk(t);case"lambertConformalConic":return i?new cT(t):new Fk(t);case"globe":return new Nk(t)}throw new Error(`Invalid projection name: ${t.name}`)}let Bk=Jg.types,Vk=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function f_(t,e,i,o,s,d,p,_,y,v,C,E,S){let R=_?Math.min(cd,Math.round(_[0])):0,O=_?Math.min(cd,Math.round(_[1])):0;t.emplaceBack(e,i,Math.round(32*o),Math.round(32*s),d,p,(R<<1)+(y?1:0),O,16*v,16*C,256*E,256*S)}function g_(t,e,i){t.emplaceBack(e,i)}function __(t,e,i,o,s,d,p){t.emplaceBack(e,i,o,s,d,p)}function b_(t,e,i,o,s){t.emplaceBack(e,i,o,s),t.emplaceBack(e,i,o,s),t.emplaceBack(e,i,o,s),t.emplaceBack(e,i,o,s)}function jk(t){for(let e of t.sections)if(Zp(e.text))return!0;return!1}class o0{constructor(e){this.layoutVertexArray=new tu,this.indexArray=new Kr,this.programConfigurations=e,this.segments=new yr,this.dynamicLayoutVertexArray=new Gl,this.opacityVertexArray=new um,this.placedSymbolArray=new Tg,this.iconTransitioningVertexArray=new ys,this.globeExtVertexArray=new dm,this.zOffsetVertexArray=new nu}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,o,s,d){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,YD.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,KD.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Vk,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,JD.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,XD.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,QD.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||s)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Et(o0,"SymbolBuffers");class a0{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new yr,this.collisionVertexArray=new pm,this.collisionVertexArrayExt=new Gl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ek.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,tk.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Et(a0,"CollisionBuffers");class y_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.a6.identity([]),this.placementViewportMatrix=r.a6.identity([]);let i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Yy(this.zoom,i["text-size"]),this.iconSizeData=Yy(this.zoom,i["icon-size"]);let o=this.layers[0].layout,s=o.get("symbol-sort-key"),d=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&s.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(p=>ts[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=o.get("symbol-z-elevate")}createArrays(){this.text=new o0(new H(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new o0(new H(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Sg,this.lineVertexArray=new su,this.symbolInstances=new Ig}calculateGlyphDependencies(e,i,o,s,d){for(let p=0;p<e.length;p++){let _=e.codePointAt(p);if(_===void 0)break;if(i[_]=!0,s&&d&&_<=65535){let y=Rm[e.charAt(p)];y&&(i[y.charCodeAt(0)]=!0)}}}populate(e,i,o,s){let d=this.layers[0],p=d.layout,_=this.projection.name==="globe",y=p.get("text-font"),v=p.get("text-field"),C=p.get("icon-image"),E=(v.value.kind!=="constant"||v.value.value instanceof _n&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),S=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,R=p.get("symbol-sort-key");if(this.features=[],!E&&!S)return;let O=i.iconDependencies,F=i.glyphDependencies,V=i.availableImages,U=new nr(this.zoom);for(let{feature:Z,id:Q,index:K,sourceLayerIndex:se}of e){let oe=d._featureFilter.needGeometry,de=Vr(Z,oe);if(!d._featureFilter.filter(U,de,o))continue;if(oe||(de.geometry=Jr(Z,o,s)),_&&Z.type!==1&&o.z<=5){let we=de.geometry,ze=.98078528056,$e=(Pe,He)=>{let De=Tm(Pe.x,Pe.y,o,1),je=Tm(He.x,He.y,o,1);return r.N.dot(De,je)<ze};for(let Pe=0;Pe<we.length;Pe++)we[Pe]=bo(we[Pe],$e)}let _e,xe;if(E){let we=d.getValueAndResolveTokens("text-field",de,o,V),ze=_n.factory(we);jk(ze)&&(this.hasRTLText=!0),(!this.hasRTLText||Ul()==="unavailable"||this.hasRTLText&&xa.isParsed())&&(_e=rk(ze,d,de))}if(S){let we=d.getValueAndResolveTokens("icon-image",de,o,V);xe=we instanceof qt?we:qt.fromString(we)}if(!_e&&!xe)continue;let Se=this.sortFeaturesByKey?R.evaluate(de,{},o):void 0;if(this.features.push({id:Q,text:_e,icon:xe,index:K,sourceLayerIndex:se,geometry:de.geometry,properties:Z.properties,type:Bk[Z.type],sortKey:Se}),xe&&(O[xe.namePrimary]=!0,xe.nameSecondary&&(O[xe.nameSecondary]=!0)),_e){let we=y.evaluate(de,{},o).join(","),ze=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ts.vertical)>=0;for(let $e of _e.sections)if($e.image)O[$e.image.namePrimary]=!0;else{let Pe=Vl(_e.toString()),He=$e.fontStack||we,De=F[He]=F[He]||{};this.calculateGlyphDependencies($e.text,De,ze,this.allowVerticalPlacement,Pe)}}}p.get("symbol-placement")==="line"&&(this.features=function(Z){let Q={},K={},se=[],oe=0;function de(we){se.push(Z[we]),oe++}function _e(we,ze,$e){let Pe=K[we];return delete K[we],K[ze]=Pe,se[Pe].geometry[0].pop(),se[Pe].geometry[0]=se[Pe].geometry[0].concat($e[0]),Pe}function xe(we,ze,$e){let Pe=Q[ze];return delete Q[ze],Q[we]=Pe,se[Pe].geometry[0].shift(),se[Pe].geometry[0]=$e[0].concat(se[Pe].geometry[0]),Pe}function Se(we,ze,$e){let Pe=$e?ze[0][ze[0].length-1]:ze[0][0];return`${we}:${Pe.x}:${Pe.y}`}for(let we=0;we<Z.length;we++){let ze=Z[we],$e=ze.geometry,Pe=ze.text?ze.text.toString():null;if(!Pe){de(we);continue}let He=Se(Pe,$e),De=Se(Pe,$e,!0);if(He in K&&De in Q&&K[He]!==Q[De]){let je=xe(He,De,$e),ut=_e(He,De,se[je].geometry);delete Q[He],delete K[De],K[Se(Pe,se[ut].geometry,!0)]=ut,se[je].geometry=null}else He in K?_e(He,De,$e):De in Q?xe(He,De,$e):(de(we),Q[He]=oe-1,K[De]=oe-1)}return se.filter(we=>we.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Z,Q)=>Z.sortKey-Q.sortKey)}update(e,i,o,s,d){let p=Object.keys(e).length!==0;if(p&&!this.stateDependentLayers.length)return;let _=p?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,_,o,s,d),this.icon.programConfigurations.updatePaintArrays(e,i,_,o,s,d)}updateZOffset(){let e=(d,p,_)=>{o+=p,o>d.length&&d.resize(o);for(let y=-p;y<0;y++)d.emplace(y+o,_)},i=(d,p,_)=>{s+=p,s>d.length&&d.resize(s);for(let y=-p;y<0;y++)d.emplace(y+s,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,s=0;for(let d=0;d<this.symbolInstances.length;d++){let p=this.symbolInstances.get(d),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:y,numIconVertices:v}=p,C=p.zOffset,E=v>0;if((_>0||y>0)&&(e(this.text.zOffsetVertexArray,_,C),e(this.text.zOffsetVertexArray,y,C)),E){let{placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:R}=p;S>=0&&i(this.icon.zOffsetVertexArray,v,C),R>=0&&i(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,C)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=dT(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){let o=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:s,y:d}of i)this.lineVertexArray.emplaceBack(s,d);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,s,d,p,_,y,v,C,E,S,R,O,F,V){let U=e.indexArray,Z=e.layoutVertexArray,Q=e.globeExtVertexArray,K=e.segments.prepareSegment(4*i.length,Z,U,this.canOverlap?p.sortKey:void 0),se=this.glyphOffsetArray.length,oe=K.vertexLength,de=this.allowVerticalPlacement&&_===ts.vertical?Math.PI/2:0,_e=p.text&&p.text.sections;for(let Se=0;Se<i.length;Se++){let{tl:we,tr:ze,bl:$e,br:Pe,texPrimary:He,texSecondary:De,pixelOffsetTL:je,pixelOffsetBR:ut,minFontScaleX:qe,minFontScaleY:kt,glyphOffset:Ct,isSDF:Ke,sectionIndex:ei}=i[Se],jt=K.vertexLength,At=Ct[1];if(f_(Z,v.x,v.y,we.x,At+we.y,He.x,He.y,o,Ke,je.x,je.y,qe,kt),f_(Z,v.x,v.y,ze.x,At+ze.y,He.x+He.w,He.y,o,Ke,ut.x,je.y,qe,kt),f_(Z,v.x,v.y,$e.x,At+$e.y,He.x,He.y+He.h,o,Ke,je.x,ut.y,qe,kt),f_(Z,v.x,v.y,Pe.x,At+Pe.y,He.x+He.w,He.y+He.h,o,Ke,ut.x,ut.y,qe,kt),y){let{x:Qe,y:Yt,z:wi}=y.anchor,[ii,Ci,ai]=y.up;__(Q,Qe,Yt,wi,ii,Ci,ai),__(Q,Qe,Yt,wi,ii,Ci,ai),__(Q,Qe,Yt,wi,ii,Ci,ai),__(Q,Qe,Yt,wi,ii,Ci,ai),b_(e.dynamicLayoutVertexArray,Qe,Yt,wi,de)}else b_(e.dynamicLayoutVertexArray,v.x,v.y,v.z,de);if(V){let Qe=De||He;g_(e.iconTransitioningVertexArray,Qe.x,Qe.y),g_(e.iconTransitioningVertexArray,Qe.x+Qe.w,Qe.y),g_(e.iconTransitioningVertexArray,Qe.x,Qe.y+Qe.h),g_(e.iconTransitioningVertexArray,Qe.x+Qe.w,Qe.y+Qe.h)}U.emplaceBack(jt,jt+1,jt+2),U.emplaceBack(jt+1,jt+2,jt+3),K.vertexLength+=4,K.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ct[0]),Se!==i.length-1&&ei===i[Se+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,p,p.index,{},R,O,F,_e&&_e[ei])}let xe=y?y.anchor:v;e.placedSymbolArray.emplaceBack(xe.x,xe.y,xe.z,v.x,v.y,se,this.glyphOffsetArray.length-se,oe,C,E,v.segment,o?o[0]:0,o?o[1]:0,s[0],s[1],_,0,!1,0,S,0)}_commitLayoutVertex(e,i,o,s,d,p,_){e.emplaceBack(i,o,s,d,p,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,i,o,s,d,p,_){let y=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),v=y.vertexLength,C=_.tileAnchorX,E=_.tileAnchorY;for(let R=0;R<4;R++)o.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,_.zOffset),this._commitLayoutVertex(o.layoutVertexArray,s,d,p,C,E,new dt(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,s,d,p,C,E,new dt(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,s,d,p,C,E,new dt(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,s,d,p,C,E,new dt(e.x1,e.y2)),y.vertexLength+=4;let S=o.indexArray;S.emplaceBack(v,v+1),S.emplaceBack(v+1,v+2),S.emplaceBack(v+2,v+3),S.emplaceBack(v+3,v),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,s,d,p){for(let _=s;_<d;_++){let y=o.get(_),v=this.getSymbolInstanceTextSize(e,p,i,_);this._addCollisionDebugVertices(y,v,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,i,o,s,d,p){for(let _=s;_<d;_++){let y=o.get(_),v=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._addCollisionDebugVertices(y,v,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new a0(iu,DC.members,ys),this.iconCollisionBox=new a0(iu,DC.members,ys);let o=Dh(this.iconSizeData,e),s=Dh(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){let p=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(s,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(s,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(o,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(o,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,i,o,s){let d=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:s),p=o_(this.textSizeData,e,d)/Mo;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,i,o){let s=this.icon.placedSymbolArray.get(o),d=o_(this.iconSizeData,e,s);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,i,o,s){e.emplaceBack(i,-o,-o,s),e.emplaceBack(i,o,-o,s),e.emplaceBack(i,o,o,s),e.emplaceBack(i,-o,o,s)}_updateTextDebugCollisionBoxes(e,i,o,s,d,p){for(let _=s;_<d;_++){let y=o.get(_),v=this.getSymbolInstanceTextSize(e,p,i,_);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,v,y.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,s,d,p){for(let _=s;_<d;_++){let y=o.get(_),v=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,v,y.padding,p.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let o=Dh(this.iconSizeData,e),s=Dh(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){let p=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(s,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(s,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(o,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._updateIconDebugCollisionBoxes(o,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,s,d,p,_,y,v){let C={};if(i<o){let{x1:E,y1:S,x2:R,y2:O,padding:F,projectedAnchorX:V,projectedAnchorY:U,projectedAnchorZ:Z,tileAnchorX:Q,tileAnchorY:K,featureIndex:se}=e.get(i);C.textBox={x1:E,y1:S,x2:R,y2:O,padding:F,projectedAnchorX:V,projectedAnchorY:U,projectedAnchorZ:Z,tileAnchorX:Q,tileAnchorY:K},C.textFeatureIndex=se}if(s<d){let{x1:E,y1:S,x2:R,y2:O,padding:F,projectedAnchorX:V,projectedAnchorY:U,projectedAnchorZ:Z,tileAnchorX:Q,tileAnchorY:K,featureIndex:se}=e.get(s);C.verticalTextBox={x1:E,y1:S,x2:R,y2:O,padding:F,projectedAnchorX:V,projectedAnchorY:U,projectedAnchorZ:Z,tileAnchorX:Q,tileAnchorY:K},C.verticalTextFeatureIndex=se}if(p<_){let{x1:E,y1:S,x2:R,y2:O,padding:F,projectedAnchorX:V,projectedAnchorY:U,projectedAnchorZ:Z,tileAnchorX:Q,tileAnchorY:K,featureIndex:se}=e.get(p);C.iconBox={x1:E,y1:S,x2:R,y2:O,padding:F,projectedAnchorX:V,projectedAnchorY:U,projectedAnchorZ:Z,tileAnchorX:Q,tileAnchorY:K},C.iconFeatureIndex=se}if(y<v){let{x1:E,y1:S,x2:R,y2:O,padding:F,projectedAnchorX:V,projectedAnchorY:U,projectedAnchorZ:Z,tileAnchorX:Q,tileAnchorY:K,featureIndex:se}=e.get(y);C.verticalIconBox={x1:E,y1:S,x2:R,y2:O,padding:F,projectedAnchorX:V,projectedAnchorY:U,projectedAnchorZ:Z,tileAnchorX:Q,tileAnchorY:K},C.verticalIconFeatureIndex=se}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){let o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){let o=e.placedSymbolArray.get(i),s=o.vertexStartIndex+4*o.numGlyphs;for(let d=o.vertexStartIndex;d<s;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let i=Math.sin(e),o=Math.cos(e),s=[],d=[],p=[];for(let _=0;_<this.symbolInstances.length;++_){p.push(_);let y=this.symbolInstances.get(_);s.push(0|Math.round(i*y.tileAnchorX+o*y.tileAnchorY)),d.push(y.featureIndex)}return p.sort((_,y)=>s[_]-s[y]||d[y]-d[_]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){let o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let i of this.symbolInstanceIndexes){let o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);let{rightJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:v}=o;s>=0&&this.addIndicesForPlacedSymbol(this.text,s),d>=0&&d!==s&&this.addIndicesForPlacedSymbol(this.text,d),p>=0&&p!==d&&p!==s&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Et(y_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),y_.addDynamicAttributes=b_;let Uk=new rr({"symbol-placement":new ct(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new ct(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ct(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Zt(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ct(Te.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ct(Te.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new ct(Te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ct(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new ct(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ct(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Zt(Te.layout_symbol["icon-size"]),"icon-text-fit":new Zt(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Zt(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Zt(Te.layout_symbol["icon-image"]),"icon-rotate":new Zt(Te.layout_symbol["icon-rotate"]),"icon-padding":new ct(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new ct(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new Zt(Te.layout_symbol["icon-offset"]),"icon-anchor":new Zt(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ct(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ct(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ct(Te.layout_symbol["text-rotation-alignment"]),"text-field":new Zt(Te.layout_symbol["text-field"]),"text-font":new Zt(Te.layout_symbol["text-font"]),"text-size":new Zt(Te.layout_symbol["text-size"]),"text-max-width":new Zt(Te.layout_symbol["text-max-width"]),"text-line-height":new Zt(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new Zt(Te.layout_symbol["text-letter-spacing"]),"text-justify":new Zt(Te.layout_symbol["text-justify"]),"text-radial-offset":new Zt(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ct(Te.layout_symbol["text-variable-anchor"]),"text-anchor":new Zt(Te.layout_symbol["text-anchor"]),"text-max-angle":new ct(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new ct(Te.layout_symbol["text-writing-mode"]),"text-rotate":new Zt(Te.layout_symbol["text-rotate"]),"text-padding":new ct(Te.layout_symbol["text-padding"]),"text-keep-upright":new ct(Te.layout_symbol["text-keep-upright"]),"text-transform":new Zt(Te.layout_symbol["text-transform"]),"text-offset":new Zt(Te.layout_symbol["text-offset"]),"text-allow-overlap":new ct(Te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ct(Te.layout_symbol["text-ignore-placement"]),"text-optional":new ct(Te.layout_symbol["text-optional"]),visibility:new ct(Te.layout_symbol.visibility)});var s0={paint:new rr({"icon-opacity":new Zt(Te.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Zt(Te.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Zt(Te.paint_symbol["text-emissive-strength"]),"icon-color":new Zt(Te.paint_symbol["icon-color"]),"icon-halo-color":new Zt(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Zt(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Zt(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new ct(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new ct(Te.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Zt(Te.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Zt(Te.paint_symbol["text-opacity"]),"text-color":new Zt(Te.paint_symbol["text-color"],{runtimeType:Ee,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Zt(Te.paint_symbol["text-halo-color"]),"text-halo-width":new Zt(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new Zt(Te.paint_symbol["text-halo-blur"]),"text-translate":new ct(Te.paint_symbol["text-translate"]),"text-translate-anchor":new ct(Te.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ct(Te.paint_symbol["icon-color-saturation"])}),layout:Uk};class uT{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:J,this.defaultValue=e}evaluate(e){if(e.formattedSection){let i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Et(uT,"FormatSectionOverride",{omit:["defaultValue"]});class v_ extends aa{constructor(e,i,o){super(e,s0,i,o)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let o=this.layout.get("text-writing-mode");if(o){let s=[];for(let d of o)s.indexOf(d)<0&&s.push(d);this.layout._values["text-writing-mode"]=s}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,o,s){let d=this.layout.get(e).evaluate(i,{},o,s),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Ud(p.value)||!d?d:function(_,y){return y.replace(/{([^{}]+)}/g,(v,C)=>C in _?String(_[C]):"")}(i.properties,d)}createBucket(e){return new y_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of s0.paint.overridableProperties){if(!v_.hasPaintOverride(this.layout,e))continue;let i=this.paint.get(e),o=new uT(i),s=new dh(o,i.property.specification,this.scope,this.options),d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new qp("source",s):new Gd("composite",s,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Qc(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&v_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){let o=e.get("text-field"),s=s0.paint.properties[i],d=!1,p=_=>{for(let y of _)if(s.overrides&&s.overrides.hasOverride(y))return void(d=!0)};if(o.value.kind==="constant"&&o.value.value instanceof _n)p(o.value.value.sections);else if(o.value.kind==="source"){let _=v=>{d||(v instanceof Aa&&Ir(v.value)===zt?p(v.value.sections):v instanceof zs?p(v.sections):v.eachChild(_))},y=o.value;y._styleExpression&&_(y._styleExpression.expression)}return d}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,o=[];return e&&o.push("symbolIcon"),i&&o.push("symbolSDF"),o}getDefaultProgramParams(e,i){return{config:new B(this,i),overrideFog:!1}}}let Gk=new rr({visibility:new ct(Te.layout_background.visibility)});var Hk={paint:new rr({"background-color":new ct(Te.paint_background["background-color"]),"background-pattern":new ct(Te.paint_background["background-pattern"]),"background-opacity":new ct(Te.paint_background["background-opacity"]),"background-emissive-strength":new ct(Te.paint_background["background-emissive-strength"])}),layout:Gk};let $k=new rr({visibility:new ct(Te.layout_raster.visibility)});var qk={paint:new rr({"raster-opacity":new ct(Te.paint_raster["raster-opacity"]),"raster-color":new xc(Te.paint_raster["raster-color"]),"raster-color-mix":new ct(Te.paint_raster["raster-color-mix"]),"raster-color-range":new ct(Te.paint_raster["raster-color-range"]),"raster-hue-rotate":new ct(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ct(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ct(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new ct(Te.paint_raster["raster-saturation"]),"raster-contrast":new ct(Te.paint_raster["raster-contrast"]),"raster-resampling":new ct(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new ct(Te.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ct(Te.paint_raster["raster-emissive-strength"]),"raster-array-band":new ct(Te.paint_raster["raster-array-band"]),"raster-elevation":new ct(Te.paint_raster["raster-elevation"])}),layout:$k},l0=fn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class c0{constructor(e,i,o,s){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(i,s)}update(e,i,o){let{width:s,height:d}=e,{context:p}=this,{gl:_}=p;if(_.bindTexture(_.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA&&(!i||i.premultiply!==!1)),o||this.size&&this.size[0]===s&&this.size[1]===d){let{x:y,y:v}=o||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)_.texSubImage2D(_.TEXTURE_2D,0,y,v,_.RGBA,_.UNSIGNED_BYTE,e);else{let C=this.format,E=_.UNSIGNED_BYTE;this.format===_.R32F&&(C=_.RED,E=_.FLOAT),_.texSubImage2D(_.TEXTURE_2D,0,y,v,s,d,C,E,e.data)}}else if(this.size=[s,d],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===_.R8&&(y=_.RED),_.texImage2D(_.TEXTURE_2D,0,this.format,y,_.UNSIGNED_BYTE,e)}else{let y=this.format,v=this.format,C=_.UNSIGNED_BYTE;this.format===_.DEPTH_COMPONENT&&(y=_.DEPTH_COMPONENT16,C=_.UNSIGNED_SHORT),this.format===_.R8&&(v=_.RED),this.format===_.R32F&&(C=_.FLOAT,v=_.RED),_.texImage2D(_.TEXTURE_2D,0,y,s,d,0,v,C,e.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,i,o=!1){let{context:s}=this,{gl:d}=s;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,s){let{context:d}=this,{gl:p}=d;p.bindTexture(p.TEXTURE_2D,this.texture),i!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,o),this.wrapS=o),s!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrapT=s)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class x_{constructor(e,i){this.context=e,this.texture=i}bind(e,i){let{context:o}=this,{gl:s}=o;s.bindTexture(s.TEXTURE_2D,this.texture),e!==this.minFilter&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,e),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,i),this.wrapS=i)}}function w_(t,e,i,o,s,d,p,_){let y=[t,e,1,i,o,1,s,d,1],v=[p,_,1],C=r.co.adjoint([],y),[E,S,R]=r.N.transformMat3(v,v,C);return r.co.multiply(y,y,[E,0,0,0,S,0,0,0,R])}function hT(t,e,i,o,s,d,p,_){let y=function(v,C,E,S,R,O,F,V){let U=w_(0,0,1,0,1,1,0,1),Z=w_(v,C,E,S,R,O,F,V),Q=r.co.adjoint([],U);return r.co.multiply(Z,Z,Q)}(t,e,i,o,s,d,p,_);return[y[2]/y[8]/mt,y[5]/y[8]/mt]}function C_(t){return[t[0],Math.min(Math.max(t[1],-ki),ki)]}class pT extends Qo{constructor(e,i,o,s){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(s),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new mo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=gt(this.map._requestManager.transformRequest(this.url,to.Image),(o,s)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new El(o)):s&&(this.image=s instanceof HTMLImageElement?et.getImageData(s):s,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new x_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new mo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof x_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(let d of e)d[1]>o&&(o=d[1]),d[1]<i&&(i=d[1]);let s=(o+i)/2;if(s>ki?this.onNorthPole=!0:s<-ki&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let d=e.map(Wi.fromLngLat);this.tileID=function(p){let _=1/0,y=1/0,v=-1/0,C=-1/0;for(let F of p)_=Math.min(_,F.x),y=Math.min(y,F.y),v=Math.max(v,F.x),C=Math.max(C,F.y);let E=Math.max(v-_,C-y),S=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),R=Math.pow(2,S),O=Math.floor((_+v)/2*R);return O>1&&(O-=1),new Xe(S,O,Math.floor((y+C)/2*R))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new mo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let U in this.tiles){let Z=this.tiles[U];Z.state!=="loaded"&&(Z.state="loaded",Z.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let i=Lm(new Xe(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(U){let Z=U[1].x-U[0].x,Q=U[1].y-U[0].y,K=U[2].x-U[1].x,se=U[2].y-U[1].y,oe=U[3].x-U[2].x,de=U[3].y-U[2].y,_e=U[0].x-U[3].x,xe=U[0].y-U[3].y,Se=Z*se-K*Q,we=K*de-oe*se,ze=oe*xe-_e*de,$e=_e*Q-Z*xe;return Se>0&&we>0&&ze>0&&$e>0||Se<0&&we<0&&ze<0&&$e<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let s=Lm(this.tileID,this.map.transform.projection),[d,p,_,y]=this.coordinates.map(U=>{let Z=s.projection.project(U[0],U[1]);return oT(s,Z)._round()});this.perspectiveTransform=hT(d.x,d.y,p.x,p.y,_.x,_.y,y.x,y.y);let v=this._boundsArray=new rl;v.emplaceBack(d.x,d.y,0,0),v.emplaceBack(p.x,p.y,mt,0),v.emplaceBack(y.x,y.y,0,mt),v.emplaceBack(_.x,_.y,mt,mt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(v,l0.members),this.boundsSegments=yr.simpleSegment(0,0,4,2);let C=[],E=[C_((S=this.coordinates)[0]),C_(S[1]),C_(S[2]),C_(S[3])];var S;let[R,O,F,V]=function(U){let Z=U[0][0],Q=Z,K=U[0][1],se=K;for(let oe=1;oe<U.length;oe++)U[oe][0]<Z?Z=U[oe][0]:U[oe][0]>Q&&(Q=U[oe][0]),U[oe][1]<K?K=U[oe][1]:U[oe][1]>se&&(se=U[oe][1]);return[Z,K,Q-Z,se-K]}(E);{let U=new rl,[Z,Q,K,se]=function(je){let ut=je[0].x,qe=ut,kt=je[0].y,Ct=kt;for(let Ke=1;Ke<je.length;Ke++)je[Ke].x<ut?ut=je[Ke].x:je[Ke].x>qe&&(qe=je[Ke].x),je[Ke].y<kt?kt=je[Ke].y:je[Ke].y>Ct&&(Ct=je[Ke].y);return[ut,kt,qe-ut,Ct-kt]}(o),oe=je=>[(je.x-Z)/K,(je.y-Q)/se],[de,_e,xe,Se]=o.map(oe),we=function(je,ut,qe,kt,Ct,Ke,ei,jt){let At=w_(0,0,1,0,1,1,0,1),Qe=w_(je,ut,qe,kt,Ct,Ke,ei,jt),Yt=r.co.adjoint([],Qe);return r.co.multiply(At,At,Yt)}(de[0],de[1],_e[0],_e[1],xe[0],xe[1],Se[0],Se[1]);this.elevatedGlobePerspectiveTransform=hT(de[0],de[1],_e[0],_e[1],xe[0],xe[1],Se[0],Se[1]);let ze=(je,ut)=>{C.push(je.lng);let qe=Math.round((je.lng-R)/F*mt),kt=Math.round((je.lat-O)/V*mt),Ct=oe(ut),Ke=r.N.transformMat3([],[Ct[0],Ct[1],1],we),ei=Math.round(Ke[0]/Ke[2]*mt),jt=Math.round(Ke[1]/Ke[2]*mt);U.emplaceBack(qe,kt,ei,jt)},$e=o[3].x-o[0].x,Pe=o[3].y-o[0].y,He=o[2].x-o[1].x,De=o[2].y-o[1].y;for(let je=0;je<65;je++){let ut=je/64,qe=[o[0].x+ut*$e,o[0].y+ut*Pe],kt=[o[1].x+ut*He,o[1].y+ut*De],Ct=kt[0]-qe[0],Ke=kt[1]-qe[1];for(let ei=0;ei<65;ei++){let jt=ei/64,At={x:qe[0]+Ct*jt,y:qe[1]+Ke*jt,z:0};ze(i.projection.unproject(At.x,At.y),At)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(U,l0.members)}{this.maxLongitudeTriangleSize=0;let U=[],Z=new Kr,Q=(K,se,oe)=>{Z.emplaceBack(K,se,oe);let de=C[K],_e=C[se],xe=C[oe],Se=Math.min(Math.min(de,_e),xe),we=Math.max(Math.max(de,_e),xe)-Se;we>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=we),U.push(Se+we/2)};for(let K=0;K<64;K++)for(let se=0;se<64;se++){let oe=65*K+se,de=oe+1,_e=oe+65,xe=_e+1;Q(oe,_e,de),Q(de,_e,xe)}[U,Z]=function(K,se){let oe=Array.from({length:K.length},(xe,Se)=>Se);oe.sort((xe,Se)=>K[xe]-K[Se]);let de=[],_e=new Kr;for(let xe=0;xe<oe.length;xe++){let Se=oe[xe];de.push(K[Se]);let we=3*Se,ze=we+1;_e.emplaceBack(se.uint16[we],se.uint16[ze],se.uint16[ze+1])}return[de,_e]}(U,Z),this.elevatedGlobeTrianglesCenterLongitudes=U,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(Z)}this.elevatedGlobeSegments=yr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,F/mt,0,V/mt,0,0,O,R,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof x_||(this.texture?this.texture.update(this.image):(this.texture=new c0(i,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;let o=this.elevatedGlobeTrianglesCenterLongitudes,s=((C,E)=>C+360*Math.round((E-C)/360))(e+180,o[0]),d=new yr,p=(C,E)=>{d.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:i.segments[0].vertexLength,primitiveLength:E,sortKey:void 0,vaos:{}})},_=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-s)<=_){let C=Be(o,0,o.length,s+_);return C===o.length||p(C,fe(o,C+1,o.length,s+360-_)-C),d}s<o[0]&&(s+=360);let y=fe(o,0,o.length,s-_);if(y===o.length)return p(0,o.length),d;p(0,y-0);let v=Be(o,y+1,o.length,s+_);return v!==o.length&&p(v,o.length-v),d}}let Wk=(Math.pow(256,2)-1)/16907520;class mT extends aa{constructor(e,i,o){super(e,qk,i,o),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(e){return!(e&&e._source instanceof pT&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let i=this._transitionablePaint._values["raster-color"].value.expression,[o,s]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(s)||o===this._curRampRange[0]&&s===this._curRampRange[1]||(this.colorRamp=Em({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:s}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,s])}}let Zk=new rr({visibility:new ct(Te["layout_raster-particle"].visibility)});var Yk={paint:new rr({"raster-particle-array-band":new ct(Te["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ct(Te["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new xc(Te["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ct(Te["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ct(Te["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ct(Te["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ct(Te["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:Zk};class fT extends aa{constructor(e,i,o){super(e,Yk,i,o),this._updateColorRamp(),this.onRemove=s=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&s.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=et.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isLayerDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Em({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=et.now()}}class Xk extends aa{constructor(e,i){super(e,{},i),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let Kk=new rr({visibility:new ct(Te.layout_sky.visibility)});var Qk={paint:new rr({"sky-type":new ct(Te.paint_sky["sky-type"]),"sky-atmosphere-sun":new ct(Te.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ct(Te.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ct(Te.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ct(Te.paint_sky["sky-gradient-radius"]),"sky-gradient":new xc(Te.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ct(Te.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ct(Te.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ct(Te.paint_sky["sky-opacity"])}),layout:Kk};function d0(t,e,i){let o=[0,0,1],s=r.bi.identity([]);return r.bi.rotateY(s,s,i?-Fi(t)+Math.PI:Fi(t)),r.bi.rotateX(s,s,-Fi(e)),r.N.transformQuat(o,o,s),r.N.normalize(o,o)}var Jk={paint:new rr({})};function gT(t,e){let i=T_(t.projection,t.zoom,t.width,t.height),o=function(d,p,_,y,v){let C=new ve(_.lng-180*ud,_.lat),E=new ve(_.lng+180*ud,_.lat),S=d.project(C.lng,C.lat),R=d.project(E.lng,E.lat),O=-Math.atan2(R.y-S.y,R.x-S.x),F=Wi.fromLngLat(_);F.y=gi(F.y,-1+ud,1-ud);let V=F.toLngLat(),U=d.project(V.lng,V.lat),Z=Wi.fromLngLat(V);Z.x+=ud;let Q=Z.toLngLat(),K=d.project(Q.lng,Q.lat),se=yT(K.x-U.x,K.y-U.y,O),oe=Wi.fromLngLat(V);oe.y+=ud;let de=oe.toLngLat(),_e=d.project(de.lng,de.lat),xe=yT(_e.x-U.x,_e.y-U.y,O),Se=Math.abs(se.x)/Math.abs(xe.y),we=r.a6.identity([]);r.a6.rotateZ(we,we,-O*(1-(v?0:y)));let ze=r.a6.identity([]);return r.a6.scale(ze,ze,[1,1-(1-Se)*y,1]),ze[4]=-xe.x/xe.y*y,r.a6.rotateZ(ze,ze,O),r.a6.multiply(ze,we,ze),ze}(t.projection,0,t.center,i,e),s=_T(t);return r.a6.scale(o,o,[s,s,1]),o}function _T(t){let e=t.projection,i=T_(t.projection,t.zoom,t.width,t.height),o=bT(e,t.center),s=bT(e,ve.convert(e.center));return Math.pow(2,o*i+(1-i)*s)}function T_(t,e,i,o,s=1/0){let d=t.range;if(!d)return 0;let p=Math.min(s,Math.max(i,o)),_=Math.log(p/1024)/Math.LN2;return us(d[0]+_,d[1]+_,e)}let ud=1/4e4;function bT(t,e){let i=gi(e.lat,-ki,ki),o=new ve(e.lng-180*ud,i),s=new ve(e.lng+180*ud,i),d=t.project(o.lng,i),p=t.project(s.lng,i),_=Wi.fromLngLat(o),y=Wi.fromLngLat(s),v=p.x-d.x,C=p.y-d.y,E=y.x-_.x,S=y.y-_.y,R=Math.sqrt((E*E+S*S)/(v*v+C*C));return Math.log(R)/Math.LN2}function yT(t,e,i){let o=Math.cos(i),s=Math.sin(i);return{x:t*o-e*s,y:t*s+e*o}}function vT(t,e,i){r.a6.identity(t),r.a6.rotateZ(t,t,Fi(e[2])),r.a6.rotateX(t,t,Fi(e[0])),r.a6.rotateY(t,t,Fi(e[1])),r.a6.scale(t,t,i),r.a6.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function E_(t,e,i,o,s,d,p,_){let y=[i[0]-e[0],i[1]-e[1],0],v=[o[0]-e[0],o[1]-e[1],0];if(r.N.length(y)<1e-12||r.N.length(v)<1e-12)return r.bi.identity(t);let C=r.N.cross([],y,v);r.N.normalize(C,C),r.N.subtract(v,o,e),y[2]=(d-s)*_,v[2]=(p-s)*_;let E=y;return r.N.cross(E,y,v),r.N.normalize(E,E),r.bi.rotationTo(t,C,E)}function u0(t,e,i=!1){let o=rd(e.zoom),s=function(d,p,_){let y=p.worldSize,v=[d[12],d[13],d[14]],C=Ui(v[1]/y),E=li(v[0]/y),S=r.a6.identity([]),R=ci(1,C)*y,O=ci(1,0)*y*Ri(C,p.zoom),F=1/Fy(y),V=O*F;if(_){let K=T_(p.projection,p.zoom,p.width,p.height,1024);V=F*p.projection.pixelSpaceConversion(p.center.lat,y,K)}let U=Fe(C,E);r.N.add(U,U,r.N.scale([],r.N.normalize([],U),R*V*v[2]));let Z=function(K){let se=[K[0],K[1],K[2]],oe=[0,1,0],de=r.N.cross([],oe,se);return r.N.cross(oe,se,de),r.N.squaredLength(oe)===0&&(oe=[0,1,0],r.N.cross(de,se,oe)),r.N.normalize(de,de),r.N.normalize(oe,oe),r.N.normalize(se,se),[de[0],de[1],de[2],0,oe[0],oe[1],oe[2],0,se[0],se[1],se[2],0,K[0],K[1],K[2],1]}(U);r.a6.scale(S,S,[V,V,V*R]),r.a6.translate(S,S,[-v[0],-v[1],-v[2]]);let Q=r.a6.multiply([],p.globeMatrix,Z);return r.a6.multiply(Q,Q,S),r.a6.multiply(Q,Q,d),Q}(t,e,i);if(o>0){let d=function(p,_){let y=_.worldSize,v=ci(1,0)*y*Ri(_.center.lat,_.zoom)/Fy(y),C=ci(1,_.center.lat)*y,E=r.a6.identity([]);return r.a6.rotateY(E,E,Fi(_.center.lng)),r.a6.rotateX(E,E,Fi(_.center.lat)),r.a6.translate(E,E,[0,0,X]),r.a6.scale(E,E,[v,v,v*C]),r.a6.translate(E,E,[_.point.x-.5*y,_.point.y-.5*y,0]),r.a6.multiply(E,E,p),r.a6.multiply(E,_.globeMatrix,E)}(t,e);return function(p,_,y){let v=(O,F,V)=>{let U=r.N.length(O),Z=r.N.length(F),Q=Mc(O,F,V);return r.N.scale(Q,Q,1/r.N.length(Q)*Ai(U,Z,V))},C=v([p[0],p[1],p[2]],[_[0],_[1],_[2]],y),E=v([p[4],p[5],p[6]],[_[4],_[5],_[6]],y),S=v([p[8],p[9],p[10]],[_[8],_[9],_[10]],y),R=Mc([p[12],p[13],p[14]],[_[12],_[13],_[14]],y);return[C[0],C[1],C[2],0,E[0],E[1],E[2],0,S[0],S[1],S[2],0,R[0],R[1],R[2],1]}(s,d,o)}return s}function xT(t,e,i,o){let s=mr.projectAabbCorners(o,i),d=Number.MAX_VALUE,p=-1;for(let v=0;v<s.length;++v){let C=s[v];C[0]=(.5*C[0]+.5)*e.width,C[1]=(.5-.5*C[1])*e.height,C[2]<d&&(p=v,d=C[2])}let _=v=>new dt(s[v][0],s[v][1]),y;switch(p){case 0:case 6:y=[_(1),_(5),_(4),_(7),_(3),_(2),_(1)];break;case 1:case 7:y=[_(0),_(4),_(5),_(6),_(2),_(3),_(0)];break;case 3:case 5:y=[_(1),_(0),_(4),_(7),_(6),_(2),_(1)];break;default:y=[_(1),_(5),_(6),_(7),_(3),_(0),_(1)]}if(xs(t,y))return d}let e2=fn([{name:"a_pos_3f",components:3,type:"Float32"}]),t2=fn([{name:"a_color_3f",components:3,type:"Float32"}]),i2=fn([{name:"a_color_4f",components:4,type:"Float32"}]),n2=fn([{name:"a_uv_2f",components:2,type:"Float32"}]),r2=fn([{name:"a_normal_3f",components:3,type:"Float32"}]),o2=fn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),a2=fn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class wT{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class CT{constructor(){this.instancedDataArray=new gm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class h0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,i,o,s){this.tileToMeter=Pi(o);let d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:p,id:_,index:y,sourceLayerIndex:v}of e){let C=Vr(p,d);if(!this.layers[0]._featureFilter.filter(new nr(this.zoom),C,o))continue;let E={id:_,sourceLayerIndex:v,index:y,geometry:d?C.geometry:Jr(p,o,s),properties:p.properties,type:p.type,patterns:{}},S=this.addFeature(E,E.geometry,C);S&&i.featureIndex.insert(p,E.geometry,y,v,this.index,this.instancesPerModel[S].instancedDataArray.length,mt/32)}this.lookup=null}update(e,i,o,s){for(let d in this.instancesPerModel){let p=this.instancesPerModel[d];for(let _ in e)p.idToFeaturesIndex.hasOwnProperty(_)&&this.evaluate(p.features[p.idToFeaturesIndex[_]],e[_],p,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let i in this.instancesPerModel){let o=this.instancesPerModel[i];for(let s of o.features){let d=this.layers[0],p=s.feature,_=this.canonical,y=d.paint.get("model-rotation").evaluate(p,{},_),v=d.paint.get("model-scale").evaluate(p,{},_),C=d.paint.get("model-translation").evaluate(p,{},_);r.N.exactEquals(s.rotation,y)&&r.N.exactEquals(s.scale,v)&&r.N.exactEquals(s.translation,C)||(this.evaluate(s,s.featureStates,o,!0),e=!0)}}return e}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let i in this.instancesPerModel){let o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,o2.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let e in this.instancesPerModel){let i=this.instancesPerModel[e];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(e,i,o){let s=this.layers[0],d=s.layout.get("model-id").evaluate(o,{},this.canonical);if(!d)return er(`modelId is not evaluated for layer ${s.id} and it is not going to get rendered.`),d;this.instancesPerModel[d]||(this.instancesPerModel[d]=new CT);let p=this.instancesPerModel[d],_=p.instancedDataArray,y=new wT(o,_.length);for(let v of i)for(let C of v){if(C.x<0||C.x>=mt||C.y<0||C.y>=mt)continue;let E=(this.lookupDim-1)/mt,S=this.lookupDim*(C.y*E|0)+C.x*E|0;if(this.lookup){if(this.lookup[S]!==0)continue;this.lookup[S]=1}this.instanceCount++;let R=_.length;_.resize(R+1),p.instancesEvaluatedElevation.push(0),_.float32[16*R]=C.x,_.float32[16*R+1]=C.y}return y.instancedDataCount=p.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(y),this.evaluate(y,{},p,!1)),d}evaluate(e,i,o,s){let d=this.layers[0],p=e.feature,_=this.canonical,y=e.rotation=d.paint.get("model-rotation").evaluate(p,i,_),v=e.scale=d.paint.get("model-scale").evaluate(p,i,_),C=e.translation=d.paint.get("model-translation").evaluate(p,i,_),E=d.paint.get("model-color").evaluate(p,i,_);E.a=d.paint.get("model-color-mix-intensity").evaluate(p,i,_);let S=[];this.maxVerticalOffset<C[2]&&(this.maxVerticalOffset=C[2]),this.maxScale=Math.max(Math.max(this.maxScale,v[0]),Math.max(v[1],v[2])),vT(S,y,v);let R=Math.round(100*E.a)+E.b/1.05;for(let O=0;O<e.instancedDataCount;++O){let F=e.instancedDataOffset+O,V=16*F,U=o.instancedDataArray.float32,Z=0;s&&(Z=U[V+6]-o.instancesEvaluatedElevation[F]);let Q=0|U[V+1];U[V]=(0|U[V])+E.r/1.05,U[V+1]=Q+E.g/1.05,U[V+2]=R,U[V+3]=1/(_.z>10?this.tileToMeter:Pi(_,Q)),U[V+4]=C[0],U[V+5]=C[1],U[V+6]=C[2]+Z,U[V+7]=S[0],U[V+8]=S[1],U[V+9]=S[2],U[V+10]=S[4],U[V+11]=S[5],U[V+12]=S[6],U[V+13]=S[8],U[V+14]=S[9],U[V+15]=S[10],o.instancesEvaluatedElevation[F]=C[2]}}}Et(h0,"ModelBucket",{omit:["layers"]}),Et(CT,"PerModelAttributes"),Et(wT,"ModelFeature");let s2=new rr({visibility:new ct(Te.layout_model.visibility),"model-id":new Zt(Te.layout_model["model-id"])});var l2={paint:new rr({"model-opacity":new ct(Te.paint_model["model-opacity"]),"model-rotation":new Zt(Te.paint_model["model-rotation"]),"model-scale":new Zt(Te.paint_model["model-scale"]),"model-translation":new Zt(Te.paint_model["model-translation"]),"model-color":new Zt(Te.paint_model["model-color"]),"model-color-mix-intensity":new Zt(Te.paint_model["model-color-mix-intensity"]),"model-type":new ct(Te.paint_model["model-type"]),"model-cast-shadows":new ct(Te.paint_model["model-cast-shadows"]),"model-receive-shadows":new ct(Te.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ct(Te.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Zt(Te.paint_model["model-emissive-strength"]),"model-roughness":new Zt(Te.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Zt(Te.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ct(Te.paint_model["model-cutoff-fade-range"])}),layout:s2};let _u=64,Nh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function TT(t,e,i,o,s,d,p,_,y,v=!1){let C=i.zoom,E=i.project(o),S=Ri(o.lat,C),R=1/S;r.a6.identity(t),r.a6.translate(t,t,[E.x+p[0]*R,E.y+p[1]*R,p[2]]);let O=1,F=1,V=i.worldSize;if(v){if(i.projection.name==="mercator"){let K=0;i.elevation&&(K=i.elevation.getAtPointOrZero(new Wi(E.x/V,E.y/V),0));let se=r.a7.transformMat4([],[E.x,E.y,K,1],i.projMatrix)[3]/i.cameraToCenterDistance;O=se,F=se*Ri(i.center.lat,C)}else if(i.projection.name==="globe"){let K=u0(t,i),se=r.a6.multiply([],i.projMatrix,K),oe=[0,0,0,1];r.a7.transformMat4(oe,oe,se);let de=oe[3]/i.cameraToCenterDistance,_e=rd(C),xe=i.projection.pixelsPerMeter(o.lat,V)*Ri(o.lat,C),Se=i.projection.pixelsPerMeter(i.center.lat,V)*Ri(i.center.lat,C);O=de/Ai(xe,or(i.center.lat),_e),F=de*S/xe,O*=Se,F*=Se}}else O=R;r.a6.scale(t,t,[O,O,F]);let U=[...t],Z=e.orientation,Q=[];if(vT(Q,[Z[0]+s[0],Z[1]+s[1],Z[2]+s[2]],d),r.a6.multiply(t,U,Q),_&&i.elevation){let K=0,se=[];if(y&&i.elevation){K=function(_e,xe,Se,we,ze){let $e=xe.elevation;if(!$e)return 0;let Pe=mr.projectAabbCorners(Se,we),He=ci(1,ze.lat)*xe.worldSize,De=function(Yt,wi){let ii=[0,0,1],Ci=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let ai of Ci){let Bi=Yt[ai.corners[0]],di=Yt[ai.corners[1]],Dn=Yt[ai.corners[2]],Xi=[di[0]-Bi[0],di[1]-Bi[1],wi*(di[2]-Bi[2])],tn=r.N.cross(Xi,Xi,[Dn[0]-Bi[0],Dn[1]-Bi[1],wi*(Dn[2]-Bi[2])]);r.N.normalize(tn,tn),ai.dotProductWithUp=r.N.dot(tn,ii)}return Ci.sort((ai,Bi)=>ai.dotProductWithUp-Bi.dotProductWithUp),Ci[0].corners}(Pe,He),je=Pe[De[0]],ut=Pe[De[1]],qe=Pe[De[2]],kt=Pe[De[3]],Ct=$e.getAtPointOrZero(new Wi(je[0]/xe.worldSize,je[1]/xe.worldSize),0),Ke=$e.getAtPointOrZero(new Wi(ut[0]/xe.worldSize,ut[1]/xe.worldSize),0),ei=$e.getAtPointOrZero(new Wi(qe[0]/xe.worldSize,qe[1]/xe.worldSize),0),jt=$e.getAtPointOrZero(new Wi(kt[0]/xe.worldSize,kt[1]/xe.worldSize),0),At=(Ct+jt)/2,Qe=(Ke+ei)/2;return At>Qe?Ke<ei?E_(_e,ut,kt,je,Ke,jt,Ct,He):E_(_e,qe,je,kt,ei,Ct,jt,He):Ct<jt?E_(_e,je,ut,qe,Ct,Ke,ei,He):E_(_e,kt,qe,ut,jt,ei,Ke,He),Math.max(At,Qe)}(se,i,e.aabb,t,o);let oe=r.a6.fromQuat([],se),de=r.a6.multiply([],oe,Q);r.a6.multiply(t,U,de)}else K=i.elevation.getAtPointOrZero(new Wi(E.x/V,E.y/V),0);K!==0&&(t[14]+=K)}}function jm(t,e,i=!1){t.uploaded||(t.gfxTexture=new c0(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function c2(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,e2.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,r2.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,n2.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?t2:i2).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,a2.members,!0)),t.segments=yr.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let o=t.material;o.pbrMetallicRoughness.baseColorTexture&&jm(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&jm(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&jm(o.normalTexture,e),o.occlusionTexture&&jm(o.occlusionTexture,e,i),o.emissionTexture&&jm(o.emissionTexture,e)}function p0(t,e,i){if(t.meshes)for(let o of t.meshes)c2(o,e,i);if(t.children)for(let o of t.children)p0(o,e,i)}function I_(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)I_(e)}function m0(t){if(t.meshes)for(let i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let i of t.children)m0(i)}class d2{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class u2{constructor(){this.tasks={},this.taskQueue=[],Ps(["process"],this),this.invoker=new d2(this.process),this.nextId=0}add(e,i){let o=this.nextId++,s=function({type:d,isSymbolTile:p,zoom:_}){return _=_||0,d==="message"?0:d!=="maybePrepare"||p?d!=="parseTile"||p?d==="parseTile"&&p?300-_:d==="maybePrepare"&&p?400-_:500:200-_:100-_}(i);if(s===0){fa();try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:s,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){fa();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let s=0;s<this.taskQueue.length;s++){let d=this.tasks[this.taskQueue[s]];d.priority<i&&(i=d.priority,e=s)}if(e===null)return null;let o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class ET{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},Ps(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new u2}send(e,i,o,s,d=!1,p){let _=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=p,this.callbacks[_]=o);let y=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!o,targetMapId:s,mustQueue:d,sourceMapId:this.mapId,data:Bl(i,y)},y),{cancel:()=>{o&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(e){let i=e.data,o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){let s=this.cancelCallbacks[o];delete this.cancelCallbacks[o],s&&s.cancel()}else if(i.mustQueue||fa()){let s=this.callbacks[o],d=this.scheduler.add(()=>this.processTask(o,i),s&&s.metadata||{type:"message"});d&&(this.cancelCallbacks[o]=d)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){let o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(yc(i.error)):o(null,yc(i.data)))}else{let o=new Set,s=i.hasCallback?(p,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?Bl(p):null,data:Bl(_,o)},o)}:p=>{},d=yc(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,d,s);else if(this.parent.getWorkerSource){let p=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,p[0],d.source,d.scope)[p[1]](d,s)}else s(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let f0=(()=>{class t{constructor(i,o){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=Lr();let s=this.workerPool.acquire(this.id);for(let d=0;d<s.length;d++){let p=new t.Actor(s[d],o,this.id);p.name=`Worker ${d}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,o,s){Yo(this.actors,(d,p)=>{d.send(i,o,p)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=ET,t})();var Um={workerUrl:"",workerClass:null,workerParams:void 0};function h2(){return Um.workerClass!=null?new Um.workerClass:new self.Worker(Um.workerUrl,Um.workerParams)}let g0="mapboxgl_preloaded_worker_pool";class Gm{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Gm.workerCount;)this.workers.push(new h2);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[g0]}numActive(){return Object.keys(this.active).length}}let Hm;function S_(){return Hm||(Hm=new Gm),Hm}Gm.workerCount=2;let M_,_0,ul,Bh,b0,Vh=null;function IT(){return fa()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:_0||ie.DRACO_URL}function ST(){if(fa()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Bh)return Bh;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Bh=WebAssembly.validate(t)?ie.MESHOPT_SIMD_URL:ie.MESHOPT_URL,Bh}let A_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},p2={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},$m={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function MT(t,e,i){let o=i.json.bufferViews.length,s=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:s,byteLength:t.byteLength},i.buffers[s]=t}let y0="KHR_draco_mesh_compression";function m2(t,e){let i=t.extensions&&t.extensions[y0];if(!i)return;let o=new ul.Decoder,s=RT(e,i.bufferView),d=new ul.Mesh;if(!o.DecodeArrayToMesh(s,s.byteLength,d))throw new Error("Failed to decode Draco mesh");let p=e.json.accessors[t.indices],_=A_[p.componentType],y=p.count*_.BYTES_PER_ELEMENT,v=ul._malloc(y);_===Uint16Array?o.GetTrianglesUInt16Array(d,y,v):o.GetTrianglesUInt32Array(d,y,v),MT(ul.memory.buffer.slice(v,v+y),p,e),ul._free(v);for(let C of Object.keys(i.attributes)){let E=o.GetAttributeByUniqueId(d,i.attributes[C]),S=e.json.accessors[t.attributes[C]],R=p2[S.componentType],O=S.count*$m[S.type]*A_[S.componentType].BYTES_PER_ELEMENT,F=ul._malloc(O);o.GetAttributeDataArrayForAllPoints(d,E,ul[R],O,F),MT(ul.memory.buffer.slice(F,F+O),S,e),ul._free(F)}o.destroy(),d.destroy(),delete t.extensions[y0]}let D_="EXT_meshopt_compression";function f2(t,e){if(!t.extensions||!t.extensions[D_])return;let i=t.extensions[D_],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),s=new Uint8Array(i.count*i.byteStride);b0.decodeGltfBuffer(s,i.count,i.byteStride,o,i.mode,i.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=s.buffer,delete t.extensions[D_]}let AT=1179937895,DT=new TextDecoder("utf8");function kT(t,e){return new URL(t,e).href}function g2(t,e,i,o){return fetch(kT(t.uri,o)).then(s=>s.arrayBuffer()).then(s=>{e.buffers[i]=s})}function RT(t,e){let i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function _2(t,e,i,o){if(t.uri){let s=kT(t.uri,o);return fetch(s).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[i]=d})}if(t.bufferView!==void 0){let s=RT(e,t.bufferView),d=new Blob([s],{type:t.mimeType});return createImageBitmap(d).then(p=>{e.images[i]=p})}}function PT(t,e=0,i){let o={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===AT){let C=new Uint32Array(t,e),E=2,S=(C[E++]>>2)-3,R=C[E++]>>2;if(E++,o.json=JSON.parse(DT.decode(C.subarray(E,E+R))),E+=R,E<S){let O=C[E++];E++;let F=e+(E<<2);o.buffers[0]=t.slice(F,F+O)}}else o.json=JSON.parse(DT.decode(new Uint8Array(t,e)));let{buffers:s,images:d,meshes:p,extensionsUsed:_,bufferViews:y}=o.json,v=Promise.resolve();if(s){let C=[];for(let E=0;E<s.length;E++){let S=s[E];S.uri?C.push(g2(S,o,E,i)):o.buffers[E]||(o.buffers[E]=null)}v=Promise.all(C)}return v.then(()=>{let C=[],E=_&&_.includes(y0),S=_&&_.includes(D_);if(E&&C.push(function(){if(!ul)return M_||(M_=function(R){let O,F=null;function V(){O=new Uint8Array(F.buffer)}function U(){throw new Error("Unexpected Draco error.")}let Z={a:{a:U,d:function(Q,K,se){return O.copyWithin(Q,K,K+se)},c:function(Q){let K=O.length,se=Math.max(Q>>>0,Math.ceil(1.2*K)),oe=Math.ceil((se-K)/65536);try{return F.grow(oe),V(),!0}catch{return!1}},b:U}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(R,Z):R.then(Q=>Q.arrayBuffer()).then(Q=>WebAssembly.instantiate(Q,Z))).then(Q=>{let{Rb:K,Qb:se,P:oe,T:de,X:_e,Ja:xe,La:Se,Qa:we,Va:ze,Wa:$e,eb:Pe,jb:He,f:De,e:je,yb:ut,zb:qe,Ab:kt,Bb:Ct,Db:Ke,Gb:ei}=Q.instance.exports;F=je;let jt=(()=>{let At=0,Qe=0,Yt=0,wi=0;return ii=>{Yt&&(K(wi),K(At),Qe+=Yt,Yt=At=0),At||(Qe+=128,At=se(Qe));let Ci=ii.length+7&-8,ai=At;Ci>=Qe&&(Yt=Ci,ai=wi=se(Ci));for(let Bi=0;Bi<ii.length;Bi++)O[ai+Bi]=ii[Bi];return ai}})();return V(),De(),{memory:je,_free:K,_malloc:se,Mesh:class{constructor(){this.ptr=oe()}destroy(){de(this.ptr)}},Decoder:class{constructor(){this.ptr=xe()}destroy(){He(this.ptr)}DecodeArrayToMesh(At,Qe,Yt){let wi=jt(At),ii=Se(this.ptr,wi,Qe,Yt.ptr);return!!_e(ii)}GetAttributeByUniqueId(At,Qe){return{ptr:we(this.ptr,At.ptr,Qe)}}GetTrianglesUInt16Array(At,Qe,Yt){ze(this.ptr,At.ptr,Qe,Yt)}GetTrianglesUInt32Array(At,Qe,Yt){$e(this.ptr,At.ptr,Qe,Yt)}GetAttributeDataArrayForAllPoints(At,Qe,Yt,wi,ii){Pe(this.ptr,At.ptr,Qe.ptr,Yt,wi,ii)}},DT_INT8:ut(),DT_UINT8:qe(),DT_INT16:kt(),DT_UINT16:Ct(),DT_UINT32:Ke(),DT_FLOAT32:ei()}})}(fetch(IT())),M_.then(R=>{ul=R,M_=void 0}))}()),S&&C.push(function(){if(b0)return;let R=function(O){let F,V=WebAssembly.instantiateStreaming(O,{}).then(Q=>{F=Q.instance,F.exports.__wasm_call_ctors()}),U={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Z={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:V,supported:!0,decodeGltfBuffer(Q,K,se,oe,de,_e){(function(xe,Se,we,ze,$e,Pe,He){let De=xe.exports.sbrk,je=ze+3&-4,ut=De(je*$e),qe=De(Pe.length),kt=new Uint8Array(xe.exports.memory.buffer);kt.set(Pe,qe);let Ct=Se(ut,ze,$e,qe,Pe.length);if(Ct===0&&He&&He(ut,je,$e),we.set(kt.subarray(ut,ut+ze*$e)),De(ut-De(0)),Ct!==0)throw new Error(`Malformed buffer data: ${Ct}`)})(F,F.exports[Z[de]],Q,K,se,oe,F.exports[U[_e]])}}}(fetch(ST()));return R.ready.then(()=>{b0=R})}()),d)for(let R=0;R<d.length;R++)C.push(_2(d[R],o,R,i));return(C.length?Promise.all(C):Promise.resolve()).then(()=>{if(E&&p)for(let{primitives:R}of p)for(let O of R)m2(O,o);if(S&&p&&y)for(let R of y)f2(R,o);return o})})}class OT{constructor(e,i,o){if(this.triangleCount=i.length/3,this.min=new dt(0,0),this.max=new dt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||o===0)return;let s=e.map(C=>C.x),d=e.map(C=>C.y);this.min=new dt(Math.min(...s),Math.min(...d)),this.max=new dt(Math.max(...s),Math.max(...d));let p=this.max.sub(this.min);p.x=Math.max(p.x,1),p.y=Math.max(p.y,1);let _=Math.max(p.x,p.y)/o;this.cellsX=Math.max(1,Math.ceil(p.x/_)),this.cellsY=Math.max(1,Math.ceil(p.y/_)),this.xScale=1/_,this.yScale=1/_;let y=[];for(let C=0;C<this.triangleCount;C++){let E=e[i[3*C+0]].sub(this.min),S=e[i[3*C+1]].sub(this.min),R=e[i[3*C+2]].sub(this.min),O=hd(Math.floor(Math.min(E.x,S.x,R.x)),this.xScale,this.cellsX),F=hd(Math.floor(Math.max(E.x,S.x,R.x)),this.xScale,this.cellsX),V=hd(Math.floor(Math.min(E.y,S.y,R.y)),this.yScale,this.cellsY),U=hd(Math.floor(Math.max(E.y,S.y,R.y)),this.yScale,this.cellsY),Z=new dt(0,0),Q=new dt(0,0),K=new dt(0,0),se=new dt(0,0);for(let oe=V;oe<=U;++oe){Z.y=Q.y=oe*_,K.y=se.y=(oe+1)*_;for(let de=O;de<=F;++de)Z.x=K.x=de*_,Q.x=se.x=(de+1)*_,(py(E,S,R,Z,Q,se)||py(E,S,R,Z,se,K))&&y.push({cellIdx:oe*this.cellsX+de,triIdx:C})}}if(y.length===0)return;y.sort((C,E)=>C.cellIdx-E.cellIdx||C.triIdx-E.triIdx);let v=0;for(;v<y.length;){let C=y[v].cellIdx,E={start:this.payload.length,len:0};for(;v<y.length&&y[v].cellIdx===C;)++E.len,this.payload.push(y[v++].triIdx);this.cells[C]=E}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let y=0;y<this.lookup.length;y++)this.lookup[y]=0;let s=hd(e.x-this.min.x,this.xScale,this.cellsX),d=hd(i.x-this.min.x,this.xScale,this.cellsX),p=hd(e.y-this.min.y,this.yScale,this.cellsY),_=hd(i.y-this.min.y,this.yScale,this.cellsY);for(let y=p;y<=_;y++)for(let v=s;v<=d;v++){let C=this.cells[y*this.cellsX+v];if(C)for(let E=0;E<C.len;E++){let S=this.payload[C.start+E],R=Math.floor(S/8),O=1<<S%8;if(!(this.lookup[R]&O)&&(this.lookup[R]|=O,o.push(S),o.length===this.triangleCount))return}}}}function hd(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}function bu(t,e){let i=t.json.bufferViews[e.bufferView],o=A_[e.componentType];return new o(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==$m[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:$m[e.type]))}function v0(t,e,i,o){let s=A_[e.componentType],d=function(C){switch(C){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(s),p=t.json.bufferViews[e.bufferView],_=p.byteStride?p.byteStride/s.BYTES_PER_ELEMENT:$m[e.type],y=i.float32,v=y.length/i.capacity;for(let C=0,E=0;C<e.count*_;C+=_,E+=v)for(let S=0;S<v;S++)y[E+S]=o[C+S]*d;i._trim()}function b2(t,e,i){let o=t.indices,s=t.attributes,d={};d.indexArray=new Kr;let p=e.json.accessors[o],_=p.count/3;d.indexArray.reserve(_);let y=bu(e,p);for(let S=0;S<_;S++)d.indexArray.emplaceBack(y[3*S],y[3*S+1],y[3*S+2]);d.indexArray._trim(),d.vertexArray=new wc;let v=e.json.accessors[s.POSITION];d.vertexArray.reserve(v.count);let C=bu(e,v);for(let S=0;S<v.count;S++)d.vertexArray.emplaceBack(C[3*S],C[3*S+1],C[3*S+2]);if(d.vertexArray._trim(),d.aabb=new mr(v.min,v.max),d.centroid=function(S,R){let O=[0,0,0],F=S.length;if(F>0){for(let V=0;V<F;V++){let U=3*S[V];O[0]+=R[U],O[1]+=R[U+1],O[2]+=R[U+2]}O[0]/=F,O[1]/=F,O[2]/=F}return O}(y,C),s.COLOR_0!==void 0){let S=e.json.accessors[s.COLOR_0],R=$m[S.type],O=bu(e,S);d.colorArray=R===3?new wc:new Gl,d.colorArray.resize(S.count),v0(e,S,d.colorArray,O)}if(s.NORMAL!==void 0){d.normalArray=new wc;let S=e.json.accessors[s.NORMAL];d.normalArray.resize(S.count);let R=bu(e,S);v0(e,S,d.normalArray,R)}if(s.TEXCOORD_0!==void 0&&i.length>0){d.texcoordArray=new ou;let S=e.json.accessors[s.TEXCOORD_0];d.texcoordArray.resize(S.count);let R=bu(e,S);v0(e,S,d.texcoordArray,R)}if(s._FEATURE_ID_RGBA4444!==void 0){let S=e.json.accessors[s._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=bu(e,S))}s._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(bu(e,e.json.accessors[s._FEATURE_RGBA4444]).buffer));let E=t.material;return d.material=function(S,R){let{emissiveFactor:O=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:V=.5,normalTexture:U,occlusionTexture:Z,emissiveTexture:Q,doubleSided:K}=S,{baseColorFactor:se=[1,1,1,1],metallicFactor:oe=1,roughnessFactor:de=1,baseColorTexture:_e,metallicRoughnessTexture:xe}=S.pbrMetallicRoughness||{},Se=Z?R[Z.index]:void 0;if(Z&&Z.extensions&&Z.extensions.KHR_texture_transform&&Se){let we=Z.extensions.KHR_texture_transform;Se.offsetScale=[we.offset[0],we.offset[1],we.scale[0],we.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new hr(...se),metallicFactor:oe,roughnessFactor:de,baseColorTexture:_e?R[_e.index]:void 0,metallicRoughnessTexture:xe?R[xe.index]:void 0},doubleSided:K,emissiveFactor:O,alphaMode:F,alphaCutoff:V,normalTexture:U?R[U.index]:void 0,occlusionTexture:Se,emissionTexture:Q?R[Q.index]:void 0,defined:S.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},i),d}function FT(t,e,i){let{matrix:o,rotation:s,translation:d,scale:p,mesh:_,extras:y,children:v}=t,C={};if(C.matrix=o||r.a6.fromRotationTranslationScale([],s||[0,0,0,1],d||[0,0,0],p||[1,1,1]),_!==void 0){C.meshes=i[_];let E=C.anchor=[0,0];for(let S of C.meshes){let{min:R,max:O}=S.aabb;E[0]+=R[0]+O[0],E[1]+=R[1]+O[1]}E[0]=Math.floor(E[0]/C.meshes.length/2),E[1]=Math.floor(E[1]/C.meshes.length/2)}if(y&&(y.id&&(C.id=y.id),y.lights&&(C.lights=function(E){if(!E.length)return[];let S=function(U){let Z=atob(U),Q=new Uint8Array(Z.length);for(let K=0;K<Z.length;K++)Q[K]=Z.codePointAt(K);return Q}(E),R=[],O=S.length/24,F=new Uint16Array(S.buffer),V=new Float32Array(S.buffer);for(let U=0;U<O;U++){let Z=F[2*U*6]/30,Q=F[2*U*6+1]/30,K=F[2*U*6+10]/100,se=V[6*U+1],oe=V[6*U+2],de=V[6*U+3],_e=V[6*U+4],xe=de-se,Se=_e-oe,we=Math.hypot(xe,Se);R.push({pos:[se+.5*xe,oe+.5*Se,Q],normal:[Se/we,-xe/we,0],width:we,height:Z,depth:K,points:[se,oe,de,_e]})}return R}(y.lights))),v){let E=[];for(let S of v)E.push(FT(e.json.nodes[S],e,i));C.children=E}return C}function y2(t){if(t.vertices.length===0||t.indices.length===0)return null;let[e,i]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let p=1;p<t.vertices.length;++p){let _=t.vertices[p];e.x=Math.min(e.x,_.x),e.y=Math.min(e.y,_.y),i.x=Math.max(i.x,_.x),i.y=Math.max(i.y,_.y)}let o=Math.ceil(Math.max(i.x-e.x,i.y-e.y)/256),s=Math.max(8,o),d=new OT(t.vertices,t.indices,s);return{vertices:t.vertices,indices:t.indices,grid:d,min:e,max:i}}function v2(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;let o=[];for(let p of i){if(!Array.isArray(p)||p.length!==2)continue;let _=p[0],y=p[1];typeof _=="number"&&typeof y=="number"&&o.push(new dt(_,y))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let s=0;for(let p=0;p<o.length;p++){let _=o[p],y=o[(p+1)%o.length],v=o[(p+2)%o.length];s+=(_.x-y.x)*(v.y-y.y)-(v.x-y.x)*(_.y-y.y)}s>0&&o.reverse();let d=Kg(o.flatMap(p=>[p.x,p.y]),[]);return d.length===0?null:{vertices:o,indices:d}}function x2(t){let e=[],i=[],o=0;for(let s of t){o=e.length;let d=s.vertexArray.float32,p=s.indexArray.uint16;for(let _=0;_<s.vertexArray.length;_++)e.push(new dt(d[3*_+0],d[3*_+1]));for(let _=0;_<3*s.indexArray.length;_++)i.push(p[_]+o)}if(i.length%3!=0)return null;for(let s=0;s<i.length;s+=3){let d=e[i[s+0]],p=e[i[s+1]],_=e[i[s+2]];(d.x-p.x)*(_.y-p.y)-(_.x-p.x)*(d.y-p.y)>0&&([i[s+1],i[s+2]]=[i[s+2],i[s+1]])}return{vertices:e,indices:i}}function LT(t){let e=function(y,v){let C=[],E=WebGL2RenderingContext;if(y.json.textures)for(let S of y.json.textures){let R={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};S.sampler!==void 0&&Object.assign(R,y.json.samplers[S.sampler]),C.push({image:v[S.source],sampler:R,uploaded:!1})}return C}(t,t.images),i=function(y,v){let C=[];for(let E of y.json.meshes){let S=[];for(let R of E.primitives)S.push(b2(R,y,v));C.push(S)}return C}(t,e),{scenes:o,scene:s,nodes:d}=t.json,p=o?o[s||0].nodes:d,_=[];for(let y of p)_.push(FT(d[y],t,i));return function(y,v,C){let E={},S=new Set;for(let R=0;R<y.length;R++){let O=C[v[R]];if(!O.extras)continue;let F=O.extras["mapbox:footprint:version"],V=O.extras["mapbox:footprint:id"];(F||V)&&S.add(R),F==="1.0.0"&&V&&(E[V]=R)}for(let R=0;R<y.length;R++){if(S.has(R))continue;let O=y[R],F=C[v[R]];if(!F.extras)continue;let V=null;O.id in E&&(V=x2(y[E[O.id]].meshes)),V||(V=v2(F)),V&&(O.footprint=y2(V))}if(S.size>0){let R=Array.from(S.values()).sort((O,F)=>O-F);for(let O=R.length-1;O>=0;O--)y.splice(R[O],1)}}(_,p,t.json.nodes),_}function w2(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,i=t.aabb.min[0]-1,o=t.aabb.min[1]-1,s=_u/(t.aabb.max[0]-i+2),d=_u/(t.aabb.max[1]-o+2);for(let p=0;p<e.length;p+=3){let _=e[p+2],y=(e[p+0]-i)*s|0,v=(e[p+1]-o)*d|0;_>t.heightmap[v*_u+y]&&(t.heightmap[v*_u+y]=_)}}function C2(t,e){let i={};i.indexArray=new Kr,i.indexArray.reserve(4*t.length),i.vertexArray=new wc,i.vertexArray.reserve(10*t.length),i.colorArray=new Gl,i.vertexArray.reserve(10*t.length);let o=0;for(let p of t){let _=Math.min(10,Math.max(4,1.3*p.height))*e,y=[-p.normal[1],p.normal[0],0],v=Math.min(.29,.1*p.width/p.depth),C=p.width-2*p.depth*e*(v+.01),E=r.N.scaleAndAdd([],p.pos,y,C/2),S=r.N.scaleAndAdd([],p.pos,y,-C/2),R=[E[0],E[1],E[2]+p.height],O=[S[0],S[1],S[2]+p.height],F=r.N.scaleAndAdd([],p.normal,y,v);r.N.scale(F,F,_);let V=r.N.scaleAndAdd([],p.normal,y,-v);r.N.scale(V,V,_),r.N.add(F,E,F),r.N.add(V,S,V),E[2]+=.1,S[2]+=.1,i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack(V[0],V[1],V[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(S[0],S[1],S[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(S[0],S[1],S[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack(V[0],V[1],V[2]);let U=C/_/2;i.colorArray.emplaceBack(-U-v,-1,U,.8),i.colorArray.emplaceBack(U+v,-1,U,.8),i.colorArray.emplaceBack(-U,0,U,1.3),i.colorArray.emplaceBack(U,0,U,1.3),i.colorArray.emplaceBack(U+v,-.8,U,.7),i.colorArray.emplaceBack(U+v,-.8,U,.7),i.colorArray.emplaceBack(0,0,U,1.3),i.colorArray.emplaceBack(0,0,U,1.3),i.colorArray.emplaceBack(U+v,-1.2,U,.8),i.colorArray.emplaceBack(U+v,-1.2,U,.8),i.indexArray.emplaceBack(6+o,4+o,8+o),i.indexArray.emplaceBack(7+o,9+o,5+o),i.indexArray.emplaceBack(0+o,1+o,2+o),i.indexArray.emplaceBack(1+o,3+o,2+o),o+=10}let s={defined:!0,emissiveFactor:[0,0,0]},d={};return d.baseColorFactor=hr.white,s.pbrMetallicRoughness=d,i.material=s,i.aabb=new mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}Et(OT,"TriangleGridIndex");class zT{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){let o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let T2=["tile","layer","source","sourceLayer","state"];class NT{constructor(e,i,o,s,d){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=s,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let i of T2)this[i]!==void 0&&(e[i]=this[i]);return e}}class BT{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new il(mt,16,0),this.featureIndexArray=new Ag,this.promoteId=i,this.is3DTile=!1}insert(e,i,o,s,d,p=0,_=0){let y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,s,d,p);let v=this.grid;for(let C=0;C<i.length;C++){let E=i[C],S=[1/0,1/0,-1/0,-1/0];for(let R=0;R<E.length;R++){let O=E[R];S[0]=Math.min(S[0],O.x),S[1]=Math.min(S[1],O.y),S[2]=Math.max(S[2],O.x),S[3]=Math.max(S[3],O.y)}_!==0&&(S[0]-=_,S[1]-=_,S[2]+=_,S[3]+=_),S[0]<mt&&S[1]<mt&&S[2]>=0&&S[3]>=0&&v.insert(y,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new qy(new Ph(this.rawTileData)).layers,this.sourceLayerCoder=new zT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,o,s){this.loadVTLayers();let d=e.params||{},p=wa(d.filter),_=e.tileResult,y=e.transform,v=_.bufferedTilespaceBounds,C=this.grid.query(v.min.x,v.min.y,v.max.x,v.max.y,(O,F,V,U)=>a1(_.bufferedTilespaceGeometry,O,F,V,U));C.sort(E2);let E=null;y.elevation&&C.length>0&&(E=Mh.create(y.elevation,this.tileID));let S={},R;for(let O=0;O<C.length;O++){let F=C[O];if(F===R)continue;R=F;let V=this.featureIndexArray.get(F),U=null;if(this.is3DTile){let Z=this.bucketLayerIDs[0][0],Q=i[Z];if(Q.type!=="model")continue;let{queryFeature:K,intersectionZ:se}=Q.queryIntersectsMatchingFeature(_,V.featureIndex,p,y);K&&this.appendToResult(S,Z,V.featureIndex,K,se)}else this.loadMatchingFeature(S,V,p,d.layers,d.availableImages,i,o,s,(Z,Q,K,se=0)=>(U||(U=Jr(Z,this.tileID.canonical,e.tileTransform)),Q.queryIntersectsFeature(_,Z,K,U,this.z,e.transform,e.pixelPosMatrix,E,se)))}return S}loadMatchingFeature(e,i,o,s,d,p,_,y,v){let{featureIndex:C,bucketIndex:E,sourceLayerIndex:S,layoutVertexArrayOffset:R}=i,O=this.bucketLayerIDs[E];if(s&&!function(Z,Q){for(let K=0;K<Z.length;K++)if(Q.indexOf(Z[K])>=0)return!0;return!1}(s,O))return;let F=this.sourceLayerCoder.decode(S),V=this.vtLayers[F].feature(C);if(o.needGeometry){let Z=Vr(V,!0);if(!o.filter(new nr(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!o.filter(new nr(this.tileID.overscaledZ),V))return;let U=this.getId(V,F);for(let Z=0;Z<O.length;Z++){let Q=O[Z];if(s&&s.indexOf(Q)<0)continue;let K=p[Q];if(!K)continue;let se={};U!==void 0&&y&&(se=y.getState(K.sourceLayer||"_geojsonTileLayer",U));let oe=!v||v(V,K,se,R);if(!oe)continue;let de=new NT(V,this.z,this.x,this.y,U),_e=Gr({},_[Q]);_e.paint=VT(_e.paint,K.paint,V,se,d),_e.layout=VT(_e.layout,K.layout,V,se,d),de.layer=_e,this.appendToResult(e,Q,C,de,oe)}}appendToResult(e,i,o,s,d){let p=e[i];p===void 0&&(p=e[i]=[]),p.push({featureIndex:o,feature:s,intersectionZ:d})}lookupSymbolFeatures(e,i,o,s,d,p,_,y){let v={};this.loadVTLayers();let C=wa(d);for(let E of e)this.loadMatchingFeature(v,{bucketIndex:o,sourceLayerIndex:s,featureIndex:E,layoutVertexArrayOffset:0},C,p,_,y,i);return v}loadFeature(e){let{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();let s=this.sourceLayerCoder.decode(o),d=this.vtFeatures[s];if(d[i])return d[i];let p=this.vtLayers[s].feature(i);return d[i]=p,p}hasLayer(e){for(let i of this.bucketLayerIDs)for(let o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){let s=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];s!=null&&(o=e.properties[s]),typeof o=="boolean"&&(o=Number(o))}return o}}function VT(t,e,i,o,s){return Bn(t,(d,p)=>{let _=e instanceof Wd?e.get(p):null;return _&&_.evaluate?_.evaluate(i,o,s):_})}function E2(t,e){return e-t}Et(BT,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let x0=new Float32Array(262144),yu=new Uint8Array(262144);function jT(t){let e=0;if(t.meshes)for(let i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(let i of t.children)e=Math.max(e,jT(i));return e}function UT(t,e,i){if(t.meshes)for(let o of t.meshes)o.aabb.min[0]!==1/0&&i.insert(e,o.aabb.min[0],o.aabb.min[1],o.aabb.max[0],o.aabb.max[1]);if(t.children)for(let o of t.children)UT(o,e,i)}let GT=["","wall","door","roof","window","lamp","logo"];class HT{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:jT(e)}}}getLocalBounds(){if(!this.node.meshes)return new mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,i=new mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let o of this.node.meshes)this.node.lightMeshIndex!==e&&i.encapsulate(o.aabb),e++;this.aabb=i}return this.aabb}}class k_{constructor(e,i,o,s,d,p){this.id=i,this.modelTraits|=Nh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,o&&(this.modelTraits|=Nh.HasMapboxMeshFeatures),s&&(this.modelTraits|=Nh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=d,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let _ of e)this.nodesInfo.push(new HT(_)),UT(_,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let i=this.getNodesInfo();for(let o of i){let s=o.node;this.uploaded?this.updatePbrBuffer(s):p0(s,e,!0)}for(let o of i)I_(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(let o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){let s=e.transform.projectionOptions,d=e.style.getBrightness(),p=this.brightness!==d;return!!(!this.uploaded||this.dirty||s.name!==this.projection.name||qm(o.paint.get("model-color").value,p)||qm(o.paint.get("model-color-mix-intensity").value,p)||qm(o.paint.get("model-roughness").value,p)||qm(o.paint.get("model-emissive-strength").value,p)||qm(o.paint.get("model-height-based-emissive-strength-multiplier").value,p))&&(this.projection=s,this.brightness=d,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let o=this.getNodesInfo(),s=this.id.canonical;for(let d of o){let p=d.feature;d.evaluatedScale=i.paint.get("model-scale").evaluate(p,{},s)}}evaluate(e){let i=this.getNodesInfo();for(let o of i){if(!o.node.meshes)continue;let s=o.feature,d=o.node.meshes&&o.node.meshes[0].featureData,p=o.evaluatedColor[2],_=o.evaluatedRMEA[2],y=this.id.canonical;if(o.hasTranslucentParts=!1,d){for(let v=0;v<GT.length;v++){let C=GT[v];C.length&&(s.properties.part=C);let E=e.paint.get("model-color").evaluate(s,{},y),S=e.paint.get("model-color-mix-intensity").evaluate(s,{},y);o.evaluatedColor[v]=[E.r,E.g,E.b,S],o.evaluatedRMEA[v][0]=e.paint.get("model-roughness").evaluate(s,{},y),o.evaluatedRMEA[v][2]=e.paint.get("model-emissive-strength").evaluate(s,{},y),o.evaluatedRMEA[v][3]=E.a,o.emissionHeightBasedParams[v]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(s,{},y),!o.hasTranslucentParts&&E.a<1&&(o.hasTranslucentParts=!0)}delete s.properties.part,S2(o,p!==o.evaluatedColor[2]||_!==o.evaluatedRMEA[2],this.modelTraits)}else o.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(s,{},y);o.evaluatedScale=e.paint.get("model-scale").evaluate(s,{},y),this.updatePbrBuffer(o.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,s){let d=e.findDEMTileFor(o);if(d&&(d.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;let p=Mh.create(e,o,d);if(!p)return;this.modelTraits&Nh.HasMapboxMeshFeatures&&this.updateDEM(e,p,o,s);for(let _ of this.getNodesInfo()){let y=_.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let v=y.footprint.vertices,C=p.getElevationAt(v[0].x,v[0].y,!0,!0);for(let E=1;E<v.length;E++)C=Math.min(C,p.getElevationAt(v[E].x,v[E].y,!0,!0));y.elevation=C}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,s){let d=i._dem._modifiedForSources[s];if(d===void 0&&(i._dem._modifiedForSources[s]=[],d=i._dem._modifiedForSources[s]),d.includes(o.canonical))return;let p=i._dem.dim;d.push(o.canonical);let _=!1;for(let y of this.getNodesInfo()){let v=y.node;if(!v.footprint||!v.footprint.grid)continue;let C=v.footprint.grid,E=i.tileCoordToPixel(C.min.x,C.min.y),S=i.tileCoordToPixel(C.max.x,C.max.y),R=Math.min(Math.min(p-S.y,E.x),Math.min(E.y,p-S.x));if(R<0)continue;let O=gi(R,2,5),F=Math.max(0,E.x-O),V=Math.max(0,E.y-O),U=Math.min(S.x+O,p-1),Z=Math.min(S.y+O,p-1);for(let oe=V;oe<=Z;++oe)for(let de=F;de<=U;++de)yu[oe*p+de]=255;let Q=0,K=0;for(let oe=0;oe<C.cellsY;++oe)for(let de=0;de<C.cellsX;++de){if(!C.cells[oe*C.cellsX+de])continue;let _e=i.tileCoordToPixel(C.min.x+de/C.xScale,C.min.y+oe/C.yScale),xe=i.tileCoordToPixel(C.min.x+(de+1)/C.xScale,C.min.y+(oe+1)/C.yScale);for(let Se=_e.y;Se<=Math.min(xe.y+1,p-1);++Se)for(let we=_e.x;we<=Math.min(xe.x+1,p-1);++we)yu[Se*p+we]===255&&(yu[Se*p+we]=0,Q+=i.getElevationAtPixel(we,Se),K++)}let se=Q/K;F=Math.max(1,E.x-O),V=Math.max(1,E.y-O),U=Math.min(S.x+O,p-2),Z=Math.min(S.y+O,p-2),_=!0;for(let oe=V;oe<=Z;++oe)for(let de=F;de<=U;++de)yu[oe*p+de]===0&&(x0[oe*p+de]=i._dem.set(de,oe,se));for(let oe=1;oe<O;++oe){F=Math.max(1,E.x-oe),V=Math.max(1,E.y-oe),U=Math.min(S.x+oe,p-2),Z=Math.min(S.y+oe,p-2);for(let de=V;de<=Z;++de)for(let _e=F;_e<=U;++_e){let xe=de*p+_e;if(yu[xe]===255){let Se=0,we=0,ze=-1,$e=-1;for(let Pe=-1;Pe<=1;++Pe)for(let He=-1;He<=1;++He){let De=(de+Pe)*p+_e+He;if(yu[De]>=oe)continue;let je=x0[De],ut=Math.abs(je);ut>we&&(Se=je,we=ut,ze=He,$e=Pe)}if(we>.1){let Pe=1-(oe+.5*Math.abs(ze*$e))/O,He=i._dem.get(_e,de)+Se*Pe,De=i._dem.get(_e+ze,de+$e),je=i._dem.get(_e-ze,de-$e,!0);(He-De)*(He-je)>0&&(He=(De+je)/2),x0[xe]=i._dem.set(_e,de,He),yu[xe]=oe}}}}}_&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=et.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let i of e)I_(i.node),m0(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;let o=i.getReplacementRegionsForTile(e.toUnwrapped()),s=this.getNodesInfo();for(let d=0;d<this.nodesInfo.length;d++){let p=s[d].node;s[d].hiddenByReplacement=!!p.footprint&&!o.find(_=>_.footprint===p.footprint)}}getHeightAtTileCoord(e,i){let o=this.getNodesInfo(),s=[];for(let d=0;d<this.nodesInfo.length;d++){let p=o[d],_=p.node.meshes[0];if(e<_.aabb.min[0]||i<_.aabb.min[1]||e>_.aabb.max[0]||i>_.aabb.max[1])continue;let y=(e-_.aabb.min[0])/(_.aabb.max[0]-_.aabb.min[0])*_u|0,v=Math.min(63,(i-_.aabb.min[1])/(_.aabb.max[1]-_.aabb.min[1])*_u|0)*_u+Math.min(63,y);if(!(_.heightmap[v]<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:_.heightmap[v],maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new dt(e,i),new dt(e,i),s),s.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function qm(t,e){return!t.isLightConstant&&e}function I2(t,e,i,o,s,d,p,_){let y=(61440&e|(61440&e)>>4)>>8,v=(3840&e|(3840&e)>>4)>>4,C=240&e|(240&e)>>4;i[3]>0&&(y=Ai(y,255*i[0],i[3]),v=Ai(v,255*i[1],i[3]),C=Ai(C,255*i[2],i[3]));let E=y<<8|v,S=C<<8|Math.floor(255*o[3]),R=function(oe){let de=gi(oe,0,2);return Math.min(Math.round(.5*de*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],O=gi(s[0],0,1),F=gi(s[1],0,1),V=gi(s[2],0,1),U=gi(s[3],0,1),Z,Q,K,se;if(O!==F&&p!==d&&F!==O){let oe=p-d;Q=1/(oe*(F-O)),K=-(d+oe*O)/(oe*(F-O));let de=gi(s[4],-1,1);se=Math.pow(10,de),Z=255*V<<8|255*U}else Z=65535,Q=0,K=1,se=1;if(t.emplaceBack(E,S,R,Z,Q,K,se),_){let oe=_.length;_.clear();for(let de=0;de<oe;de++)_.emplaceBack(E,S,R,Z,Q,K,se)}}function S2(t,e,i){let o=t.node,s=0,d=i&Nh.HasMeshoptCompression;for(let p of o.meshes){if(o.lights&&o.lightMeshIndex===s||!p.featureData)continue;p.featureArray=new au,p.featureArray.reserve(p.featureData.length);let _=e;for(let y of p.featureData){let v=d?65535&y:y>>16&65535,C=d?y>>16&65535:65535&y,E=(15&C)<8?15&C:0,S=t.evaluatedRMEA[E],R=t.evaluatedColor[E],O=t.emissionHeightBasedParams[E],F;if(_&&E===2&&o.lights&&(F=new au,F.resize(10*o.lights.length)),I2(p.featureArray,v,R,S,O,p.aabb.min[2],p.aabb.max[2],F),F&&_){_=!1;let V=o.meshes[o.lightMeshIndex];V.featureArray=F,V.featureArray._trim()}}p.featureArray._trim(),s++}}function $T(t,e,i,o){let s=1<<t.z;e.lat=Ui((o/mt+t.y)/s),e.lng=li((i/mt+t.x)/s)}Et(k_,"Tiled3dModelBucket",{omit:["layers"]}),Et(HT,"Tiled3dModelFeature");let M2={circle:class extends aa{constructor(t,e,i){super(t,vA,e,i)}createBucket(t){return new ca(t)}queryRadius(t){let e=t;return Eh("circle-radius",this,e)+Eh("circle-stroke-width",this,e)+Ng(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,o,s,d,p,_){let y=l1(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),v=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Fw(t,o,d,p,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,v)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){let i=Ow(this);return{config:new B(this,e),defines:i,overrideFog:!1}}},heatmap:class extends aa{createBucket(t){return new zw(t)}constructor(t,e,i){super(t,KA,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Em({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Eh("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,o,s,d,p,_){let y=this.paint.get("heatmap-radius").evaluate(e,i);return Fw(t,o,d,p,_,!0,!0,new dt(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new B(this,e),overrideFog:!1}:{}}},hillshade:class extends aa{constructor(t,e,i){super(t,JA,e,i)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends aa{constructor(t,e,i){super(t,pD,e,i)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e){return{config:new B(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new $y(t)}queryRadius(){return Ng(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,o,s,d){return!t.queryGeometry.isAboveHorizon&&Cc(s1(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends aa{constructor(t,e,i){super(t,jD,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new r_(t)}queryRadius(){return Ng(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,i,o,s,d,p,_,y){let v=l1(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(e,i),E=this.paint.get("fill-extrusion-base").evaluate(e,i),S=[0,0],R=_&&d.elevation,O=d.elevation?d.elevation.exaggeration():1,F=t.tile.getBucket(this);if(R&&F instanceof r_){let K=F.centroidVertexArray,se=y+1;se<K.length&&(S[0]=K.geta_centroid_pos0(se),S[1]=K.geta_centroid_pos1(se))}if(S[0]===0&&S[1]===1)return!1;d.projection.name==="globe"&&(o=bC([o],[new dt(0,0),new dt(mt,mt)],t.tileID.canonical).map(K=>K.polygon).flat());let V=R?_:null,[U,Z]=function(K,se,oe,de,_e,xe,Se,we,ze,$e,Pe){return K.projection.name==="globe"?function(He,De,je,ut,qe,kt,Ct,Ke,ei,jt,At){let Qe=[],Yt=[],wi=He.projection.upVectorScale(At,He.center.lat,He.worldSize).metersToTile,ii=[0,0,0,1],Ci=[0,0,0,1],ai=(di,Dn,Xi,tn)=>{di[0]=Dn,di[1]=Xi,di[2]=tn,di[3]=1},Bi=_C();je>0&&(je+=Bi),ut+=Bi;for(let di of De){let Dn=[],Xi=[];for(let tn of di){let un=tn.x+qe.x,Ki=tn.y+qe.y,Jn=He.projection.projectTilePoint(un,Ki,At),Cn=He.projection.upVector(At,tn.x,tn.y),vr=je,$r=ut;if(Ct){let yo=vC(un,Ki,je,ut,Ct,Ke,ei,jt);vr+=yo.base,$r+=yo.top}je!==0?ai(ii,Jn.x+Cn[0]*wi*vr,Jn.y+Cn[1]*wi*vr,Jn.z+Cn[2]*wi*vr):ai(ii,Jn.x,Jn.y,Jn.z),ai(Ci,Jn.x+Cn[0]*wi*$r,Jn.y+Cn[1]*wi*$r,Jn.z+Cn[2]*wi*$r),r.N.transformMat4(ii,ii,kt),r.N.transformMat4(Ci,Ci,kt),Dn.push(new Ah(ii[0],ii[1],ii[2])),Xi.push(new Ah(Ci[0],Ci[1],Ci[2]))}Qe.push(Dn),Yt.push(Xi)}return[Qe,Yt]}(K,se,oe,de,_e,xe,Se,we,ze,$e,Pe):Se?function(He,De,je,ut,qe,kt,Ct,Ke,ei){let jt=[],At=[],Qe=[0,0,0,1];for(let Yt of He){let wi=[],ii=[];for(let Ci of Yt){let ai=Ci.x+ut.x,Bi=Ci.y+ut.y,di=vC(ai,Bi,De,je,kt,Ct,Ke,ei);Qe[0]=ai,Qe[1]=Bi,Qe[2]=di.base,Qe[3]=1,r.a7.transformMat4(Qe,Qe,qe),Qe[3]=Math.max(Qe[3],1e-5);let Dn=new Ah(Qe[0]/Qe[3],Qe[1]/Qe[3],Qe[2]/Qe[3]);Qe[0]=ai,Qe[1]=Bi,Qe[2]=di.top,Qe[3]=1,r.a7.transformMat4(Qe,Qe,qe),Qe[3]=Math.max(Qe[3],1e-5);let Xi=new Ah(Qe[0]/Qe[3],Qe[1]/Qe[3],Qe[2]/Qe[3]);wi.push(Dn),ii.push(Xi)}jt.push(wi),At.push(ii)}return[jt,At]}(se,oe,de,_e,xe,Se,we,ze,$e):function(He,De,je,ut,qe){let kt=[],Ct=[],Ke=qe[8]*De,ei=qe[9]*De,jt=qe[10]*De,At=qe[11]*De,Qe=qe[8]*je,Yt=qe[9]*je,wi=qe[10]*je,ii=qe[11]*je;for(let Ci of He){let ai=[],Bi=[];for(let di of Ci){let Dn=di.x+ut.x,Xi=di.y+ut.y,tn=qe[0]*Dn+qe[4]*Xi+qe[12],un=qe[1]*Dn+qe[5]*Xi+qe[13],Ki=qe[2]*Dn+qe[6]*Xi+qe[14],Jn=qe[3]*Dn+qe[7]*Xi+qe[15],Cn=tn+Ke,vr=un+ei,$r=Ki+jt,yo=Math.max(Jn+At,1e-5),Yn=tn+Qe,sr=un+Yt,ro=Ki+wi,oo=Math.max(Jn+ii,1e-5);ai.push(new Ah(Cn/yo,vr/yo,$r/yo)),Bi.push(new Ah(Yn/oo,sr/oo,ro/oo))}kt.push(ai),Ct.push(Bi)}return[kt,Ct]}(se,oe,de,_e,xe)}(d,o,E,C,v,p,V,S,O,d.center.lat,t.tileID.canonical),Q=t.queryGeometry;return function(K,se,oe){let de=1/0;Cc(oe,se)&&(de=yC(oe,se[0]));for(let _e=0;_e<se.length;_e++){let xe=se[_e],Se=K[_e];for(let we=0;we<xe.length-1;we++){let ze=xe[we],$e=[ze,xe[we+1],Se[we+1],Se[we],ze];xs(oe,$e)&&(de=Math.min(de,yC(oe,$e)))}}return de!==1/0&&de}(U,Z,Q.isPointQuery()?Q.screenBounds:Q.screenGeometry)}},line:class extends aa{constructor(t,e,i){super(t,wC,e,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Oa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=MC.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Zy(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){let i=IC(this);return{config:new B(this,e),defines:i,overrideFog:!1}}queryRadius(t){let e=t,i=AC(Eh("line-width",this,e),Eh("line-gap-width",this,e)),o=Eh("line-offset",this,e);return i/2+Math.abs(o)+Ng(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,o,s,d){if(t.queryGeometry.isAboveHorizon)return!1;let p=s1(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),_=t.pixelToTileUnitsFactor/2*AC(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),y=this.paint.get("line-offset").evaluate(e,i);return y&&(o=function(v,C){let E=[],S=new dt(0,0);for(let R=0;R<v.length;R++){let O=v[R],F=[];for(let V=0;V<O.length;V++){let U=O[V],Z=O[V+1],Q=V===0?S:U.sub(O[V-1])._unit()._perp(),K=V===O.length-1?S:Z.sub(U)._unit()._perp(),se=Q._add(K)._unit();se._mult(1/(se.x*K.x+se.y*K.y)),F.push(se._mult(C)._add(U))}E.push(F)}return E}(o,y*t.pixelToTileUnitsFactor)),function(v,C,E){for(let S=0;S<C.length;S++){let R=C[S];if(v.length>=3){for(let O=0;O<R.length;O++)if(al(v,R[O]))return!0}if(uu(v,R,E))return!0}return!1}(p,o,_)}isTileClipped(){return!0}},symbol:v_,background:class extends aa{constructor(t,e,i){super(t,Hk,e,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:mT,"raster-particle":fT,sky:class extends aa{constructor(t,e,i){super(t,Qk,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Em({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let o=this.paint.get("sky-atmosphere-sun"),s=!o,d=t.style.light,p=d.properties.get("position");return s&&d.properties.get("anchor")==="viewport"&&er("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),s?d0(p.azimuthal,90-p.polar,e):d0(o[0],90-o[1],e)}let i=this.paint.get("sky-gradient-center");return d0(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends aa{constructor(t,e,i){super(t,Jk,e)}},model:class extends aa{constructor(t,e,i){super(t,l2,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new h0(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof k_?mt-1:0}queryIntersectsFeature(t,e,i,o,s,d){if(!this.modelManager)return!1;let p=this.modelManager,_=t.tile.getBucket(this);if(!(_&&_ instanceof h0))return!1;let y=_;for(let v in y.instancesPerModel){let C=y.instancesPerModel[v];if(C.idToFeaturesIndex.hasOwnProperty(e.id)){let E=C.features[C.idToFeaturesIndex[e.id]],S=p.getModel(v,this.scope);if(!S)return!1;let R=r.a6.create(),O=new ve(0,0),F=y.canonical,V=Number.MAX_VALUE;for(let U=0;U<E.instancedDataCount;++U){let Z=16*(E.instancedDataOffset+U),Q=C.instancedDataArray.float32,K=[Q[Z+4],Q[Z+5],Q[Z+6]];$T(F,O,Q[Z],0|Q[Z+1]),TT(R,S,d,O,E.rotation,E.scale,K,!1,!1,!1),d.projection.name==="globe"&&(R=u0(R,d));let se=r.a6.multiply([],d.projMatrix,R),oe=t.queryGeometry,de=xT(oe.isPointQuery()?oe.screenBounds:oe.screenGeometry,d,se,S.aabb);de!=null&&(V=Math.min(de,V))}return V!==Number.MAX_VALUE&&V}}return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Gd}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,i,o){let s=t.tile,d=s.getBucket(this),p=null,_=Number.MAX_VALUE;if(!(d&&d instanceof k_))return{queryFeature:p,intersectionZ:_};let y=d.getNodesInfo()[e];if(y.hiddenByReplacement||!y.node.meshes||!i.filter(new nr(s.tileID.overscaledZ),y.feature,s.tileID.canonical))return{queryFeature:p,intersectionZ:_};let v=y.node,C=o.calculatePosMatrix(s.tileID.toUnwrapped(),o.worldSize),E=y.evaluatedScale,S=0;o.elevation&&v.elevation&&(S=v.elevation*o.elevation.exaggeration()),r.a6.translate(C,C,[(v.anchor?v.anchor[0]:0)*(E[0]-1),(v.anchor?v.anchor[1]:0)*(E[1]-1),S]),r.a6.scale(C,C,E),r.a6.multiply(C,C,v.matrix);let R=t.queryGeometry,O=R.isPointQuery()?R.screenBounds:R.screenGeometry,F=function(U){let Z=r.a6.multiply([],C,U.matrix),Q=r.a6.multiply(Z,o.expandedFarZProjMatrix,Z);for(let K=0;K<U.meshes.length;++K){let se=U.meshes[K];if(K===U.lightMeshIndex)continue;let oe=xT(O,o,Q,se.aabb);oe!=null&&(_=Math.min(oe,_))}if(U.children)for(let K of U.children)F(K)};if(F(v),_===Number.MAX_VALUE)return{queryFeature:p,intersectionZ:_};let V=new ve(0,0);return $T(s.tileID.canonical,V,y.node.anchor[0],y.node.anchor[1]),p={type:"Feature",geometry:{type:"Point",coordinates:[V.lng,V.lat]},properties:y.feature.properties,id:y.feature.id,state:{},layer:this.serialize()},{queryFeature:p,intersectionZ:_}}}},mi={read:function(t,e){return t.readFields(mi._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,i){t===1?e.header_length=i.readFixed32():t===2?e.x=i.readVarint():t===3?e.y=i.readVarint():t===4?e.z=i.readVarint():t===5&&e.layers.push(mi.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};mi.Filter.read=function(t,e){return t.readFields(mi.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},mi.Filter._readField=function(t,e,i){t===1?(e.delta_filter=mi.Filter.Delta.read(i,i.readVarint()+i.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=mi.Filter.Zigzag.read(i,i.readVarint()+i.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=mi.Filter.BitShuffle.read(i,i.readVarint()+i.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=mi.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),e.filter="byteshuffle_filter")},mi.Filter.Delta={},mi.Filter.Delta.read=function(t,e){return t.readFields(mi.Filter.Delta._readField,{block_size:0},e)},mi.Filter.Delta._readField=function(t,e,i){t===1&&(e.block_size=i.readVarint())},mi.Filter.Zigzag={},mi.Filter.Zigzag.read=function(t,e){return t.readFields(mi.Filter.Zigzag._readField,{},e)},mi.Filter.Zigzag._readField=function(t,e,i){},mi.Filter.BitShuffle={},mi.Filter.BitShuffle.read=function(t,e){return t.readFields(mi.Filter.BitShuffle._readField,{},e)},mi.Filter.BitShuffle._readField=function(t,e,i){},mi.Filter.ByteShuffle={},mi.Filter.ByteShuffle.read=function(t,e){return t.readFields(mi.Filter.ByteShuffle._readField,{},e)},mi.Filter.ByteShuffle._readField=function(t,e,i){},mi.Codec={},mi.Codec.read=function(t,e){return t.readFields(mi.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},mi.Codec._readField=function(t,e,i){t===1?(e.gzip_data=mi.Codec.GzipData.read(i,i.readVarint()+i.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=mi.Codec.JpegImage.read(i,i.readVarint()+i.pos),e.codec="jpeg_image"):t===3?(e.webp_image=mi.Codec.WebpImage.read(i,i.readVarint()+i.pos),e.codec="webp_image"):t===4&&(e.png_image=mi.Codec.PngImage.read(i,i.readVarint()+i.pos),e.codec="png_image")},mi.Codec.GzipData={},mi.Codec.GzipData.read=function(t,e){return t.readFields(mi.Codec.GzipData._readField,{},e)},mi.Codec.GzipData._readField=function(t,e,i){},mi.Codec.JpegImage={},mi.Codec.JpegImage.read=function(t,e){return t.readFields(mi.Codec.JpegImage._readField,{},e)},mi.Codec.JpegImage._readField=function(t,e,i){},mi.Codec.WebpImage={},mi.Codec.WebpImage.read=function(t,e){return t.readFields(mi.Codec.WebpImage._readField,{},e)},mi.Codec.WebpImage._readField=function(t,e,i){},mi.Codec.PngImage={},mi.Codec.PngImage.read=function(t,e){return t.readFields(mi.Codec.PngImage._readField,{},e)},mi.Codec.PngImage._readField=function(t,e,i){},mi.DataIndexEntry={},mi.DataIndexEntry.read=function(t,e){return t.readFields(mi.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},mi.DataIndexEntry._readField=function(t,e,i){t===1?e.first_byte=i.readFixed64():t===2?e.last_byte=i.readFixed64():t===3?e.filters.push(mi.Filter.read(i,i.readVarint()+i.pos)):t===4?e.codec=mi.Codec.read(i,i.readVarint()+i.pos):t===5?e.offset=i.readFloat():t===6?e.scale=i.readFloat():t===7&&e.bands.push(i.readString())},mi.Layer={},mi.Layer.read=function(t,e){return t.readFields(mi.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},mi.Layer._readField=function(t,e,i){t===1?e.version=i.readVarint():t===2?e.name=i.readString():t===3?e.units=i.readString():t===4?e.tilesize=i.readVarint():t===5?e.buffer=i.readVarint():t===6?e.pixel_format=i.readVarint():t===7&&e.data_index.push(mi.DataIndexEntry.read(i,i.readVarint()+i.pos))};let hl={read:function(t,e){return t.readFields(hl._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,i){t===2?(e.uint32_values=hl.Uint32Values.read(i,i.readVarint()+i.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=hl.Fixed32Values.read(i,i.readVarint()+i.pos),e.values="fixed32_values")},Uint32Values:{}};hl.Uint32Values.read=function(t,e){return t.readFields(hl.Uint32Values._readField,{values:[]},e)},hl.Uint32Values._readField=function(t,e,i){t===1&&(e.readValuesInto=function(o){if(o.type!==2)throw new Error(`Unsupported pbf type "${o.type}"`);let s=function(p){return p.type===2?p.readVarint()+p.pos:p.pos+1}(o),d=o.pos;return o.pos=s,function(p){o.pos=d;let _=0;for(;o.pos<s;){let y=o.readVarint();p[_++]=y}return p}}(i))},hl.Fixed32Values={},hl.Fixed32Values.read=function(t,e){return t.readFields(hl.Fixed32Values._readField,{values:[]},e)},hl.Fixed32Values._readField=function(t,e,i){throw new Error("Not implemented")};class A2{constructor(e=0,i=0,o=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=o,this.size=0,this.ttl=i}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let i=this.items[e];delete this.items[e],this.size--,i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.first===i&&(this.first=i.next),this.last===i&&(this.last=i.prev)}return this}entries(e=this.keys()){return e.map(i=>[i,this.get(i)])}evict(e=!1){if(e||this.size>0){let i=this.first;delete this.items[i.key],--this.size==0?(this.first=null,this.last=null):(this.first=i.next,this.first.prev=null)}return this}expiresAt(e){let i;return this.has(e)&&(i=this.items[e].expiry),i}get(e){let i;if(this.has(e)){let o=this.items[e];this.ttl>0&&o.expiry<=Date.now()?this.delete(e):(i=o.value,this.set(e,i,!0))}return i}has(e){return e in this.items}keys(){let e=[],i=this.first;for(;i!==null;)e.push(i.key),i=i.next;return e}set(e,i,o=!1,s=this.resetTtl){let d;if(o||this.has(e)){if(d=this.items[e],d.value=i,o===!1&&s&&(d.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==d){let p=this.last,_=d.next,y=d.prev;this.first===d&&(this.first=d.next),d.next=null,d.prev=this.last,p.next=d,y!==null&&(y.next=_),_!==null&&(_.prev=y)}}else this.max>0&&this.size===this.max&&this.evict(!0),d=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:i},++this.size==1?this.first=d:this.last.next=d;return this.last=d,this}values(e=this.keys()){return e.map(i=>this.get(i))}}function D2(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){let s=o===1?1:0,d=o===2?1:0;for(let p=0;p<e[0];p++){let _=e[1]*p;for(let y=s;y<e[1];y++){let v=e[2]*(y+_);for(let C=d;C<e[2];C++){let E=e[3]*(C+v);for(let S=0;S<e[3];S++){let R=E+S;t[R]+=t[R-i]}}}}i*=e[o]}return t}function k2(t){for(let e=0,i=t.length;e<i;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function R2(t,e){switch(e){case"uint32":return t;case"uint16":for(let i=0;i<t.length;i+=2){let o=t[i],s=t[i+1];t[i]=(240&o)>>4|(61440&o)>>8|(240&s)<<4|61440&s,t[i+1]=15&o|(3840&o)>>4|(15&s)<<8|(3840&s)<<4}return t;case"uint8":for(let i=0;i<t.length;i+=4){let o=t[i],s=t[i+1],d=t[i+2],p=t[i+3];t[i+0]=(192&o)>>6|(192&s)>>4|(192&d)>>2|192&p,t[i+1]=(48&o)>>4|(48&s)>>2|48&d|(48&p)<<2,t[i+2]=(12&o)>>2|12&s|(12&d)<<2|(12&p)<<4,t[i+3]=3&o|(3&s)<<2|(3&d)<<4|(3&p)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class pd extends Error{constructor(e){super(e),this.name="MRTError"}}var is=Uint8Array,jh=Uint16Array,P2=Int32Array,qT=new is([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),WT=new is([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),O2=new is([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),ZT=function(t,e){for(var i=new jh(31),o=0;o<31;++o)i[o]=e+=1<<t[o-1];var s=new P2(i[30]);for(o=1;o<30;++o)for(var d=i[o];d<i[o+1];++d)s[d]=d-i[o]<<5|o;return{b:i,r:s}},YT=ZT(qT,2),XT=YT.b,F2=YT.r;XT[28]=258,F2[258]=28;for(var L2=ZT(WT,0).b,w0=new jh(32768),Or=0;Or<32768;++Or){var Uh=(43690&Or)>>1|(21845&Or)<<1;w0[Or]=((65280&(Uh=(61680&(Uh=(52428&Uh)>>2|(13107&Uh)<<2))>>4|(3855&Uh)<<4))>>8|(255&Uh)<<8)>>1}var Wm=function(t,e,i){for(var o=t.length,s=0,d=new jh(e);s<o;++s)t[s]&&++d[t[s]-1];var p,_=new jh(e);for(s=1;s<e;++s)_[s]=_[s-1]+d[s-1]<<1;if(i){p=new jh(1<<e);var y=15-e;for(s=0;s<o;++s)if(t[s])for(var v=s<<4|t[s],C=e-t[s],E=_[t[s]-1]++<<C,S=E|(1<<C)-1;E<=S;++E)p[w0[E]>>y]=v}else for(p=new jh(o),s=0;s<o;++s)t[s]&&(p[s]=w0[_[t[s]-1]++]>>15-t[s]);return p},Zm=new is(288);for(Or=0;Or<144;++Or)Zm[Or]=8;for(Or=144;Or<256;++Or)Zm[Or]=9;for(Or=256;Or<280;++Or)Zm[Or]=7;for(Or=280;Or<288;++Or)Zm[Or]=8;var KT=new is(32);for(Or=0;Or<32;++Or)KT[Or]=5;var z2=Wm(Zm,9,1),N2=Wm(KT,5,1),C0=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},pl=function(t,e,i){var o=e/8|0;return(t[o]|t[o+1]<<8)>>(7&e)&i},T0=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},B2=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ml=function(t,e,i){var o=new Error(e||B2[t]);if(o.code=t,Error.captureStackTrace&&Error.captureStackTrace(o,ml),!i)throw o;return o},V2=new is(0),j2=typeof TextDecoder<"u"&&new TextDecoder;try{j2.decode(V2,{stream:!0})}catch{}let U2={gzip_data:"gzip"},G2={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},H2={uint32:1,uint16:2,uint8:4},$2={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class QT{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new pd("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){let i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new pd(`Expected header with length >= ${o} but got buffer of length ${i.length}`);let s=new Ph(i.subarray(0,o)),d=mi.read(s);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new pd(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(let p of d.layers)this.layers[p.name]=new q2(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let i=[],o=this.getLayer(e.layerName);for(let s=0;s<o.dataIndex.length;s++){let d=o.dataIndex[s],p=d.first_byte-e.firstByte,_=d.last_byte+1-e.firstByte;if(s<e.firstBlock||s>e.lastBlock||o._blocksInProgress.has(s))continue;let y={layerName:o.name,firstByte:p,lastByte:_,pixelFormat:o.pixelFormat,blockIndex:s,blockShape:[d.bands.length].concat(o.bandShape),buffer:o.buffer,codec:d.codec.codec,filters:d.filters.map(v=>v.filter)};o._blocksInProgress.add(s),i.push(y)}return new JT(i,()=>{i.forEach(s=>o._blocksInProgress.delete(s.blockIndex))},(s,d)=>{if(i.forEach(p=>o._blocksInProgress.delete(p.blockIndex)),s)throw s;d.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class q2{constructor({version:e,name:i,units:o,tilesize:s,pixel_format:d,buffer:p,data_index:_},y){if(this.version=e,this.version!==1)throw new pd(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=s,this.buffer=p,this.pixelFormat=G2[d],this.dataIndex=_,this.bandShape=[s+2*p,s+2*p,H2[this.pixelFormat]],this._decodedBlocks=function(v=1e3,C=0,E=!1){if(isNaN(v)||v<0)throw new TypeError("Invalid max value");if(isNaN(C)||C<0)throw new TypeError("Invalid ttl value");if(typeof E!="boolean")throw new TypeError("Invalid resetTtl value");return new A2(v,C,E)}(y?y.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.set(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(let[o,s]of this.dataIndex.entries()){for(let[d,p]of s.bands.entries())if(p===e)return{bandIndex:i+d,blockIndex:o,blockBandIndex:d};i+=s.bands.length}break;case"number":for(let[o,s]of this.dataIndex.entries()){if(e>=i&&e<i+s.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=s.bands.length}break;default:throw new pd(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new pd(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,o=-1/0,s=1/0,d=-1/0;for(let p of e){let{blockIndex:_}=this.getBlockForBand(p);if(_<0)throw new pd(`Invalid band: ${JSON.stringify(p)}`);let y=this.dataIndex[_];s=Math.min(s,_),d=Math.max(d,_),i=Math.min(i,y.first_byte),o=Math.max(o,y.last_byte)}return{layerName:this.name,firstByte:i,lastByte:o,firstBlock:s,lastBlock:d}}hasBand(e){let{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){let{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){let{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e),s=this._decodedBlocks.get(i.toString());if(!s)throw new pd(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let d=this.dataIndex[i],p=this.bandShape.reduce((v,C)=>v*C,1),_=o*p,y=s.subarray(_,_+p);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:d.offset,scale:d.scale}}}class JT{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}QT.performDecoding=function(t,e){return Promise.all(e.tasks.map(i=>{let{layerName:o,firstByte:s,lastByte:d,pixelFormat:p,blockShape:_,blockIndex:y,filters:v,codec:C}=i,E=new Uint8Array(t).subarray(s,d+1),S=new Uint32Array(_[0]*_[1]*_[2]),R;if(C!=="gzip_data")throw new Error(`Unhandled codec: ${C}`);return R=function(O,F){if(!globalThis.DecompressionStream&&F==="gzip_data")return Promise.resolve(((Q=function(oe){oe[0]==31&&oe[1]==139&&oe[2]==8||ml(6,"invalid gzip data");var de=oe[3],_e=10;4&de&&(_e+=2+(oe[10]|oe[11]<<8));for(var xe=(de>>3&1)+(de>>4&1);xe>0;xe-=!oe[_e++]);return _e+(2&de)}(Z=O))+8>Z.length&&ml(6,"invalid gzip data"),function(oe,de,_e,xe){var Se=oe.length;if(!Se||de.f&&!de.l)return _e||new is(0);var we=!_e,ze=we||de.i!=2,$e=de.i;we&&(_e=new is(3*Se));var Pe=function(da){var Go=_e.length;if(da>Go){var ns=new is(Math.max(2*Go,da));ns.set(_e),_e=ns}},He=de.f||0,De=de.p||0,je=de.b||0,ut=de.l,qe=de.d,kt=de.m,Ct=de.n,Ke=8*Se;do{if(!ut){He=pl(oe,De,1);var ei=pl(oe,De+1,3);if(De+=3,!ei){var jt=oe[(Xi=4+((De+7)/8|0))-4]|oe[Xi-3]<<8,At=Xi+jt;if(At>Se){$e&&ml(0);break}ze&&Pe(je+jt),_e.set(oe.subarray(Xi,At),je),de.b=je+=jt,de.p=De=8*At,de.f=He;continue}if(ei==1)ut=z2,qe=N2,kt=9,Ct=5;else if(ei==2){var Qe=pl(oe,De,31)+257,Yt=pl(oe,De+10,15)+4,wi=Qe+pl(oe,De+5,31)+1;De+=14;for(var ii=new is(wi),Ci=new is(19),ai=0;ai<Yt;++ai)Ci[O2[ai]]=pl(oe,De+3*ai,7);De+=3*Yt;var Bi=C0(Ci),di=(1<<Bi)-1,Dn=Wm(Ci,Bi,1);for(ai=0;ai<wi;){var Xi,tn=Dn[pl(oe,De,di)];if(De+=15&tn,(Xi=tn>>4)<16)ii[ai++]=Xi;else{var un=0,Ki=0;for(Xi==16?(Ki=3+pl(oe,De,3),De+=2,un=ii[ai-1]):Xi==17?(Ki=3+pl(oe,De,7),De+=3):Xi==18&&(Ki=11+pl(oe,De,127),De+=7);Ki--;)ii[ai++]=un}}var Jn=ii.subarray(0,Qe),Cn=ii.subarray(Qe);kt=C0(Jn),Ct=C0(Cn),ut=Wm(Jn,kt,1),qe=Wm(Cn,Ct,1)}else ml(1);if(De>Ke){$e&&ml(0);break}}ze&&Pe(je+131072);for(var vr=(1<<kt)-1,$r=(1<<Ct)-1,yo=De;;yo=De){var Yn=(un=ut[T0(oe,De)&vr])>>4;if((De+=15&un)>Ke){$e&&ml(0);break}if(un||ml(2),Yn<256)_e[je++]=Yn;else{if(Yn==256){yo=De,ut=null;break}var sr=Yn-254;Yn>264&&(sr=pl(oe,De,(1<<(ao=qT[ai=Yn-257]))-1)+XT[ai],De+=ao);var ro=qe[T0(oe,De)&$r],oo=ro>>4;if(ro||ml(3),De+=15&ro,Cn=L2[oo],oo>3){var ao=WT[oo];Cn+=T0(oe,De)&(1<<ao)-1,De+=ao}if(De>Ke){$e&&ml(0);break}ze&&Pe(je+131072);var Un=je+sr;if(je<Cn){var La=0-Cn,md=Math.min(Cn,Un);for(La+je<0&&ml(3);je<md;++je)_e[je]=xe[La+je]}for(;je<Un;++je)_e[je]=_e[je-Cn]}}de.l=ut,de.p=yo,de.b=je,de.f=He,ut&&(He=1,de.m=kt,de.d=qe,de.n=Ct)}while(!He);return je!=_e.length&&we?function(da,Go,ns){return(Go==null||Go<0)&&(Go=0),(ns==null||ns>da.length)&&(ns=da.length),new is(da.subarray(Go,ns))}(_e,0,je):_e.subarray(0,je)}(Z.subarray(Q,-8),{i:2},new is(((V=Z)[(U=V.length)-4]|V[U-3]<<8|V[U-2]<<16|V[U-1]<<24)>>>0),void 0)));var V,U,Z,Q;let K=U2[F];if(!K)throw new Error(`Unhandled codec: ${F}`);let se=new globalThis.DecompressionStream(K);return new Response(new Blob([O]).stream().pipeThrough(se)).arrayBuffer().then(oe=>new Uint8Array(oe))}(E,C).then(O=>{let F=hl.read(new Ph(O));if(F.values==="uint32_values")return F.uint32_values.readValuesInto(S),new $2[p](S.buffer);throw new Error(`Unhandled numeric data "${F.values}"`)}),R.then(O=>{for(let F=v.length-1;F>=0;F--)switch(v[F]){case"delta_filter":D2(O,_);break;case"zigzag_filter":k2(O);break;case"bitshuffle_filter":R2(O,p);break;default:throw new Error(`Unhandled filter "${v[F]}"`)}return{layerName:o,blockIndex:y,data:O}}).catch(O=>{throw O})}))},Et(JT,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let eE=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class E0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");let s=o>>4;if(s!==1)throw new Error(`Got v${s} data when expected v1.`);let d=eE[15&o];if(!d)throw new Error("Unrecognized array type.");let[p]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new E0(_,p,d,e)}constructor(e,i=64,o=Float64Array,s){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let d=eE.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-_%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${o}.`);s&&s instanceof ArrayBuffer?(this.data=s,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+_+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){let o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return I0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:d,coords:p,nodeSize:_}=this,y=[0,d.length-1,0],v=[];for(;y.length;){let C=y.pop()||0,E=y.pop()||0,S=y.pop()||0;if(E-S<=_){for(let V=S;V<=E;V++){let U=p[2*V],Z=p[2*V+1];U>=e&&U<=o&&Z>=i&&Z<=s&&v.push(d[V])}continue}let R=S+E>>1,O=p[2*R],F=p[2*R+1];O>=e&&O<=o&&F>=i&&F<=s&&v.push(d[R]),(C===0?e<=O:i<=F)&&(y.push(S),y.push(R-1),y.push(1-C)),(C===0?o>=O:s>=F)&&(y.push(R+1),y.push(E),y.push(1-C))}return v}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:s,coords:d,nodeSize:p}=this,_=[0,s.length-1,0],y=[],v=o*o;for(;_.length;){let C=_.pop()||0,E=_.pop()||0,S=_.pop()||0;if(E-S<=p){for(let V=S;V<=E;V++)iE(d[2*V],d[2*V+1],e,i)<=v&&y.push(s[V]);continue}let R=S+E>>1,O=d[2*R],F=d[2*R+1];iE(O,F,e,i)<=v&&y.push(s[R]),(C===0?e-o<=O:i-o<=F)&&(_.push(S),_.push(R-1),_.push(1-C)),(C===0?e+o>=O:i+o>=F)&&(_.push(R+1),_.push(E),_.push(1-C))}return y}}function I0(t,e,i,o,s,d){if(s-o<=i)return;let p=o+s>>1;tE(t,e,p,o,s,d),I0(t,e,i,o,p-1,1-d),I0(t,e,i,p+1,s,1-d)}function tE(t,e,i,o,s,d){for(;s>o;){if(s-o>600){let v=s-o+1,C=i-o+1,E=Math.log(v),S=.5*Math.exp(2*E/3),R=.5*Math.sqrt(E*S*(v-S)/v)*(C-v/2<0?-1:1);tE(t,e,i,Math.max(o,Math.floor(i-C*S/v+R)),Math.min(s,Math.floor(i+(v-C)*S/v+R)),d)}let p=e[2*i+d],_=o,y=s;for(Ym(t,e,o,i),e[2*s+d]>p&&Ym(t,e,o,s);_<y;){for(Ym(t,e,_,y),_++,y--;e[2*_+d]<p;)_++;for(;e[2*y+d]>p;)y--}e[2*o+d]===p?Ym(t,e,o,y):(y++,Ym(t,e,y,s)),y<=i&&(o=y+1),i<=y&&(s=y-1)}}function Ym(t,e,i,o){S0(t,i,o),S0(e,2*i,2*o),S0(e,2*i+1,2*o+1)}function S0(t,e,i){let o=t[e];t[e]=t[i],t[i]=o}function iE(t,e,i,o){let s=t-i,d=e-o;return s*s+d*d}r.$=oT,r.A=ch,r.B=Gp,r.C=Di,r.D=Te,r.E=Qo,r.F=rr,r.G=ct,r.H=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Sn(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Ai(t.x,e.x,i),y:Ai(t.y,e.y,i),z:Ai(t.z,e.z,i),azimuthal:Ai(t.azimuthal,e.azimuthal,i),polar:Ai(t.polar,e.polar,i)}}},r.I=e0,r.J=nl,r.K=nr,r.L=Wi,r.M=class{constructor(t,e,i,o){this.id=t,this.position=e!=null?new ve(e[0],e[1]):new ve(0,0),this.orientation=i??[0,0,0],this.nodes=o,this.uploaded=!1,this.aabb=new mr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.a6.multiply(t.matrix,e,t.matrix),t.meshes)for(let i of t.meshes){let o=mr.applyTransform(i.aabb,t.matrix);this.aabb.encapsulate(o)}if(t.children)for(let i of t.children)this._applyTransformations(i,t.matrix)}computeBoundsAndApplyParent(){let t=r.a6.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,i,o,s,d,p=!1){TT(this.matrix,this,t.transform,this.position,e,i,o,s,d,p)}upload(t){if(!this.uploaded){for(let e of this.nodes)p0(e,t);for(let e of this.nodes)I_(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)m0(t)}},r.O=us,r.P=dt,r.Q=Wd,r.R=to,r.S=rd,r.T=c0,r.U=Ai,r.V=mt,r.W=kd,r.X=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([i,o]){let s=Sn([1,i,o]);return{x:s.x,y:s.y,z:s.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Ai(t.x,e.x,i),y:Ai(t.y,e.y,i),z:Ai(t.z,e.z,i)}}},r.Y=function(t,e,i=0,o=!0){let s=new dt(i,i),d=t.sub(s),p=e.add(s),_=[d,new dt(p.x,d.y),p,new dt(d.x,p.y)];return o&&_.push(d.clone()),_},r.Z=Gd,r._=function(t,e){let i=[];for(let o=0;o<t.length;o++){let s=Ia(o-1,-1,t.length-1),d=Ia(o+1,-1,t.length-1),p=t[o],_=t[d],y=t[s].sub(p).unit(),v=_.sub(p).unit(),C=v.angleWithSep(y.x,y.y),E=y.add(v).unit().mult(-1*e/Math.sin(C/2));i.push(p.add(E))}return i},r.a=El,r.a$=function(t){let e=[];for(let i in t)e.push(t[i]);return e},r.a0=a1,r.a1=function(t,e,i=0){return r.N.fromValues(((e.x-i)*t.scale-t.x)*mt,(e.y*t.scale-t.y)*mt,On(e.z,e.y))},r.a2=Ay,r.a3=CC,r.a4=function(t){let e=1/0,i=1/0,o=-1/0,s=-1/0;for(let d of t)e=Math.min(e,d.x),i=Math.min(i,d.y),o=Math.max(o,d.x),s=Math.max(s,d.y);return{min:new dt(e,i),max:new dt(o,s)}},r.a5=_i,r.a8=al,r.a9=sn,r.aA=ag,r.aB=yr,r.aC=Lr,r.aD=wg,r.aE=y_,r.aF=function(){xa.isLoading()||xa.isLoaded()||Ul()!=="deferred"||tm()},r.aG=wa,r.aH=Vr,r.aI=NT,r.aJ=Fs,r.aK=Zy,r.aL=$y,r.aM=Jr,r.aN=Ka,r.aO=fm,r.aP=Ew,r.aQ=Kg,r.aR=l0,r.aS=function(t,e){let i=rd(e.zoom);if(i===0)return Xl(t);let o=Hg(t),s=Py(o),d=_i(o.getWest())*e.worldSize,p=_i(o.getEast())*e.worldSize,_=ri(o.getNorth())*e.worldSize,y=ri(o.getSouth())*e.worldSize,v=[d,_,0],C=[p,_,0],E=[d,y,0],S=[p,y,0],R=r.a6.invert([],e.globeMatrix);return r.N.transformMat4(v,v,R),r.N.transformMat4(C,C,R),r.N.transformMat4(E,E,R),r.N.transformMat4(S,S,R),s[0]=Mc(s[0],E,i),s[1]=Mc(s[1],S,i),s[2]=Mc(s[2],C,i),s[3]=Mc(s[3],v,i),mr.fromPoints(s)},r.aT=qg,r.aU=Tm,r.aV=Mc,r.aW=jo,r.aX=jA,r.aY=Ps,r.aZ=QT,r.a_=Le,r.aa=gi,r.ab=X,r.ac=function(t,e){let i={};for(let o=0;o<e.length;o++){let s=e[o];s in t&&(i[s]=t[s])}return i},r.ad=Ae,r.ae=ri,r.af=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,o){let s=this.entries[t]=this.entries[t]||{callbacks:[]};if(s.result){let[d,p]=s.result;return this.scheduler?this.scheduler.add(()=>{o(d,p)},e):o(d,p),()=>{}}return s.callbacks.push(o),s.cancel||(s.cancel=i((d,p)=>{s.result=[d,p];for(let _ of s.callbacks)this.scheduler?this.scheduler.add(()=>{_(d,p)},e):_(d,p);setTimeout(()=>delete this.entries[t],3e3)})),()=>{s.result||(s.callbacks=s.callbacks.filter(d=>d!==o),s.callbacks.length||(s.cancel(),delete this.entries[t]))}}},r.ag=sm,r.ah=function(t,e,i){let o=JSON.stringify(t.request);return t.data&&(this.deduped.entries[o]={result:[null,t.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},s=>{let d=Le(t.request,(p,_,y,v)=>{p?s(p):_&&s(null,{vectorTile:i?void 0:new qy(new Ph(_)),rawData:_,cacheControl:y,expires:v})});return()=>{d.cancel(),s()}},e)},r.ai=function(t){$i++,$i>Pt&&(t.getActor().send("enforceCacheSizeLimit",Ve),$i=0)},r.aj=Rr,r.ak=Ge,r.al=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.am=nt,r.an=mT,r.ao=fT,r.ap=pT,r.aq=function(t,e){let i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<t.length;o++){let s=document.createElement("source");tt(t[o])||(i.crossOrigin="Anonymous"),s.src=t[o],i.appendChild(s)}return{cancel:()=>{}}},r.ar=x_,r.as=Lm,r.at=li,r.au=Ui,r.av=rl,r.aw=Kr,r.ax=hr,r.ay=fn,r.az=wc,r.b=mo,r.b$=_g,r.b0=function(t,e){let i=[];for(let o in t)o in e||i.push(o);return i},r.b1=Yo,r.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.b3=function(t,e){let{x:i,y:o}=t.point,s=kw(i,o,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.a6.multiply(s,s,Oy(Xl(e)))},r.b5=Dh,r.b6=ts,r.b7=o_,r.b8=function(t,e,i,o,s){let d=5*e+2;t.float32[d+0]=i,t.float32[d+1]=o,t.float32[d+2]=s},r.b9=b_,r.bA=T_,r.bB=gT,r.bC=function(t){let e=gT(t,!0);return r.b4.invert([],[e[0],e[1],e[4],e[5]])},r.bD=Dy,r.bE=function(t){let{x:e,y:i}=t.point,{lng:o,lat:s}=t._center;return kw(e,i,t.worldSize,o,s)},r.bF=qn,r.bG=te,r.bH=function(t){let e=Math.round((t+45+360)%360/90)%4;return Nc[e]},r.bI=45,r.bJ=Ut,r.bK=h,r.bL=ql,r.bM=zg,r.bN=Oo,r.bO=wh,r.bP=u,r.bQ=function(t,e,i){let o=Math.sqrt(t*t+e*e+i*i),s=o>0?Math.acos(i/o)*Cl:0,d=t!==0||e!==0?Math.atan2(-e,-t)*Cl+90:0;return d<0&&(d+=360),[o,d,s]},r.bR=Pi,r.bS=mr,r.bT=Sn,r.bU=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.bV=function(t){return t({pluginStatus:oa,pluginURL:jl}),em.on("pluginStateChange",t),t},r.bW=f0,r.bX=S_,r.bY=Fh,r.bZ=t0,r.b_=gr,r.ba=ZC,r.bb=xs,r.bc=Mo,r.bd=tT,r.be=n0,r.bf=Jy,r.bg=E0,r.bh=Ia,r.bj=Fi,r.bk=ae,r.bl=ci,r.bm=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},r.bn=ve,r.bo=dT,r.bp=at,r.bq=ky,r.br=_T,r.bs=Xe,r.bt=Mw,r.bu=function(t,e,i,o,s,d,p,_,y){if(y.name==="globe")return Mw(t,e,new Xe(i,o,s),!1);let v=Lm({z:i,x:o,y:s},y);return new mr([(d+v.x/v.scale)*e,e*(v.y/v.scale),p],[(d+v.x2/v.scale)*e,e*(v.y2/v.scale),_])},r.bv=function(t,e,i){let o=0;for(let s=0;s<2;++s){let d=i?i[s]:0;t[s]>d&&(o+=(t[s]-d)*(t[s]-d)),e[s]<d&&(o+=(d-e[s])*(d-e[s]))}return o},r.bw=ki,r.bx=q,r.by=function(t){let e=r.a6.identity(new Float64Array(16));r.a6.multiply(e,t.pixelMatrix,t.globeMatrix);let i=[0,me,0],o=[0,Ie,0];return r.N.transformMat4(i,i,e),r.N.transformMat4(o,o,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Ly(t,new ve(t.center.lat,90)),o[0]>0&&o[0]<=t.width&&o[1]>0&&o[1]<=t.height&&!Ly(t,new ve(t.center.lat,-90))]},r.bz=function(t,e){let{scale:i}=t.tileTransform,o=i*mt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.b4.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},r.c=LT,r.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.c0=ye,r.c1=Ao,r.c2=function(t,e,i){return t.type==="custom"?new Xk(t,e):new M2[t.type](t,e,i)},r.c3=function(t){let e=t.indexOf(fh);return e>=0?t.slice(0,e):t},r.c4=function(t){return t.indexOf(fh)>=0},r.c5=function(t){let e=t.indexOf(fh);return e>=0?t.slice(e+1):""},r.c6=function(t){let e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.c7=Mi,r.c8=em,r.c9=Ne,r.cA=IC,r.cB=(t,e,i,o,s,d)=>{let p=t.transform;return{u_matrix:EC(t,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:s,u_image:0,u_tile_units_to_pixels:TC(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:d}},r.cC=(t,e,i,o,s,d,p)=>{let _=t.transform,y=_.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:EC(t,e,i,o),u_pixels_to_tile_units:y,u_device_pixel_ratio:d,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:s,u_texsize:SC(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:TC(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:p,u_emissive_strength:i.paint.get("line-emissive-strength")}},r.cD=zo,r.cE=Em,r.cF=_C,r.cG=Rt,r.cH=r_,r.cI=sd,r.cJ=450,r.cK=7,r.cL=Wk,r.cM=256,r.cN=Oy,r.cO=$l,r.cP=mm,r.cQ=function(t,e,i,o,s){return gi((t-e)/(i-e)*(s-o)+o,o,s)},r.cR=Ri,r.cS=u0,r.cT=[1,1,1],r.cU=Mh,r.cV=Nh,r.cW=ys,r.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){let e=Xw(new dt(0,0),new dt(mt,mt),t),i=[];for(let o of this._activeRegions){if(o.hiddenByOverlap||!Yw(e,o))continue;let s=SD(o.min,o.max,t);i.push({min:s.min,max:s.max,sourceId:this._sourceIds[o.priority],footprint:o.footprint,footprintTileId:o.tileId})}return i}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let i=[];for(let o of e.cache.getVisibleCoordinates()){let s=e.cache.getTile(o).buckets[e.layer];if(s)for(let d of s.getNodesInfo()){let p=d.node;p.footprint&&i.push({footprint:p.footprint,id:o.toUnwrapped()})}}return i}})))}_addSource(t){let e=t.getFootprints();if(e.length!==0){for(let i of e){if(!i.footprint)continue;let o=Xw(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:o.min,max:o.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||t_(e.min,i.min)||t_(e.max,i.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,i=0;for(;!t&&e!==this._activeRegions.length;){let o=this._activeRegions[e],s=this._prevRegions[i];t=o.priority!==s.priority||!Zw(o,s),++e,++i}}if(t){++this._updateTime;let e=i=>{let o=this._activeRegions;if(i>=o.length)return i;let s=o[i].priority;for(;i<o.length&&o[i].priority===s;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let s=i,d=i;for(;s!==o;){let p=this._activeRegions[s];p.hiddenByOverlap=!1;for(let _=0;_<d;_++){let y=this._activeRegions[_];if(!y.hiddenByOverlap&&Yw(p,y)&&(p.hiddenByOverlap=Qw(p.footprint,p.tileId,y.footprint,y.tileId),p.hiddenByOverlap))break}++s}i=o,o=e(i)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.cY=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let i=new Ka,o=new Kr,s=[],d=t+1+2,p=e[0]+1,_=e[0]+1+(1+e.length),y=(v,C,E)=>{let S=v===d-1?v-2:v===0?v:v-1;return S+=E?24575:0,[S,C]};for(let v=0;v<d;++v)i.emplaceBack(...y(v,0,!0));for(let v=0;v<p;++v)for(let C=0;C<d;++C)i.emplaceBack(...y(C,v,(C===0||C===d-1)&&!0));for(let v=0;v<e.length;++v){let C=e[v];for(let E=0;E<d;++E)i.emplaceBack(...y(E,C,!0))}for(let v=0;v<e.length;++v){let C=o.length,E=e[v]+1+2,S=new Kr;for(let F=0;F<E-1;F++){let V=F===E-2,U=V?d*(_-e.length+v-F):d;for(let Z=0;Z<d-1;Z++){let Q=F*d+Z;F===0||V||Z===0||Z===d-2?(S.emplaceBack(Q+1,Q,Q+U),S.emplaceBack(Q+U,Q+U+1,Q+1)):(o.emplaceBack(Q+1,Q,Q+U),o.emplaceBack(Q+U,Q+U+1,Q+1))}}let R=yr.simpleSegment(0,C,i.length,o.length-C);for(let F=0;F<S.uint16.length;F+=3)o.emplaceBack(S.uint16[F],S.uint16[F+1],S.uint16[F+2]);let O=yr.simpleSegment(0,C,i.length,o.length-C);s.push({withoutSkirts:R,withSkirts:O})}return{vertices:i,indices:o,segments:s}}_createGrid(t){let e=this._fillGridMeshWithLods(le,ce);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Ew.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new Kr;for(let p=0;p<=le;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let i=new $l,o=new $l,s=new $l,d=new $l;this._poleSegments=[];for(let p=0,_=0;p<te;p++){let y=360/(1<<p);i.emplaceBack(0,-X,0,.5,0),o.emplaceBack(0,-X,0,.5,1),s.emplaceBack(0,-X,0,.5,.5),d.emplaceBack(0,-X,0,.5,.5);for(let v=0;v<=le;v++){let C=v/le,E=0,S=Ai(0,y,C),[R,O,F]=be(HA,$A,S,X);i.emplaceBack(R,O,F,C,E),o.emplaceBack(R,O,F,C,1-E);let V=Fi(S);C=.5+.5*Math.sin(V),E=.5+.5*Math.cos(V),s.emplaceBack(R,O,F,C,E),d.emplaceBack(R,O,F,C,1-E)}this._poleSegments.push(yr.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,Ug,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(o,Ug,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(s,Ug,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(d,Ug,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.cZ=function(t){return Ga.has(t)},r.c_=Zo,r.ca=n,r.cb=class extends ol{constructor(t){super(t),this.current=f}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.cc=yt,r.cd=function(t,e,i){let o=rd(i.zoom),s=t.style.map._antialias,d=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return o===0&&!s&&!d},r.ce=function(t){let e=t.pixelsPerMeter,i=e/ci(1,t.center.lat),o=r.a6.identity(new Float64Array(16));return r.a6.translate(o,o,[t.point.x,t.point.y,0]),r.a6.scale(o,o,[i,i,e]),Float32Array.from(o)},r.cf=Hg,r.cg=function(t){let e=ki-5;t=gi(t,-e,e)/e*90;let i=Math.pow(Math.abs(Math.sin(Fi(t))),3);return Math.round(i*(ce.length-1))},r.ch=function(t,e,i,o){let s=e.getNorth(),d=e.getSouth(),p=e.getWest(),_=e.getEast(),y=1<<t.z,v=_-p,C=s-d,E=v/le,S=-C/ce[i],R=[0,E,0,S,0,0,s,p,0];if(t.z>0){let O=180/o;r.co.multiply(R,R,[O/v+1,0,0,0,O/C+1,0,-.5*O/E,.5*O/S,1])}return R[2]=y,R[5]=t.x,R[8]=t.y,R},r.ci=Xl,r.cj=function(t,e,i){let o=r.a6.identity(new Float64Array(16)),s=(e/(1<<t)-.5)*Math.PI*2;return r.a6.rotateY(o,i.globeMatrix,s),Float32Array.from(o)},r.ck=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let i=e.getSource().maxzoom,o=1<<i,s=Math.floor(t.x),d=Math.floor((t.x-s)*o),p=Math.floor(t.y*o),_=this.findDEMTileFor(new nt(i,s,i,d,p));return!(!_||!_.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let o=this._source();if(!o||t.y<0||t.y>1)return e;let s=o.getSource().maxzoom,d=1<<s,p=Math.floor(t.x),_=t.x-p,y=new nt(s,p,s,Math.floor(_*d),Math.floor(t.y*d)),v=this.findDEMTileFor(y);if(!v||!v.dem)return e;let C=v.dem,E=1<<v.tileID.canonical.z,S=(_*E-v.tileID.canonical.x)*C.dim,R=(t.y*E-v.tileID.canonical.y)*C.dim,O=Math.floor(S),F=Math.floor(R);return(i?this.exaggeration():1)*Ai(Ai(C.get(O,F),C.get(O,F+1),R-F),Ai(C.get(O+1,F),C.get(O+1,F+1),R-F),S-O)}getAtTileOffset(t,e,i){let o=1<<t.canonical.z;return this.getAtPointOrZero(new Wi(t.wrap+(t.canonical.x+e/mt)/o,(t.canonical.y+i/mt)/o))}getAtTileOffsetFunc(t,e,i,o){return s=>{let d=this.getAtTileOffset(t,s.x,s.y),p=o.upVector(t.canonical,s.x,s.y),_=o.upVectorScale(t.canonical,e,i).metersToTile;return r.N.scale(p,p,d*_),p}}getForTilePoints(t,e,i,o){if(this.isUsingMockSource())return!1;let s=Mh.create(this,t,o);return!!s&&(e.forEach(d=>{d[2]=this.exaggeration()*s.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let i=e.dem.tree,o=e.tileID,s=1<<t.canonical.z-o.canonical.z,d=t.canonical.x/s-o.canonical.x,p=t.canonical.y/s-o.canonical.y,_=0;for(let y=0;y<t.canonical.z-o.canonical.z&&!i.leaves[_];y++){d*=2,p*=2;let v=2*Math.floor(p)+Math.floor(d);_=i.childOffsets[_]+v,d%=1,p%=1}return{min:this.exaggeration()*i.minimums[_],max:this.exaggeration()*i.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(let s of t){let d=this.getMinMaxForTile(s.tileID);d&&(i=Math.min(i,d.min),o=Math.max(o,d.max),e=!0)}return e?{min:i,max:o}:null}},r.cl=Gg,r.cm=Vw,r.cn=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.cp=Dw,r.cq=256,r.cr=function(t,e){let i=[0,0,0],o=qg(Xl(e.canonical));return r.N.transformMat4(i,i,o),r.N.transformMat4(i,i,t),i},r.cs=t=>({u_camera_to_center_distance:new Oo(t),u_extrude_scale:new x(t),u_device_pixel_ratio:new Oo(t),u_matrix:new h(t),u_inv_rot_matrix:new h(t),u_merc_center:new ql(t),u_tile_id:new zg(t),u_zoom_transition:new Oo(t),u_up_dir:new zg(t),u_emissive_strength:new Oo(t)}),r.ct=t=>({u_matrix:new h(t),u_pixels_to_tile_units:new x(t),u_device_pixel_ratio:new Oo(t),u_units_to_pixels:new ql(t),u_dash_image:new wh(t),u_gradient_image:new wh(t),u_image_height:new Oo(t),u_texsize:new ql(t),u_tile_units_to_pixels:new Oo(t),u_alpha_discard_threshold:new Oo(t),u_trim_offset:new ql(t),u_emissive_strength:new Oo(t)}),r.cu=t=>({u_matrix:new h(t),u_texsize:new ql(t),u_pixels_to_tile_units:new x(t),u_device_pixel_ratio:new Oo(t),u_image:new wh(t),u_units_to_pixels:new ql(t),u_tile_units_to_pixels:new Oo(t),u_alpha_discard_threshold:new Oo(t),u_trim_offset:new ql(t)}),r.cv=bh,r.cw=ik,r.cx=nk,r.cy=Ow,r.cz=(t,e,i,o,s,d)=>{let p=t.transform,_=p.projection.name==="globe",y;if(d.paint.get("circle-pitch-alignment")==="map")if(_){let C=Dw(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;y=Float32Array.from([C,0,0,C])}else y=p.calculatePixelsToTileUnitsMatrix(i);else y=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);let v={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(p.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:et.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:qA,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(_){v.u_inv_rot_matrix=o,v.u_merc_center=s,v.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],v.u_zoom_transition=rd(p.zoom);let C=s[0]*mt,E=s[1]*mt;v.u_up_dir=p.projection.upVector(new Xe(0,0,0),C,E)}return v},r.d=gt,r.d0=Yr,r.d1=Yi,r.d2=Fe,r.d3=function([t,e,i]){let o=Math.hypot(t,e,i),s=Math.atan2(t,i),d=.5*Math.PI-Math.acos(-e/o);return new ve(qn(s),qn(d))},r.d4=Re,r.d5=ie,r.d6=Ly,r.d7=Rw,r.d8=function(t){let e=[0,0,0],i=r.a6.identity(new Float64Array(16));return r.a6.multiply(i,t.pixelMatrix,t.globeMatrix),r.N.transformMat4(e,e,i),new dt(e[0],e[1])},r.d9=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(i){if(Ue==null){let o=i.navigator?i.navigator.userAgent:null;Ue=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Ue}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.dA=dl,r.dB=zT,r.dC=BT,r.dD=xC,r.dE=Bn,r.dF=XC,r.dG=function(t,e,i,o,s,d,p,_,y,v,C){t.createArrays(),t.tilePixelRatio=mt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let E=t.layers[0].layout,S=t.layers[0]._unevaluatedLayout._values,R={};if(t.textSizeData.kind==="composite"){let{minZoom:U,maxZoom:Z}=t.textSizeData;R.compositeTextSizes=[S["text-size"].possiblyEvaluate(new nr(U),_),S["text-size"].possiblyEvaluate(new nr(Z),_)]}if(t.iconSizeData.kind==="composite"){let{minZoom:U,maxZoom:Z}=t.iconSizeData;R.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new nr(U),_),S["icon-size"].possiblyEvaluate(new nr(Z),_)]}R.layoutTextSize=S["text-size"].possiblyEvaluate(new nr(y+1),_),R.layoutIconSize=S["icon-size"].possiblyEvaluate(new nr(y+1),_),R.textMaxSize=S["text-size"].possiblyEvaluate(new nr(18),_);let O=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",F=E.get("text-size"),V=!1;for(let U of t.features)if(U.icon&&U.icon.nameSecondary){V=!0;break}for(let U of t.features){let Z=E.get("text-font").evaluate(U,{},_).join(","),Q=F.evaluate(U,{},_),K=R.layoutTextSize.evaluate(U,{},_),se=(R.layoutIconSize.evaluate(U,{},_),{horizontal:{},vertical:void 0}),oe=U.text,de,_e=[0,0];if(oe){let we=oe.toString(),ze=E.get("text-letter-spacing").evaluate(U,{},_)*Mo,$e=E.get("text-line-height").evaluate(U,{},_)*Mo,Pe=ay(we)?ze:0,He=E.get("text-anchor").evaluate(U,{},_),De=E.get("text-variable-anchor");if(!De){let Ct=E.get("text-radial-offset").evaluate(U,{},_);_e=Ct?tT(He,[Ct*Mo,i0]):E.get("text-offset").evaluate(U,{},_).map(Ke=>Ke*Mo)}let je=O?"center":E.get("text-justify").evaluate(U,{},_),ut=E.get("symbol-placement")==="point",qe=ut?E.get("text-max-width").evaluate(U,{},_)*Mo:1/0,kt=Ct=>{t.allowVerticalPlacement&&Vl(we)&&(se.vertical=Qy(oe,e,i,s,Z,qe,$e,He,Ct,Pe,_e,ts.vertical,!0,K,Q))};if(!O&&De){let Ct=je==="auto"?De.map(ei=>n0(ei)):[je],Ke=!1;for(let ei=0;ei<Ct.length;ei++){let jt=Ct[ei];if(!se.horizontal[jt])if(Ke)se.horizontal[jt]=se.horizontal[0];else{let At=Qy(oe,e,i,s,Z,qe,$e,"center",jt,Pe,_e,ts.horizontal,!1,K,Q);At&&(se.horizontal[jt]=At,Ke=At.positionedLines.length===1)}}kt("left")}else{if(je==="auto"&&(je=n0(He)),ut||E.get("text-writing-mode").indexOf("horizontal")>=0||!Vl(we)){let Ct=Qy(oe,e,i,s,Z,qe,$e,He,je,Pe,_e,ts.horizontal,!1,K,Q);Ct&&(se.horizontal[je]=Ct)}kt(ut?"left":je)}}let xe=!1;if(U.icon&&U.icon.namePrimary){let we=o[U.icon.namePrimary];we&&(de=wk(s[U.icon.namePrimary],U.icon.nameSecondary?s[U.icon.nameSecondary]:void 0,E.get("icon-offset").evaluate(U,{},_),E.get("icon-anchor").evaluate(U,{},_)),xe=we.sdf,t.sdfIcons===void 0?t.sdfIcons=we.sdf:t.sdfIcons!==we.sdf&&er("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(we.pixelRatio!==t.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let Se=nT(se.horizontal)||se.vertical;t.iconsInText||(t.iconsInText=!!Se&&Se.iconsInText),(Se||de)&&Ak(t,U,se,de,o,R,K,0,_e,xe,p,_,v,C,V)}d&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)},r.dH=qy,r.dI=Ph,r.dJ=i_,r.dK=vi,r.dL=Jg,r.dM=Qg,r.dN=ur,r.dO=kC,r.dP=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==AT){let i=new Uint32Array(t,0,7),[,,o,s,d,p]=i;e=i.byteLength+s+d+p+d,(o!==t.byteLength||e>=t.byteLength)&&er("Invalid b3dm header information.")}return PT(t,e)},r.dQ=function(t,e){let i=LT(t);for(let o of i){for(let s of o.meshes)w2(s);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(C2(o.lights,e)))}return i},r.dR=k_,r.dS=ET,r.dT=xa,r.dU=function(t){mn(),Tt&&Tt.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-t;o++)e.delete(i[o])})})},r.da=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",rt,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ye(t))return t;let i=ti(t);return i.params.push(`sdk=js-${M}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ye(t))return t;let i=ti(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(t,e){if(!ye(t))return t;let i=ti(t);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,o){if(!ye(t))return t;let s=ti(t);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),i&&s.params.push(`language=${i}`),o&&s.params.push(`worldview=${o}`),this._makeAPIURL(s,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,o){let s=ti(t);return ye(t)?(s.path=`/styles/v1${s.path}/sprite${e}${i}`,this._makeAPIURL(s,this._customAccessToken||o)):(s.path+=`${e}${i}`,ni(s))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ye(t))return t;let o=ti(t);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&o.authority!=="raster"&&i===512?"@2x":""}${Ii.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${ie.RASTER_URL_PREFIX}${o.path}`:o.authority==="rasterarrays"?o.path=`/${ie.RASTERARRAYS_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${ie.TILE_URL_VERSION}${o.path}`);let s=this._customAccessToken||function(d){for(let p of d){let _=p.match(/^access_token=(.*)$/);if(_)return _[1]}return null}(o.params)||ie.ACCESS_TOKEN;return ie.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,s)}canonicalizeTileURL(t,e){let i=ti(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let o="mapbox://";i.path.match(/^\/raster\/v1\//)?o+=`raster/${i.path.replace(`/${ie.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?o+=`rasterarrays/${i.path.replace(`/${ie.RASTERARRAYS_URL_PREFIX}/`,"")}`:o+=`tiles/${i.path.replace(`/${ie.TILE_URL_VERSION}/`,"")}`;let s=i.params;return e&&(s=s.filter(d=>!d.match(/^access_token=/))),s.length&&(o+=`?${s.join("&")}`),o}canonicalizeTileset(t,e){let i=!!e&&ye(e),o=[];for(let s of t.tiles||[])ue(s)?o.push(this.canonicalizeTileURL(s,i)):o.push(s);return o}_makeAPIURL(t,e){let i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",o=ti(ie.API_URL);if(t.protocol=o.protocol,t.authority=o.authority,t.protocol==="http"){let s=t.params.indexOf("secure");s>=0&&t.params.splice(s,1)}if(o.path!=="/"&&(t.path=`${o.path}${t.path}`),!ie.REQUIRE_ACCESS_TOKEN)return ni(t);if(e=e||ie.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(s=>s.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),ni(t)}},r.db=function(t,e){e?Ga.add(t):Ga.delete(t)},r.dc=Ii,r.dd=Bo,r.de=Tr,r.df=xt,r.dg=Zi,r.dh=function(t){Ga.delete(t)},r.di=Br,r.dj=Nr,r.dk=M,r.dl=function(t,e){Ve=t,Pt=e},r.dm=function(t,e,i=!1){if(oa===Yp||oa===Xp||oa===Kp)throw new Error("setRTLTextPlugin cannot be called multiple times.");jl=et.resolveURL(t),oa=Yp,Qp=e,Jp(),i||tm()},r.dn=Ul,r.dp=function(){S_().acquire(g0)},r.dq=function(){let t=Hm;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(g0),Hm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dr=Gm,r.ds=function(t){let e=Ei();if(!e)return;let i=e.delete(St);t&&i.catch(t).then(()=>t())},r.dt=Um,r.du=IT,r.dv=function(t){_0=et.resolveURL(t),Vh||(Vh=new f0(S_(),new Qo)),Vh.broadcast("setDracoUrl",_0)},r.dw=ST,r.dx=function(t){Bh=et.resolveURL(t),Vh||(Vh=new f0(S_(),new Qo)),Vh.broadcast("setMeshoptUrl",Bh)},r.dy=Et,r.dz=od,r.e=Gr,r.f=et,r.g=function(t,e){return Ne(Gr(t,{type:"json"}),e)},r.h=es,r.i=Il,r.j=Rd,r.k=lh,r.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>PT(e,0,t))},r.m=cg,r.n=Ud,r.o=Yd,r.p=YC,r.q=hh,r.r=uh,r.s=Hp,r.t=_r,r.u=Zd,r.v=wn,r.w=er,r.x=Kn,r.z=rm}),c(["./shared"],function(r){"use strict";function M(Ue){let Y=Ue?Ue.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function z(Ue){if(typeof Ue=="number"||typeof Ue=="boolean"||typeof Ue=="string"||Ue==null)return JSON.stringify(Ue);if(Array.isArray(Ue)){let ae="[";for(let fe of Ue)ae+=`${z(fe)},`;return`${ae}]`}let Y="{";for(let ae of Object.keys(Ue).sort())Y+=`${ae}:${z(Ue[ae])},`;return`${Y}}`}function ie(Ue){let Y="";for(let ae of r.b2)Y+=`/${z(Ue[ae])}`;return Y}class ue{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,ae){this._layerConfigs={},this._layers={},this.update(Y,[],ae)}update(Y,ae,fe){this._options=fe;for(let Ge of Y)this._layerConfigs[Ge.id]=Ge,(this._layers[Ge.id]=r.c2(Ge,this.scope,this._options)).compileFilter(),this.keyCache[Ge.id]&&delete this.keyCache[Ge.id];for(let Ge of ae)delete this.keyCache[Ge],delete this._layerConfigs[Ge],delete this._layers[Ge];this.familiesBySource={};let Be=function(Ge,et){let St={};for(let Pt=0;Pt<Ge.length;Pt++){let Tt=et&&et[Ge[Pt].id]||ie(Ge[Pt]);et&&(et[Ge[Pt].id]=Tt);let Dt=St[Tt];Dt||(Dt=St[Tt]=[]),Dt.push(Ge[Pt])}let Ve=[];for(let Pt in St)Ve.push(St[Pt]);return Ve}(r.a$(this._layerConfigs),this.keyCache);for(let Ge of Be){let et=Ge.map(Ei=>this._layers[Ei.id]),St=et[0];if(St.visibility==="none")continue;let Ve=St.source||"",Pt=this.familiesBySource[Ve];Pt||(Pt=this.familiesBySource[Ve]={});let Tt=St.sourceLayer||"_geojsonTileLayer",Dt=Pt[Tt];Dt||(Dt=Pt[Tt]=[]),Dt.push(et)}}}let ye=1*r.dA;class Je{constructor(Y){let ae={},fe=[];for(let St in Y){let Ve=Y[St],Pt=ae[St]={};for(let Tt in Ve.glyphs){let Dt=Ve.glyphs[+Tt];if(!Dt||Dt.bitmap.width===0||Dt.bitmap.height===0)continue;let Ei=Dt.metrics.localGlyph?ye:1,mn={x:0,y:0,w:Dt.bitmap.width+2*Ei,h:Dt.bitmap.height+2*Ei};fe.push(mn),Pt[Tt]=mn}}let{w:Be,h:Ge}=r.p(fe),et=new r.dz({width:Be||1,height:Ge||1});for(let St in Y){let Ve=Y[St];for(let Pt in Ve.glyphs){let Tt=Ve.glyphs[+Pt];if(!Tt||Tt.bitmap.width===0||Tt.bitmap.height===0)continue;let Dt=ae[St][Pt],Ei=Tt.metrics.localGlyph?ye:1;r.dz.copy(Tt.bitmap,et,{x:0,y:0},{x:Dt.x+Ei,y:Dt.y+Ei},Tt.bitmap)}}this.image=et,this.positions=ae}}r.dy(Je,"GlyphAtlas");class It{constructor(Y){this.tileID=new r.am(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=r.as(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster}parse(Y,ae,fe,Be,Ge){this.status="parsing",this.data=Y,this.collisionBoxArray=new r.aD;let et=new r.dB(Object.keys(Y.layers).sort()),St=new r.dC(this.tileID,this.promoteId);St.bucketLayerIDs=[];let Ve={},Pt=new r.dD(256,256),Tt={featureIndex:St,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Pt,availableImages:fe,brightness:this.brightness},Dt=ae.familiesBySource[this.source];for(let on in Dt){let Mn=Y.layers[on];if(!Mn)continue;let zr=!1,Ln=!1,To=!1;for(let kr of Dt[on])kr[0].type==="symbol"?zr=!0:Ln=!0,kr[0].is3D()&&kr[0].type!=="model"&&(To=!0);if(this.extraShadowCaster&&!To||this.isSymbolTile===!0&&!zr||this.isSymbolTile===!1&&!Ln)continue;Mn.version===1&&r.w(`Vector tile source "${this.source}" layer "${on}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let ho=et.encode(on),to=[];for(let kr=0;kr<Mn.length;kr++){let gr=Mn.feature(kr),Ne=St.getId(gr,on);to.push({feature:gr,id:Ne,index:kr,sourceLayerIndex:ho})}for(let kr of Dt[on]){let gr=kr[0];(!this.extraShadowCaster||gr.is3D()&&gr.type!=="model")&&(this.isSymbolTile!==void 0&&gr.type==="symbol"!==this.isSymbolTile||gr.minzoom&&this.zoom<Math.floor(gr.minzoom)||gr.maxzoom&&this.zoom>=gr.maxzoom||gr.visibility!=="none"&&(st(kr,this.zoom,Tt.brightness,fe),(Ve[gr.id]=gr.createBucket({index:St.bucketLayerIDs.length,layers:kr,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ho,sourceID:this.source,projection:this.projection.spec})).populate(to,Tt,this.tileID.canonical,this.tileTransform),St.bucketLayerIDs.push(kr.map(Ne=>Ne.id))))}}let Ei,mn,En,gn;Pt.trim();let $i={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ii=()=>{if(Ei)return this.status="done",Ge(Ei);if(this.extraShadowCaster)this.status="done",Ge(null,{buckets:r.a$(Ve).filter(on=>!on.isEmpty()),featureIndex:St,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Tt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(mn&&En&&gn){let on=new Je(mn),Mn=new r.dF(En,gn);for(let zr in Ve){let Ln=Ve[zr];Ln instanceof r.aE?(st(Ln.layers,this.zoom,Tt.brightness,fe),r.dG(Ln,mn,on.positions,En,Mn.iconPositions,this.showCollisionBoxes,fe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Ln.hasPattern&&(Ln instanceof r.aK||Ln instanceof r.aL||Ln instanceof r.cH)&&(st(Ln.layers,this.zoom,Tt.brightness,fe),Ln.addFeatures(Tt,this.tileID.canonical,Mn.patternPositions,fe,this.tileTransform,this.brightness))}this.status="done",Ge(null,{buckets:r.a$(Ve).filter(zr=>!zr.isEmpty()),featureIndex:St,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:on.image,lineAtlas:Pt,imageAtlas:Mn,brightness:Tt.brightness})}};if(!this.extraShadowCaster){let on=r.dE(Tt.glyphDependencies,Ln=>Object.keys(Ln).map(Number));Object.keys(on).length?Be.send("getGlyphs",{uid:this.uid,stacks:on,scope:this.scope},(Ln,To)=>{Ei||(Ei=Ln,mn=To,Ii())},void 0,!1,$i):mn={};let Mn=Object.keys(Tt.iconDependencies);Mn.length?Be.send("getImages",{icons:Mn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Ln,To)=>{Ei||(Ei=Ln,En=To,Ii())},void 0,!1,$i):En={};let zr=Object.keys(Tt.patternDependencies);zr.length?Be.send("getImages",{icons:zr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Ln,To)=>{Ei||(Ei=Ln,gn=To,Ii())},void 0,!1,$i):gn={}}Ii()}}function st(Ue,Y,ae,fe){let Be=new r.K(Y,{brightness:ae});for(let Ge of Ue)Ge.recalculate(Be,fe)}class Xt extends r.E{constructor(Y,ae,fe,Be,Ge,et){super(),this.actor=Y,this.layerIndex=ae,this.availableImages=fe,this.loadVectorData=Ge||r.ah,this.loading={},this.loaded={},this.deduped=new r.af(Y.scheduler),this.isSpriteLoaded=Be,this.scheduler=Y.scheduler,this.brightness=et}loadTile(Y,ae){let fe=Y.uid,Be=Y&&Y.request,Ge=Be&&Be.collectResourceTiming,et=this.loading[fe]=new It(Y);et.abort=this.loadVectorData(Y,(St,Ve)=>{let Pt=!this.loading[fe];if(delete this.loading[fe],Pt||St||!Ve)return et.status="done",Pt||(this.loaded[fe]=et),ae(St);let Tt=Ve.rawData,Dt={};Ve.expires&&(Dt.expires=Ve.expires),Ve.cacheControl&&(Dt.cacheControl=Ve.cacheControl),et.vectorTile=Ve.vectorTile||new r.dH(new r.dI(Tt));let Ei=()=>{et.parse(et.vectorTile,this.layerIndex,this.availableImages,this.actor,(mn,En)=>{if(mn||!En)return ae(mn);let gn={};if(Ge){let $i=M(Be);$i.length>0&&(gn.resourceTiming=JSON.parse(JSON.stringify($i)))}ae(null,r.e({rawTileData:Tt.slice(0)},En,Dt,gn))})};this.isSpriteLoaded?Ei():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Ei,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):Ei()}),this.loaded=this.loaded||{},this.loaded[fe]=et})}reloadTile(Y,ae){let fe=this.loaded,Be=Y.uid,Ge=this;if(fe&&fe[Be]){let et=fe[Be];et.showCollisionBoxes=Y.showCollisionBoxes,et.projection=Y.projection,et.brightness=Y.brightness,et.tileTransform=r.as(Y.tileID.canonical,Y.projection),et.extraShadowCaster=Y.extraShadowCaster;let St=(Ve,Pt)=>{let Tt=et.reloadCallback;Tt&&(delete et.reloadCallback,et.parse(et.vectorTile,Ge.layerIndex,this.availableImages,Ge.actor,Tt)),ae(Ve,Pt)};et.status==="parsing"?et.reloadCallback=St:et.status==="done"&&(et.vectorTile?et.parse(et.vectorTile,this.layerIndex,this.availableImages,this.actor,St):St())}else ae(null,void 0)}abortTile(Y,ae){let fe=Y.uid,Be=this.loading[fe];Be&&(Be.abort&&Be.abort(),delete this.loading[fe]),ae()}removeTile(Y,ae){let fe=this.loaded,Be=Y.uid;fe&&fe[Be]&&delete fe[Be],ae()}}class Oi{loadTile(Y,ae){let{uid:fe,encoding:Be,rawImageData:Ge,padding:et}=Y,St=ImageBitmap&&Ge instanceof ImageBitmap?this.getImageData(Ge,et):Ge;ae(null,new r.dJ(fe,St,Be,et<1))}getImageData(Y,ae){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);let fe=this.offscreenCanvasContext.getImageData(-ae,-ae,Y.width+2*ae,Y.height+2*ae);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),fe}}class vi{decodeRasterArray({task:Y,buffer:ae},fe){r.aZ.performDecoding(ae,Y).then(Be=>{fe(null,Be)},Be=>{fe(Be)})}}function Ti(Ue,Y){if(Ue.length!==0){xn(Ue[0],Y);for(var ae=1;ae<Ue.length;ae++)xn(Ue[ae],!Y)}}function xn(Ue,Y){for(var ae=0,fe=0,Be=0,Ge=Ue.length,et=Ge-1;Be<Ge;et=Be++){var St=(Ue[Be][0]-Ue[et][0])*(Ue[et][1]+Ue[Be][1]),Ve=ae+St;fe+=Math.abs(ae)>=Math.abs(St)?ae-Ve+St:St-Ve+ae,ae=Ve}ae+fe>=0!=!!Y&&Ue.reverse()}var Wo=r.dK(function Ue(Y,ae){var fe,Be=Y&&Y.type;if(Be==="FeatureCollection")for(fe=0;fe<Y.features.length;fe++)Ue(Y.features[fe],ae);else if(Be==="GeometryCollection")for(fe=0;fe<Y.geometries.length;fe++)Ue(Y.geometries[fe],ae);else if(Be==="Feature")Ue(Y.geometry,ae);else if(Be==="Polygon")Ti(Y.coordinates,ae);else if(Be==="MultiPolygon")for(fe=0;fe<Y.coordinates.length;fe++)Ti(Y.coordinates[fe],ae);return Y});let ur=r.dL.prototype.toGeoJSON,Lo=class{constructor(Ue){this._feature=Ue,this.extent=r.V,this.type=Ue.type,this.properties=Ue.tags,"id"in Ue&&!isNaN(Ue.id)&&(this.id=parseInt(Ue.id,10))}loadGeometry(){if(this._feature.type===1){let Ue=[];for(let Y of this._feature.geometry)Ue.push([new r.P(Y[0],Y[1])]);return Ue}{let Ue=[];for(let Y of this._feature.geometry){let ae=[];for(let fe of Y)ae.push(new r.P(fe[0],fe[1]));Ue.push(ae)}return Ue}}toGeoJSON(Ue,Y,ae){return ur.call(this,Ue,Y,ae)}},dt=class{constructor(Ue){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.V,this.length=Ue.length,this._features=Ue}feature(Ue){return new Lo(this._features[Ue])}};var ja={exports:{}},Cl=r.dN,Fi=r.dM.VectorTileFeature,qn=Nc;function Nc(Ue,Y){this.options=Y||{},this.features=Ue,this.length=Ue.length}function yt(Ue,Y){this.id=typeof Ue.id=="number"?Ue.id:void 0,this.type=Ue.type,this.rawGeometry=Ue.type===1?[Ue.geometry]:Ue.geometry,this.properties=Ue.tags,this.extent=Y||4096}Nc.prototype.feature=function(Ue){return new yt(this.features[Ue],this.options.extent)},yt.prototype.loadGeometry=function(){var Ue=this.rawGeometry;this.geometry=[];for(var Y=0;Y<Ue.length;Y++){for(var ae=Ue[Y],fe=[],Be=0;Be<ae.length;Be++)fe.push(new Cl(ae[Be][0],ae[Be][1]));this.geometry.push(fe)}return this.geometry},yt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ue=this.geometry,Y=1/0,ae=-1/0,fe=1/0,Be=-1/0,Ge=0;Ge<Ue.length;Ge++)for(var et=Ue[Ge],St=0;St<et.length;St++){var Ve=et[St];Y=Math.min(Y,Ve.x),ae=Math.max(ae,Ve.x),fe=Math.min(fe,Ve.y),Be=Math.max(Be,Ve.y)}return[Y,fe,ae,Be]},yt.prototype.toGeoJSON=Fi.prototype.toGeoJSON;var Zo=r.dO,Yr=qn;function gi(Ue){var Y=new Zo;return function(ae,fe){for(var Be in ae.layers)fe.writeMessage(3,us,ae.layers[Be])}(Ue,Y),Y.finish()}function us(Ue,Y){var ae;Y.writeVarintField(15,Ue.version||1),Y.writeStringField(1,Ue.name||""),Y.writeVarintField(5,Ue.extent||4096);var fe={keys:[],values:[],keycache:{},valuecache:{}};for(ae=0;ae<Ue.length;ae++)fe.feature=Ue.feature(ae),Y.writeMessage(2,Ia,fe);var Be=fe.keys;for(ae=0;ae<Be.length;ae++)Y.writeStringField(3,Be[ae]);var Ge=fe.values;for(ae=0;ae<Ge.length;ae++)Y.writeMessage(4,ma,Ge[ae])}function Ia(Ue,Y){var ae=Ue.feature;ae.id!==void 0&&Y.writeVarintField(1,ae.id),Y.writeMessage(2,Yo,Ue),Y.writeVarintField(3,ae.type),Y.writeMessage(4,Lr,ae)}function Yo(Ue,Y){var ae=Ue.feature,fe=Ue.keys,Be=Ue.values,Ge=Ue.keycache,et=Ue.valuecache;for(var St in ae.properties){var Ve=ae.properties[St],Pt=Ge[St];if(Ve!==null){Pt===void 0&&(fe.push(St),Ge[St]=Pt=fe.length-1),Y.writeVarint(Pt);var Tt=typeof Ve;Tt!=="string"&&Tt!=="boolean"&&Tt!=="number"&&(Ve=JSON.stringify(Ve));var Dt=Tt+":"+Ve,Ei=et[Dt];Ei===void 0&&(Be.push(Ve),et[Dt]=Ei=Be.length-1),Y.writeVarint(Ei)}}}function Gr(Ue,Y){return(Y<<3)+(7&Ue)}function Ua(Ue){return Ue<<1^Ue>>31}function Lr(Ue,Y){for(var ae=Ue.loadGeometry(),fe=Ue.type,Be=0,Ge=0,et=ae.length,St=0;St<et;St++){var Ve=ae[St],Pt=1;fe===1&&(Pt=Ve.length),Y.writeVarint(Gr(1,Pt));for(var Tt=fe===3?Ve.length-1:Ve.length,Dt=0;Dt<Tt;Dt++){Dt===1&&fe!==1&&Y.writeVarint(Gr(2,Tt-1));var Ei=Ve[Dt].x-Be,mn=Ve[Dt].y-Ge;Y.writeVarint(Ua(Ei)),Y.writeVarint(Ua(mn)),Be+=Ei,Ge+=mn}fe===3&&Y.writeVarint(Gr(7,1))}}function ma(Ue,Y){var ae=typeof Ue;ae==="string"?Y.writeStringField(1,Ue):ae==="boolean"?Y.writeBooleanField(7,Ue):ae==="number"&&(Ue%1!=0?Y.writeDoubleField(3,Ue):Ue<0?Y.writeSVarintField(6,Ue):Y.writeVarintField(5,Ue))}ja.exports=gi,ja.exports.fromVectorTileJs=gi,ja.exports.fromGeojsonVt=function(Ue,Y){Y=Y||{};var ae={};for(var fe in Ue)ae[fe]=new Yr(Ue[fe].features,Y),ae[fe].name=fe,ae[fe].version=Y.version,ae[fe].extent=Y.extent;return gi({layers:ae})},ja.exports.GeoJSONWrapper=Yr;var zo=r.dK(ja.exports);let co={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ue=>Ue},Ps=Math.fround||(Xo=new Float32Array(1),Ue=>(Xo[0]=+Ue,Xo[0]));var Xo;let Bn=3,Mi=5,Ao=6;class Bc{constructor(Y){this.options=Object.assign(Object.create(co),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){let{log:ae,minZoom:fe,maxZoom:Be}=this.options;ae&&console.time("total time");let Ge=`prepare ${Y.length} points`;ae&&console.time(Ge),this.points=Y;let et=[];for(let Ve=0;Ve<Y.length;Ve++){let Pt=Y[Ve];if(!Pt.geometry)continue;let[Tt,Dt]=Pt.geometry.coordinates,Ei=Ps(Os(Tt)),mn=Ps(Sn(Dt));et.push(Ei,mn,1/0,Ve,-1,1),this.options.reduce&&et.push(0)}let St=this.trees[Be+1]=this._createTree(et);ae&&console.timeEnd(Ge);for(let Ve=Be;Ve>=fe;Ve--){let Pt=+Date.now();St=this.trees[Ve]=this._createTree(this._cluster(St,Ve)),ae&&console.log("z%d: %d clusters in %dms",Ve,St.numItems,+Date.now()-Pt)}return ae&&console.timeEnd("total time"),this}getClusters(Y,ae){let fe=((Y[0]+180)%360+360)%360-180,Be=Math.max(-90,Math.min(90,Y[1])),Ge=Y[2]===180?180:((Y[2]+180)%360+360)%360-180,et=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)fe=-180,Ge=180;else if(fe>Ge){let Dt=this.getClusters([fe,Be,180,et],ae),Ei=this.getClusters([-180,Be,Ge,et],ae);return Dt.concat(Ei)}let St=this.trees[this._limitZoom(ae)],Ve=St.range(Os(fe),Sn(et),Os(Ge),Sn(Be)),Pt=St.data,Tt=[];for(let Dt of Ve){let Ei=this.stride*Dt;Tt.push(Pt[Ei+Mi]>1?er(Pt,Ei,this.clusterProps):this.points[Pt[Ei+Bn]])}return Tt}getChildren(Y){let ae=this._getOriginId(Y),fe=this._getOriginZoom(Y),Be="No cluster with the specified id.",Ge=this.trees[fe];if(!Ge)throw new Error(Be);let et=Ge.data;if(ae*this.stride>=et.length)throw new Error(Be);let St=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),Ve=Ge.within(et[ae*this.stride],et[ae*this.stride+1],St),Pt=[];for(let Tt of Ve){let Dt=Tt*this.stride;et[Dt+4]===Y&&Pt.push(et[Dt+Mi]>1?er(et,Dt,this.clusterProps):this.points[et[Dt+Bn]])}if(Pt.length===0)throw new Error(Be);return Pt}getLeaves(Y,ae,fe){let Be=[];return this._appendLeaves(Be,Y,ae=ae||10,fe=fe||0,0),Be}getTile(Y,ae,fe){let Be=this.trees[this._limitZoom(Y)],Ge=Math.pow(2,Y),{extent:et,radius:St}=this.options,Ve=St/et,Pt=(fe-Ve)/Ge,Tt=(fe+1+Ve)/Ge,Dt={features:[]};return this._addTileFeatures(Be.range((ae-Ve)/Ge,Pt,(ae+1+Ve)/Ge,Tt),Be.data,ae,fe,Ge,Dt),ae===0&&this._addTileFeatures(Be.range(1-Ve/Ge,Pt,1,Tt),Be.data,Ge,fe,Ge,Dt),ae===Ge-1&&this._addTileFeatures(Be.range(0,Pt,Ve/Ge,Tt),Be.data,-1,fe,Ge,Dt),Dt.features.length?Dt:null}getClusterExpansionZoom(Y){let ae=this._getOriginZoom(Y)-1;for(;ae<=this.options.maxZoom;){let fe=this.getChildren(Y);if(ae++,fe.length!==1)break;Y=fe[0].properties.cluster_id}return ae}_appendLeaves(Y,ae,fe,Be,Ge){let et=this.getChildren(ae);for(let St of et){let Ve=St.properties;if(Ve&&Ve.cluster?Ge+Ve.point_count<=Be?Ge+=Ve.point_count:Ge=this._appendLeaves(Y,Ve.cluster_id,fe,Be,Ge):Ge<Be?Ge++:Y.push(St),Y.length===fe)break}return Ge}_createTree(Y){let ae=new r.bg(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fe=0;fe<Y.length;fe+=this.stride)ae.add(Y[fe],Y[fe+1]);return ae.finish(),ae.data=Y,ae}_addTileFeatures(Y,ae,fe,Be,Ge,et){for(let St of Y){let Ve=St*this.stride,Pt=ae[Ve+Mi]>1,Tt,Dt,Ei;if(Pt)Tt=uo(ae,Ve,this.clusterProps),Dt=ae[Ve],Ei=ae[Ve+1];else{let gn=this.points[ae[Ve+Bn]];Tt=gn.properties;let[$i,Ii]=gn.geometry.coordinates;Dt=Os($i),Ei=Sn(Ii)}let mn={type:1,geometry:[[Math.round(this.options.extent*(Dt*Ge-fe)),Math.round(this.options.extent*(Ei*Ge-Be))]],tags:Tt},En;En=Pt||this.options.generateId?ae[Ve+Bn]:this.points[ae[Ve+Bn]].id,En!==void 0&&(mn.id=En),et.features.push(mn)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,ae){let{radius:fe,extent:Be,reduce:Ge,minPoints:et}=this.options,St=fe/(Be*Math.pow(2,ae)),Ve=Y.data,Pt=[],Tt=this.stride;for(let Dt=0;Dt<Ve.length;Dt+=Tt){if(Ve[Dt+2]<=ae)continue;Ve[Dt+2]=ae;let Ei=Ve[Dt],mn=Ve[Dt+1],En=Y.within(Ve[Dt],Ve[Dt+1],St),gn=Ve[Dt+Mi],$i=gn;for(let Ii of En){let on=Ii*Tt;Ve[on+2]>ae&&($i+=Ve[on+Mi])}if($i>gn&&$i>=et){let Ii,on=Ei*gn,Mn=mn*gn,zr=-1,Ln=(Dt/Tt<<5)+(ae+1)+this.points.length;for(let To of En){let ho=To*Tt;if(Ve[ho+2]<=ae)continue;Ve[ho+2]=ae;let to=Ve[ho+Mi];on+=Ve[ho]*to,Mn+=Ve[ho+1]*to,Ve[ho+4]=Ln,Ge&&(Ii||(Ii=this._map(Ve,Dt,!0),zr=this.clusterProps.length,this.clusterProps.push(Ii)),Ge(Ii,this._map(Ve,ho)))}Ve[Dt+4]=Ln,Pt.push(on/$i,Mn/$i,1/0,Ln,-1,$i),Ge&&Pt.push(zr)}else{for(let Ii=0;Ii<Tt;Ii++)Pt.push(Ve[Dt+Ii]);if($i>1)for(let Ii of En){let on=Ii*Tt;if(!(Ve[on+2]<=ae)){Ve[on+2]=ae;for(let Mn=0;Mn<Tt;Mn++)Pt.push(Ve[on+Mn])}}}}return Pt}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,ae,fe){if(Y[ae+Mi]>1){let et=this.clusterProps[Y[ae+Ao]];return fe?Object.assign({},et):et}let Be=this.points[Y[ae+Bn]].properties,Ge=this.options.map(Be);return fe&&Ge===Be?Object.assign({},Ge):Ge}}function er(Ue,Y,ae){return{type:"Feature",id:Ue[Y+Bn],properties:uo(Ue,Y,ae),geometry:{type:"Point",coordinates:[(fe=Ue[Y],360*(fe-.5)),fa(Ue[Y+1])]}};var fe}function uo(Ue,Y,ae){let fe=Ue[Y+Mi],Be=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe,Ge=Ue[Y+Ao],et=Ge===-1?{}:Object.assign({},ae[Ge]);return Object.assign(et,{cluster:!0,cluster_id:Ue[Y+Bn],point_count:fe,point_count_abbreviated:Be})}function Os(Ue){return Ue/360+.5}function Sn(Ue){let Y=Math.sin(Ue*Math.PI/180),ae=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return ae<0?0:ae>1?1:ae}function fa(Ue){let Y=(180-360*Ue)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}var Fs={exports:{}};Fs.exports=function(){function Ue(Ne,Le,tt,lt){for(var it,ht=lt,gt=tt-Le>>1,rt=tt-Le,xt=Ne[Le],pt=Ne[Le+1],ti=Ne[tt],ni=Ne[tt+1],Bt=Le+3;Bt<tt;Bt+=3){var In=Y(Ne[Bt],Ne[Bt+1],xt,pt,ti,ni);if(In>ht)it=Bt,ht=In;else if(In===ht){var Gn=Math.abs(Bt-gt);Gn<rt&&(it=Bt,rt=Gn)}}ht>lt&&(it-Le>3&&Ue(Ne,Le,it,lt),Ne[it+2]=ht,tt-it>3&&Ue(Ne,it,tt,lt))}function Y(Ne,Le,tt,lt,it,ht){var gt=it-tt,rt=ht-lt;if(gt!==0||rt!==0){var xt=((Ne-tt)*gt+(Le-lt)*rt)/(gt*gt+rt*rt);xt>1?(tt=it,lt=ht):xt>0&&(tt+=gt*xt,lt+=rt*xt)}return(gt=Ne-tt)*gt+(rt=Le-lt)*rt}function ae(Ne,Le,tt,lt){var it={id:Ne===void 0?null:Ne,type:Le,geometry:tt,tags:lt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ht){var gt=ht.geometry,rt=ht.type;if(rt==="Point"||rt==="MultiPoint"||rt==="LineString")fe(ht,gt);else if(rt==="Polygon"||rt==="MultiLineString")for(var xt=0;xt<gt.length;xt++)fe(ht,gt[xt]);else if(rt==="MultiPolygon")for(xt=0;xt<gt.length;xt++)for(var pt=0;pt<gt[xt].length;pt++)fe(ht,gt[xt][pt])}(it),it}function fe(Ne,Le){for(var tt=0;tt<Le.length;tt+=3)Ne.minX=Math.min(Ne.minX,Le[tt]),Ne.minY=Math.min(Ne.minY,Le[tt+1]),Ne.maxX=Math.max(Ne.maxX,Le[tt]),Ne.maxY=Math.max(Ne.maxY,Le[tt+1])}function Be(Ne,Le,tt,lt){if(Le.geometry){var it=Le.geometry.coordinates,ht=Le.geometry.type,gt=Math.pow(tt.tolerance/((1<<tt.maxZoom)*tt.extent),2),rt=[],xt=Le.id;if(tt.promoteId?xt=Le.properties[tt.promoteId]:tt.generateId&&(xt=lt||0),ht==="Point")Ge(it,rt);else if(ht==="MultiPoint")for(var pt=0;pt<it.length;pt++)Ge(it[pt],rt);else if(ht==="LineString")et(it,rt,gt,!1);else if(ht==="MultiLineString"){if(tt.lineMetrics){for(pt=0;pt<it.length;pt++)et(it[pt],rt=[],gt,!1),Ne.push(ae(xt,"LineString",rt,Le.properties));return}St(it,rt,gt,!1)}else if(ht==="Polygon")St(it,rt,gt,!0);else{if(ht!=="MultiPolygon"){if(ht==="GeometryCollection"){for(pt=0;pt<Le.geometry.geometries.length;pt++)Be(Ne,{id:xt,geometry:Le.geometry.geometries[pt],properties:Le.properties},tt,lt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(pt=0;pt<it.length;pt++){var ti=[];St(it[pt],ti,gt,!0),rt.push(ti)}}Ne.push(ae(xt,ht,rt,Le.properties))}}function Ge(Ne,Le){Le.push(Ve(Ne[0])),Le.push(Pt(Ne[1])),Le.push(0)}function et(Ne,Le,tt,lt){for(var it,ht,gt=0,rt=0;rt<Ne.length;rt++){var xt=Ve(Ne[rt][0]),pt=Pt(Ne[rt][1]);Le.push(xt),Le.push(pt),Le.push(0),rt>0&&(gt+=lt?(it*pt-xt*ht)/2:Math.sqrt(Math.pow(xt-it,2)+Math.pow(pt-ht,2))),it=xt,ht=pt}var ti=Le.length-3;Le[2]=1,Ue(Le,0,ti,tt),Le[ti+2]=1,Le.size=Math.abs(gt),Le.start=0,Le.end=Le.size}function St(Ne,Le,tt,lt){for(var it=0;it<Ne.length;it++){var ht=[];et(Ne[it],ht,tt,lt),Le.push(ht)}}function Ve(Ne){return Ne/360+.5}function Pt(Ne){var Le=Math.sin(Ne*Math.PI/180),tt=.5-.25*Math.log((1+Le)/(1-Le))/Math.PI;return tt<0?0:tt>1?1:tt}function Tt(Ne,Le,tt,lt,it,ht,gt,rt){if(lt/=Le,ht>=(tt/=Le)&&gt<lt)return Ne;if(gt<tt||ht>=lt)return null;for(var xt=[],pt=0;pt<Ne.length;pt++){var ti=Ne[pt],ni=ti.geometry,Bt=ti.type,In=it===0?ti.minX:ti.minY,Gn=it===0?ti.maxX:ti.maxY;if(In>=tt&&Gn<lt)xt.push(ti);else if(!(Gn<tt||In>=lt)){var Wn=[];if(Bt==="Point"||Bt==="MultiPoint")Dt(ni,Wn,tt,lt,it);else if(Bt==="LineString")Ei(ni,Wn,tt,lt,it,!1,rt.lineMetrics);else if(Bt==="MultiLineString")En(ni,Wn,tt,lt,it,!1);else if(Bt==="Polygon")En(ni,Wn,tt,lt,it,!0);else if(Bt==="MultiPolygon")for(var Rr=0;Rr<ni.length;Rr++){var Nr=[];En(ni[Rr],Nr,tt,lt,it,!0),Nr.length&&Wn.push(Nr)}if(Wn.length){if(rt.lineMetrics&&Bt==="LineString"){for(Rr=0;Rr<Wn.length;Rr++)xt.push(ae(ti.id,Bt,Wn[Rr],ti.tags));continue}Bt!=="LineString"&&Bt!=="MultiLineString"||(Wn.length===1?(Bt="LineString",Wn=Wn[0]):Bt="MultiLineString"),Bt!=="Point"&&Bt!=="MultiPoint"||(Bt=Wn.length===3?"Point":"MultiPoint"),xt.push(ae(ti.id,Bt,Wn,ti.tags))}}}return xt.length?xt:null}function Dt(Ne,Le,tt,lt,it){for(var ht=0;ht<Ne.length;ht+=3){var gt=Ne[ht+it];gt>=tt&&gt<=lt&&(Le.push(Ne[ht]),Le.push(Ne[ht+1]),Le.push(Ne[ht+2]))}}function Ei(Ne,Le,tt,lt,it,ht,gt){for(var rt,xt,pt=mn(Ne),ti=it===0?$i:Ii,ni=Ne.start,Bt=0;Bt<Ne.length-3;Bt+=3){var In=Ne[Bt],Gn=Ne[Bt+1],Wn=Ne[Bt+2],Rr=Ne[Bt+3],Nr=Ne[Bt+4],Zi=it===0?In:Gn,po=it===0?Rr:Nr,Bo=!1;gt&&(rt=Math.sqrt(Math.pow(In-Rr,2)+Math.pow(Gn-Nr,2))),Zi<tt?po>tt&&(xt=ti(pt,In,Gn,Rr,Nr,tt),gt&&(pt.start=ni+rt*xt)):Zi>lt?po<lt&&(xt=ti(pt,In,Gn,Rr,Nr,lt),gt&&(pt.start=ni+rt*xt)):gn(pt,In,Gn,Wn),po<tt&&Zi>=tt&&(xt=ti(pt,In,Gn,Rr,Nr,tt),Bo=!0),po>lt&&Zi<=lt&&(xt=ti(pt,In,Gn,Rr,Nr,lt),Bo=!0),!ht&&Bo&&(gt&&(pt.end=ni+rt*xt),Le.push(pt),pt=mn(Ne)),gt&&(ni+=rt)}var Br=Ne.length-3;In=Ne[Br],Gn=Ne[Br+1],Wn=Ne[Br+2],(Zi=it===0?In:Gn)>=tt&&Zi<=lt&&gn(pt,In,Gn,Wn),Br=pt.length-3,ht&&Br>=3&&(pt[Br]!==pt[0]||pt[Br+1]!==pt[1])&&gn(pt,pt[0],pt[1],pt[2]),pt.length&&Le.push(pt)}function mn(Ne){var Le=[];return Le.size=Ne.size,Le.start=Ne.start,Le.end=Ne.end,Le}function En(Ne,Le,tt,lt,it,ht){for(var gt=0;gt<Ne.length;gt++)Ei(Ne[gt],Le,tt,lt,it,ht,!1)}function gn(Ne,Le,tt,lt){Ne.push(Le),Ne.push(tt),Ne.push(lt)}function $i(Ne,Le,tt,lt,it,ht){var gt=(ht-Le)/(lt-Le);return Ne.push(ht),Ne.push(tt+(it-tt)*gt),Ne.push(1),gt}function Ii(Ne,Le,tt,lt,it,ht){var gt=(ht-tt)/(it-tt);return Ne.push(Le+(lt-Le)*gt),Ne.push(ht),Ne.push(1),gt}function on(Ne,Le){for(var tt=[],lt=0;lt<Ne.length;lt++){var it,ht=Ne[lt],gt=ht.type;if(gt==="Point"||gt==="MultiPoint"||gt==="LineString")it=Mn(ht.geometry,Le);else if(gt==="MultiLineString"||gt==="Polygon"){it=[];for(var rt=0;rt<ht.geometry.length;rt++)it.push(Mn(ht.geometry[rt],Le))}else if(gt==="MultiPolygon")for(it=[],rt=0;rt<ht.geometry.length;rt++){for(var xt=[],pt=0;pt<ht.geometry[rt].length;pt++)xt.push(Mn(ht.geometry[rt][pt],Le));it.push(xt)}tt.push(ae(ht.id,gt,it,ht.tags))}return tt}function Mn(Ne,Le){var tt=[];tt.size=Ne.size,Ne.start!==void 0&&(tt.start=Ne.start,tt.end=Ne.end);for(var lt=0;lt<Ne.length;lt+=3)tt.push(Ne[lt]+Le,Ne[lt+1],Ne[lt+2]);return tt}function zr(Ne,Le){if(Ne.transformed)return Ne;var tt,lt,it,ht=1<<Ne.z,gt=Ne.x,rt=Ne.y;for(tt=0;tt<Ne.features.length;tt++){var xt=Ne.features[tt],pt=xt.geometry,ti=xt.type;if(xt.geometry=[],ti===1)for(lt=0;lt<pt.length;lt+=2)xt.geometry.push(Ln(pt[lt],pt[lt+1],Le,ht,gt,rt));else for(lt=0;lt<pt.length;lt++){var ni=[];for(it=0;it<pt[lt].length;it+=2)ni.push(Ln(pt[lt][it],pt[lt][it+1],Le,ht,gt,rt));xt.geometry.push(ni)}}return Ne.transformed=!0,Ne}function Ln(Ne,Le,tt,lt,it,ht){return[Math.round(tt*(Ne*lt-it)),Math.round(tt*(Le*lt-ht))]}function To(Ne,Le,tt,lt,it){for(var ht=Le===it.maxZoom?0:it.tolerance/((1<<Le)*it.extent),gt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:tt,y:lt,z:Le,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},rt=0;rt<Ne.length;rt++){gt.numFeatures++,ho(gt,Ne[rt],ht,it);var xt=Ne[rt].minX,pt=Ne[rt].minY,ti=Ne[rt].maxX,ni=Ne[rt].maxY;xt<gt.minX&&(gt.minX=xt),pt<gt.minY&&(gt.minY=pt),ti>gt.maxX&&(gt.maxX=ti),ni>gt.maxY&&(gt.maxY=ni)}return gt}function ho(Ne,Le,tt,lt){var it=Le.geometry,ht=Le.type,gt=[];if(ht==="Point"||ht==="MultiPoint")for(var rt=0;rt<it.length;rt+=3)gt.push(it[rt]),gt.push(it[rt+1]),Ne.numPoints++,Ne.numSimplified++;else if(ht==="LineString")to(gt,it,Ne,tt,!1,!1);else if(ht==="MultiLineString"||ht==="Polygon")for(rt=0;rt<it.length;rt++)to(gt,it[rt],Ne,tt,ht==="Polygon",rt===0);else if(ht==="MultiPolygon")for(var xt=0;xt<it.length;xt++){var pt=it[xt];for(rt=0;rt<pt.length;rt++)to(gt,pt[rt],Ne,tt,!0,rt===0)}if(gt.length){var ti=Le.tags||null;if(ht==="LineString"&&lt.lineMetrics){for(var ni in ti={},Le.tags)ti[ni]=Le.tags[ni];ti.mapbox_clip_start=it.start/it.size,ti.mapbox_clip_end=it.end/it.size}var Bt={geometry:gt,type:ht==="Polygon"||ht==="MultiPolygon"?3:ht==="LineString"||ht==="MultiLineString"?2:1,tags:ti};Le.id!==null&&(Bt.id=Le.id),Ne.features.push(Bt)}}function to(Ne,Le,tt,lt,it,ht){var gt=lt*lt;if(lt>0&&Le.size<(it?gt:lt))tt.numPoints+=Le.length/3;else{for(var rt=[],xt=0;xt<Le.length;xt+=3)(lt===0||Le[xt+2]>gt)&&(tt.numSimplified++,rt.push(Le[xt]),rt.push(Le[xt+1])),tt.numPoints++;it&&function(pt,ti){for(var ni=0,Bt=0,In=pt.length,Gn=In-2;Bt<In;Gn=Bt,Bt+=2)ni+=(pt[Bt]-pt[Gn])*(pt[Bt+1]+pt[Gn+1]);if(ni>0===ti)for(Bt=0,In=pt.length;Bt<In/2;Bt+=2){var Wn=pt[Bt],Rr=pt[Bt+1];pt[Bt]=pt[In-2-Bt],pt[Bt+1]=pt[In-1-Bt],pt[In-2-Bt]=Wn,pt[In-1-Bt]=Rr}}(rt,ht),Ne.push(rt)}}function kr(Ne,Le){var tt=(Le=this.options=function(it,ht){for(var gt in ht)it[gt]=ht[gt];return it}(Object.create(this.options),Le)).debug;if(tt&&console.time("preprocess data"),Le.maxZoom<0||Le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Le.promoteId&&Le.generateId)throw new Error("promoteId and generateId cannot be used together.");var lt=function(it,ht){var gt=[];if(it.type==="FeatureCollection")for(var rt=0;rt<it.features.length;rt++)Be(gt,it.features[rt],ht,rt);else Be(gt,it.type==="Feature"?it:{geometry:it},ht);return gt}(Ne,Le);this.tiles={},this.tileCoords=[],tt&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Le.indexMaxZoom,Le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(lt=function(it,ht){var gt=ht.buffer/ht.extent,rt=it,xt=Tt(it,1,-1-gt,gt,0,-1,2,ht),pt=Tt(it,1,1-gt,2+gt,0,-1,2,ht);return(xt||pt)&&(rt=Tt(it,1,-gt,1+gt,0,-1,2,ht)||[],xt&&(rt=on(xt,1).concat(rt)),pt&&(rt=rt.concat(on(pt,-1)))),rt}(lt,Le)).length&&this.splitTile(lt,0,0,0),tt&&(lt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function gr(Ne,Le,tt){return 32*((1<<Ne)*tt+Le)+Ne}return kr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},kr.prototype.splitTile=function(Ne,Le,tt,lt,it,ht,gt){for(var rt=[Ne,Le,tt,lt],xt=this.options,pt=xt.debug;rt.length;){lt=rt.pop(),tt=rt.pop(),Le=rt.pop(),Ne=rt.pop();var ti=1<<Le,ni=gr(Le,tt,lt),Bt=this.tiles[ni];if(!Bt&&(pt>1&&console.time("creation"),Bt=this.tiles[ni]=To(Ne,Le,tt,lt,xt),this.tileCoords.push({z:Le,x:tt,y:lt}),pt)){pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Le,tt,lt,Bt.numFeatures,Bt.numPoints,Bt.numSimplified),console.timeEnd("creation"));var In="z"+Le;this.stats[In]=(this.stats[In]||0)+1,this.total++}if(Bt.source=Ne,it){if(Le===xt.maxZoom||Le===it)continue;var Gn=1<<it-Le;if(tt!==Math.floor(ht/Gn)||lt!==Math.floor(gt/Gn))continue}else if(Le===xt.indexMaxZoom||Bt.numPoints<=xt.indexMaxPoints)continue;if(Bt.source=null,Ne.length!==0){pt>1&&console.time("clipping");var Wn,Rr,Nr,Zi,po,Bo,Br=.5*xt.buffer/xt.extent,Tr=.5-Br,Ga=.5+Br,Ls=1+Br;Wn=Rr=Nr=Zi=null,po=Tt(Ne,ti,tt-Br,tt+Ga,0,Bt.minX,Bt.maxX,xt),Bo=Tt(Ne,ti,tt+Tr,tt+Ls,0,Bt.minX,Bt.maxX,xt),Ne=null,po&&(Wn=Tt(po,ti,lt-Br,lt+Ga,1,Bt.minY,Bt.maxY,xt),Rr=Tt(po,ti,lt+Tr,lt+Ls,1,Bt.minY,Bt.maxY,xt),po=null),Bo&&(Nr=Tt(Bo,ti,lt-Br,lt+Ga,1,Bt.minY,Bt.maxY,xt),Zi=Tt(Bo,ti,lt+Tr,lt+Ls,1,Bt.minY,Bt.maxY,xt),Bo=null),pt>1&&console.timeEnd("clipping"),rt.push(Wn||[],Le+1,2*tt,2*lt),rt.push(Rr||[],Le+1,2*tt,2*lt+1),rt.push(Nr||[],Le+1,2*tt+1,2*lt),rt.push(Zi||[],Le+1,2*tt+1,2*lt+1)}}},kr.prototype.getTile=function(Ne,Le,tt){var lt=this.options,it=lt.extent,ht=lt.debug;if(Ne<0||Ne>24)return null;var gt=1<<Ne,rt=gr(Ne,Le=(Le%gt+gt)%gt,tt);if(this.tiles[rt])return zr(this.tiles[rt],it);ht>1&&console.log("drilling down to z%d-%d-%d",Ne,Le,tt);for(var xt,pt=Ne,ti=Le,ni=tt;!xt&&pt>0;)pt--,ti=Math.floor(ti/2),ni=Math.floor(ni/2),xt=this.tiles[gr(pt,ti,ni)];return xt&&xt.source?(ht>1&&console.log("found parent tile z%d-%d-%d",pt,ti,ni),ht>1&&console.time("drilling down"),this.splitTile(xt.source,pt,ti,ni,Ne,Le,tt),ht>1&&console.timeEnd("drilling down"),this.tiles[rt]?zr(this.tiles[rt],it):null):null},function(Ne,Le){return new kr(Ne,Le)}}();var Cr=r.dK(Fs.exports);function No(Ue,Y){let ae=Ue.tileID.canonical;if(!this._geoJSONIndex)return Y(null,null);let fe=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!fe)return Y(null,null);let Be=new dt(fe.features),Ge=zo(Be);Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),Y(null,{vectorTile:Be,rawData:Ge.buffer})}class Tl extends Xt{constructor(Y,ae,fe,Be,Ge,et){super(Y,ae,fe,Be,No,et),Ge&&(this.loadGeoJSON=Ge)}loadData(Y,ae){let fe=Y&&Y.request,Be=fe&&fe.collectResourceTiming;this.loadGeoJSON(Y,(Ge,et)=>{if(Ge||!et)return ae(Ge);if(typeof et!="object")return ae(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{Wo(et,!0);try{if(Y.filter){let Ve=r.r(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ve.result==="error")throw new Error(Ve.value.map(Tt=>`${Tt.key}: ${Tt.message}`).join(", "));et={type:"FeatureCollection",features:et.features.filter(Tt=>Ve.value.evaluate({zoom:0},Tt))}}this._geoJSONIndex=Y.cluster?new Bc(function({superclusterOptions:Ve,clusterProperties:Pt}){if(!Pt||!Ve)return Ve;let Tt={},Dt={},Ei={accumulated:null,zoom:0},mn={properties:null},En=Object.keys(Pt);for(let gn of En){let[$i,Ii]=Pt[gn],on=r.r(Ii),Mn=r.r(typeof $i=="string"?[$i,["accumulated"],["get",gn]]:$i);Tt[gn]=on.value,Dt[gn]=Mn.value}return Ve.map=gn=>{mn.properties=gn;let $i={};for(let Ii of En)$i[Ii]=Tt[Ii].evaluate(Ei,mn);return $i},Ve.reduce=(gn,$i)=>{mn.properties=$i;for(let Ii of En)Ei.accumulated=gn[Ii],gn[Ii]=Dt[Ii].evaluate(Ei,mn)},Ve}(Y)).load(et.features):Cr(et,Y.geojsonVtOptions)}catch(Ve){return ae(Ve)}this.loaded={};let St={};if(Be){let Ve=M(fe);Ve&&(St.resourceTiming={},St.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Ve)))}ae(null,St)}})}reloadTile(Y,ae){let fe=this.loaded;return fe&&fe[Y.uid]?super.reloadTile(Y,ae):this.loadTile(Y,ae)}loadGeoJSON(Y,ae){if(Y.request)r.g(Y.request,ae);else{if(typeof Y.data!="string")return ae(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));try{return ae(null,JSON.parse(Y.data))}catch{return ae(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Y,ae){try{ae(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(fe){ae(fe)}}getClusterChildren(Y,ae){try{ae(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(fe){ae(fe)}}getClusterLeaves(Y,ae){try{ae(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(fe){ae(fe)}}}class Ko{constructor(Y,ae){this.tileID=new r.am(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=ae}parse(Y,ae,fe,Be){this.status="parsing";let Ge=new r.am(fe.tileID.overscaledZ,fe.tileID.wrap,fe.tileID.canonical.z,fe.tileID.canonical.x,fe.tileID.canonical.y),et={},St=ae.familiesBySource[fe.source],Ve=new r.dC(Ge,fe.promoteId);return Ve.bucketLayerIDs=[],Ve.is3DTile=!0,r.dP(Y).then(Pt=>{if(!Pt)return Be(new Error("Could not parse tile"));let Tt=r.dQ(Pt,1/r.bR(fe.tileID.canonical)),Dt=Pt.json.extensionsUsed&&Pt.json.extensionsUsed.includes("MAPBOX_mesh_features")||Pt.json.asset.extras&&Pt.json.asset.extras.MAPBOX_mesh_features,Ei=Pt.json.extensionsUsed&&Pt.json.extensionsUsed.includes("EXT_meshopt_compression"),mn=new r.K(this.zoom,{brightness:this.brightness});for(let En in St)for(let gn of St[En]){let $i=gn[0];Ve.bucketLayerIDs.push(gn.map(on=>on.id)),$i.recalculate(mn,[]);let Ii=new r.dR(Tt,Ge,Dt,Ei,this.brightness,Ve);Dt||(Ii.needsUpload=!0),et[$i.fqid]=Ii,Ii.evaluate($i)}this.status="done",Be(null,{buckets:et,featureIndex:Ve})}).catch(Pt=>Be(new Error(Pt.message)))}}class Sa{constructor(Y,ae,fe,Be,Ge,et){this.actor=Y,this.layerIndex=ae,this.brightness=et,this.loading={},this.loaded={}}loadTile(Y,ae){let fe=Y.uid,Be=this.loading[fe]=new Ko(Y,this.brightness);r.a_(Y.request,(Ge,et)=>{let St=!this.loading[fe];return delete this.loading[fe],St||Ge?(Be.status="done",St||(this.loaded[fe]=Be),ae(Ge)):et&&et.byteLength!==0?void Be.parse(et,this.layerIndex,Y,(Ve,Pt)=>{Be.status="done",this.loaded=this.loaded||{},this.loaded[fe]=Be,Ve||!Pt?ae(Ve):ae(null,Pt)}):(Be.status="done",this.loaded[fe]=Be,ae())})}reloadTile(Y,ae){let fe=this.loaded,Be=Y.uid;if(fe&&fe[Be]){let Ge=fe[Be];Ge.projection=Y.projection,Ge.brightness=Y.brightness;let et=(St,Ve)=>{Ge.reloadCallback&&(delete Ge.reloadCallback,this.loadTile(Y,ae)),ae(St,Ve)};Ge.status==="parsing"?Ge.reloadCallback=et:Ge.status==="done"&&this.loadTile(Y,ae)}}abortTile(Y,ae){let fe=Y.uid;this.loading[fe]&&delete this.loading[fe],ae()}removeTile(Y,ae){let fe=this.loaded,Be=Y.uid;fe&&fe[Be]&&delete fe[Be],ae()}}class ga{constructor(Y){this.self=Y,this.actor=new r.dS(Y,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.bo({name:"mercator"}),this.workerSourceTypes={vector:Xt,geojson:Tl,"batched-model":Sa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ae,fe)=>{if(this.workerSourceTypes[ae])throw new Error(`Worker source with name "${ae}" already registered.`);this.workerSourceTypes[ae]=fe},this.self.registerRTLTextPlugin=ae=>{if(r.dT.isParsed())throw new Error("RTL text plugin already registered.");r.dT.applyArabicShaping=ae.applyArabicShaping,r.dT.processBidirectionalText=ae.processBidirectionalText,r.dT.processStyledBidirectionalText=ae.processStyledBidirectionalText}}clearCaches(Y,ae,fe){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y],delete this.rasterArrayWorkerSource,fe()}checkIfReady(Y,ae,fe){fe()}setReferrer(Y,ae){this.referrer=ae}spriteLoaded(Y,{scope:ae,isLoaded:fe}){if(this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.isSpriteLoaded[Y][ae]=fe,this.workerSources[Y]&&this.workerSources[Y][ae])for(let Be in this.workerSources[Y][ae]){let Ge=this.workerSources[Y][ae][Be];for(let et in Ge)Ge[et]instanceof Xt&&(Ge[et].isSpriteLoaded=fe,Ge[et].fire(new r.b("isSpriteLoaded")))}}setImages(Y,{scope:ae,images:fe},Be){if(this.availableImages[Y]||(this.availableImages[Y]={}),this.availableImages[Y][ae]=fe,this.workerSources[Y]&&this.workerSources[Y][ae]){for(let Ge in this.workerSources[Y][ae]){let et=this.workerSources[Y][ae][Ge];for(let St in et)et[St].availableImages=fe}Be()}else Be()}setProjection(Y,ae){this.projections[Y]=r.bo(ae)}setBrightness(Y,ae,fe){this.brightness=ae,fe()}setLayers(Y,ae,fe){this.getLayerIndex(Y,ae.scope).replace(ae.layers,ae.options),fe()}updateLayers(Y,ae,fe){this.getLayerIndex(Y,ae.scope).update(ae.layers,ae.removedIds,ae.options),fe()}loadTile(Y,ae,fe){ae.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,ae.type,ae.source,ae.scope).loadTile(ae,fe)}loadDEMTile(Y,ae,fe){this.getDEMWorkerSource(Y,ae.source,ae.scope).loadTile(ae,fe)}decodeRasterArray(Y,ae,fe){this.getRasterArrayWorkerSource().decodeRasterArray(ae,fe)}reloadTile(Y,ae,fe){ae.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,ae.type,ae.source,ae.scope).reloadTile(ae,fe)}abortTile(Y,ae,fe){this.getWorkerSource(Y,ae.type,ae.source,ae.scope).abortTile(ae,fe)}removeTile(Y,ae,fe){this.getWorkerSource(Y,ae.type,ae.source,ae.scope).removeTile(ae,fe)}removeSource(Y,ae,fe){if(!(this.workerSources[Y]&&this.workerSources[Y][ae.scope]&&this.workerSources[Y][ae.scope][ae.type]&&this.workerSources[Y][ae.scope][ae.type][ae.source]))return;let Be=this.workerSources[Y][ae.scope][ae.type][ae.source];delete this.workerSources[Y][ae.scope][ae.type][ae.source],Be.removeSource!==void 0?Be.removeSource(ae,fe):fe()}loadWorkerSource(Y,ae,fe){try{this.self.importScripts(ae.url),fe()}catch(Be){fe(Be.toString())}}syncRTLPluginState(Y,ae,fe){try{r.dT.setState(ae);let Be=r.dT.getPluginURL();if(r.dT.isLoaded()&&!r.dT.isParsed()&&Be!=null){this.self.importScripts(Be);let Ge=r.dT.isParsed();fe(Ge?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Be}`),Ge)}}catch(Be){fe(Be.toString())}}setDracoUrl(Y,ae){this.dracoUrl=ae}getAvailableImages(Y,ae){this.availableImages[Y]||(this.availableImages[Y]={});let fe=this.availableImages[Y][ae];return fe||(fe=[]),fe}getLayerIndex(Y,ae){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let fe=this.layerIndexes[Y][ae];return fe||(fe=this.layerIndexes[Y][ae]=new ue,fe.scope=ae),fe}getWorkerSource(Y,ae,fe,Be){if(this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][Be]||(this.workerSources[Y][Be]={}),this.workerSources[Y][Be][ae]||(this.workerSources[Y][Be][ae]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),!this.workerSources[Y][Be][ae][fe]){let Ge={send:(et,St,Ve,Pt,Tt,Dt)=>{this.actor.send(et,St,Ve,Y,Tt,Dt)},scheduler:this.actor.scheduler};this.workerSources[Y][Be][ae][fe]=new this.workerSourceTypes[ae](Ge,this.getLayerIndex(Y,Be),this.getAvailableImages(Y,Be),this.isSpriteLoaded[Y][Be],void 0,this.brightness)}return this.workerSources[Y][Be][ae][fe]}getDEMWorkerSource(Y,ae,fe){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][fe]||(this.demWorkerSources[Y][fe]={}),this.demWorkerSources[Y][fe][ae]||(this.demWorkerSources[Y][fe][ae]=new Oi),this.demWorkerSources[Y][fe][ae]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new vi),this.rasterArrayWorkerSource}enforceCacheSizeLimit(Y,ae){r.dU(ae)}getWorkerPerformanceMetrics(Y,ae,fe){fe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ga(self)),ga}),c(["./shared"],function(r){"use strict";function M(u,n){if(Array.isArray(u)){if(!Array.isArray(n)||u.length!==n.length)return!1;for(let a=0;a<u.length;a++)if(!M(u[a],n[a]))return!1;return!0}if(typeof u=="object"&&u!==null&&n!==null){if(typeof n!="object"||Object.keys(u).length!==Object.keys(n).length)return!1;for(let a in u)if(!M(u[a],n[a]))return!1;return!0}return u===n}var z=ie;function ie(u){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,f,b=new Blob([""],{type:"text/javascript"}),x=URL.createObjectURL(b);try{f=new Worker(x),h=!0}catch{h=!1}return f&&f.terminate(),URL.revokeObjectURL(x),h}()?function(){var h=document.createElement("canvas");h.width=h.height=1;var f=h.getContext("2d");if(!f)return!1;var b=f.getImageData(0,0,1,1);return b&&b.width===h.width}()?(ue[a=n&&n.failIfMajorPerformanceCaveat]===void 0&&(ue[a]=function(h){var f,b=function(x){var T=document.createElement("canvas"),I=Object.create(ie.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=x,T.getContext("webgl2",I)}(h);if(!b)return!1;try{f=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!f||b.isContextLost())&&(b.shaderSource(f,"void main() {}"),b.compileShader(f),b.getShaderParameter(f,b.COMPILE_STATUS)===!0)}(a)),ue[a]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var a}(u)}var ue={};function ye(u,n,a){let h=document.createElement(u);return n!=null&&(h.className=n),a&&a.appendChild(h),h}function Je(u,n,a){let h=document.createElementNS("http://www.w3.org/2000/svg",u);for(let f of Object.keys(n))h.setAttributeNS(null,f,String(n[f]));return a&&a.appendChild(h),h}ie.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let It=typeof document<"u"?document.documentElement&&document.documentElement.style:null,st=It&&It.userSelect!==void 0?"userSelect":"WebkitUserSelect",Xt;function Oi(){It&&st&&(Xt=It[st],It[st]="none")}function vi(){It&&st&&(It[st]=Xt)}function Ti(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",Ti,!0)}function xn(){window.addEventListener("click",Ti,!0),window.setTimeout(()=>{window.removeEventListener("click",Ti,!0)},0)}function Wo(u,n){let a=u.getBoundingClientRect();return dt(u,a,n)}function ur(u,n){let a=u.getBoundingClientRect(),h=[];for(let f=0;f<n.length;f++)h.push(dt(u,a,n[f]));return h}function Lo(u){return window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button}function dt(u,n,a){let h=u.offsetWidth===n.width?1:u.offsetWidth/n.width;return new r.P((a.clientX-n.left)*h,(a.clientY-n.top)*h)}class ja{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(n,a){this._updatedSourceCaches[n]=a,this.setDirty()}discardSourceCacheUpdate(n){delete this._updatedSourceCaches[n]}updateLayer(n){let a=n.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(n.id),this.setDirty()}removeLayer(n){let a=n.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][n.id]=n,this._updatedLayers[a].delete(n.id),this._updatedPaintProps.delete(n.fqid),this.setDirty()}getRemovedLayer(n){return this._removedLayers[n.scope]?this._removedLayers[n.scope][n.id]:null}discardLayerRemoval(n){this._removedLayers[n.scope]&&delete this._removedLayers[n.scope][n.id]}getLayerUpdatesByScope(){let n={};for(let a in this._updatedLayers)n[a]=n[a]||{},n[a].updatedIds=Array.from(this._updatedLayers[a].values());for(let a in this._removedLayers)n[a]=n[a]||{},n[a].removedIds=Object.keys(this._removedLayers[a]);return n}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(n){this._updatedPaintProps.add(n.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(n){this._updatedImages.add(n),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class Cl extends r.E{constructor(n){super(),this.requestManager=n,this.models={"":{}},this.numModelsLoading={}}loadModel(n,a){return r.l(this.requestManager.transformRequest(a,r.R.Model).url).then(h=>{if(!h)return;let f=r.c(h),b=new r.M(n,void 0,void 0,f);return b.computeBoundsAndApplyParent(),b}).catch(h=>{this.fire(new r.a(new Error(`Could not load model ${n} from ${a}: ${h.message}`)))})}load(n,a){this.models[a]||(this.models[a]={});let h=Object.keys(n);this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+h.length;let f=[];for(let b of h)f.push(this.loadModel(b,n[b]));Promise.allSettled(f).then(b=>{for(let x=0;x<b.length;x++){let{status:T,value:I}=b[x];T==="fulfilled"&&I&&(this.models[a][h[x]]=I)}this.numModelsLoading[a]-=h.length,this.fire(new r.b("data",{dataType:"style"}))}).catch(b=>{this.fire(new r.a(new Error(`Could not load models: ${b.message}`)))})}isLoaded(){for(let n in this.numModelsLoading)if(this.numModelsLoading[n]>0)return!1;return!0}hasModel(n,a){return!!this.getModel(n,a)}getModel(n,a){return this.models[a]||(this.models[a]={}),this.models[a][n]}addModel(n,a,h){this.models[h]||(this.models[h]={}),this.hasModel(n,h)&&this.removeModel(n,h),this.load({[n]:this.requestManager.normalizeModelURL(a)},h)}addModels(n,a){let h={};for(let f in n)h[f]=this.requestManager.normalizeModelURL(n[f]);this.load(h,a)}removeModel(n,a){this.models[a]||(this.models[a]={});let h=this.models[a][n];delete this.models[a][n],h.destroy()}listModels(n){return this.models[n]||(this.models[n]={}),Object.keys(this.models[n])}upload(n,a){this.models[a]||(this.models[a]={});for(let h in this.models[a])this.models[a][h].upload(n.context)}}class Fi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,a,h){let f=String(a);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][f]=this.stateChanges[n][f]||{},r.e(this.stateChanges[n][f],h),this.deletedStates[n]===null){this.deletedStates[n]={};for(let b in this.state[n])b!==f&&(this.deletedStates[n][b]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][f]===null){this.deletedStates[n][f]={};for(let b in this.state[n][f])h[b]||(this.deletedStates[n][f][b]=null)}else for(let b in h)this.deletedStates[n]&&this.deletedStates[n][f]&&this.deletedStates[n][f][b]===null&&delete this.deletedStates[n][f][b]}removeFeatureState(n,a,h){if(this.deletedStates[n]===null)return;let f=String(a);if(this.deletedStates[n]=this.deletedStates[n]||{},h&&a!==void 0)this.deletedStates[n][f]!==null&&(this.deletedStates[n][f]=this.deletedStates[n][f]||{},this.deletedStates[n][f][h]=null);else if(a!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][f])for(h in this.deletedStates[n][f]={},this.stateChanges[n][f])this.deletedStates[n][f][h]=null;else this.deletedStates[n][f]=null;else this.deletedStates[n]=null}getState(n,a){let h=String(a),f=r.e({},(this.state[n]||{})[h],(this.stateChanges[n]||{})[h]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){let b=this.deletedStates[n][a];if(b===null)return{};for(let x in b)delete f[x]}return f}initializeTileState(n,a){n.setFeatureState(this.state,a)}coalesceChanges(n,a){let h={};for(let f in this.stateChanges){this.state[f]=this.state[f]||{};let b={};for(let x in this.stateChanges[f])this.state[f][x]||(this.state[f][x]={}),r.e(this.state[f][x],this.stateChanges[f][x]),b[x]=this.state[f][x];h[f]=b}for(let f in this.deletedStates){this.state[f]=this.state[f]||{};let b={};if(this.deletedStates[f]===null)for(let x in this.state[f])b[x]={},this.state[f][x]={};else for(let x in this.deletedStates[f]){if(this.deletedStates[f][x]===null)this.state[f][x]={};else if(this.state[f][x])for(let T of Object.keys(this.deletedStates[f][x]))delete this.state[f][x][T];b[x]=this.state[f][x]}h[f]=h[f]||{},r.e(h[f],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(let f in n)n[f].setFeatureState(h,a)}}function qn(u){let{userImage:n}=u;return!!(n&&n.render&&n.render())&&(u.data.replace(new Uint8Array(n.data.buffer)),!0)}class Nc extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(n){this.images[n]={},this.loaded[n]=!1,this.updatedImages[n]={},this.patterns[n]={},this.callbackDispatchedThisFrame[n]={},this.atlasImage[n]=new r.h({width:1,height:1})}isLoaded(){for(let n in this.loaded)if(!this.loaded[n])return!1;return!0}setLoaded(n,a){if(this.loaded[a]!==n&&(this.loaded[a]=n,n)){for(let{ids:h,callback:f}of this.requestors)this._notify(h,a,f);this.requestors=[]}}hasImage(n,a){return!!this.getImage(n,a)}getImage(n,a){return this.images[a][n]}addImage(n,a,h){this._validate(n,h)&&(this.images[a][n]=h)}_validate(n,a){let h=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "stretchX" value`))),h=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "stretchY" value`))),h=!1),this._validateContent(a.content,a)||(this.fire(new r.a(new Error(`Image "${n}" has invalid "content" value`))),h=!1),h}_validateStretch(n,a){if(!n)return!0;let h=0;for(let f of n){if(f[0]<h||f[1]<f[0]||a<f[1])return!1;h=f[1]}return!0}_validateContent(n,a){return!(n&&(n.length!==4||n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,a,h){h.version=this.images[a][n].version+1,this.images[a][n]=h,this.updatedImages[a][n]=!0}removeImage(n,a){let h=this.images[a][n];delete this.images[a][n],delete this.patterns[a][n],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(n){return Object.keys(this.images[n])}getImages(n,a,h){let f=!0,b=!!this.loaded[a];if(!b)for(let x of n)this.images[a][x]||(f=!1);b||f?this._notify(n,a,h):this.requestors.push({ids:n,scope:a,callback:h})}getUpdatedImages(n){return this.updatedImages[n]}_notify(n,a,h){let f={};for(let b of n){this.images[a][b]||this.fire(new r.b("styleimagemissing",{id:b}));let x=this.images[a][b];x?f[b]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:r.w(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,f)}getPixelSize(n){let{width:a,height:h}=this.atlasImage[n];return{width:a,height:h}}getPattern(n,a){let h=this.patterns[a][n],f=this.getImage(n,a);if(!f)return null;if(h&&h.position.version===f.version)return h.position;if(h)h.position.version=f.version;else{let b={w:f.data.width+2,h:f.data.height+2,x:0,y:0},x=new r.I(b,f);this.patterns[a][n]={bin:b,position:x}}return this._updatePatternAtlas(a),this.patterns[a][n].position}bind(n,a){let h=n.gl,f=this.atlasTexture[a];f?this.dirty&&(f.update(this.atlasImage[a]),this.dirty=!1):(f=new r.T(n,this.atlasImage[a],h.RGBA),this.atlasTexture[a]=f),f.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(n){let a=[];for(let x in this.patterns[n])a.push(this.patterns[n][x].bin);let{w:h,h:f}=r.p(a),b=this.atlasImage[n];b.resize({width:h||1,height:f||1});for(let x in this.patterns[n]){let{bin:T}=this.patterns[n][x],I=T.x+1,A=T.y+1,k=this.images[n][x].data,P=k.width,L=k.height;r.h.copy(k,b,{x:0,y:0},{x:I,y:A},{width:P,height:L}),r.h.copy(k,b,{x:0,y:L-1},{x:I,y:A-1},{width:P,height:1}),r.h.copy(k,b,{x:0,y:0},{x:I,y:A+L},{width:P,height:1}),r.h.copy(k,b,{x:P-1,y:0},{x:I-1,y:A},{width:1,height:L}),r.h.copy(k,b,{x:0,y:0},{x:I+P,y:A},{width:1,height:L})}this.dirty=!0}beginFrame(){for(let n in this.images)this.callbackDispatchedThisFrame[n]={}}dispatchRenderCallbacks(n,a){for(let h of n){if(this.callbackDispatchedThisFrame[a][h])continue;this.callbackDispatchedThisFrame[a][h]=!0;let f=this.images[a][h];qn(f)&&this.updateImage(h,a,f)}}}class yt{constructor(n,a,h,f){this.message=(n?`${n}: `:"")+h,f&&(this.identifier=f),a!=null&&a.__line__&&(this.line=a.__line__)}}class Zo extends yt{}function Yr(u){let n=u.key,a=u.value,h=u.valueSpec||{},f=u.objectElementValidators||{},b=u.style,x=u.styleSpec,T=[],I=r.i(a);if(I!=="object")return[new yt(n,a,`object expected, ${I} found`)];for(let A in a){let k=A.split(".")[0],P;f[k]?P=f[k]:h[k]?P=Cr:f["*"]?P=f["*"]:h["*"]&&(P=Cr),P?T=T.concat(P({key:(n&&`${n}.`)+A,value:a[A],valueSpec:h[k]||h["*"],style:b,styleSpec:x,object:a,objectKey:A},a)):T.push(new Zo(n,a[A],`unknown property "${A}"`))}for(let A in h)f[A]||h[A].required&&h[A].default===void 0&&a[A]===void 0&&T.push(new yt(n,a,`missing required property "${A}"`));return T}function gi(u){let n=u.value,a=u.valueSpec,h=u.style,f=u.styleSpec,b=u.key,x=u.arrayElementValidator||Cr;if(r.i(n)!=="array")return[new yt(b,n,`array expected, ${r.i(n)} found`)];if(a.length&&n.length!==a.length)return[new yt(b,n,`array length ${a.length} expected, length ${n.length} found`)];if(a["min-length"]&&n.length<a["min-length"])return[new yt(b,n,`array length at least ${a["min-length"]} expected, length ${n.length} found`)];let T={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};f.$version<7&&(T.function=a.function),r.i(a.value)==="object"&&(T=a.value);let I=[];for(let A=0;A<n.length;A++)I=I.concat(x({array:n,arrayIndex:A,value:n[A],valueSpec:T,style:h,styleSpec:f,key:`${b}[${A}]`},!0));return I}function us(u){let n=u.key,a=u.value,h=u.valueSpec,f=r.i(a);if(f==="number"&&a!=a&&(f="NaN"),f!=="number")return[new yt(n,a,`number expected, ${f} found`)];if("minimum"in h){let b=h.minimum;if(r.i(h.minimum)==="array"&&(b=h.minimum[u.arrayIndex]),a<b)return[new yt(n,a,`${a} is less than the minimum value ${b}`)]}if("maximum"in h){let b=h.maximum;if(r.i(h.maximum)==="array"&&(b=h.maximum[u.arrayIndex]),a>b)return[new yt(n,a,`${a} is greater than the maximum value ${b}`)]}return[]}function Ia(u){let n=u.valueSpec,a=r.u(u.value.type),h,f,b,x={},T=a!=="categorical"&&u.value.property===void 0,I=!T,A=r.i(u.value.stops)==="array"&&r.i(u.value.stops[0])==="array"&&r.i(u.value.stops[0][0])==="object",k=Yr({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(B){if(a==="identity")return[new yt(B.key,B.value,'identity function may not have a "stops" property')];let H=[],G=B.value;return H=H.concat(gi({key:B.key,value:G,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:P})),r.i(G)==="array"&&G.length===0&&H.push(new yt(B.key,G,"array must have at least one stop")),H},default:function(B){return Cr({key:B.key,value:B.value,valueSpec:n,style:B.style,styleSpec:B.styleSpec})}}});return a==="identity"&&T&&k.push(new yt(u.key,u.value,'missing required property "property"')),a==="identity"||u.value.stops||k.push(new yt(u.key,u.value,'missing required property "stops"')),a==="exponential"&&u.valueSpec.expression&&!r.s(u.valueSpec)&&k.push(new yt(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(I&&!r.k(u.valueSpec)?k.push(new yt(u.key,u.value,"property functions not supported")):T&&!r.m(u.valueSpec)&&k.push(new yt(u.key,u.value,"zoom functions not supported"))),a!=="categorical"&&!A||u.value.property!==void 0||k.push(new yt(u.key,u.value,'"property" property is required')),k;function P(B){let H=[],G=B.value,$=B.key;if(r.i(G)!=="array")return[new yt($,G,`array expected, ${r.i(G)} found`)];if(G.length!==2)return[new yt($,G,`array length 2 expected, length ${G.length} found`)];if(A){if(r.i(G[0])!=="object")return[new yt($,G,`object expected, ${r.i(G[0])} found`)];if(G[0].zoom===void 0)return[new yt($,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new yt($,G,"object stop key must have value")];let j=r.u(G[0].zoom);if(typeof j!="number")return[new yt($,G[0].zoom,"stop zoom values must be numbers")];if(b&&b>j)return[new yt($,G[0].zoom,"stop zoom values must appear in ascending order")];j!==b&&(b=j,f=void 0,x={}),H=H.concat(Yr({key:`${$}[0]`,value:G[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:us,value:L}}))}else H=H.concat(L({key:`${$}[0]`,value:G[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},G));return r.n(r.o(G[1]))?H.concat([new yt(`${$}[1]`,G[1],"expressions are not allowed in function stops.")]):H.concat(Cr({key:`${$}[1]`,value:G[1],valueSpec:n,style:B.style,styleSpec:B.styleSpec}))}function L(B,H){let G=r.i(B.value),$=r.u(B.value),j=B.value!==null?B.value:H;if(h){if(G!==h)return[new yt(B.key,j,`${G} stop domain type must match previous stop domain type ${h}`)]}else h=G;if(G!=="number"&&G!=="string"&&G!=="boolean"&&typeof $!="number"&&typeof $!="string"&&typeof $!="boolean")return[new yt(B.key,j,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&a!=="categorical"){let W=`number expected, ${G} found`;return r.k(n)&&a===void 0&&(W+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new yt(B.key,j,W)]}return a!=="categorical"||G!=="number"||typeof $=="number"&&isFinite($)&&Math.floor($)===$?a!=="categorical"&&G==="number"&&typeof $=="number"&&typeof f=="number"&&f!==void 0&&$<f?[new yt(B.key,j,"stop domain values must appear in ascending order")]:(f=$,a==="categorical"&&$ in x?[new yt(B.key,j,"stop domain values must be unique")]:(x[$]=!0,[])):[new yt(B.key,j,`integer expected, found ${String($)}`)]}}function Yo(u){let n=(u.expressionContext==="property"?r.q:r.r)(r.o(u.value),u.valueSpec);if(n.result==="error")return n.value.map(h=>new yt(`${u.key}${h.key}`,u.value,h.message));let a=n.value.expression||n.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!a.outputDefined())return[new yt(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!r.t(a))return[new yt(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return Gr(a,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!r.v(a,["zoom","feature-state"]))return[new yt(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!r.x(a))return[new yt(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Gr(u,n){let a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(let f of n.valueSpec.expression.parameters)a.delete(f);if(a.size===0)return[];let h=[];return u instanceof r.C&&a.has(u.name)?[new yt(n.key,n.value,`["${u.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(u.eachChild(f=>{h.push(...Gr(f,n))}),h)}function Ua(u){let n=u.key,a=u.value,h=u.valueSpec,f=[];return Array.isArray(h.values)?h.values.indexOf(r.u(a))===-1&&f.push(new yt(n,a,`expected one of [${h.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(h.values).indexOf(r.u(a))===-1&&f.push(new yt(n,a,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(a)} found`)),f}function Lr(u){return r.z(r.o(u.value))?Yo(r.j({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):ma(u)}function ma(u){let n=u.value,a=u.key;if(r.i(n)!=="array")return[new yt(a,n,`array expected, ${r.i(n)} found`)];let h=u.styleSpec,f,b=[];if(n.length<1)return[new yt(a,n,"filter array must have at least 1 element")];switch(b=b.concat(Ua({key:`${a}[0]`,value:n[0],valueSpec:h.filter_operator,style:u.style,styleSpec:u.styleSpec})),r.u(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&r.u(n[1])==="$type"&&b.push(new yt(a,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&b.push(new yt(a,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(f=r.i(n[1]),f!=="string"&&b.push(new yt(`${a}[1]`,n[1],`string expected, ${f} found`)));for(let x=2;x<n.length;x++)f=r.i(n[x]),r.u(n[1])==="$type"?b=b.concat(Ua({key:`${a}[${x}]`,value:n[x],valueSpec:h.geometry_type,style:u.style,styleSpec:u.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&b.push(new yt(`${a}[${x}]`,n[x],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let x=1;x<n.length;x++)b=b.concat(ma({key:`${a}[${x}]`,value:n[x],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":f=r.i(n[1]),n.length!==2?b.push(new yt(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):f!=="string"&&b.push(new yt(`${a}[1]`,n[1],`string expected, ${f} found`))}return b}function zo(u,n){let a=u.key,h=u.style,f=u.layer,b=u.styleSpec,x=u.value,T=u.objectKey,I=b[`${n}_${u.layerType}`];if(!I)return[];let A=T.match(/^(.*)-transition$/);if(n==="paint"&&A&&I[A[1]]&&I[A[1]].transition)return Cr({key:a,value:x,valueSpec:b.transition,style:h,styleSpec:b});let k=u.valueSpec||I[T];if(!k)return[new Zo(a,x,`unknown property "${T}"`)];let P;if(r.i(x)==="string"&&r.k(k)&&!k.tokens&&(P=/^{([^}]+)}$/.exec(x))){let B=`\`{ "type": "identity", "property": ${P?JSON.stringify(P[1]):'"_"'} }\``;return[new yt(a,x,`"${T}" does not support interpolation syntax
Use an identity property function instead: ${B}.`)]}let L=[];if(u.layerType==="symbol")T!=="text-field"||!h||h.glyphs||h.imports||L.push(new yt(a,x,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&r.A(r.o(x))&&r.u(x.type)==="identity"&&L.push(new yt(a,x,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&n==="paint"&&f&&f.layout&&f.layout.hasOwnProperty("model-id")&&r.k(k)&&(r.B(k)||r.m(k))){let B=r.q(r.o(x),k),H=B.value.expression||B.value._styleExpression.expression;H&&!r.v(H,["measure-light"])&&(T==="model-emissive-strength"&&r.x(H)&&r.t(H)||L.push(new yt(a,x,`${T} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return L.concat(Cr({key:u.key,value:x,valueSpec:k,style:h,styleSpec:b,expressionContext:"property",propertyType:n,propertyKey:T}))}function co(u){return zo(u,"paint")}function Ps(u){return zo(u,"layout")}function Xo(u){let n=[],a=u.value,h=u.key,f=u.style,b=u.styleSpec;a.type||a.ref||n.push(new yt(h,a,'either "type" or "ref" is required'));let x=r.u(a.type),T=r.u(a.ref);if(a.id){let I=r.u(a.id);for(let A=0;A<u.arrayIndex;A++){let k=f.layers[A];r.u(k.id)===I&&n.push(new yt(h,a.id,`duplicate layer id "${a.id}", previously used at line ${k.id.__line__}`))}}if("ref"in a){let I;["type","source","source-layer","filter","layout"].forEach(A=>{A in a&&n.push(new yt(h,a[A],`"${A}" is prohibited for ref layers`))}),f.layers.forEach(A=>{r.u(A.id)===T&&(I=A)}),I?I.ref?n.push(new yt(h,a.ref,"ref cannot reference another ref layer")):x=r.u(I.type):typeof T=="string"&&n.push(new yt(h,a.ref,`ref layer "${T}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(a.source){let I=f.sources&&f.sources[a.source],A=I&&r.u(I.type);I?A==="vector"&&x==="raster"?n.push(new yt(h,a.source,`layer "${a.id}" requires a raster source`)):A==="raster"&&x!=="raster"?n.push(new yt(h,a.source,`layer "${a.id}" requires a vector source`)):A!=="vector"||a["source-layer"]?A==="raster-dem"&&x!=="hillshade"?n.push(new yt(h,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="raster-array"||["raster","raster-particle"].includes(x)?x!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||A==="geojson"&&I.lineMetrics?x==="raster-particle"&&A!=="raster-array"&&n.push(new yt(h,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):n.push(new yt(h,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new yt(h,a.source,"raster-array source can only be used with layer type 'raster'.")):n.push(new yt(h,a,`layer "${a.id}" must specify a "source-layer"`)):n.push(new yt(h,a.source,`source "${a.source}" not found`))}else n.push(new yt(h,a,'missing required property "source"'));return n=n.concat(Yr({key:h,value:a,valueSpec:b.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Cr({key:`${h}.type`,value:a.type,valueSpec:b.layer.type,style:u.style,styleSpec:u.styleSpec,object:a,objectKey:"type"}),filter:I=>Lr(r.j({layerType:x},I)),layout:I=>Yr({layer:a,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":A=>Ps(r.j({layerType:x},A))}}),paint:I=>Yr({layer:a,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":A=>co(r.j({layerType:x,layer:a},A))}})}})),n}function Bn(u){let n=u.value,a=u.key,h=r.i(n);return h!=="string"?[new yt(a,n,`string expected, ${h} found`)]:[]}let Mi={promoteId:function({key:u,value:n}){if(r.i(n)==="string")return Bn({key:u,value:n});{let a=[];for(let h in n)a.push(...Bn({key:`${u}.${h}`,value:n[h]}));return a}}};function Ao(u){let n=u.value,a=u.key,h=u.styleSpec,f=u.style;if(!n.type)return[new yt(a,n,'"type" is required')];let b=r.u(n.type),x=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&(n.url||n.tiles||x.push(new Zo(a,n,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(Yr({key:a,value:n,valueSpec:h[`source_${b.replace("-","_")}`],style:u.style,styleSpec:h,objectElementValidators:Mi})),x;case"geojson":if(x=Yr({key:a,value:n,valueSpec:h.source_geojson,style:f,styleSpec:h,objectElementValidators:Mi}),n.cluster)for(let T in n.clusterProperties){let[I,A]=n.clusterProperties[T],k=typeof I=="string"?[I,["accumulated"],["get",T]]:I;x.push(...Yo({key:`${a}.${T}.map`,value:A,expressionContext:"cluster-map"})),x.push(...Yo({key:`${a}.${T}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return x;case"video":return Yr({key:a,value:n,valueSpec:h.source_video,style:f,styleSpec:h});case"image":return Yr({key:a,value:n,valueSpec:h.source_image,style:f,styleSpec:h});case"canvas":return[new yt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ua({key:`${a}.type`,value:n.type,valueSpec:{values:Bc(h)},style:f,styleSpec:h})}}function Bc(u){return u.source.reduce((n,a)=>{let h=u[a];return h.type.type==="enum"&&(n=n.concat(Object.keys(h.type.values))),n},[])}function er(u){let n=u.value,a=[];if(!n)return a;let h=r.i(n);return h!=="string"?(a=a.concat([new yt(u.key,n,`string expected, "${h}" found`)]),a):(function(f){let b=f.indexOf("://")===-1;try{return new URL(f,b?"http://example.com":void 0),!0}catch{return!1}}(n)||(a=a.concat([new yt(u.key,n,`invalid url "${n}"`)])),a)}function uo(u){let n=u.value,a=u.styleSpec,h=a.light,f=u.style,b=[],x=r.i(n);if(n===void 0)return b;if(x!=="object")return b=b.concat([new yt("light",n,`object expected, ${x} found`)]),b;for(let T in n){let I=T.match(/^(.*)-transition$/);b=b.concat(I&&h[I[1]]&&h[I[1]].transition?Cr({key:T,value:n[T],valueSpec:a.transition,style:f,styleSpec:a}):h[T]?Cr({key:T,value:n[T],valueSpec:h[T],style:f,styleSpec:a}):[new yt(T,n[T],`unknown property "${T}"`)])}return b}function Os(u){let n=u.value,a=[];if(!n)return a;let h=r.i(n);if(h!=="object")return a=a.concat([new yt("light-3d",n,`object expected, ${h} found`)]),a;let f=u.styleSpec,b=f["light-3d"],x=u.key,T=u.style,I=u.style.lights;for(let P of["type","id"])if(!(P in n))return a=a.concat([new yt("light-3d",n,`missing property ${P} on light`)]),a;if(n.type&&I)for(let P=0;P<u.arrayIndex;P++){let L=r.u(n.type),B=I[P];r.u(B.type)===L&&a.push(new yt(x,n.id,`duplicate light type "${n.type}", previously defined at line ${B.id.__line__}`))}let A=`properties_light_${n.type}`;if(!(A in f))return a=a.concat([new yt("light-3d",n,`Invalid light type ${n.type}`)]),a;let k=f[A];for(let P in n)if(P==="properties"){let L=n[P],B=r.i(L);if(B!=="object")return a=a.concat([new yt("properties",L,`object expected, ${B} found`)]),a;for(let H in L)a=a.concat(k[H]?Cr({key:H,value:L[H],valueSpec:k[H],style:T,styleSpec:f}):[new Zo(u.key,L[H],`unknown property "${H}"`)])}else{let L=P.match(/^(.*)-transition$/);a=a.concat(L&&b[L[1]]&&b[L[1]].transition?Cr({key:P,value:n[P],valueSpec:f.transition,style:T,styleSpec:f}):b[P]?Cr({key:P,value:n[P],valueSpec:b[P],style:T,styleSpec:f}):[new Zo(P,n[P],`unknown property "${P}"`)])}return a}function Sn(u){let n=u.value,a=u.key,h=u.style,f=u.styleSpec,b=f.terrain,x=[],T=r.i(n);if(n===void 0||T==="null")return x;if(T!=="object")return x=x.concat([new yt("terrain",n,`object expected, ${T} found`)]),x;for(let I in n){let A=I.match(/^(.*)-transition$/);x=x.concat(A&&b[A[1]]&&b[A[1]].transition?Cr({key:I,value:n[I],valueSpec:f.transition,style:h,styleSpec:f}):b[I]?Cr({key:I,value:n[I],valueSpec:b[I],style:h,styleSpec:f}):[new Zo(I,n[I],`unknown property "${I}"`)])}if(n.source){let I=h.sources&&h.sources[n.source],A=I&&r.u(I.type);I?A!=="raster-dem"&&x.push(new yt(a,n.source,`terrain cannot be used with a source of type ${String(A)}, it only be used with a "raster-dem" source type`)):x.push(new yt(a,n.source,`source "${n.source}" not found`))}else x.push(new yt(a,n,'terrain is missing required property "source"'));return x}function fa(u){let n=u.value,a=u.style,h=u.styleSpec,f=h.fog,b=[],x=r.i(n);if(n===void 0)return b;if(x!=="object")return b=b.concat([new yt("fog",n,`object expected, ${x} found`)]),b;for(let T in n){let I=T.match(/^(.*)-transition$/);b=b.concat(I&&f[I[1]]&&f[I[1]].transition?Cr({key:T,value:n[T],valueSpec:h.transition,style:a,styleSpec:h}):f[T]?Cr({key:T,value:n[T],valueSpec:f[T],style:a,styleSpec:h}):[new Zo(T,n[T],`unknown property "${T}"`)])}return b}let Fs={"*":()=>[],array:gi,boolean:function(u){let n=u.value,a=u.key,h=r.i(n);return h!=="boolean"?[new yt(a,n,`boolean expected, ${h} found`)]:[]},number:us,color:function(u){let n=u.key,a=u.value,h=r.i(a);return h!=="string"?[new yt(n,a,`color expected, ${h} found`)]:r.y(a)===null?[new yt(n,a,`color expected, "${a}" found`)]:[]},enum:Ua,filter:Lr,function:Ia,layer:Xo,object:Yr,source:Ao,model:er,light:uo,"light-3d":Os,terrain:Sn,fog:fa,string:Bn,formatted:function(u){return Bn(u).length===0?[]:Yo(u)},resolvedImage:function(u){return Bn(u).length===0?[]:Yo(u)},projection:function(u){let n=u.value,a=u.styleSpec,h=a.projection,f=u.style,b=[],x=r.i(n);if(x==="object")for(let T in n)b=b.concat(Cr({key:T,value:n[T],valueSpec:h[T],style:f,styleSpec:a}));else x!=="string"&&(b=b.concat([new yt("projection",n,`object or string expected, ${x} found`)]));return b},import:function(u){let{value:n,styleSpec:a}=u,x=n,{data:h}=x,f=O0(x,["data"]);Object.defineProperty(f,"__line__",{value:n.__line__,enumerable:!1});let b=Yr(r.j({},u,{value:f,valueSpec:a.import}));return r.u(f.id)===""&&b.push(new yt(`${u.key}.id`,f,"import id can't be an empty string")),h&&(b=b.concat(Tl(h,a,{key:`${u.key}.data`}))),b}};function Cr(u,n=!1){let a=u.value,h=u.valueSpec,f=u.styleSpec;if(h.expression&&r.A(r.u(a)))return Ia(u);if(h.expression&&r.n(r.o(a)))return Yo(u);if(h.type&&Fs[h.type]){let b=Fs[h.type](u);return n===!0&&b.length>0&&r.i(u.value)==="array"?Yo(u):b}return Yr(r.j({},u,{valueSpec:h.type?f[h.type]:h}))}function No(u){let n=u.value,a=u.key,h=Bn(u);return h.length||(n.indexOf("{fontstack}")===-1&&h.push(new yt(a,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&h.push(new yt(a,n,'"glyphs" url must include a "{range}" token'))),h}function Tl(u,n=r.D,a={}){return Cr({key:a.key||"",value:u,valueSpec:n.$root,styleSpec:n,style:u,objectElementValidators:{glyphs:No,"*":()=>[]}})}function Ko(u,n=r.D){return Ve(Tl(u,n))}let Sa=u=>Ve(Ao(u)),ga=u=>Ve(uo(u)),Ue=u=>Ve(Os(u)),Y=u=>Ve(Sn(u)),ae=u=>Ve(fa(u)),fe=u=>Ve(Xo(u)),Be=u=>Ve(Lr(u)),Ge=u=>Ve(co(u)),et=u=>Ve(Ps(u)),St=u=>Ve(er(u));function Ve(u){return u.slice().sort((n,a)=>n.line&&a.line?n.line-a.line:0)}function Pt(u,n){let a=!1;if(n&&n.length)for(let h of n)h instanceof Zo?r.w(h.message):(u.fire(new r.a(new Error(h.message))),a=!0);return a}let Tt=new r.F({anchor:new r.G(r.D.light.anchor),position:new r.H(r.D.light.position),color:new r.G(r.D.light.color),intensity:new r.G(r.D.light.intensity)});class Dt extends r.E{constructor(n,a="flat"){super(),this._transitionable=new r.J(Tt),this.setLight(n,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a,h={}){this._validate(ga,n,h)||(this._transitionable.setTransitionOrValue(n),this.id=a)}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,h){return(!h||h.validate!==!1)&&Pt(this,n.call(Ko,r.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.D})))}}let Ei=new r.F({source:new r.G(r.D.terrain.source),exaggeration:new r.G(r.D.terrain.exaggeration)}),mn=class extends r.E{constructor(u,n,a,h){super(),this.scope=a,this._transitionable=new r.J(Ei,a,h),this._transitionable.setTransitionOrValue(u,h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(u,n){this._transitionable.setTransitionOrValue(u,n)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new r.K(u)).get("exaggeration")}isZoomDependent(){let u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof r.Z}},En=45,gn=65,$i=.05;function Ii(u,n,a,h){let f=r.O(En,gn,a),[b,x]=on(u,h),T=1-Math.min(1,Math.exp((n-b)/(x-b)*-6));return T*=T*T,T=Math.min(1,1.00747*T),T*f*u.alpha}function on(u,n){let a=.5/Math.tan(.5*n);return[u.range[0]+a,u.range[1]+a]}function Mn(u,n,a,h,f){let b=r.N.transformMat4([],[n,a,h],f.mercatorFogMatrix);return Ii(u,r.N.length(b),f.pitch,f._fov)}function zr(u,n,a,h,f,b,x){let T=[[a,h,0],[f,h,0],[f,b,0],[a,b,0]],I=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let k of T){let P=r.N.transformMat4([],k,n),L=r.N.length(P);I=Math.min(I,L),A=Math.max(A,L)}return[Ii(u,I,x.pitch,x._fov),Ii(u,A,x.pitch,x._fov)]}let Ln=new r.F({range:new r.G(r.D.fog.range),color:new r.G(r.D.fog.color),"high-color":new r.G(r.D.fog["high-color"]),"space-color":new r.G(r.D.fog["space-color"]),"horizon-blend":new r.G(r.D.fog["horizon-blend"]),"star-intensity":new r.G(r.D.fog["star-intensity"]),"vertical-range":new r.G(r.D.fog["vertical-range"])});class To extends r.E{constructor(n,a,h,f){super(),this._transitionable=new r.J(Ln,h,new Map(f)),this.set(n,f),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new r.Q(Ln)}get state(){let n=this._transform,a=n.projection.name==="globe",h=r.S(n.zoom),f=this.properties.get("range"),b=[.5,3];return{range:a?[r.U(b[0],f[0],h),r.U(b[1],f[1],h)]:f,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a,h={}){if(this._validate(ae,n,h))return;let f=r.e({},n);for(let b of Object.keys(r.D.fog))f[b]===void 0&&(f[b]=r.D.fog[b].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;let a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.O(En,gn,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?function(h,f,b){let x=r.L.fromLngLat(f),T=b.elevation?b.elevation.getAtPointOrZero(x):0;return Mn(h,x.x,x.y,T,b)}(this.state,n,a):0}getOpacityForTile(n){if(!this._transform.projection.supportsFog)return[1,1];let a=this._transform.calculateFogTileMatrix(n.toUnwrapped());return zr(this.state,a,0,0,r.V,r.V,this._transform)}getOpacityForBounds(n,a,h,f,b){return this._transform.projection.supportsFog?zr(this.state,n,a,h,f,b,this._transform):[1,1]}getFovAdjustedRange(n){return this._transform.projection.supportsFog?on(this.state,n):[0,1]}isVisibleOnFrustum(n){if(!this._transform.projection.supportsFog)return!1;let a=[4,5,6,7];for(let h of a){let f=n.points[h],b;if(f[2]>=0)b=f;else{let x=n.points[h-4];b=r.W(x,f,x[2]/(x[2]-f[2]))}if(Mn(this.state,b[0],b[1],0,this._transform)>=$i)return!0}return!1}updateConfig(n){this._transitionable.setTransitionOrValue(this._options,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,h){return(!h||h.validate!==!1)&&Pt(this,n.call(Ko,r.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.D})))}}class ho extends r.E{constructor(n,a,h,f){super(),this.scope=h,this._options=n,this.properties=new r.Q(a),this._transitionable=new r.J(a,h,new Map(f)),this._transitionable.setTransitionOrValue(n.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(n){this._transitionable.setTransitionOrValue(this._options.properties,new Map(n))}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(n,a){this._options=n,this._transitionable.setTransitionOrValue(n.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let to=new r.F({color:new r.G(r.D.properties_light_ambient.color),intensity:new r.G(r.D.properties_light_ambient.intensity)}),kr=new r.F({direction:new r.X(r.D.properties_light_directional.direction),color:new r.G(r.D.properties_light_directional.color),intensity:new r.G(r.D.properties_light_directional.intensity),"cast-shadows":new r.G(r.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.G(r.D.properties_light_directional["shadow-intensity"])});class gr{constructor(n,a,h,f){this.screenBounds=n,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(n,a){let h,f;if(n instanceof r.P||typeof n[0]=="number"){let b=r.P.convert(n);h=[b],f=a.isPointAboveHorizon(b)}else{let b=r.P.convert(n[0]),x=r.P.convert(n[1]);h=[b,x],f=r.Y(b,x).every(T=>a.isPointAboveHorizon(T))}return new gr(h,a.getCameraPoint(),f,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return r.Y(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){let a=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],f=r.Y(a,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<h.x?f.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?f[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(f[3]=this.cameraPoint)),r._(f,n)}bufferedCameraGeometryGlobe(n){let a=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],f=r.Y(a,h,n),b=this.cameraPoint.clone();switch(3*((b.y>a.y)+(b.y>h.y))+((b.x>a.x)+(b.x>h.x))){case 0:f[0]=b,f[4]=b.clone();break;case 1:f.splice(1,0,b);break;case 2:f[1]=b;break;case 3:f.splice(4,0,b);break;case 5:f.splice(2,0,b);break;case 6:f[3]=b;break;case 7:f.splice(3,0,b);break;case 8:f[2]=b}return f}containsTile(n,a,h,f=0){let b=n.queryPadding/a._pixelsPerMercatorPixel+1,x=h?this._bufferedCameraMercator(b,a):this._bufferedScreenMercator(b,a),T=n.tileID.wrap+(x.unwrapped?f:0),I=x.polygon.map($=>r.$(n.tileTransform,$,T));if(!r.a0(I,0,0,r.V,r.V))return;T=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?f:0);let A=this.screenGeometryMercator.polygon.map($=>r.a1(n.tileTransform,$,T)),k=A.map($=>new r.P($[0],$[1])),P=a.getFreeCameraOptions().position||new r.L(0,0,0),L=r.a1(n.tileTransform,P,T),B=A.map($=>{let j=r.N.sub($,$,L);return r.N.normalize(j,j),new r.a2(L,j)}),H=r.a3(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:B,bufferedTilespaceGeometry:I,bufferedTilespaceBounds:(G=r.a4(I),G.min.x=r.aa(G.min.x,0,r.V),G.min.y=r.aa(G.min.y,0,r.V),G.max.x=r.aa(G.max.x,0,r.V),G.max.y=r.aa(G.max.y,0,r.V),G),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:H};var G}_bufferedScreenMercator(n,a){let h=tt(n);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let f;return f=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map(b=>a.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[h]=f,f}}_bufferedCameraMercator(n,a){let h=tt(n);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let f;return f=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map(b=>a.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[h]=f,f}}_projectAndResample(n,a){let h=function(b,x){let T=r.a6.multiply([],x.pixelMatrix,x.globeMatrix),I=[0,-r.ab,0,1],A=[0,r.ab,0,1],k=[0,0,0,1];r.a7.transformMat4(I,I,T),r.a7.transformMat4(A,A,T),r.a7.transformMat4(k,k,T);let P=new r.P(I[0]/I[3],I[1]/I[3]),L=new r.P(A[0]/A[3],A[1]/A[3]),B=r.a8(b,P)&&I[3]<k[3],H=r.a8(b,L)&&A[3]<k[3];if(!B&&!H)return null;let G=function(ne,le,ce){for(let me=1;me<ne.length;me++){let Ie=Le(le.pointCoordinate3D(ne[me-1]).x),be=Le(le.pointCoordinate3D(ne[me]).x);if(ce<0){if(Ie<be)return{idx:me,t:-Ie/(be-1-Ie)}}else if(be<Ie)return{idx:me,t:(1-Ie)/(be+1-Ie)}}return null}(b,x,B?-1:1);if(!G)return null;let{idx:$,t:j}=G,W=$>1?Ne(b.slice(0,$),x):[],ee=$<b.length?Ne(b.slice($),x):[];W=W.map(ne=>new r.P(Le(ne.x),ne.y)),ee=ee.map(ne=>new r.P(Le(ne.x),ne.y));let X=[...W];X.length===0&&X.push(ee[ee.length-1]);let te=r.U(X[X.length-1].y,(ee.length===0?W[0]:ee[0]).y,j),q;return q=B?[new r.P(0,te),new r.P(0,0),new r.P(1,0),new r.P(1,te)]:[new r.P(1,te),new r.P(1,1),new r.P(0,1),new r.P(0,te)],X.push(...q),ee.length===0?X.push(W[0]):X.push(...ee),{polygon:X.map(ne=>new r.L(ne.x,ne.y)),unwrapped:!1}}(n,a);if(h)return h;let f=function(b,x){let T=!1,I=-1/0,A=0;for(let P=0;P<b.length-1;P++)b[P].x>I&&(I=b[P].x,A=P);for(let P=0;P<b.length-1;P++){let L=(A+P)%(b.length-1),B=b[L],H=b[L+1];Math.abs(B.x-H.x)>.5&&(B.x<H.x?(B.x+=1,L===0&&(b[b.length-1].x+=1)):(H.x+=1,L+1===b.length-1&&(b[0].x+=1)),T=!0)}let k=r.a5(x.center.lng);return T&&k<Math.abs(k-1)&&b.forEach(P=>{P.x-=1}),{polygon:b,unwrapped:T}}(Ne(n,a).map(b=>new r.P(Le(b.x),b.y)),a);return{polygon:f.polygon.map(b=>new r.L(b.x,b.y)),unwrapped:f.unwrapped}}}function Ne(u,n){return r.a9(u,a=>{let h=n.pointCoordinate3D(a);a.x=h.x,a.y=h.y},1/256)}function Le(u){return u<0?1+u%1:u%1}function tt(u){return 100*u|0}function lt(u,n,a,h,f){let b=function(x,T){if(x)return f(x);if(T){u.url&&T.tiles&&u.tiles&&delete u.tiles;let I=r.ac(r.e(T,u),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(I.vectorLayers=T.vector_layers,I.vectorLayerIds=I.vectorLayers.map(A=>A.id)),T.raster_layers&&(I.rasterLayers=T.raster_layers,I.rasterLayerIds=I.rasterLayers.map(A=>A.id)),I.tiles=n.canonicalizeTileset(I,u.url),f(null,I)}};return u.url?r.g(n.transformRequest(n.normalizeSourceURL(u.url,null,a,h),r.R.Source),b):r.f.frame(()=>b(null,u))}class it{constructor(n,a,h){this.bounds=r.ad.convert(this.validateBounds(n)),this.minzoom=a||0,this.maxzoom=h||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){let a=Math.pow(2,n.z),h=Math.floor(r.a5(this.bounds.getWest())*a),f=Math.floor(r.ae(this.bounds.getNorth())*a),b=Math.ceil(r.a5(this.bounds.getEast())*a),x=Math.ceil(r.ae(this.bounds.getSouth())*a);return n.x>=h&&n.x<b&&n.y>=f&&n.y<x}}class ht extends r.E{constructor(n,a,h,f){if(super(),this.id=n,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.e(this,r.ac(a,["url","scheme","tileSize","promoteId"])),this._options=r.e({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f),this._tileWorkers={},this._deduped=new r.af}load(n){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"}));let a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=lt(this._options,this.map._requestManager,a,h,(f,b)=>{this._tileJSONRequest=null,this._loaded=!0,f?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new r.a(f))):b&&(r.e(this,b),b.bounds&&(this.tileBounds=new it(b.bounds,this.minzoom,this.maxzoom)),r.aj(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),n&&n(f)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();let n=r.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.e({},this._options)}loadTile(n,a){let h=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(h,r.R.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:n.isExtraShadowCaster};if(f.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=a:n.request=n.actor.send("reloadTile",f,b.bind(this));else if(n.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",f,b.bind(this),void 0,!0);else{let x=r.ah.call({deduped:this._deduped},f,(T,I)=>{T||!I?b.call(this,T):(f.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},n.actor&&n.actor.send("loadTile",f,b.bind(this),void 0,!0))},!0);n.request={cancel:x}}function b(x,T){return delete n.request,n.aborted?a(null):x&&x.status!==404?a(x):(T&&T.resourceTiming&&(n.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&n.setExpiryData(T),n.loadVectorData(T,this.map.painter),r.ai(this.dispatcher),a(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(n){n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id,scope:this.scope}),n.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class gt extends r.E{constructor(n,a,h,f){super(),this.id=n,this.dispatcher=h,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.e({type:"raster"},a),r.e(this,r.ac(a,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"})),this._tileJSONRequest=lt(this._options,this.map._requestManager,null,null,(a,h)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new r.a(a)):h&&(r.e(this,h),h.bounds&&(this.tileBounds=new it(h.bounds,this.minzoom,this.maxzoom)),r.aj(h.tiles),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),n&&n(a)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest();let n=r.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(n))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.e({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){let h=r.f.devicePixelRatio>=2,f=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);n.request=r.d(this.map._requestManager.transformRequest(f,r.R.Tile),(b,x,T,I)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):b?(n.state="errored",a(b)):x?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:T,expires:I}),n.setTexture(x,this.map.painter),n.state="loaded",r.ai(this.dispatcher),void a(null)):a(null)))}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a()}unloadTile(n,a){n.texture&&n.texture instanceof r.T?(n.destroy(!0),n.texture&&n.texture instanceof r.T&&this.map.painter.saveTileTexture(n.texture)):n.destroy(),a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class rt extends gt{constructor(n,a,h,f){super(n,a,h,f),this.type="raster-array",this.maxzoom=22,this._options=r.e({type:"raster-array"},a)}triggerRepaint(n){let a=this.map.painter._terrain,h=this.map.style.getSourceCache(this.id);a&&a.enabled&&h&&a._clearRenderCacheForTile(h.id,n.tileID),this.map.triggerRepaint()}loadTile(n,a){let h=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),f=this.map._requestManager.transformRequest(h,r.R.Tile);n.requestParams=f,n.actor||(n.actor=this.dispatcher.getActor()),n.request=n.fetchHeader(void 0,(b,x,T,I)=>{if(delete n.request,n.aborted)return n.state="unloaded",a(null);if(b)return b.code===20?void 0:(n.state="errored",a(b));this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:T,expires:I}),n.state="empty",a(null)})}unloadTile(n){let a=n.texture;a&&a instanceof r.T?(n.destroy(!0),this.map.painter.saveTileTexture(a)):(n.destroy(),n.flushQueues(),n._isHeaderLoaded=!1,delete n._mrt,delete n.textureDescriptor),n.fbo&&(n.fbo.destroy(),delete n.fbo),delete n.request,delete n.requestParams,delete n.neighboringTiles,n.state="unloaded"}prepareTile(n,a,h){n._isHeaderLoaded&&(n.state!=="empty"&&(n.state="reloading"),n.fetchBand(a,h,(f,b)=>{if(f)return n.state="errored",this.fire(new r.a(f)),void this.triggerRepaint(n);b&&(n.setTexture(b,this.map.painter),n.state="loaded",this.triggerRepaint(n))}))}getInitialBand(n){if(!this.rasterLayers)return 0;let a=this.rasterLayers.find(({id:b})=>b===n),h=a&&a.fields,f=h&&h.bands&&h.bands;return f?f[0]:0}getTextureDescriptor(n,a,h){if(!n)return;let f=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!f)return;let b=null;a instanceof r.an?b=a.paint.get("raster-array-band"):a instanceof r.ao&&(b=a.paint.get("raster-particle-array-band"));let x=b||this.getInitialBand(f);if(x!=null)if(n.textureDescriptor){if(!n.updateNeeded(f,x)||h)return Object.assign({},n.textureDescriptor,{texture:n.texture})}else this.prepareTile(n,f,x)}}let xt=32,pt=33,ti=new Uint16Array(8184);for(let u=0;u<2046;u++){let n=u+2,a=0,h=0,f=0,b=0,x=0,T=0;for(1&n?f=b=x=xt:a=h=T=xt;(n>>=1)>1;){let A=a+f>>1,k=h+b>>1;1&n?(f=a,b=h,a=x,h=T):(a=f,h=b,f=x,b=T),x=A,T=k}let I=4*u;ti[I+0]=a,ti[I+1]=h,ti[I+2]=f,ti[I+3]=b}let ni=new Uint16Array(2178),Bt=new Uint8Array(1089),In=new Uint16Array(1089);function Gn(u){return u===0?-.03125:u===32?.03125:0}let Wn=(()=>{class u{constructor(a,h,f,b){this.id=u.uniqueIdxCounter,u.uniqueIdxCounter++,this.context=a;let x=a.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||b||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){this.id=u.uniqueIdxCounter,u.uniqueIdxCounter++;let h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return u.uniqueIdxCounter=0,u})(),Rr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Nr{constructor(n,a,h,f,b,x){this.length=a.length,this.attributes=h,this.itemSize=a.bytesPerElement,this.dynamicDraw=f,this.instanceCount=x,this.context=n;let T=n.gl;this.buffer=T.createBuffer(),n.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||b||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){let a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let h=0;h<this.attributes.length;h++){let f=a.attributes[this.attributes[h].name];f!==void 0&&n.enableVertexAttribArray(f)}}setVertexAttribPointers(n,a,h){for(let f=0;f<this.attributes.length;f++){let b=this.attributes[f],x=a.attributes[b.name];x!==void 0&&n.vertexAttribPointer(x,b.components,n[Rr[b.type]],!1,this.itemSize,b.offset+this.itemSize*(h||0))}}setVertexAttribDivisor(n,a,h){for(let f=0;f<this.attributes.length;f++){let b=a.attributes[this.attributes[f].name];b!==void 0&&this.instanceCount&&this.instanceCount>0&&n.vertexAttribDivisor(b,h)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Zi{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class po extends Zi{getDefault(){return r.ax.transparent}set(n){let a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Bo extends Zi{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Br extends Zi{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Tr extends Zi{getDefault(){return[!0,!0,!0,!0]}set(n){let a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ga extends Zi{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Ls extends Zi{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Ma extends Zi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){let a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class mo extends Zi{getDefault(){let n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){let a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class El extends Zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class Qo extends Zi{getDefault(){return[0,1]}set(n){let a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class hs extends Zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class ac extends Zi{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Ad extends Zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class Vc extends Zi{getDefault(){let n=this.gl;return[n.ONE,n.ZERO,n.ONE,n.ZERO]}set(n){let a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Dd extends Zi{getDefault(){return r.ax.transparent}set(n){let a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Eo extends Zi{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(n,n),this.current=n,this.dirty=!1)}}class hr extends Zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class Ai extends Zi{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class kd extends Zi{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let jc=class extends Zi{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class Rd extends Zi{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Sp extends Zi{getDefault(){let n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){let a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Vo extends Zi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class D extends Zi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class N extends Zi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class J extends Zi{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class re extends Zi{getDefault(){return null}set(n){let a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class pe extends Zi{getDefault(){return null}set(n){this.gl&&(n!==this.current||this.dirty)&&(this.gl.bindVertexArray(n),this.current=n,this.dirty=!1)}}class ge extends Zi{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Ee extends Zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class ft extends Zi{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;let a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Ze extends Zi{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class Vt extends Ze{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class zt extends Ze{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Mt extends Ze{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class oi extends zt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ji{constructor(n,a,h,f,b){this.context=n,this.width=a,this.height=h;let x=this.framebuffer=n.gl.createFramebuffer();f&&(this.colorAttachment=new Vt(n,x)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new zt(n,x):new Mt(n,x))}destroy(){let n=this.context.gl;if(this.colorAttachment){let a=this.colorAttachment.get();a&&n.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let a=this.depthAttachment.get();a&&n.deleteRenderbuffer(a)}else{let a=this.depthAttachment.get();a&&n.deleteTexture(a)}n.deleteFramebuffer(this.framebuffer)}}class ot{constructor(n,a,h){this.func=n,this.mask=a,this.range=h}}ot.ReadOnly=!1,ot.ReadWrite=!0,ot.disabled=new ot(519,ot.ReadOnly,[0,1]);let tr=7680;class ke{constructor(n,a,h,f,b,x){this.test=n,this.ref=a,this.mask=h,this.fail=f,this.depthFail=b,this.pass=x}}ke.disabled=new ke({func:519,mask:0},0,0,tr,tr,tr);let Kt=771;class Gt{constructor(n,a,h,f){this.blendFunction=n,this.blendColor=a,this.mask=h,this.blendEquation=f}}Gt.Replace=[1,0,1,0],Gt.disabled=new Gt(Gt.Replace,r.ax.transparent,[!1,!1,!1,!1]),Gt.unblended=new Gt(Gt.Replace,r.ax.transparent,[!0,!0,!0,!0]),Gt.alphaBlended=new Gt([1,Kt,1,Kt],r.ax.transparent,[!0,!0,!0,!0]),Gt.multiply=new Gt([774,0,774,0],r.ax.transparent,[!0,!0,!0,!0]);let Er=1029,_n=2305;class qt{constructor(n,a,h){this.enable=n,this.mode=a,this.frontFace=h}}qt.disabled=new qt(!1,Er,_n),qt.backCCW=new qt(!0,Er,_n),qt.backCW=new qt(!0,Er,2304),qt.frontCW=new qt(!0,1028,2304),qt.frontCCW=new qt(!0,1028,_n);class Ku{constructor(n,a){this.gl=n,this.clearColor=new po(this),this.clearDepth=new Bo(this),this.clearStencil=new Br(this),this.colorMask=new Tr(this),this.depthMask=new Ga(this),this.stencilMask=new Ls(this),this.stencilFunc=new Ma(this),this.stencilOp=new mo(this),this.stencilTest=new El(this),this.depthRange=new Qo(this),this.depthTest=new hs(this),this.depthFunc=new ac(this),this.blend=new Ad(this),this.blendFunc=new Vc(this),this.blendColor=new Dd(this),this.blendEquation=new Eo(this),this.cullFace=new hr(this),this.cullFaceSide=new Ai(this),this.frontFace=new kd(this),this.program=new jc(this),this.activeTexture=new Rd(this),this.viewport=new Sp(this),this.bindFramebuffer=new Vo(this),this.bindRenderbuffer=new D(this),this.bindTexture=new N(this),this.bindVertexBuffer=new J(this),this.bindElementBuffer=new re(this),this.bindVertexArrayOES=new pe(this),this.pixelStoreUnpack=new ge(this),this.pixelStoreUnpackPremultiplyAlpha=new Ee(this),this.pixelStoreUnpackFlipY=new ft(this),this.options=a?Ht({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=n.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE),this.maxPointSize=n.getParameter(n.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a,h){return new Wn(this,n,a,h)}createVertexBuffer(n,a,h,f,b){return new Nr(this,n,a,h,f,b)}createRenderbuffer(n,a,h){let f=this.gl,b=f.createRenderbuffer();return this.bindRenderbuffer.set(b),f.renderbufferStorage(f.RENDERBUFFER,n,a,h),this.bindRenderbuffer.set(null),b}createFramebuffer(n,a,h,f){return new ji(this,n,a,h,f)}clear({color:n,depth:a,stencil:h,colorMask:f}){let b=this.gl,x=0;n&&(x|=b.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set(f||[!0,!0,!0,!0])),a!==void 0&&(x|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h!==void 0&&(x|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),b.clear(x)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){M(n.blendFunction,Gt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor),n.blendEquation?this.blendEquation.set(n.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(n.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var zn=r.ay([{name:"a_pos",type:"Float32",components:3}]);class Ir{constructor(n,a,h,f){let b={width:h[0],height:h[1],data:null},x=n.gl;this.targetColorTexture=new r.T(n,b,x.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new r.T(n,b,x.RGBA,{useMipmap:!1}),this.context=n,this.setNumParticles(a,f),this.lastInvalidatedAt=0}setNumParticles(n,a){if(this.numParticles===a)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());let h=new r.az;h.reserve(Math.round(a));let f=r.aA(n.key);for(let b=0;b<a;b++)h.emplaceBack(f(),f(),f());this.particleVertices0=this.context.createVertexBuffer(h,zn.members,!0),this.particleVertices1=this.context.createVertexBuffer(h,zn.members,!0),this.particleSegment=r.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=a}update(n){return!(this.lastInvalidatedAt<n&&(this.lastInvalidatedAt=r.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}let Jo={type:2,extent:r.V,loadGeometry:()=>[[new r.P(0,0),new r.P(r.V+1,0),new r.P(r.V+1,r.V+1),new r.P(0,r.V+1),new r.P(0,0)]]};class fo{constructor(n,a,h,f,b){this.tileID=n,this.uid=r.aC(),this.uses=0,this.tileSize=a,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,f&&f.style&&(this._lastUpdatedBrightness=f.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",f&&f.transform&&(this.projection=f.transform.projection)}registerFadeDuration(n){let a=n+this.timeAdded;a<r.f.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,a,h){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(f,b){let x={};if(!b)return x;for(let T of f){let I=T.layerIds.map(A=>b.getLayer(A)).filter(Boolean);if(I.length!==0){T.layers=I,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(A=>I.filter(k=>k.id===A)[0]));for(let A of I)x[A.fqid]=T}}return x}(n.buckets,a.style),this.hasSymbolBuckets=!1;for(let f in this.buckets){let b=this.buckets[f];if(b instanceof r.aE){if(this.hasSymbolBuckets=!0,!h)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let f in this.buckets){let b=this.buckets[f];if(b instanceof r.aE&&b.hasRTLText){this.hasRTLText=!0,r.aF();break}}this.queryPadding=0;for(let f in this.buckets){let b=this.buckets[f],x=a.style.getOwnLayer(f);if(!x)continue;let T=x.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,T)}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas),this._lastUpdatedBrightness=n.brightness}else this.collisionBoxArray=new r.aD}unloadVectorData(){if(this.hasData()){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.fqid]}upload(n){for(let f in this.buckets){let b=this.buckets[f];b.uploadPending()&&b.upload(n)}let a=n.gl,h=this.imageAtlas;if(h&&!h.uploaded){let f=!!Object.keys(h.patternPositions).length;this.imageAtlasTexture=new r.T(n,h.image,a.RGBA,{useMipmap:f}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(n,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(n,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(n,a,h){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture,h),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let f=a.style.getBrightness();(this._lastUpdatedBrightness||f)&&(this._lastUpdatedBrightness&&f&&Math.abs(this._lastUpdatedBrightness-f)<.001||(this._lastUpdatedBrightness=f,this.updateBuckets(void 0,a)))}queryRenderedFeatures(n,a,h,f,b,x,T,I){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:f,pixelPosMatrix:T,transform:x,params:b,tileTransform:this.tileTransform},n,a,h):{}}querySourceFeatures(n,a){let h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;let f=h.loadVTLayers(),b=a?a.sourceLayer:"",x=f._geojsonTileLayer||f[b];if(!x)return;let T=r.aG(a&&a.filter),{z:I,x:A,y:k}=this.tileID.canonical,P={z:I,x:A,y:k};for(let L=0;L<x.length;L++){let B=x.feature(L);if(T.needGeometry){let $=r.aH(B,!0);if(!T.filter(new r.K(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!T.filter(new r.K(this.tileID.overscaledZ),B))continue;let H=h.getId(B,b),G=new r.aI(B,I,A,k,H);G.tile=P,n.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let n in this.buckets)if(this.buckets[n].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){let a=this.expirationTime;if(n.cacheControl){let h=r.aJ(n.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){let h=Date.now(),f=!1;if(this.expirationTime>h)f=!1;else if(a)if(this.expirationTime<a)f=!0;else{let b=this.expirationTime-a;b?this.expirationTime=h+Math.max(b,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,a){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(n).length!==0&&a&&this.updateBuckets(n,a)}updateBuckets(n,a){if(!this.latestFeatureIndex)return;let h=this.latestFeatureIndex.loadVTLayers(),f=a.style.listImages(),b=a.style.getBrightness();for(let x in this.buckets){if(!a.style.hasLayer(x))continue;let T=this.buckets[x],I=T.layers[0].sourceLayer||"_geojsonTileLayer",A=h[I],k={};if(n&&(k=n[I],!A||!k||Object.keys(k).length===0))continue;if(T.update(k,A,f,this.imageAtlas&&this.imageAtlas.patternPositions||{},b),T instanceof r.aK||T instanceof r.aL){let L=a.style.getOwnSourceCache(T.layers[0].source);a._terrain&&a._terrain.enabled&&L&&T.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(L.id,this.tileID)}let P=a&&a.style&&a.style.getOwnLayer(x);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=r.f.now()+n}setTexture(n,a){let h=a.context,f=h.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof r.T?this.texture.update(n,{useMipmap:!0}):(this.texture=new r.T(h,n,f.RGBA,{useMipmap:!0}),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE))}setDependencies(n,a){let h={};for(let f of a)h[f]=!0;this.dependencies[n]=h}hasDependency(n,a){for(let h of n){let f=this.dependencies[h];if(f){for(let b of a)if(f[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;let h=r.aM(Jo,this.tileID.canonical,this.tileTransform)[0],f=new r.aN,b=new r.aO;for(let x=0;x<h.length;x++){let{x:T,y:I}=h[x];f.emplaceBack(T,I),b.emplaceBack(x)}b.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(b),this._tileDebugBuffer=n.createVertexBuffer(f,r.aP.members),this._tileDebugSegments=r.aB.simpleSegment(0,0,f.length,b.length)}_makeTileBoundsBuffers(n,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;let h=r.aM(Jo,this.tileID.canonical,this.tileTransform)[0],f,b;if(this.isRaster){let x=function(T,I){let A=r.as(T,I),k=Math.pow(2,T.z);for(let $=0;$<pt;$++)for(let j=0;j<pt;j++){let W=r.at((T.x+(j+Gn(j))/xt)/k),ee=r.au((T.y+($+Gn($))/xt)/k),X=I.project(W,ee),te=$*pt+j;ni[2*te+0]=Math.round((X.x*A.scale-A.x)*r.V),ni[2*te+1]=Math.round((X.y*A.scale-A.y)*r.V)}Bt.fill(0),In.fill(0);for(let $=2045;$>=0;$--){let j=4*$,W=ti[j+0],ee=ti[j+1],X=ti[j+2],te=ti[j+3],q=W+X>>1,ne=ee+te>>1,le=q+ne-ee,ce=ne+W-q,me=ee*pt+W,Ie=te*pt+X,be=ne*pt+q,Fe=Math.hypot((ni[2*me+0]+ni[2*Ie+0])/2-ni[2*be+0],(ni[2*me+1]+ni[2*Ie+1])/2-ni[2*be+1])>=16;Bt[be]=Bt[be]||(Fe?1:0),$<1022&&(Bt[be]=Bt[be]||Bt[(ee+ce>>1)*pt+(W+le>>1)]||Bt[(te+ce>>1)*pt+(X+le>>1)])}let P=new r.av,L=new r.aw,B=0;function H($,j){let W=j*pt+$;return In[W]===0&&(P.emplaceBack(ni[2*W+0],ni[2*W+1],$*r.V/xt,j*r.V/xt),In[W]=++B),In[W]-1}function G($,j,W,ee,X,te){let q=$+W>>1,ne=j+ee>>1;if(Math.abs($-X)+Math.abs(j-te)>1&&Bt[ne*pt+q])G(X,te,$,j,q,ne),G(W,ee,X,te,q,ne);else{let le=H($,j),ce=H(W,ee),me=H(X,te);L.emplaceBack(le,ce,me)}}return G(0,0,xt,xt,xt,0),G(xt,xt,0,0,0,xt),{vertices:P,indices:L}}(this.tileID.canonical,a);f=x.vertices,b=x.indices}else{f=new r.av,b=new r.aw;for(let{x:T,y:I}of h)f.emplaceBack(T,I,0,0);let x=r.aQ(f.int16,void 0,4);for(let T=0;T<x.length;T+=3)b.emplaceBack(x[T],x[T+1],x[T+2])}this._tileBoundsBuffer=n.createVertexBuffer(f,r.aR.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(b),this._tileBoundsSegments=r.aB.simpleSegment(0,0,f.length,b.length)}_makeGlobeTileDebugBuffers(n,a){let h=a.projection;if(!h||h.name!=="globe"||a.freezeTileCoverage)return;let f=this.tileID.canonical,b=r.aS(f,a),x=r.aT(b),T=r.S(a.zoom),I;T>0&&(I=r.a6.invert(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,f,a,x,I,T),this._makeGlobeTileDebugTextBuffer(n,f,a,x,I,T)}_globePoint(n,a,h,f,b,x,T){let I=r.aU(n,a,h);if(x){let A=1<<h.z,k=r.a5(f.center.lng),P=r.ae(f.center.lat),L=(h.x+.5)/A-k,B=0;L>.5?B=-1:L<-.5&&(B=1);let H=(n/r.V+h.x)/A+B,G=(a/r.V+h.y)/A;H=(H-k)*f._pixelsPerMercatorPixel+k,G=(G-P)*f._pixelsPerMercatorPixel+P;let $=[H*f.worldSize,G*f.worldSize,0];r.N.transformMat4($,$,x),I=r.aV(I,$,T)}return r.N.transformMat4(I,I,b)}_makeGlobeTileDebugBorderBuffer(n,a,h,f,b,x){let T=new r.aN,I=new r.aO,A=new r.aW,k=(L,B,H,G,$)=>{let j=(H-L)/($-1),W=(G-B)/($-1),ee=T.length;for(let X=0;X<$;X++){let te=L+X*j,q=B+X*W;T.emplaceBack(te,q);let ne=this._globePoint(te,q,a,h,f,b,x);A.emplaceBack(ne[0],ne[1],ne[2]),I.emplaceBack(ee+X)}},P=r.V;k(0,0,P,0,16),k(P,0,P,P,16),k(P,P,0,P,16),k(0,P,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(I),this._tileDebugBuffer=n.createVertexBuffer(T,r.aP.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(A,r.aX.members),this._tileDebugSegments=r.aB.simpleSegment(0,0,T.length,I.length)}_makeGlobeTileDebugTextBuffer(n,a,h,f,b,x){let T=r.V/4,I=new r.aN,A=new r.aw,k=new r.aW,P=25;A.reserve(32),I.reserve(P),k.reserve(P);let L=(B,H)=>P*B+H;for(let B=0;B<P;B++){let H=B*T;for(let G=0;G<P;G++){let $=G*T;I.emplaceBack($,H);let j=this._globePoint($,H,a,h,f,b,x);k.emplaceBack(j[0],j[1],j[2])}}for(let B=0;B<4;B++)for(let H=0;H<4;H++){let G=L(B,H),$=L(B,H+1),j=L(B+1,H),W=L(B+1,H+1);A.emplaceBack(G,$,j),A.emplaceBack(j,$,W)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(A),this._tileDebugTextBuffer=n.createVertexBuffer(I,r.aP.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(k,r.aX.members),this._tileDebugTextSegments=r.aB.simpleSegment(0,0,P,32)}destroy(n=!1){for(let a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!n&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let Aa={vector:ht,raster:gt,"raster-dem":class extends gt{constructor(u,n,a,h){super(u,n,a,h),this.type="raster-dem",this.maxzoom=22,this._options=r.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(u,n){let a=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(f,b){f&&(u.state="errored",n(f)),b&&(u.dem=b,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",n(null))}u.request=r.d(this.map._requestManager.transformRequest(a,r.R.Tile),(function(f,b,x,T){if(delete u.request,u.aborted)u.state="unloaded",n(null);else if(f)u.state="errored",n(f);else if(b){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:x,expires:T});let I=ImageBitmap&&b instanceof ImageBitmap&&r.ak(),A=1-(b.width-r.al(b.width))/2;A<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));let k=I?b:r.f.getImageData(b,A),P={uid:u.uid,coord:u.tileID,source:this.id,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:A};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",P,h.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){let n=u.canonical,a=Math.pow(2,n.z),h=(n.x-1+a)%a,f=n.x===0?u.wrap-1:u.wrap,b=(n.x+1+a)%a,x=n.x+1===a?u.wrap+1:u.wrap,T={};return T[new r.am(u.overscaledZ,f,n.z,h,n.y).key]={backfilled:!1},T[new r.am(u.overscaledZ,x,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(T[new r.am(u.overscaledZ,f,n.z,h,n.y-1).key]={backfilled:!1},T[new r.am(u.overscaledZ,u.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},T[new r.am(u.overscaledZ,x,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<a&&(T[new r.am(u.overscaledZ,f,n.z,h,n.y+1).key]={backfilled:!1},T[new r.am(u.overscaledZ,u.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},T[new r.am(u.overscaledZ,x,n.z,b,n.y+1).key]={backfilled:!1}),T}},"raster-array":rt,geojson:class extends r.E{constructor(u,n,a,h){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(h),this._data=n.data,this._options=r.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;let f=r.V/this.tileSize;this.workerOptions=r.e({source:this.id,scope:this.scope,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*f,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*f,extent:r.V,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:r.V,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*f,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}getClusterExpansionZoom(u,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},n),this}getClusterChildren(u,n){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},n),this}getClusterLeaves(u,n,a,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:n,offset:a},h),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.b("dataloading",{dataType:"source"})),this._loaded=!1;let u=r.e({},this.workerOptions);u.scope=this.scope;let n=this._data;typeof n=="string"?(u.request=this.map._requestManager.transformRequest(r.f.resolveURL(n),r.R.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,u,(a,h)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new r.a(a));else{let f={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&h&&h.resourceTiming&&h.resourceTiming[this.id]&&(f.resourceTiming=h.resourceTiming[this.id]),this.fire(new r.b("data",f)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(u,n){let a=u.actor?"reloadTile":"loadTile";u.actor=this.actor;let h={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:r.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};u.request=this.actor.send(a,h,(f,b)=>(delete u.request,u.destroy(),u.aborted?n(null):f?n(f):(u.loadVectorData(b,this.map.painter,a==="reloadTile"),n(null))),void 0,a==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.ap{constructor(u,n,a,h){super(u,n,a,h),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;let u=this.options;this.urls=[];for(let n of u.urls)this.urls.push(this.map._requestManager.transformRequest(n,r.R.Source).url);r.aq(this.urls,(n,a)=>{this._loaded=!0,n?this.fire(new r.a(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){let n=this.video.seekable;u<n.start(0)||u>n.end(0)?this.fire(new r.a(new yt(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let u=this.map.painter.context,n=u.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(u,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.ap,model:class extends r.E{constructor(u,n,a,h){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=n}load(){let u=[];for(let n in this._options.models){let a=this._options.models[n],h=r.l(this.map._requestManager.transformRequest(a.uri,r.R.Model).url).then(f=>{if(!f)return;let b=r.c(f),x=new r.M(n,a.position,a.orientation,b);x.computeBoundsAndApplyParent(),this.models.push(x)}).catch(f=>{this.fire(new r.a(new Error(`Could not load model ${n} from ${a.uri}: ${f.message}`)))});u.push(h)}return Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(n=>{this.fire(new r.a(new Error(`Could not load models: ${n.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,n){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(u,n,a,h){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=n,this.tiles=this._options.tiles,this.maxzoom=n.maxzoom||19,this.minzoom=n.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(h)}onAdd(u){this.map=u,this.load()}load(u){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"}));let n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map._worldview;this._tileJSONRequest=lt(this._options,this.map._requestManager,n,a,(h,f)=>{this._tileJSONRequest=null,this._loaded=!0,h?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new r.a(h))):f&&(r.e(this,f),f.bounds&&(this.tileBounds=new it(f.bounds,this.minzoom,this.maxzoom)),r.aj(f.tiles,this.map._requestManager._customAccessToken),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),u&&u(h)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,n){let a=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(a,r.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=n;else{if(u.buckets){let b=Object.values(u.buckets);for(let x of b)x.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",h,f.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",h,f.bind(this),void 0,!0);function f(b,x){return u.aborted?n(null):b&&b.status!==404?n(b):(x&&(x.resourceTiming&&(u.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&u.setExpiryData(x),u.buckets=Ht(Ht({},u.buckets),x.buckets),x.featureIndex&&(u.latestFeatureIndex=x.featureIndex)),u.state="loaded",void n(null))}}serialize(){return r.e({},this._options)}},canvas:class extends r.ap{constructor(u,n,a,h){super(u,n,a,h),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(b=>typeof b!="number"))||this.fire(new r.a(new yt(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.a(new yt(`sources.${u}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new r.a(new yt(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new r.a(new yt(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.a(new yt(`sources.${u}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let n=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof r.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends r.E{constructor(u,n,a,h){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new it(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),r.e(this,r.ac(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this._map=u,this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){let{x:n,y:a,z:h}=u.canonical;return this._implementation.hasTile({x:n,y:a,z:h})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,n){let{x:a,y:h,z:f}=u.tileID.canonical,b=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:a,y:h,z:f},{signal:b.signal})).then((function(x){return delete u.request,u.aborted?(u.state="unloaded",n(null)):x===void 0?(u.state="errored",n(null)):x===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",n(null)):function(T){return T instanceof ImageData||T instanceof HTMLCanvasElement||T instanceof ImageBitmap||T instanceof HTMLImageElement}(x)?(this.loadTileData(u,x),u.state="loaded",void n(null)):(u.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.code!==20&&(u.state="errored",n(x))}),u.request.cancel=()=>b.abort()}loadTileData(u,n){u.setTexture(n,this._map.painter)}unloadTile(u,n){if(u.texture&&u.texture instanceof r.T?(u.destroy(!0),u.texture&&u.texture instanceof r.T&&this._map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){let{x:a,y:h,z:f}=u.tileID.canonical;this._implementation.unloadTile({x:a,y:h,z:f})}n()}abortTile(u,n){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){let u=r.ag(this.id,this.scope);this._map.style.clearSource(u)}_update(){this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))}}},Sr=function(u,n,a,h){let f=new Aa[n.type](u,n,a,h);if(f.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${f.id}`);return r.aY(["load","abort","unload","serialize","prepare"],f),f};function Uc(u,n){let a=r.a6.identity([]);return r.a6.scale(a,a,[.5*u.width,.5*-u.height,1]),r.a6.translate(a,a,[1,-1,0]),r.a6.multiply(a,a,u.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(a)}function sc(u,n,a,h,f,b,x,T=!1){let I=u.tilesIn(h,x,T);I.sort(zs);let A=[];for(let P of I)A.push({wrappedTileID:P.tile.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(n,a,u._state,P,f,b,Uc(u.transform,P.tile.tileID),T)});let k=function(P){let L={},B={};for(let H of P){let G=H.queryResults,$=H.wrappedTileID,j=B[$]=B[$]||{};for(let W in G){let ee=G[W],X=j[W]=j[W]||{},te=L[W]=L[W]||[];for(let q of ee)X[q.featureIndex]||(X[q.featureIndex]=!0,te.push(q))}}return L}(A);for(let P in k)k[P].forEach(L=>{let B=L.feature,H=B.layer;H&&H.type!=="background"&&H.type!=="sky"&&H.type!=="slot"&&(B.source=H.source,H["source-layer"]&&(B.sourceLayer=H["source-layer"]),B.state=B.id!==void 0?u.getFeatureState(H["source-layer"],B.id):{})});return k}function Da(u,n){let a=u.getRenderableIds().map(b=>u.getTileByID(b)),h=[],f={};for(let b=0;b<a.length;b++){let x=a[b],T=x.tileID.canonical.key;f[T]||(f[T]=!0,x.querySourceFeatures(h,n))}return h}function zs(u,n){let a=u.tileID,h=n.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}class Ns extends fo{constructor(n,a,h,f,b){super(n,a,h,f,b),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(n,a){let h=a.context,f=h.gl;this.texture=this.texture||a.getTileTexture(n.width),this.texture&&this.texture instanceof r.T?this.texture.update(n,{useMipmap:!1,premultiply:!1}):this.texture=new r.T(h,n,f.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(n=16384,a){let h=this._mrt=new r.aZ(30),f=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(n-1)}});return this.entireBuffer=null,this.request=r.a_(f,(b,x,T,I)=>{if(b)a(b);else try{let A=h.getHeaderLength(x);if(A>n)return void(this.request=this.fetchHeader(A,a));h.parseHeader(x),this._isHeaderLoaded=!0;let k=0;for(let P of Object.values(h.layers))k=Math.max(k,P.dataIndex[P.dataIndex.length-1].last_byte);x.byteLength>=k&&(this.entireBuffer=x),a(null,this.entireBuffer||x,T,I)}catch(A){a(A)}}),this.request}fetchBand(n,a,h){let f=this._mrt;if(!this._isHeaderLoaded||!f)return void h(new Error("Tile header is not ready"));let b=this.actor;if(!b)return void h(new Error("Can't fetch tile band without an actor"));let x,T=(P,L)=>{x.complete(P,L),P?h(P):(this.updateTextureDescriptor(n,a),h(null,this.textureDescriptor&&this.textureDescriptor.img))},I=(P,L)=>{if(P)return h(P);let B=b.send("decodeRasterArray",{buffer:L,task:x},T,void 0,!0);this._workQueue.push(()=>{B&&B.cancel(),x.cancel()})},A=f.getLayer(n);if(!A)return void h(new Error(`Unknown sourceLayer "${n}"`));if(A.hasDataForBand(a))return this.updateTextureDescriptor(n,a),void h(null,this.textureDescriptor?this.textureDescriptor.img:null);let k=A.getDataRange([a]);if(x=f.createDecodingTask(k),!x||x.tasks.length)if(this.flushQueues(),this.entireBuffer)I(null,this.entireBuffer.slice(k.firstByte,k.lastByte+1));else{let P=Object.assign({},this.requestParams,{headers:{Range:`bytes=${k.firstByte}-${k.lastByte}`}}),L=r.a_(P,I);this._fetchQueue.push(()=>{L.cancel(),x.cancel()})}else h(null)}updateNeeded(n,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==n)&&this.state!=="errored"}updateTextureDescriptor(n,a){if(!this._mrt)return;let h=this._mrt.getLayer(n);if(!h||!h.hasBand(a)||!h.hasDataForBand(a))return;let{bytes:f,tileSize:b,buffer:x,offset:T,scale:I}=h.getBandView(a),A=b+2*x,k={data:f,width:A,height:A},P=this.texture;P&&P instanceof r.T&&P.update(k,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:n,band:a,img:k,buffer:x,offset:T,tileSize:b,format:h.pixelFormat,mix:[I,256*I,65536*I,16777216*I]}}}class Il{constructor(n,a){this.max=n,this.onRemove=a,this.reset()}reset(){for(let n in this.data)for(let a of this.data[n])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(n,a,h){let f=n.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);let b={value:a,timeout:void 0};if(h!==void 0&&(b.timeout=setTimeout(()=>{this.remove(n,b)},h)),this.data[f].push(b),this.order.push(f),this.order.length>this.max){let x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){let a=this.data[n].shift();return a.timeout&&clearTimeout(a.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),a.value}getByKey(n){let a=this.data[n];return a?a[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,a){if(!this.has(n))return this;let h=n.wrapped().key,f=a===void 0?0:this.data[h].indexOf(a),b=this.data[h][f];return this.data[h].splice(f,1),b.timeout&&clearTimeout(b.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(b.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){let a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(n){let a=[];for(let h in this.data)for(let f of this.data[h])n(f.value)||a.push(f);for(let h of a)this.remove(h.value.tileID,h)}}class _a extends r.E{constructor(n,a,h){super(),this.id=n,this._onlySymbols=h,a.on("data",f=>{f.dataType==="source"&&f.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&f.dataType==="source"&&f.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new Il(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Fi,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let n in this._tiles){let a=this._tiles[n];if(a.state!=="errored"&&(a.state!=="loaded"||!a.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,a){return n.isSymbolTile=this._onlySymbols,n.isExtraShadowCaster=this._shadowCasterTiles[n.tileID.key],this._source.loadTile(n,a)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let a in this._tiles){let h=this._tiles[a];h.upload(n),h.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.a$(this._tiles).map(n=>n.tileID).sort(lc).map(n=>n.key)}getRenderableIds(n,a){let h=[];for(let f in this._tiles)this._isIdRenderable(+f,n,a)&&h.push(this._tiles[f]);return n?h.sort((f,b)=>{let x=f.tileID,T=b.tileID,I=new r.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),A=new r.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-T.overscaledZ||A.y-I.y||A.x-I.x}).map(f=>f.tileID.key):h.map(f=>f.tileID).sort(lc).map(f=>f.key)}hasRenderableParent(n){let a=this.findLoadedParent(n,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(n,a,h){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(a||!this._tiles[n].holdingForFade())&&(h||!this._shadowCasterTiles[n])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,a){let h=this._tiles[n];h&&(h.state!=="loading"&&(h.state=a),this._loadTile(h,this._tileLoaded.bind(this,h,n,a)))}_tileLoaded(n,a,h,f){if(f)if(n.state="errored",f.status!==404)this._source.fire(new r.a(f,{tile:n}));else{if(!(n.tileID.key in this._loadedParentTiles))return void this._source.fire(new r.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let b=this.map.painter.terrain;this.update(this.transform,b.getScaledDemTileSize(),!0),b.resetTileLookupCache(this.id)}else this.update(this.transform)}else n.timeAdded=r.f.now(),h==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(a,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new r.b("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){let a=this.getRenderableIds();for(let f=0;f<a.length;f++){let b=a[f];if(n.neighboringTiles&&n.neighboringTiles[b]){let x=this.getTileByID(b);h(n,x),h(x,n)}}function h(f,b){if(!f.dem||f.dem.borderReady)return;f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0;let x=b.tileID.canonical.x-f.tileID.canonical.x,T=b.tileID.canonical.y-f.tileID.canonical.y,I=Math.pow(2,f.tileID.canonical.z),A=b.tileID.key;x===0&&T===0||Math.abs(T)>1||(Math.abs(x)>1&&(Math.abs(x+I)===1?x+=I:Math.abs(x-I)===1&&(x-=I)),b.dem&&f.dem&&(f.dem.backfillBorder(b.dem,x,T),f.neighboringTiles&&f.neighboringTiles[A]&&(f.neighboringTiles[A].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,a,h,f){for(let b in this._tiles){let x=this._tiles[b];if(f[b]||!x.hasData()||x.tileID.overscaledZ<=a||x.tileID.overscaledZ>h)continue;let T=x.tileID;for(;x&&x.tileID.overscaledZ>a+1;){let A=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[A.key],x&&x.hasData()&&(T=A)}let I=T;for(;I.overscaledZ>a;)if(I=I.scaledTo(I.overscaledZ-1),n[I.key]){f[T.key]=T;break}}}findLoadedParent(n,a){if(n.key in this._loadedParentTiles){let h=this._loadedParentTiles[n.key];return h&&h.tileID.overscaledZ>=a?h:null}for(let h=n.overscaledZ-1;h>=a;h--){let f=n.scaledTo(h),b=this._getLoadedTile(f);if(b)return b}}_getLoadedTile(n){let a=this._tiles[n.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,a){a=a||this._source.tileSize;let h=Math.ceil(n.width/a)+1,f=Math.ceil(n.height/a)+1,b=Math.floor(h*f*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(T)}handleWrapJump(n){let a=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,a){let h={};for(let f in this._tiles){let b=this._tiles[f];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+a),h[b.tileID.key]=b}this._tiles=h;for(let f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(let f in this._tiles)this._setTileReloadTimer(+f,this._tiles[f])}}update(n,a,h,f){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let b;if(this.updateCacheSize(n,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)b=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(I=>new r.am(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y));else if(this.tileCoverLift!==0){let I=n.clone();I.tileCoverLift=this.tileCoverLift,b=I.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&n.projection.name==="globe"&&(b.push(new r.am(1,0,1,0,0)),b.push(new r.am(1,0,1,1,0)),b.push(new r.am(1,0,1,0,1)),b.push(new r.am(1,0,1,1,1)))}else b=n.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(b=b.filter(I=>this._source.hasTile(I)));else b=[];if(b.length>0&&this.castsShadows&&f&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ka(this._source.type)){let I=n.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!h}),A=Math.min(I,this._source.maxzoom),k=n.extendTileCoverForShadows(b,f,A);for(let P of k)this._shadowCasterTiles[P.key]=!0,b.push(P)}let x=this._updateRetainedTiles(b);if(ka(this._source.type)&&b.length!==0){let I={},A={},k=Object.keys(x);for(let L of k){let B=x[L],H=this._tiles[L];if(!H||H.fadeEndTime&&H.fadeEndTime<=r.f.now())continue;let G=this.findLoadedParent(B,Math.max(B.overscaledZ-_a.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),I[G.tileID.key]=G.tileID),A[L]=B}let P=b[b.length-1].overscaledZ;for(let L in this._tiles){let B=this._tiles[L];if(x[L]||!B.hasData())continue;let H=B.tileID;for(;H.overscaledZ>P;){H=H.scaledTo(H.overscaledZ-1);let G=this._tiles[H.key];if(G&&G.hasData()&&A[H.key]){x[L]=B.tileID;break}}}for(let L in I)x[L]||(this._coveredTiles[L]=!0,x[L]=I[L])}for(let I in x)this._tiles[I].clearFadeHold();let T=r.b0(this._tiles,x);for(let I of T){let A=this._tiles[I];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(+I)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){let a={};if(n.length===0)return a;let h={},f=n.reduce((A,k)=>Math.min(A,k.overscaledZ),1/0),b=n[0].overscaledZ,x=Math.max(b-_a.maxOverzooming,this._source.minzoom),T=Math.max(b+_a.maxUnderzooming,this._source.minzoom),I={};for(let A of n){let k=this._addTile(A);a[A.key]=A,k.hasData()||f<this._source.maxzoom&&(I[A.key]=A)}this._retainLoadedChildren(I,f,T,a);for(let A of n){let k=this._tiles[A.key];if(k.hasData())continue;if(A.canonical.z>=this._source.maxzoom){let L=A.children(this._source.maxzoom)[0],B=this.getTile(L);if(B&&B.hasData()){a[L.key]=L;continue}}else{let L=A.children(this._source.maxzoom);if(a[L[0].key]&&a[L[1].key]&&a[L[2].key]&&a[L[3].key])continue}let P=k.wasRequested();for(let L=A.overscaledZ-1;L>=x;--L){let B=A.scaledTo(L);if(h[B.key]||(h[B.key]=!0,k=this.getTile(B),!k&&P&&(k=this._addTile(B)),k&&(a[B.key]=B,P=k.wasRequested(),k.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let n in this._tiles){let a=[],h,f=this._tiles[n].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){h=this._loadedParentTiles[f.key];break}a.push(f.key);let b=f.scaledTo(f.overscaledZ-1);if(h=this._getLoadedTile(b),h)break;f=b}for(let b of a)this._loadedParentTiles[b]=h}}_addTile(n){let a=this._tiles[n.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[n.key]||this._reloadTile(n.key,"reloading"),a;a=this._cache.getAndRemove(n),a&&(this._setTileReloadTimer(n.key,a),a.tileID=n,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,a)));let h=!!a;if(!h){let f=this.map?this.map.painter:null,b=this._source.tileSize*n.overscaleFactor();a=this._source.type==="raster-array"?new Ns(n,b,this.transform.tileZoom,f,this._isRaster):new fo(n,b,this.transform.tileZoom,f,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,n.key,a.state))}return a?(a.uses++,this._tiles[n.key]=a,h||this._source.fire(new r.b("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(n,a){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);let h=a.getExpiryTimeout();h&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},h))}_removeTile(n){let a=this._tiles[n];a&&(a.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,a,h){let f=[],b=this.transform;if(!b)return f;let x=b.projection.name==="globe",T=r.a5(b.center.lng);for(let I in this._tiles){let A=this._tiles[I];if(h&&A.clearQueryDebugViz(),A.holdingForFade())continue;let k;if(x){let P=A.tileID.canonical;if(P.z===0){let L=[Math.abs(r.aa(T,...Sl(P,-1))-T),Math.abs(r.aa(T,...Sl(P,1))-T)];k=[0,2*L.indexOf(Math.min(...L))-1]}else{let L=[Math.abs(r.aa(T,...Sl(P,-1))-T),Math.abs(r.aa(T,...Sl(P,0))-T),Math.abs(r.aa(T,...Sl(P,1))-T)];k=[L.indexOf(Math.min(...L))-1]}}else k=[0];for(let P of k){let L=n.containsTile(A,b,a,P);L&&f.push(L)}}return f}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(n){return this._getRenderableCoordinates(n)}_getRenderableCoordinates(n,a){let h=this.getRenderableIds(n,a).map(b=>this._tiles[b].tileID),f=this.transform.projection.name==="globe";for(let b of h)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=f?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return h}sortCoordinatesByDistance(n){let a=n.slice(),h=this.transform._camera.position,f=this.transform._camera.forward(),b={};for(let x of a){let T=1/(1<<x.canonical.z);b[x.key]=((x.canonical.x+.5)*T+x.wrap-h[0])*f[0]+((x.canonical.y+.5)*T-h[1])*f[1]-h[2]*f[2]}return a.sort((x,T)=>b[x.key]-b[T.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(ka(this._source.type))for(let n in this._tiles){let a=this._tiles[n];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=r.f.now())return!0}return!1}setFeatureState(n,a,h){this._state.updateState(n=n||"_geojsonTileLayer",a,h)}removeFeatureState(n,a,h){this._state.removeFeatureState(n=n||"_geojsonTileLayer",a,h)}getFeatureState(n,a){return this._state.getState(n=n||"_geojsonTileLayer",a)}setDependencies(n,a,h){let f=this._tiles[n];f&&f.setDependencies(a,h)}reloadTilesForDependencies(n,a){for(let h in this._tiles)this._tiles[h].hasDependency(n,a)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(n,a))}_preloadTiles(n,a){if(!this._sourceLoaded){let I=()=>{this._sourceLoaded&&(this._source.off("data",I),this._preloadTiles(n,a))};return void this._source.on("data",I)}let h=new Map,f=Array.isArray(n)?n:[n],b=this.map.painter.terrain,x=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(let I of f){let A=I.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let k of A)h.set(k.key,k);this.usedForTerrain&&I.updateElevation(!1)}let T=Array.from(h.values());r.b1(T,(I,A)=>{let k=new fo(I,this._source.tileSize*I.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(k,P=>{this._source.type==="raster-dem"&&k.dem&&this._backfillDEM(k),A(P,k)})},a)}}function lc(u,n){let a=Math.abs(2*u.wrap)-+(u.wrap<0),h=Math.abs(2*n.wrap)-+(n.wrap<0);return u.overscaledZ-n.overscaledZ||h-a||n.canonical.y-u.canonical.y||n.canonical.x-u.canonical.x}function ka(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function Sl(u,n){let a=1<<u.z;return[u.x/a+n,(u.x+1)/a+n]}_a.maxOverzooming=10,_a.maxUnderzooming=3;class Qu{constructor(n){this.style=n,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let n=!1,a=!1;for(let h in this.style._mergedLayers){let f=this.style._mergedLayers[h];if(f.type==="fill-extrusion")this.layers.push({layer:f,visible:n,visibilityChanged:a});else if(f.type==="model"){let b=this.style.getLayerSource(f);b&&b.type==="batched-model"&&this.layers.push({layer:f,visible:n,visibilityChanged:a})}}}onNewFrame(n){this.layersGotHidden=!1;for(let a of this.layers){let h=a.layer,f=!1;h.type==="fill-extrusion"?f=!h.isHidden(n)&&h.paint.get("fill-extrusion-opacity")>0:h.type==="model"&&(f=!h.isHidden(n)&&h.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!f&&a.visible,a.visible=f}}updateZOffset(n,a){this.currentBuildingBuckets=[];for(let f of this.layers){let b=f.layer,x=this.style.getLayerSourceCache(b),T=1;b.type==="fill-extrusion"&&(T=f.visible?b.paint.get("fill-extrusion-vertical-scale"):0);let I=x?x.getTile(a):null;if(!I&&x&&a.canonical.z>x.getSource().minzoom){let A=a.scaledTo(Math.min(x.getSource().maxzoom,a.overscaledZ-1));for(;A.overscaledZ>=x.getSource().minzoom&&(I=x.getTile(A),!I&&A.overscaledZ!==0);)A=A.scaledTo(A.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:I?I.getBucket(b):null,tileID:I?I.tileID:a,verticalScale:T})}n.hasAnyZOffset=!1;let h=!1;for(let f=0;f<n.symbolInstances.length;f++){let b=n.symbolInstances.get(f),x=b.zOffset,T=this._getHeightAtTileOffset(a,b.tileAnchorX,b.tileAnchorY);b.zOffset=T!==Number.NEGATIVE_INFINITY?T:x,h||x===b.zOffset||(h=!0),n.hasAnyZOffset||b.zOffset===0||(n.hasAnyZOffset=!0)}h&&(n.zOffsetBuffersNeedUpload=!0,n.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(n,a,h,f){let b=a,x=h;if(n.canonical.z!==f.canonical.z){let T=f.canonical,I=1/(1<<n.canonical.z-T.z);b=(a+n.canonical.x*r.V)*I-T.x*r.V|0,x=(h+n.canonical.y*r.V)*I-T.y*r.V|0}return{tileX:b,tileY:x}}_getHeightAtTileOffset(n,a,h){let f,b;for(let x=0;x<this.layers.length;++x){if(this.layers[x].layer.type!=="fill-extrusion")continue;let{bucket:T,tileID:I,verticalScale:A}=this.currentBuildingBuckets[x];if(!T)continue;let{tileX:k,tileY:P}=this._mapCoordToOverlappingTile(n,a,h,I),L=T.getHeightAtTileCoord(k,P);L&&L.height!==void 0&&(L.hidden?f=L.height:b=Math.max(L.height*A,b||0))}if(b!==void 0)return b;for(let x=0;x<this.layers.length;++x){let T=this.layers[x];if(T.layer.type!=="model"||!T.visible)continue;let{bucket:I,tileID:A}=this.currentBuildingBuckets[x];if(!I)continue;let{tileX:k,tileY:P}=this._mapCoordToOverlappingTile(n,a,h,A),L=I.getHeightAtTileCoord(k,P);if(L&&!L.hidden)return L.height===void 0&&f!==void 0?Math.min(L.maxHeight,f)*L.verticalScale:(L.height||0)*L.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Bs(u,n){let a={};for(let h in u)h!=="ref"&&(a[h]=u[h]);return r.b2.forEach(h=>{h in n&&(a[h]=n[h])}),a}function cc(u){u=u.slice();let n=Object.create(null);for(let a=0;a<u.length;a++)n[u[a].id]=u[a];for(let a=0;a<u.length;a++)"ref"in u[a]&&(u[a]=Bs(u[a],n[u[a].ref]));return u}let Di={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Ml(u,n,a){a.push({command:Di.addSource,args:[u,n[u]]})}function ea(u,n,a){n.push({command:Di.removeSource,args:[u]}),a[u]=!0}function Ju(u,n,a,h){ea(u,a,h),Ml(u,n,a)}function eh(u,n,a){let h;for(h in u[a])if(u[a].hasOwnProperty(h)&&h!=="data"&&!M(u[a][h],n[a][h]))return!1;for(h in n[a])if(n[a].hasOwnProperty(h)&&h!=="data"&&!M(u[a][h],n[a][h]))return!1;return!0}function ps(u,n,a,h,f,b){let x;for(x in n=n||{},u=u||{})u.hasOwnProperty(x)&&(M(u[x],n[x])||a.push({command:b,args:[h,x,n[x],f]}));for(x in n)n.hasOwnProperty(x)&&!u.hasOwnProperty(x)&&(M(u[x],n[x])||a.push({command:b,args:[h,x,n[x],f]}))}function Ha(u){return u.id}function Vs(u,n){return u[n.id]=n,u}class js{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=r.aa(n,0,1);let a=1,h=this._distances[a],f=n*this.paddedLength+this.padding;for(;h<f&&a<this._distances.length;)h=this._distances[++a];let b=a-1,x=this._distances[b],T=h-x,I=T>0?(f-x)/T:0;return this.points[b].mult(1-I).add(this.points[a].mult(I))}}class Gc{constructor(n,a,h){let f=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/h),this.yCellCount=Math.ceil(a/h);for(let x=0;x<this.xCellCount*this.yCellCount;x++)f.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,h,f,b){this._forEachCell(a,h,f,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(b)}insertCircle(n,a,h,f){this._forEachCell(a-f,h-f,a+f,h+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(h),this.circles.push(f)}_insertBoxCell(n,a,h,f,b,x){this.boxCells[b].push(x)}_insertCircleCell(n,a,h,f,b,x){this.circleCells[b].push(x)}_query(n,a,h,f,b,x){if(h<0||n>this.width||f<0||a>this.height)return!b&&[];let T=[];if(n<=0&&a<=0&&this.width<=h&&this.height<=f){if(b)return!0;for(let I=0;I<this.boxKeys.length;I++)T.push({key:this.boxKeys[I],x1:this.bboxes[4*I],y1:this.bboxes[4*I+1],x2:this.bboxes[4*I+2],y2:this.bboxes[4*I+3]});for(let I=0;I<this.circleKeys.length;I++){let A=this.circles[3*I],k=this.circles[3*I+1],P=this.circles[3*I+2];T.push({key:this.circleKeys[I],x1:A-P,y1:k-P,x2:A+P,y2:k+P})}return x?T.filter(x):T}return this._forEachCell(n,a,h,f,this._queryCell,T,{hitTest:b,seenUids:{box:{},circle:{}}},x),b?T.length>0:T}_queryCircle(n,a,h,f,b){let x=n-h,T=n+h,I=a-h,A=a+h;if(T<0||x>this.width||A<0||I>this.height)return!f&&[];let k=[];return this._forEachCell(x,I,T,A,this._queryCellCircle,k,{hitTest:f,circle:{x:n,y:a,radius:h},seenUids:{box:{},circle:{}}},b),f?k.length>0:k}query(n,a,h,f,b){return this._query(n,a,h,f,!1,b)}hitTest(n,a,h,f,b){return this._query(n,a,h,f,!0,b)}hitTestCircle(n,a,h,f){return this._queryCircle(n,a,h,!0,f)}_queryCell(n,a,h,f,b,x,T,I){let A=T.seenUids,k=this.boxCells[b];if(k!==null){let L=this.bboxes;for(let B of k)if(!A.box[B]){A.box[B]=!0;let H=4*B;if(n<=L[H+2]&&a<=L[H+3]&&h>=L[H+0]&&f>=L[H+1]&&(!I||I(this.boxKeys[B]))){if(T.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[B],x1:L[H],y1:L[H+1],x2:L[H+2],y2:L[H+3]})}}}let P=this.circleCells[b];if(P!==null){let L=this.circles;for(let B of P)if(!A.circle[B]){A.circle[B]=!0;let H=3*B;if(this._circleAndRectCollide(L[H],L[H+1],L[H+2],n,a,h,f)&&(!I||I(this.circleKeys[B]))){if(T.hitTest)return x.push(!0),!0;{let G=L[H],$=L[H+1],j=L[H+2];x.push({key:this.circleKeys[B],x1:G-j,y1:$-j,x2:G+j,y2:$+j})}}}}}_queryCellCircle(n,a,h,f,b,x,T,I){let A=T.circle,k=T.seenUids,P=this.boxCells[b];if(P!==null){let B=this.bboxes;for(let H of P)if(!k.box[H]){k.box[H]=!0;let G=4*H;if(this._circleAndRectCollide(A.x,A.y,A.radius,B[G+0],B[G+1],B[G+2],B[G+3])&&(!I||I(this.boxKeys[H])))return x.push(!0),!0}}let L=this.circleCells[b];if(L!==null){let B=this.circles;for(let H of L)if(!k.circle[H]){k.circle[H]=!0;let G=3*H;if(this._circlesCollide(B[G],B[G+1],B[G+2],A.x,A.y,A.radius)&&(!I||I(this.circleKeys[H])))return x.push(!0),!0}}}_forEachCell(n,a,h,f,b,x,T,I){let A=this._convertToXCellCoord(n),k=this._convertToYCellCoord(a),P=this._convertToXCellCoord(h),L=this._convertToYCellCoord(f);for(let B=A;B<=P;B++)for(let H=k;H<=L;H++)if(b.call(this,n,a,h,f,this.xCellCount*H+B,x,T,I))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,h,f,b,x){let T=f-n,I=b-a,A=h+x;return A*A>T*T+I*I}_circleAndRectCollide(n,a,h,f,b,x,T){let I=(x-f)/2,A=Math.abs(n-(f+I));if(A>I+h)return!1;let k=(T-b)/2,P=Math.abs(a-(b+k));if(P>k+h)return!1;if(A<=I||P<=k)return!0;let L=A-I,B=P-k;return L*L+B*B<=h*h}}let $a={unknown:0,flipRequired:1,flipNotRequired:2},Do=Math.tan(85*Math.PI/180);function Al(u,n,a,h,f,b,x){let T=r.a6.create();if(a)if(b.name==="globe"){let I=r.b3(f,n);r.a6.multiply(T,T,I)}else{let I=r.b4.invert([],x);T[0]=I[0],T[1]=I[1],T[4]=I[2],T[5]=I[3],h||r.a6.rotateZ(T,T,f.angle)}else r.a6.multiply(T,f.labelPlaneMatrix,u);return T}function Pd(u,n,a,h,f,b,x){let T=Al(u,n,a,h,f,b,x);return b.name==="globe"&&a||(T[2]=T[6]=T[10]=T[14]=0),T}function Od(u,n,a,h,f,b,x){if(a){if(b.name==="globe"){let T=Al(u,n,a,h,f,b,x);return r.a6.invert(T,T),r.a6.multiply(T,u,T),T}{let T=r.a6.clone(u),I=r.a6.identity([]);return I[0]=x[0],I[1]=x[1],I[4]=x[2],I[5]=x[3],r.a6.multiply(T,T,I),h||r.a6.rotateZ(T,T,-f.angle),T}}return f.glCoordMatrix}function ko(u,n,a,h){let f=[u,n,a,1];a?r.a7.transformMat4(f,f,h):$c(f,f,h);let b=f[3];return f[0]/=b,f[1]/=b,f[2]/=b,f}function Dl(u,n){return Math.min(.5+u/n*.5,1.5)}function dc(u,n){let a=u[0]/u[3],h=u[1]/u[3];return a>=-n[0]&&a<=n[0]&&h>=-n[1]&&h<=n[1]}function uc(u,n,a,h,f,b,x,T,I,A){let k=a.transform,P=h?u.textSizeData:u.iconSizeData,L=r.b5(P,a.transform.zoom),B=k.projection.name==="globe",H=[256/a.width*2+1,256/a.height*2+1],G=h?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;G.clear();let $=null;B&&($=h?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);let j=u.lineVertexArray,W=h?u.text.placedSymbolArray:u.icon.placedSymbolArray,ee=a.transform.width/a.transform.height,X,te=!1;for(let q=0;q<W.length;q++){let ne=W.get(q),{numGlyphs:le,writingMode:ce}=ne;if(ce!==r.b6.vertical||te||X===r.b6.horizontal||(te=!0),X=ce,(ne.hidden||ce===r.b6.vertical)&&!te){ms(le,G);continue}te=!1;let me=new r.P(ne.tileAnchorX,ne.tileAnchorY),{x:Ie,y:be,z:Fe}=k.projection.projectTilePoint(me.x,me.y,A.canonical);if(I){let[_t,Rt,Wt]=I(me);Ie+=_t,be+=Rt,Fe+=Wt}let Re=[Ie,be,Fe,1];if(r.a7.transformMat4(Re,Re,n),!dc(Re,H)){ms(le,G);continue}let Ye=Re[3],ve=Dl(a.transform.getCameraToCenterDistance(k.projection),Ye),Ae=r.b7(P,L,ne),he=x?Ae/ve:Ae*ve,Ce=ko(Ie,be,Fe,f);if(Ce[3]<=0){ms(le,G);continue}let Xe={},at=x?null:I,nt=Fd(ne,he,!1,T,n,f,b,u.glyphOffsetArray,j,G,$,Ce,me,Xe,ee,at,k.projection,A,x);te=nt.useVertical,at&&nt.needsFlipping&&(Xe={}),(nt.notEnoughRoom||te||nt.needsFlipping&&Fd(ne,he,!0,T,n,f,b,u.glyphOffsetArray,j,G,$,Ce,me,Xe,ee,at,k.projection,A,x).notEnoughRoom)&&ms(le,G)}h?(u.text.dynamicLayoutVertexBuffer.updateData(G),$&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData($)):(u.icon.dynamicLayoutVertexBuffer.updateData(G),$&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData($))}function hc(u,n,a,h,f,b,x,T,I,A,k,P,L,B,H,G){let{lineStartIndex:$,glyphStartIndex:j,segment:W}=T,ee=j+T.numGlyphs,X=$+T.lineLength,te=n.getoffsetX(j),q=n.getoffsetX(ee-1),ne=pc(u*te,a,h,f,b,x,W,$,X,I,A,k,P,L,!0,B,H,G);if(!ne)return null;let le=pc(u*q,a,h,f,b,x,W,$,X,I,A,k,P,L,!0,B,H,G);return le?{first:ne,last:le}:null}function Us(u,n,a,h){return u===r.b6.horizontal&&Math.abs(h)>Math.abs(a)?{useVertical:!0}:u===r.b6.vertical?h>0?{needsFlipping:!0}:null:n!==$a.unknown&&function(f,b){return f===0||Math.abs(b/f)>Do}(a,h)?n===$a.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Fd(u,n,a,h,f,b,x,T,I,A,k,P,L,B,H,G,$,j,W){let ee=n/24,X=u.lineOffsetX*ee,te=u.lineOffsetY*ee,{lineStartIndex:q,glyphStartIndex:ne,numGlyphs:le,segment:ce,writingMode:me,flipState:Ie}=u,be=q+u.lineLength,Fe=Re=>{if(k){let[he,Ce,Xe]=Re.up,at=A.length;r.b8(k,at+0,he,Ce,Xe),r.b8(k,at+1,he,Ce,Xe),r.b8(k,at+2,he,Ce,Xe),r.b8(k,at+3,he,Ce,Xe)}let[Ye,ve,Ae]=Re.point;r.b9(A,Ye,ve,Ae,Re.angle)};if(le>1){let Re=hc(ee,T,X,te,a,P,L,u,I,b,B,G,!1,$,j,W);if(!Re)return{notEnoughRoom:!0};if(h&&!a){let[Ye,ve,Ae]=Re.first.point,[he,Ce,Xe]=Re.last.point;[Ye,ve]=ko(Ye,ve,Ae,x),[he,Ce]=ko(he,Ce,Xe,x);let at=Us(me,Ie,(he-Ye)*H,Ce-ve);if(u.flipState=at&&at.needsFlipping?$a.flipRequired:$a.flipNotRequired,at)return at}Fe(Re.first);for(let Ye=ne+1;Ye<ne+le-1;Ye++){let ve=pc(ee*T.getoffsetX(Ye),X,te,a,P,L,ce,q,be,I,b,B,G,!1,!1,$,j,W);if(!ve)return A.length-=4*(Ye-ne),{notEnoughRoom:!0};Fe(ve)}Fe(Re.last)}else{if(h&&!a){let Ye=ko(L.x,L.y,0,f),ve=q+ce+1,Ae=new r.P(I.getx(ve),I.gety(ve)),he=ko(Ae.x,Ae.y,0,f),Ce=he[3]>0?he:Hc(L,Ae,Ye,1,f,void 0,$,j.canonical),Xe=Us(me,Ie,(Ce[0]-Ye[0])*H,Ce[1]-Ye[1]);if(u.flipState=Xe&&Xe.needsFlipping?$a.flipRequired:$a.flipNotRequired,Xe)return Xe}let Re=pc(ee*T.getoffsetX(ne),X,te,a,P,L,ce,q,be,I,b,B,G,!1,!1,$,j,W);if(!Re)return{notEnoughRoom:!0};Fe(Re)}return{}}function kl(u,n,a,h,f){let{x:b,y:x,z:T}=h.projectTilePoint(u.x,u.y,n);if(!f)return ko(b,x,T,a);let[I,A,k]=f(u);return ko(b+I,x+A,T+k,a)}function Hc(u,n,a,h,f,b,x,T){let I=kl(u.sub(n)._unit()._add(u),T,f,x,b);return r.N.sub(I,a,I),r.N.normalize(I,I),r.N.scaleAndAdd(I,a,I,h)}function pc(u,n,a,h,f,b,x,T,I,A,k,P,L,B,H,G,$,j){let W=h?u-n:u+n,ee=W>0?1:-1,X=0;h&&(ee*=-1,X=Math.PI),ee<0&&(X+=Math.PI);let te=T+x+(ee>0?0:1)|0,q=f,ne=f,le=0,ce=0,me=Math.abs(W),Ie=[],be=[],Fe=b,Re=Fe,Ye=()=>Hc(Re,Fe,ne,me-le+1,k,L,G,$.canonical);for(;le+ce<=me;){if(te+=ee,te<T||te>=I)return null;if(ne=q,Re=Fe,Ie.push(ne),B&&be.push(Re),Fe=new r.P(A.getx(te),A.gety(te)),q=P[te],!q){let Rt=kl(Fe,$.canonical,k,G,L);q=Rt[3]>0?P[te]=Rt:Ye()}le+=ce,ce=r.N.distance(ne,q)}H&&L&&(P[te]&&(q=Ye(),ce=r.N.distance(ne,q)),P[te]=q);let ve=(me-le)/ce,Ae=Fe.sub(Re)._mult(ve)._add(Re),he=r.N.sub([],q,ne),Ce=r.N.scaleAndAdd([],ne,he,ve),Xe=[0,0,1],at=he[0],nt=he[1];if(j&&(Xe=G.upVector($.canonical,Ae.x,Ae.y),Xe[0]!==0||Xe[1]!==0||Xe[2]!==1)){let Rt=[Xe[2],0,-Xe[0]],Wt=r.N.cross([],Xe,Rt);r.N.normalize(Rt,Rt),r.N.normalize(Wt,Wt),at=r.N.dot(he,Rt),nt=r.N.dot(he,Wt)}if(a){let Rt=r.N.cross([],Xe,he);r.N.normalize(Rt,Rt),r.N.scaleAndAdd(Ce,Ce,Rt,a*ee)}let _t=X+Math.atan2(nt,at);return Ie.push(Ce),B&&be.push(Ae),{point:Ce,angle:_t,path:Ie,tilePath:be,up:Xe}}function ms(u,n){let a=n.length,h=a+4*u;n.resize(h),n.float32.fill(-1/0,4*a,4*h)}function $c(u,n,a){let h=n[0],f=n[1];return u[0]=a[0]*h+a[4]*f+a[12],u[1]=a[1]*h+a[5]*f+a[13],u[3]=a[3]*h+a[7]*f+a[15],u}let Ro=100;class mt{constructor(n,a,h=new Gc(n.width+200,n.height+200,25),f=new Gc(n.width+200,n.height+200,25)){this.transform=n,this.grid=h,this.ignoredGrid=f,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Ro,this.screenBottomBoundary=n.height+Ro,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,h,f,b,x,T,I){let A=h.projectedAnchorX,k=h.projectedAnchorY,P=h.projectedAnchorZ,L=h.elevation,B=h.tileID,H=n.getProjection();if(L&&B){let[q,ne,le]=H.upVector(B.canonical,h.tileAnchorX,h.tileAnchorY),ce=H.upVectorScale(B.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;A+=q*L*ce,k+=ne*L*ce,P+=le*L*ce}let G=this.projectAndGetPerspectiveRatio(T,A,k,P,h.tileID,H.name==="globe"||!!L||this.transform.pitch>0,H),$=x*G.perspectiveRatio,j=(h.x1*a+f.x-h.padding)*$+G.point.x,W=(h.y1*a+f.y-h.padding)*$+G.point.y,ee=(h.x2*a+f.x+h.padding)*$+G.point.x,X=(h.y2*a+f.y+h.padding)*$+G.point.y,te=G.perspectiveRatio<=.55||G.occluded;return!this.isInsideGrid(j,W,ee,X)||!b&&this.grid.hitTest(j,W,ee,X,I)||te?{box:[],offscreen:!1,occluded:G.occluded}:{box:[j,W,ee,X],offscreen:this.isOffscreen(j,W,ee,X),occluded:!1}}placeCollisionCircles(n,a,h,f,b,x,T,I,A,k,P,L,B,H,G){let $=[],j=this.transform.elevation,W=n.getProjection(),ee=j?j.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,W):null,X=new r.P(h.tileAnchorX,h.tileAnchorY),{x:te,y:q,z:ne}=W.projectTilePoint(X.x,X.y,G.canonical);if(ee){let[Ae,he,Ce]=ee(X);te+=Ae,q+=he,ne+=Ce}let le=W.name==="globe",ce=this.projectAndGetPerspectiveRatio(T,te,q,ne,G,le||!!j||this.transform.pitch>0,W),{perspectiveRatio:me}=ce,Ie=(P?x/me:x*me)/r.bc,be=ko(te,q,ne,I),Fe=ce.signedDistanceFromCamera>0?hc(Ie,b,h.lineOffsetX*Ie,h.lineOffsetY*Ie,!1,be,X,h,f,I,{},j&&!P?ee:null,P&&!!j,W,G,P):null,Re=!1,Ye=!1,ve=!0;if(Fe&&!ce.occluded){let Ae=.5*B*me+H,he=new r.P(-100,-100),Ce=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Xe=new js,{first:at,last:nt}=Fe,_t=at.path.length,Rt=[];for(let Ut=_t-1;Ut>=1;Ut--)Rt.push(at.path[Ut]);for(let Ut=1;Ut<nt.path.length;Ut++)Rt.push(nt.path[Ut]);let Wt=2.5*Ae;A&&(Rt=Rt.map(([Ut,_i,ri],ci)=>(ee&&!le&&(ri=ee(ci<_t-1?at.tilePath[_t-1-ci]:nt.tilePath[ci-_t+2])[2]),ko(Ut,_i,ri,A))),Rt.some(Ut=>Ut[3]<=0)&&(Rt=[]));let Nt=[];if(Rt.length>0){let Ut=1/0,_i=-1/0,ri=1/0,ci=-1/0;for(let li of Rt)Ut=Math.min(Ut,li[0]),ri=Math.min(ri,li[1]),_i=Math.max(_i,li[0]),ci=Math.max(ci,li[1]);_i>=he.x&&Ut<=Ce.x&&ci>=he.y&&ri<=Ce.y&&(Nt=[Rt.map(li=>new r.P(li[0],li[1]))],(Ut<he.x||_i>Ce.x||ri<he.y||ci>Ce.y)&&(Nt=r.ba(Nt,he.x,he.y,Ce.x,Ce.y)))}for(let Ut of Nt){Xe.reset(Ut,.25*Ae);let _i=0;_i=Xe.length<=.5*Ae?1:Math.ceil(Xe.paddedLength/Wt)+1;for(let ri=0;ri<_i;ri++){let ci=ri/Math.max(_i-1,1),li=Xe.lerp(ci),Ui=li.x+Ro,On=li.y+Ro;$.push(Ui,On,Ae,0);let ki=Ui-Ae,or=On-Ae,Ri=Ui+Ae,Yi=On+Ae;if(ve=ve&&this.isOffscreen(ki,or,Ri,Yi),Ye=Ye||this.isInsideGrid(ki,or,Ri,Yi),!a&&this.grid.hitTestCircle(Ui,On,Ae,L)&&(Re=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Re,occluded:!1}}}}return{circles:!k&&Re||!Ye?[]:$,offscreen:ve,collisionDetected:Re,occluded:ce.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let a=[],h=1/0,f=1/0,b=-1/0,x=-1/0;for(let k of n){let P=new r.P(k.x+Ro,k.y+Ro);h=Math.min(h,P.x),f=Math.min(f,P.y),b=Math.max(b,P.x),x=Math.max(x,P.y),a.push(P)}let T=this.grid.query(h,f,b,x).concat(this.ignoredGrid.query(h,f,b,x)),I={},A={};for(let k of T){let P=k.key;if(I[P.bucketInstanceId]===void 0&&(I[P.bucketInstanceId]={}),I[P.bucketInstanceId][P.featureIndex])continue;let L=[new r.P(k.x1,k.y1),new r.P(k.x2,k.y1),new r.P(k.x2,k.y2),new r.P(k.x1,k.y2)];r.bb(a,L)&&(I[P.bucketInstanceId][P.featureIndex]=!0,A[P.bucketInstanceId]===void 0&&(A[P.bucketInstanceId]=[]),A[P.bucketInstanceId].push(P.featureIndex))}return A}insertCollisionBox(n,a,h,f,b){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:f,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,h,f,b){let x=a?this.ignoredGrid:this.grid,T={bucketInstanceId:h,featureIndex:f,collisionGroupID:b};for(let I=0;I<n.length;I+=4)x.insertCircle(T,n[I],n[I+1],n[I+2])}projectAndGetPerspectiveRatio(n,a,h,f,b,x,T){let I=[a,h,f,1],A=!1;f||this.transform.pitch>0?(r.a7.transformMat4(I,I,n),this.fogState&&b&&T.name!=="globe"&&(A=function(L,B,H,G,$,j){let W=j.calculateFogTileMatrix($),ee=[B,H,G];return r.N.transformMat4(ee,ee,W),Ii(L,r.N.length(ee),j.pitch,j._fov)}(this.fogState,a,h,f,b.toUnwrapped(),this.transform)>.9)):$c(I,I,n);let k=I[3];return{point:new r.P((I[0]/k+1)/2*this.transform.width+Ro,(-I[1]/k+1)/2*this.transform.height+Ro),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(T)/k*.5,1.5),signedDistanceFromCamera:k,occluded:x&&I[2]>k||A}}isOffscreen(n,a,h,f){return h<Ro||n>=this.screenRightBoundary||f<Ro||a>this.screenBottomBoundary}isInsideGrid(n,a,h,f){return h>=0&&n<this.gridRightBoundary&&f>=0&&a<this.gridBottomBoundary}getViewportMatrix(){let n=r.a6.identity([]);return r.a6.translate(n,n,[-100,-100,0]),n}}function ta(u,n,a){let h=n.createTileMatrix(u,u.worldSize,a.toUnwrapped());return r.a6.multiply(new Float32Array(16),u.projMatrix,h)}function qa(u,n,a){if(n.projection.name===a.projection.name)return u.projMatrix;let h=a.clone();return h.setProjection(n.projection),ta(h,n.getProjection(),u)}function fs(u,n,a){return n.name===a.projection.name?u.projMatrix:ta(a,n,u)}class Ra{constructor(n,a,h,f){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):f&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class gs{constructor(n,a,h,f,b,x=!1){this.text=new Ra(n?n.text:null,a,h,b),this.icon=new Ra(n?n.icon:null,a,f,b),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Po{constructor(n,a,h,f=!1){this.text=n,this.icon=a,this.skipFade=h,this.clipped=f}}class Gs{constructor(){this.invProjMatrix=r.a6.create(),this.viewportMatrix=r.a6.create(),this.circles=[]}}class _s{constructor(n,a,h,f,b){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=h,this.bucketIndex=f,this.tileID=b}}class mc{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){let a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:h=>h.collisionGroupID===a}}return this.collisionGroups[n]}}function Hs(u,n,a,h,f){let{horizontalAlign:b,verticalAlign:x}=r.bf(u),T=-(b-.5)*n,I=-(x-.5)*a,A=r.bd(u,h);return new r.P(T+A[0]*f,I+A[1]*f)}function Ld(u,n,a,h,f){let b=new r.P(u,n);return a&&b._rotate(h?f:-f),b}class th{constructor(n,a,h,f,b,x){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new mt(this.transform,b),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new mc(h),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,h,f){let b=h.getBucket(a),x=h.latestFeatureIndex;if(!b||!x||a.fqid!==b.layerIds[0])return;let T=b.layers[0].layout,I=h.collisionBoxArray,A=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),k=h.tileSize/r.V,P=h.tileID.toUnwrapped();this.transform.setProjection(b.projection);let L=(B=h.tileID,H=b.getProjection(),G=this.transform,H.name===this.projection?G.calculateProjMatrix(B.toUnwrapped()):ta(G,H,B));var B,H,G;let $=T.get("text-pitch-alignment")==="map",j=T.get("text-rotation-alignment")==="map";a.compileFilter();let W=a.dynamicFilter(),ee=a.dynamicFilterNeedsFeature(),X=this.transform.calculatePixelsToTileUnitsMatrix(h),te=Pd(L,h.tileID.canonical,$,j,this.transform,b.getProjection(),X),q=null;if($){let ce=Od(L,h.tileID.canonical,$,j,this.transform,b.getProjection(),X);q=r.a6.multiply([],this.transform.labelPlaneMatrix,ce)}let ne=null;W&&h.latestFeatureIndex&&(ne={unwrappedTileID:P,dynamicFilter:W,dynamicFilterNeedsFeature:ee,featureIndex:h.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new _s(b.bucketInstanceId,x,b.sourceLayerIndex,b.index,h.tileID);let le={bucket:b,layout:T,posMatrix:L,textLabelPlaneMatrix:te,labelToScreenMatrix:q,clippingData:ne,scale:A,textPixelRatio:k,holdingForFade:h.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:r.b5(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.b5(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(f)for(let ce of b.sortKeyRanges){let{sortKey:me,symbolInstanceStart:Ie,symbolInstanceEnd:be}=ce;n.push({sortKey:me,symbolInstanceStart:Ie,symbolInstanceEnd:be,parameters:le})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:le})}attemptAnchorPlacement(n,a,h,f,b,x,T,I,A,k,P,L,B,H,G,$,j,W){let{textOffset0:ee,textOffset1:X,crossTileID:te}=L,q=[ee,X],ne=Hs(n,h,f,q,b),le=this.collisionIndex.placeCollisionBox(H,b,a,Ld(ne.x,ne.y,x,T,this.transform.angle),P,I,A,k.predicate);if($){let ce=H.getSymbolInstanceIconSize(W,this.transform.zoom,L.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(H,ce,$,Ld(ne.x,ne.y,x,T,this.transform.angle),P,I,A,k.predicate).box.length===0)return}if(le.box.length>0){let ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[te]&&this.prevPlacement.placements[te]&&this.prevPlacement.placements[te].text&&(ce=this.prevPlacement.variableOffsets[te].anchor),this.variableOffsets[te]={textOffset:q,width:h,height:f,anchor:n,textScale:b,prevAnchor:ce},this.markUsedJustification(H,n,L,G),H.allowVerticalPlacement&&(this.markUsedOrientation(H,G,L),this.placedOrientations[te]=G),{shift:ne,placedGlyphBoxes:le}}}placeLayerBucketPart(n,a,h,f){let{bucket:b,layout:x,posMatrix:T,textLabelPlaneMatrix:I,labelToScreenMatrix:A,clippingData:k,textPixelRatio:P,holdingForFade:L,collisionBoxArray:B,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:G,collisionGroup:$}=n.parameters,j=x.get("text-optional"),W=x.get("icon-optional"),ee=x.get("text-allow-overlap"),X=x.get("icon-allow-overlap"),te=x.get("text-rotation-alignment")==="map",q=x.get("text-pitch-alignment")==="map",ne=x.get("symbol-z-order")==="viewport-y",le=x.get("symbol-z-elevate");this.transform.setProjection(b.projection);let ce=ee&&(X||!b.hasIconData()||W),me=X&&(ee||!b.hasTextData()||j);!b.collisionArrays&&B&&b.deserializeCollisionBoxes(B),h&&f&&b.updateCollisionDebugBuffers(this.transform.zoom,B);let Ie=(be,Fe,Re)=>{let{crossTileID:Ye,numVerticalGlyphVertices:ve}=be;if(k){let Ri={zoom:this.transform.zoom,pitch:this.transform.pitch},Yi=null;if(k.dynamicFilterNeedsFeature){let Pi=this.retainedQueryData[b.bucketInstanceId];Yi=k.featureIndex.loadFeature({featureIndex:be.featureIndex,bucketIndex:Pi.bucketIndex,sourceLayerIndex:Pi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,k.dynamicFilter)(Ri,Yi,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new r.P(be.tileAnchorX,be.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[Ye]=new Po(!1,!1,!1,!0),void a.add(Ye)}if(a.has(Ye))return;if(L)return void(this.placements[Ye]=new Po(!1,!1,!1));let Ae=!1,he=!1,Ce=!0,Xe=!1,at=!1,nt=null,_t={box:null,offscreen:null,occluded:null},Rt={box:null,offscreen:null,occluded:null},Wt=null,Nt=null,Ut=null,_i=0,ri=0,ci=0;Re.textFeatureIndex?_i=Re.textFeatureIndex:be.useRuntimeCollisionCircles&&(_i=be.featureIndex),Re.verticalTextFeatureIndex&&(ri=Re.verticalTextFeatureIndex);let li=Ri=>{Ri.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;let Yi=this.transform.elevation;Ri.elevation=be.zOffset+(Yi?Yi.getAtTileOffset(Ri.tileID,Ri.tileAnchorX,Ri.tileAnchorY):0)},Ui=Re.textBox;if(Ui){li(Ui);let Ri=Pi=>{let Wi=r.b6.horizontal;if(b.allowVerticalPlacement&&!Pi&&this.prevPlacement){let jn=this.prevPlacement.placedOrientations[Ye];jn&&(this.placedOrientations[Ye]=jn,Wi=jn,this.markUsedOrientation(b,Wi,be))}return Wi},Yi=(Pi,Wi)=>{if(b.allowVerticalPlacement&&ve>0&&Re.verticalTextBox){for(let jn of b.writingModes)if(jn===r.b6.vertical?(_t=Wi(),Rt=_t):_t=Pi(),_t&&_t.box&&_t.box.length)break}else _t=Pi()};if(x.get("text-variable-anchor")){let Pi=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ye]){let sn=this.prevPlacement.variableOffsets[Ye];Pi.indexOf(sn.anchor)>0&&(Pi=Pi.filter(Qr=>Qr!==sn.anchor),Pi.unshift(sn.anchor))}let Wi=(sn,Qr,bo)=>{let sa=b.getSymbolInstanceTextSize(H,be,this.transform.zoom,Fe),vs=(sn.x2-sn.x1)*sa+2*sn.padding,la=(sn.y2-sn.y1)*sa+2*sn.padding,Jr=be.hasIconTextFit&&!X?Qr:null;Jr&&li(Jr);let Vr={box:[],offscreen:!1,occluded:!1},Fo=ee?2*Pi.length:Pi.length;for(let Uo=0;Uo<Fo;++Uo){let ca=this.attemptAnchorPlacement(Pi[Uo%Pi.length],sn,vs,la,sa,te,q,P,T,$,Uo>=Pi.length,be,Fe,b,bo,Jr,H,G);if(ca&&(Vr=ca.placedGlyphBoxes,Vr&&Vr.box&&Vr.box.length)){Ae=!0,nt=ca.shift;break}}return Vr};Yi(()=>Wi(Ui,Re.iconBox,r.b6.horizontal),()=>{let sn=Re.verticalTextBox;return sn&&li(sn),b.allowVerticalPlacement&&!(_t&&_t.box&&_t.box.length)&&ve>0&&sn?Wi(sn,Re.verticalIconBox,r.b6.vertical):{box:null,offscreen:null,occluded:null}}),_t&&(Ae=_t.box,Ce=_t.offscreen,Xe=_t.occluded);let jn=Ri(!(!_t||!_t.box));if(!Ae&&this.prevPlacement){let sn=this.prevPlacement.variableOffsets[Ye];sn&&(this.variableOffsets[Ye]=sn,this.markUsedJustification(b,sn.anchor,be,jn))}}else{let Pi=(Wi,jn)=>{let sn=b.getSymbolInstanceTextSize(H,be,this.transform.zoom,Fe),Qr=this.collisionIndex.placeCollisionBox(b,sn,Wi,new r.P(0,0),ee,P,T,$.predicate);return Qr&&Qr.box&&Qr.box.length&&(this.markUsedOrientation(b,jn,be),this.placedOrientations[Ye]=jn),Qr};Yi(()=>Pi(Ui,r.b6.horizontal),()=>{let Wi=Re.verticalTextBox;return b.allowVerticalPlacement&&ve>0&&Wi?(li(Wi),Pi(Wi,r.b6.vertical)):{box:null,offscreen:null,occluded:null}}),Ri(!!(_t&&_t.box&&_t.box.length))}}if(Wt=_t,Ae=Wt&&Wt.box&&Wt.box.length>0,Ce=Wt&&Wt.offscreen,Xe=Wt&&Wt.occluded,be.useRuntimeCollisionCircles){let Ri=b.text.placedSymbolArray.get(be.centerJustifiedTextSymbolIndex>=0?be.centerJustifiedTextSymbolIndex:be.verticalPlacedTextSymbolIndex),Yi=r.b7(b.textSizeData,H,Ri),Pi=x.get("text-padding");Nt=this.collisionIndex.placeCollisionCircles(b,ee,Ri,b.lineVertexArray,b.glyphOffsetArray,Yi,T,I,A,h,q,$.predicate,be.collisionCircleDiameter*Yi/r.bc,Pi,this.retainedQueryData[b.bucketInstanceId].tileID),Ae=ee||Nt.circles.length>0&&!Nt.collisionDetected,Ce=Ce&&Nt.offscreen,Xe=Nt.occluded}if(Re.iconFeatureIndex&&(ci=Re.iconFeatureIndex),Re.iconBox){let Ri=Yi=>{li(Yi);let Pi=be.hasIconTextFit&&nt?Ld(nt.x,nt.y,te,q,this.transform.angle):new r.P(0,0),Wi=b.getSymbolInstanceIconSize(G,this.transform.zoom,be.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,Wi,Yi,Pi,X,P,T,$.predicate)};Rt&&Rt.box&&Rt.box.length&&Re.verticalIconBox?(Ut=Ri(Re.verticalIconBox),he=Ut.box.length>0):(Ut=Ri(Re.iconBox),he=Ut.box.length>0),Ce=Ce&&Ut.offscreen,at=Ut.occluded}let On=j||be.numHorizontalGlyphVertices===0&&ve===0,ki=W||be.numIconVertices===0;if(On||ki?ki?On||(he=he&&Ae):Ae=he&&Ae:he=Ae=he&&Ae,Ae&&Wt&&Wt.box&&this.collisionIndex.insertCollisionBox(Wt.box,x.get("text-ignore-placement"),b.bucketInstanceId,Rt&&Rt.box&&ri?ri:_i,$.ID),he&&Ut&&this.collisionIndex.insertCollisionBox(Ut.box,x.get("icon-ignore-placement"),b.bucketInstanceId,ci,$.ID),Nt&&(Ae&&this.collisionIndex.insertCollisionCircles(Nt.circles,x.get("text-ignore-placement"),b.bucketInstanceId,_i,$.ID),h)){let Ri=b.bucketInstanceId,Yi=this.collisionCircleArrays[Ri];Yi===void 0&&(Yi=this.collisionCircleArrays[Ri]=new Gs);for(let Pi=0;Pi<Nt.circles.length;Pi+=4)Yi.circles.push(Nt.circles[Pi+0]),Yi.circles.push(Nt.circles[Pi+1]),Yi.circles.push(Nt.circles[Pi+2]),Yi.circles.push(Nt.collisionDetected?1:0)}let or=b.projection.name!=="globe";ce=ce&&(or||!Xe),me=me&&(or||!at),this.placements[Ye]=new Po(Ae||ce,he||me,Ce||b.justReloaded),a.add(Ye)};if(le&&this.buildingIndex&&(this.buildingIndex.updateZOffset(b,this.retainedQueryData[b.bucketInstanceId].tileID),b.updateZOffset()),ne){let be=b.getSortedSymbolIndexes(this.transform.angle);for(let Fe=be.length-1;Fe>=0;--Fe){let Re=be[Fe];Ie(b.symbolInstances.get(Re),Re,b.collisionArrays[Re])}b.hasAnyZOffset&&r.w(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){let be=b.getSortedIndexesByZOffset();for(let Fe=0;Fe<be.length;++Fe){let Re=be[Fe];Ie(b.symbolInstances.get(Re),Re,b.collisionArrays[Re])}}else for(let be=n.symbolInstanceStart;be<n.symbolInstanceEnd;be++)Ie(b.symbolInstances.get(be),be,b.collisionArrays[be]);if(h&&b.bucketInstanceId in this.collisionCircleArrays){let be=this.collisionCircleArrays[b.bucketInstanceId];r.a6.invert(be.invProjMatrix,T),be.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(n,a,h,f){let{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:I,crossTileID:A}=h,k=r.be(a),P=f===r.b6.vertical?I:k==="left"?b:k==="center"?x:k==="right"?T:-1;b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=P>=0&&b!==P?0:A),x>=0&&(n.text.placedSymbolArray.get(x).crossTileID=P>=0&&x!==P?0:A),T>=0&&(n.text.placedSymbolArray.get(T).crossTileID=P>=0&&T!==P?0:A),I>=0&&(n.text.placedSymbolArray.get(I).crossTileID=P>=0&&I!==P?0:A)}markUsedOrientation(n,a,h){let f=a===r.b6.horizontal||a===r.b6.horizontalOnly?a:0,b=a===r.b6.vertical?a:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:A}=h,k=n.text.placedSymbolArray;x>=0&&(k.get(x).placedOrientation=f),T>=0&&(k.get(T).placedOrientation=f),I>=0&&(k.get(I).placedOrientation=f),A>=0&&(k.get(A).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;let a=this.prevPlacement,h=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;let f=a?a.symbolFadeChange(n):1,b=a?a.opacities:{},x=a?a.variableOffsets:{},T=a?a.placedOrientations:{};for(let I in this.placements){let A=this.placements[I],k=b[I];k?(this.opacities[I]=new gs(k,f,A.text,A.icon,null,A.clipped),h=h||A.text!==k.text.placed||A.icon!==k.icon.placed):(this.opacities[I]=new gs(null,f,A.text,A.icon,A.skipFade,A.clipped),h=h||A.text||A.icon)}for(let I in b){let A=b[I];if(!this.opacities[I]){let k=new gs(A,f,!1,!1);k.isHidden()||(this.opacities[I]=k,h=h||A.text.placed||A.icon.placed)}}for(let I in x)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=x[I]);for(let I in T)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=T[I]);h?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a){let h=new Set;for(let f of a){let b=f.getBucket(n);b&&f.latestFeatureIndex&&n.fqid===b.layerIds[0]&&(this.updateBucketOpacities(b,h,f.collisionBoxArray),b.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(b,f.tileID),b.updateZOffset()))}}updateBucketOpacities(n,a,h){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();let f=n.layers[0].layout,b=!!n.layers[0].dynamicFilter(),x=new gs(null,0,!1,!1,!0),T=f.get("text-allow-overlap"),I=f.get("icon-allow-overlap"),A=f.get("text-variable-anchor"),k=f.get("text-rotation-alignment")==="map",P=f.get("text-pitch-alignment")==="map",L=new gs(null,0,T&&(I||!n.hasIconData()||f.get("icon-optional")),I&&(T||!n.hasTextData()||f.get("text-optional")),!0);!n.collisionArrays&&h&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(h);let B=(G,$,j)=>{for(let W=0;W<$/4;W++)G.opacityVertexArray.emplaceBack(j)},H=0;for(let G=0;G<n.symbolInstances.length;G++){let $=n.symbolInstances.get(G),{numHorizontalGlyphVertices:j,numVerticalGlyphVertices:W,crossTileID:ee,numIconVertices:X}=$,te=a.has(ee),q=this.opacities[ee];te?q=x:q||(q=L,this.opacities[ee]=q),a.add(ee);let ne=j>0||W>0,le=X>0,ce=this.placedOrientations[ee],me=ce===r.b6.vertical,Ie=ce===r.b6.horizontal||ce===r.b6.horizontalOnly;if(!ne&&!le||q.isHidden()||H++,ne){let be=rh(q.text);B(n.text,j,me?bs:be),B(n.text,W,Ie?bs:be);let Fe=q.text.isHidden(),{leftJustifiedTextSymbolIndex:Re,centerJustifiedTextSymbolIndex:Ye,rightJustifiedTextSymbolIndex:ve,verticalPlacedTextSymbolIndex:Ae}=$,he=n.text.placedSymbolArray,Ce=Fe||me?1:0;Re>=0&&(he.get(Re).hidden=Ce),Ye>=0&&(he.get(Ye).hidden=Ce),ve>=0&&(he.get(ve).hidden=Ce),Ae>=0&&(he.get(Ae).hidden=Fe||Ie?1:0);let Xe=this.variableOffsets[ee];Xe&&this.markUsedJustification(n,Xe.anchor,$,ce);let at=this.placedOrientations[ee];at&&(this.markUsedJustification(n,"left",$,at),this.markUsedOrientation(n,at,$))}if(le){let be=rh(q.icon),{placedIconSymbolIndex:Fe,verticalPlacedIconSymbolIndex:Re}=$,Ye=n.icon.placedSymbolArray,ve=q.icon.isHidden()?1:0;Fe>=0&&(B(n.icon,X,me?bs:be),Ye.get(Fe).hidden=ve),Re>=0&&(B(n.icon,$.numVerticalIconVertices,Ie?bs:be),Ye.get(Re).hidden=ve)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){let be=n.collisionArrays[G];if(be){let Fe=new r.P(0,0),Re=!0;if(be.textBox||be.verticalTextBox){if(A){let ve=this.variableOffsets[ee];ve?(Fe=Hs(ve.anchor,ve.width,ve.height,ve.textOffset,ve.textScale),k&&Fe._rotate(P?this.transform.angle:-this.transform.angle)):Re=!1}b&&(Re=!q.clipped),be.textBox&&$s(n.textCollisionBox.collisionVertexArray,q.text.placed,!Re||me,Fe.x,Fe.y),be.verticalTextBox&&$s(n.textCollisionBox.collisionVertexArray,q.text.placed,!Re||Ie,Fe.x,Fe.y)}let Ye=Re&&!!(!Ie&&be.verticalIconBox);be.iconBox&&$s(n.iconCollisionBox.collisionVertexArray,q.icon.placed,Ye,$.hasIconTextFit?Fe.x:0,$.hasIconTextFit?Fe.y:0),be.verticalIconBox&&$s(n.iconCollisionBox.collisionVertexArray,q.icon.placed,!Ye,$.hasIconTextFit?Fe.x:0,$.hasIconTextFit?Fe.y:0)}}}if(n.fullyClipped=H===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){let G=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=G.invProjMatrix,n.placementViewportMatrix=G.viewportMatrix,n.collisionCircleArray=G.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){let h=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*h>n}setStale(){this.stale=!0}}function $s(u,n,a,h,f){u.emplaceBack(n?1:0,a?1:0,h||0,f||0),u.emplaceBack(n?1:0,a?1:0,h||0,f||0),u.emplaceBack(n?1:0,a?1:0,h||0,f||0),u.emplaceBack(n?1:0,a?1:0,h||0,f||0)}let qc=Math.pow(2,25),qs=Math.pow(2,24),ih=Math.pow(2,17),Pa=Math.pow(2,16),Mp=Math.pow(2,9),Ws=Math.pow(2,8),nh=Math.pow(2,1);function rh(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;let n=u.placed?1:0,a=Math.floor(127*u.opacity);return a*qc+n*qs+a*ih+n*Pa+a*Mp+n*Ws+a*nh+n}let bs=0;class zd{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,a,h,f,b){let x=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(x,f,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((T,I)=>T.sortKey-I.sortKey));this._currentPartIndex<x.length;){let T=x[this._currentPartIndex];if(a.placeLayerBucketPart(T,this._seenCrossTileIDs,h,T.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class fc{constructor(n,a,h,f,b,x,T,I,A){this.placement=new th(n,b,x,T,I,A),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(n,a,h,f){let b=r.f.now(),x=()=>{let T=r.f.now()-b;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){let T=a[n[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=I)&&(!T.maxzoom||T.maxzoom>I)){let A=T,k=A.layout.get("symbol-z-elevate"),P=this._inProgressLayer=this._inProgressLayer||new zd(A),L=r.ag(T.source,T.scope);if(P.continuePlacement(k?f[L]:h[L],this.placement,this._showCollisionBoxes,T,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}let Wc=512/r.V/2;class Nd{constructor(n,a,h){this.tileID=n,this.bucketInstanceId=h,this.index=new r.bg(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let f=n.canonical.x*r.V,b=n.canonical.y*r.V;for(let x=0;x<a.length;x++){let{key:T,crossTileID:I,tileAnchorX:A,tileAnchorY:k}=a.get(x),P=Math.floor((f+A)*Wc),L=Math.floor((b+k)*Wc);this.index.add(P,L),this.keys.push(T),this.crossTileIDs.push(I)}this.index.finish()}findMatches(n,a,h){let f=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),b=Wc/Math.pow(2,a.canonical.z-this.tileID.canonical.z),x=a.canonical.x*r.V,T=a.canonical.y*r.V;for(let I=0;I<n.length;I++){let A=n.get(I);if(A.crossTileID)continue;let{key:k,tileAnchorX:P,tileAnchorY:L}=A,B=Math.floor((x+P)*b),H=Math.floor((T+L)*b),G=this.index.range(B-f,H-f,B+f,H+f);for(let $ of G){let j=this.crossTileIDs[$];if(this.keys[$]===k&&!h.has(j)){h.add(j),A.crossTileID=j;break}}}}}class Zs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class gc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){let a=Math.round((n-this.lng)/360);if(a!==0)for(let h in this.indexes){let f=this.indexes[h],b={};for(let x in f){let T=f[x];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+a),b[T.tileID.key]=T}this.indexes[h]=b}this.lng=n}addBucket(n,a,h){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);let f=this.usedCrossTileIDs[n.overscaledZ];for(let b in this.indexes){let x=this.indexes[b];if(Number(b)>n.overscaledZ)for(let T in x){let I=x[T];I.tileID.isChildOf(n)&&I.findMatches(a.symbolInstances,n,f)}else{let T=x[n.scaledTo(Number(b)).key];T&&T.findMatches(a.symbolInstances,n,f)}}for(let b=0;b<a.symbolInstances.length;b++){let x=a.symbolInstances.get(b);x.crossTileID||(x.crossTileID=h.generate(),f.add(x.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Nd(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(let h of a.crossTileIDs)this.usedCrossTileIDs[n].delete(h)}removeStaleBuckets(n){let a=!1;for(let h in this.indexes){let f=this.indexes[h];for(let b in f)n[f[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,f[b]),delete f[b],a=!0)}return a}}class Bd{constructor(){this.layerIndexes={},this.crossTileIDs=new Zs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,h,f){let b=this.layerIndexes[n.fqid];b===void 0&&(b=this.layerIndexes[n.fqid]=new gc);let x=!1,T={};f.name!=="globe"&&b.handleWrapJump(h);for(let I of a){let A=I.getBucket(n);A&&n.fqid===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(I.tileID,A,this.crossTileIDs)&&(x=!0),T[A.bucketInstanceId]=!0)}return b.removeStaleBuckets(T)&&(x=!0),x}pruneUnusedLayers(n){let a={};n.forEach(h=>{a[h]=!0});for(let h in this.layerIndexes)a[h]||delete this.layerIndexes[h]}}class Me{constructor(n=0,a=0,h=0,f=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(h)||h<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=h,this.right=f}interpolate(n,a,h){return a.top!=null&&n.top!=null&&(this.top=r.U(n.top,a.top,h)),a.bottom!=null&&n.bottom!=null&&(this.bottom=r.U(n.bottom,a.bottom,h)),a.left!=null&&n.left!=null&&(this.left=r.U(n.left,a.left,h)),a.right!=null&&n.right!=null&&(this.right=r.U(n.right,a.right,h)),this}getCenter(n,a){let h=r.aa((this.left+n-this.right)/2,0,n),f=r.aa((this.top+a-this.bottom)/2,0,a);return new r.P(h,f)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Me(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function We(u,n){let a=r.bk(u,3);r.a6.fromQuat(u,n),r.bm(u,3,a)}function Lt(u,n){let a=r.bi.identity([]);return r.bi.rotateZ(a,a,-n),r.bi.rotateX(a,a,-u),a}function si(u,n){let a=[u[0],u[1],0],h=[n[0],n[1],0];if(r.N.length(a)>=1e-15){let x=r.N.normalize([],a);r.N.scale(h,x,r.N.dot(h,x)),n[0]=h[0],n[1]=h[1]}let f=r.N.cross([],n,u);if(r.N.len(f)<1e-15)return null;let b=Math.atan2(-f[1],f[0]);return Lt(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),b)}class Hn{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){let a=n instanceof r.L?n:new r.L(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=r.bh(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;let h=this.position,f=this._elevation?this._elevation.getAtPointOrZero(r.L.fromLngLat(n)):0,b=r.L.fromLngLat(n,f),x=[b.x-h.x,b.y-h.y,b.z-h.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=si(x,a)}setPitchBearing(n,a){this.orientation=Lt(r.bj(n),r.bj(-a))}}class an{constructor(n,a){this._transform=r.a6.identity([]),this.orientation=a,this.position=n}get mercatorPosition(){let n=this.position;return new r.L(n[0],n[1],n[2])}get position(){let n=r.bk(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&r.bm(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||r.bi.identity([]),n&&We(this._transform,this._orientation)}getPitchBearing(){let n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=Lt(n,a),We(this._transform,this._orientation)}forward(){let n=r.bk(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){let n=r.bk(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){let n=r.bk(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){let h=new Float64Array(16);return r.a6.invert(h,this.getWorldToCamera(n,a)),h}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(n,a,h){let f=this.position;r.N.scale(f,f,-n);let b=new Float64Array(16);return r.a6.fromScaling(b,[h,h,h]),r.a6.translate(b,b,f),b[10]*=a,b}getWorldToCamera(n,a){let h=new Float64Array(16),f=new Float64Array(4),b=this.position;return r.bi.conjugate(f,this._orientation),r.N.scale(b,b,-n),r.a6.fromQuat(h,f),r.a6.translate(h,h,b),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=a,h[9]*=a,h[10]*=a,h[11]*=a,h}getCameraToClipPerspective(n,a,h,f){let b=new Float64Array(16);return r.a6.perspective(b,n,a,h,f),b}getCameraToClipOrthographic(n,a,h,f,b,x){let T=new Float64Array(16);return r.a6.ortho(T,n,a,h,f,b,x),T}getDistanceToElevation(n,a=!1){let h=n===0?0:r.bl(n,a?r.au(this.position[1]):this.position[1]),f=this.forward();return(h-this.position[2])/f[2]}clone(){return new an([...this.position],[...this.orientation])}}let Kn=(u,n,a)=>(1-a)*u+a*n,_r=u=>u*u*u*u*u;class Io{constructor(n,a,h,f,b,x,T){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=h??0,this._maxPitch=f??60,this.setProjection(x),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new r.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Me,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new an,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let n=new Io(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(n,a=!1){let h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(n||h)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return r.ac(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};let a=this.projection?this.getProjection():void 0;this.projection=r.bo(this.projectionOptions);let h=!M(a,this.getProjection());return h&&this._calcMatrices(),this.mercatorFromTransition=!1,h}setOrthographicProjectionAtLowPitch(n){return this._orthographicProjectionAtLowPitch!==n&&(this._orthographicProjectionAtLowPitch=n,this._calcMatrices(),!0)}setMercatorFromTransition(){let n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.bo({name:"mercator"});let a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){let n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bh(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){let a=-n*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=r.b4.create(),r.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){let a=r.aa(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=r.bj(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){let a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(n){this._tileCoverLift!==n&&(this._tileCoverLift=n)}_updateCameraOnTerrain(){let n=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&n===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||n===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let h=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&h.exaggeration()&&this._centerAltitudeValidForExaggeration!==h.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*h.exaggeration(),this._centerAltitudeValidForExaggeration=h.exaggeration()):(this._centerAltitude=n||0,this._centerAltitudeValidForExaggeration=h.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop(),f=0,b=0;for(let x=0;x<a.length;x++){let T=new r.P(a[x][0]*this.width,h+a[x][1]*(this.height-h)),I=n.pointCoordinate(T);if(!I)continue;let A=1/Math.hypot(I[0]-this._camera.position[0],I[1]-this._camera.position[1]);f+=I[3]*A,b+=A}return b===0?NaN:f/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*a,f=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),x=Math.max(f-h,b);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){let a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude())),h;h=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];let f=r.N.length(r.N.sub([],this._camera.position,h));return r.aa(this._zoomFromMercatorZ(f),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!r.bi.exactEquals(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){let h=[n.position.x,n.position.y,n.position.z];r.N.exactEquals(h,this._camera.position)||(this._setCameraPosition(h),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let n=this._camera.position,a=new Hn;return a.position=new r.L(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!r.bi.length(n))return!1;r.bi.normalize(n,n);let a=r.N.transformQuat([],[0,0,-1],n),h=r.N.transformQuat([],[0,-1,0],n);if(h[2]<0)return!1;let f=si(a,h);return!!f&&(this._camera.orientation=f,!0)}_setCameraPosition(n){let a=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,f=this.cameraToCenterDistance;n[2]=r.aa(n[2],f/h,f/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,h){this._unmodified=!1,this._edgeInsets.interpolate(n,a,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){let a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){let a=[new r.bp(0,n)];if(this.renderWorldCopies){let h=this.pointCoordinate(new r.P(0,0)),f=this.pointCoordinate(new r.P(this.width,0)),b=this.pointCoordinate(new r.P(this.width,this.height)),x=this.pointCoordinate(new r.P(0,this.height)),T=Math.floor(Math.min(h.x,f.x,b.x,x.x)),I=Math.floor(Math.max(h.x,f.x,b.x,x.x)),A=1;for(let k=T-A;k<=I+A;k++)k!==0&&a.push(new r.bp(k,n))}return a}isLODDisabled(n){return(!n||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(n,a,h){let f=[];if(a[0]===0&&a[1]===0)return f;for(let x of n){let T=x.canonical,I=x.overscaledZ,A=x.wrap,k=1<<T.z,P=T.x+1<k,L=T.x>0,B=T.y+1<k,H=T.y>0,G=x.wrap-(L?0:1),$=x.wrap+(P?0:1),j=L?T.x-1:k-1,W=P?T.x+1:0;a[0]<0?(f.push(new r.am(I,$,T.z,W,T.y)),a[1]<0&&B&&(f.push(new r.am(I,A,T.z,T.x,T.y+1)),f.push(new r.am(I,$,T.z,W,T.y+1))),a[1]>0&&H&&(f.push(new r.am(I,A,T.z,T.x,T.y-1)),f.push(new r.am(I,$,T.z,W,T.y-1)))):a[0]>0?(f.push(new r.am(I,G,T.z,j,T.y)),a[1]<0&&B&&(f.push(new r.am(I,A,T.z,T.x,T.y+1)),f.push(new r.am(I,G,T.z,j,T.y+1))),a[1]>0&&H&&(f.push(new r.am(I,A,T.z,T.x,T.y-1)),f.push(new r.am(I,G,T.z,j,T.y-1)))):a[1]<0&&B?f.push(new r.am(I,A,T.z,T.x,T.y+1)):H&&f.push(new r.am(I,A,T.z,T.x,T.y-1))}if(f.length>1){f.sort((I,A)=>I.overscaledZ-A.overscaledZ||I.wrap-A.wrap||I.canonical.z-A.canonical.z||I.canonical.x-A.canonical.x||I.canonical.y-A.canonical.y);let x=0,T=0;for(;T<f.length;)f[T].equals(f[x])?++T:f[++x]=f[T++];f.length=x+1}let b=[];for(let x of f)f.some(T=>x.isChildOf(T))||b.push(x);return f=b.filter(x=>!n.some(T=>!!(x.overscaledZ<h&&T.isChildOf(x))||x.equals(T)||x.isChildOf(T))),f}coveringTiles(n){let a=this.coveringZoomLevel(n),h=a,f=this.elevation&&this.elevation.exaggeration(),b=f&&!n.isTerrainDEM,x=this.projection.name==="mercator";if(n.minzoom!==void 0&&a<n.minzoom)return[];n.maxzoom!==void 0&&a>n.maxzoom&&(a=n.maxzoom);let T=this.locationCoordinate(this.center),I=this.center.lat,A=1<<a,k=[A*T.x,A*T.y,0],P=this.projection.name==="globe",L=!P,B=r.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,L),H=P?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=A*r.bl(1,this.center.lat),$=this._camera.position[2]/r.bl(1,this.center.lat),j=[A*H.x,A*H.y,$*(L?1:G)],W=P||f,ee=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),X=this.isLODDisabled(!0)?a:0,te;if(this._elevation&&n.isTerrainDEM)te=1e4*this._elevation.exaggeration();else if(this._elevation){let he=this._elevation.getMinMaxForVisibleTiles();te=he?he.max:this._centerAltitude}else te=this._centerAltitude;let q=n.isTerrainDEM?-te:this._elevation?this._elevation.getMinElevationBelowMSL():0,ne=this.projection.isReprojectedInTileSpace?r.br(this):1,le=he=>{let Xe=new r.L(he.x+25e-6,he.y,he.z),at=new r.L(he.x,he.y+25e-6,he.z),nt=he.toLngLat(),_t=Xe.toLngLat(),Rt=at.toLngLat(),Wt=this.locationCoordinate(nt),Nt=this.locationCoordinate(_t),Ut=this.locationCoordinate(Rt),_i=Math.hypot(Nt.x-Wt.x,Nt.y-Wt.y),ri=Math.hypot(Ut.x-Wt.x,Ut.y-Wt.y);return Math.sqrt(_i*ri)*ne/25e-6},ce=he=>{let Ce=te,Xe=q;return{aabb:r.bu(this,A,0,0,0,he,Xe,Ce,this.projection),zoom:0,x:0,y:0,minZ:Xe,maxZ:Ce,wrap:he,fullyVisible:!1}},me=[],Ie=[],be=a,Fe=n.reparseOverscaled?h:a,Re=he=>he*he,Ye=Re(($-this._centerAltitude)*G),ve=he=>{if(!this._elevation||!he.tileID||!x)return;let Ce=this._elevation.getMinMaxForTile(he.tileID),Xe=he.aabb;Ce?(Xe.min[2]=Ce.min,Xe.max[2]=Ce.max,Xe.center[2]=(Xe.min[2]+Xe.max[2])/2):(he.shouldSplit=Ae(he),he.shouldSplit||(Xe.min[2]=Xe.max[2]=Xe.center[2]=this._centerAltitude))},Ae=he=>{if(he.zoom<X)return!0;if(he.zoom===be)return!1;if(he.shouldSplit!=null)return he.shouldSplit;let Ce=he.aabb.distanceX(j),Xe=he.aabb.distanceY(j),at=Ye,nt=1;if(P){at=Re(he.aabb.distanceZ(j));let Wt=Math.pow(2,he.zoom),Nt=r.au((he.y+1)/Wt),Ut=r.au(he.y/Wt),_i=Math.min(Math.max(I,Nt),Ut),ri=r.bJ(_i)/r.bJ(I);if(nt=_i===I?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ri/this._mercatorScaleRatio),this.zoom<=r.bG&&he.zoom===be-1&&ri>=.9)return!0}else if(b&&(at=Re(he.aabb.distanceZ(j)*G)),this.projection.isReprojectedInTileSpace&&h<=5){let Wt=Math.pow(2,he.zoom),Nt=le(new r.L((he.x+.5)/Wt,(he.y+.5)/Wt));nt=Nt>.85?1:Nt}let _t=Ce*Ce+Xe*Xe+at,Rt=Re((1<<be-he.zoom)*ee*nt*((Wt,Nt)=>{if(Nt*Re(.707)<Wt)return 1;let Ut=Math.sqrt(Nt/Wt);return Ut/(1.4144271570014144+(Math.pow(1.1,Ut-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(at,Ye),_t));return _t<Rt};if(this.renderWorldCopies)for(let he=1;he<=3;he++)me.push(ce(-he)),me.push(ce(he));for(me.push(ce(0));me.length>0;){let he=me.pop(),Ce=he.x,Xe=he.y,at=he.fullyVisible,nt=()=>this.projection.name==="globe"&&(he.y===0||he.y===(1<<he.zoom)-1);if(!at){let _t=W?he.aabb.intersects(B):he.aabb.intersectsFlat(B);if(_t===0&&nt()){let Rt=new r.bs(he.zoom,Ce,Xe);_t=r.bt(this,A,Rt,!0).intersects(B)}if(_t===0)continue;at=_t===2}if(he.zoom!==be&&Ae(he))for(let _t=0;_t<4;_t++){let Rt=(Ce<<1)+_t%2,Wt=(Xe<<1)+(_t>>1),Nt={aabb:x?he.aabb.quadrant(_t):r.bu(this,A,he.zoom+1,Rt,Wt,he.wrap,he.minZ,he.maxZ,this.projection),zoom:he.zoom+1,x:Rt,y:Wt,wrap:he.wrap,fullyVisible:at,tileID:void 0,shouldSplit:void 0,minZ:he.minZ,maxZ:he.maxZ};b&&!P&&(Nt.tileID=new r.am(he.zoom+1===be?Fe:he.zoom+1,he.wrap,he.zoom+1,Rt,Wt),ve(Nt)),me.push(Nt)}else{let _t=he.zoom===be?Fe:he.zoom;if(n.minzoom&&n.minzoom>_t)continue;if(!at){let Ut=W?he.aabb.intersectsPrecise(B):he.aabb.intersectsPreciseFlat(B);if(Ut===0&&nt()){let _i=new r.bs(he.zoom,Ce,Xe);Ut=r.bt(this,A,_i,!0).intersectsPrecise(B)}if(Ut===0)continue}let Rt=k[0]-(.5+Ce+(he.wrap<<he.zoom))*(1<<a-he.zoom),Wt=k[1]-.5-Xe,Nt=he.tileID?he.tileID:new r.am(_t,he.wrap,he.zoom,Ce,Xe);Ie.push({tileID:Nt,distanceSq:Rt*Rt+Wt*Wt})}}if(this.fogCullDistSq){let he=this.fogCullDistSq,Ce=this.horizonLineFromTop();Ie=Ie.filter(Xe=>{let at=[0,0,0,1],nt=[r.V,r.V,0,1],_t=this.calculateFogTileMatrix(Xe.tileID.toUnwrapped());r.a7.transformMat4(at,at,_t),r.a7.transformMat4(nt,nt,_t);let Rt=r.a7.min([],at,nt),Wt=r.a7.max([],at,nt),Nt=r.bv(Rt,Wt);if(Nt===0)return!0;let Ut=!1,_i=this._elevation;if(_i&&Nt>he&&Ce!==0){let ri=this.calculateProjMatrix(Xe.tileID.toUnwrapped()),ci;n.isTerrainDEM||(ci=_i.getMinMaxForTile(Xe.tileID)),ci||(ci={min:q,max:te});let li=r.bH(this.rotation),Ui=[li[0]*r.V,li[1]*r.V,ci.max];r.N.transformMat4(Ui,Ui,ri),Ut=(1-Ui[1])*this.height*.5<Ce}return Nt<he||Ut})}return Ie.sort((he,Ce)=>he.distanceSq-Ce.distanceSq).map(he=>he.tileID)}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){let a=r.aa(n.lat,-r.bw,r.bw),h=this.projection.project(n.lng,a);return new r.P(h.x*this.worldSize,h.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,a){let h,f,b=this.centerPoint;if(this.projection.name==="globe"){let T=this.worldSize;h=(a.x-b.x)/T,f=(a.y-b.y)/T}else{let T=this.pointCoordinate(a),I=this.pointCoordinate(b);h=T.x-I.x,f=T.y-I.y}let x=this.locationCoordinate(n);this.setLocation(new r.L(x.x-h,x.y-f))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,a){let h=a?r.bl(a,n.lat):void 0,f=this.projection.project(n.lng,n.lat);return new r.L(f.x,f.y,h)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){let h=a??this._centerAltitude,f=[n.x,n.y,0,1],b=[n.x,n.y,1,1];r.a7.transformMat4(f,f,this.pixelMatrixInverse),r.a7.transformMat4(b,b,this.pixelMatrixInverse);let x=b[3];r.a7.scale(f,f,1/f[3]),r.a7.scale(b,b,1/x);let T=f[2],I=b[2];return{p0:f,p1:b,t:T===I?0:(h-T)/(I-T)}}screenPointToMercatorRay(n){let a=[n.x,n.y,0,1],h=[n.x,n.y,1,1];return r.a7.transformMat4(a,a,this.pixelMatrixInverse),r.a7.transformMat4(h,h,this.pixelMatrixInverse),r.a7.scale(a,a,1/a[3]),r.a7.scale(h,h,1/h[3]),a[2]=r.bl(a[2],this._center.lat)*this.worldSize,h[2]=r.bl(h[2],this._center.lat)*this.worldSize,r.a7.scale(a,a,1/this.worldSize),r.a7.scale(h,h,1/this.worldSize),new r.a2([a[0],a[1],a[2]],r.N.normalize([],r.N.sub([],h,a)))}rayIntersectionCoordinate(n){let{p0:a,p1:h,t:f}=n,b=r.bl(a[2],this._center.lat),x=r.bl(h[2],this._center.lat);return new r.L(r.U(a[0],h[0],f)/this.worldSize,r.U(a[1],h[1],f)/this.worldSize,r.U(b,x,f))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let a=this.projection.pointCoordinate3D(this,n.x,n.y);if(a)return new r.L(a[0],a[1],a[2]);let h=0,f=this.horizonLineFromTop();if(n.y>f)return this.pointCoordinate(n);let b=.02*f,x=n.clone();for(let T=0;T<10&&f-h>b;T++){x.y=r.U(h,f,.66);let I=this.projection.pointCoordinate3D(this,x.x,x.y);I?(f=x.y,a=I):h=x.y}return a?new r.L(a[0],a[1],a[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=r.bx)return!this.isPointAboveHorizon(n);let a=this.pointCoordinate(n);return a.y>=0&&a.y<=1}_coordinatePoint(n,a){let h=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,f=[n.x*this.worldSize,n.y*this.worldSize,h+n.toAltitude(),1];return r.a7.transformMat4(f,f,this.pixelMatrix),f[3]>0?new r.P(f[0]/f[3],f[1]/f[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:n,left:a}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,f=this.width-this._edgeInsets.right,b=this.pointLocation3D(new r.P(a,n)),x=this.pointLocation3D(new r.P(f,n)),T=this.pointLocation3D(new r.P(f,h)),I=this.pointLocation3D(new r.P(a,h)),A=Math.min(b.lng,x.lng,T.lng,I.lng),k=Math.max(b.lng,x.lng,T.lng,I.lng),P=Math.min(b.lat,x.lat,T.lat,I.lat),L=Math.max(b.lat,x.lat,T.lat,I.lat),B=Math.pow(2,-this.zoom)/16*270,H=this.projection.name==="globe"?1:4,G=($,j,W,ee,X)=>{let te=($+W)/2,q=(j+ee)/2,ne=new r.P(te,q),{lng:le,lat:ce}=this.pointLocation3D(ne),me=Math.max(0,A-le,P-ce,le-k,ce-L);A=Math.min(A,le),k=Math.max(k,le),P=Math.min(P,ce),L=Math.max(L,ce),(X<H||me>B)&&(G($,j,te,q,X+1),G(te,q,W,ee,X+1))};if(G(a,n,f,n,1),G(f,n,f,h,1),G(f,h,a,h,1),G(a,h,a,n,1),this.projection.name==="globe"){let[$,j]=r.by(this);$?(L=90,k=180,A=-180):j&&(P=-90,k=180,A=-180)}return new r.ad(new r.bn(A,P),new r.bn(k,L))}_getBoundsRectangular(n,a){let{top:h,left:f}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,T=new r.P(f,h),I=new r.P(x,h),A=new r.P(x,b),k=new r.P(f,b),P=this.pointCoordinate(T,n),L=this.pointCoordinate(I,n),B=this.pointCoordinate(A,a),H=this.pointCoordinate(k,a),G=($,j)=>(j.y-$.y)/(j.x-$.x);return P.y>1&&L.y>=0?P=new r.L((1-H.y)/G(H,P)+H.x,1):P.y<0&&L.y<=1&&(P=new r.L(-H.y/G(H,P)+H.x,0)),L.y>1&&P.y>=0?L=new r.L((1-B.y)/G(B,L)+B.x,1):L.y<0&&P.y<=1&&(L=new r.L(-B.y/G(B,L)+B.x,0)),new r.ad().extend(this.coordinateLocation(P)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(B))}_getBoundsRectangularTerrain(){let n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);let a=n.visibleDemTiles.reduce((h,f)=>{if(f.dem){let b=f.dem.tree;h.min=Math.min(h.min,b.minimums[0]),h.max=Math.max(h.max,b.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){let a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,h=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-r.bw,this.maxLat=r.bw,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.a5(this.minLng)*this.tileSize,this.worldMaxX=r.a5(this.maxLng)*this.tileSize,this.worldMinY=r.ae(this.maxLat)*this.tileSize,this.worldMaxY=r.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){let a=n.key,h=this._distanceTileDataCache;if(h[a])return h[a];let f=n.canonical,b=1/this.height,x=this.cameraWorldSize,T=x/this.zoomScale(f.z),I=(f.x+Math.pow(2,f.z)*n.wrap)*T,A=f.y*T,k=this.point;k.x*=x/this.worldSize,k.y*=x/this.worldSize;let P=this.angle,L=Math.sin(-P),B=-Math.cos(-P);return h[a]={bearing:[L,B],center:[(k.x-I)*b,(k.y-A)*b],scale:T/r.V*b},h[a]}calculateFogTileMatrix(n){let a=n.key,h=this._fogTileMatrixCache;if(h[a])return h[a];let f=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return r.a6.multiply(f,this.worldToFogMatrix,f),h[a]=new Float32Array(f),h[a]}calculateProjMatrix(n,a=!1,h=!1){let f=n.key,b;if(b=h?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,b[f])return b[f];let x=this.calculatePosMatrix(n,this.worldSize),T;return T=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,r.a6.multiply(x,T,x),b[f]=new Float32Array(x),b[f]}calculatePixelsToTileUnitsMatrix(n){let a=n.tileID.key,h=this._pixelsToTileUnitsCache;if(h[a])return h[a];let f=r.bz(n,this);return h[a]=f,h[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let n=1/this.worldSize,a=r.a6.fromScaling([],[n,n,n]);return r.a6.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let n=this._elevation;this._updateCameraState();let a=r.bl(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(a),f=this._camera.forward(),b=r.bl(1,this._center.lat);h[2]/=b,f[2]/=b,r.N.normalize(f,f);let x=n.raycast(h,f,n.exaggeration());if(x){let T=r.N.scaleAndAdd([],h,f,x),I=new r.L(T[0],T[1],r.bl(T[2],r.au(T[1]))),A=(I.z+r.N.length([I.x-h[0],I.y-h[1],I.z-h[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(A),this._centerAltitude=I.toAltitude(),this._center=this.coordinateLocation(I),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;let a=this._elevation,h=r.bl(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(h),b=a.getAtPointOrZero(new r.L(...f)),x=this.pixelsPerMeter/this.worldSize*b,T=this._minimumHeightOverTerrain(),I=f[2]-x;if(I<=T)if(I<0||n){let A=this.locationCoordinate(this._center,this._centerAltitude),k=[f[0],f[1],A.z-f[2]],P=r.N.length(k);k[2]-=(T-I)/this._pixelsPerMercatorPixel;let L=r.N.length(k);if(L===0)return;r.N.scale(k,k,P/L*this._pixelsPerMercatorPixel),this._camera.position=[f[0],f[1],A.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){let L=this.center;return L.lat=r.aa(L.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(L.lng=r.aa(L.lng,this.minLng,this.maxLng)),this.center=L,void(this._constraining=!1)}let a=this._unmodified,{x:h,y:f}=this.point,b=0,x=h,T=f,I=this.width/2,A=this.height/2,k=this.worldMinY*this.scale,P=this.worldMaxY*this.scale;if(f-A<k&&(T=k+A),f+A>P&&(T=P-A),P-k<this.height&&(b=Math.max(b,this.height/(P-k)),T=(P+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let L=this.worldMinX*this.scale,B=this.worldMaxX*this.scale,H=this.worldSize/2-(L+B)/2;x=(h+H+this.worldSize)%this.worldSize-H,x-I<L&&(x=L+I),x+I>B&&(x=B-I),B-L<this.width&&(b=Math.max(b,this.width/(B-L)),x=(B+L)/2)}x===h&&T===f||(this.center=this.unproject(new r.P(x,T))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let n=this.centerOffset,a=this.projection.name==="globe",h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bl(1,this.center.lat)/r.bl(1,r.bI));let f=r.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,f),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let b=this.projection.zAxisUnit==="meters"?h:1,x=this._camera.getWorldToCamera(this.worldSize,b),T,I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(I[8]=2*-n.x/this.width,I[9]=2*n.y/this.height,this.isOrthographic){let ce=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),me=ce*this.aspect,Ie=-me,be=-ce;me-=n.x,Ie-=n.x,ce+=n.y,be+=n.y,T=this._camera.getCameraToClipOrthographic(Ie,me,be,ce,this._nearZ,this._farZ),((Fe,Re,Ye,ve)=>{for(let Ae=0;Ae<16;Ae++)Fe[Ae]=Kn(Re[Ae],Ye[Ae],ve)})(T,T,I,_r(this.pitch>=15?1:this.pitch/15))}else T=I;let A=r.a6.mul([],I,x),k=r.a6.mul([],T,x);if(this.projection.isReprojectedInTileSpace){let ce=this.locationCoordinate(this.center),me=r.a6.identity([]);r.a6.translate(me,me,[ce.x*this.worldSize,ce.y*this.worldSize,0]),r.a6.multiply(me,me,r.bB(this)),r.a6.translate(me,me,[-ce.x*this.worldSize,-ce.y*this.worldSize,0]),r.a6.multiply(k,k,me),r.a6.multiply(A,A,me),this.inverseAdjustmentMatrix=r.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.a6.scale([],k,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=k,this.invProjMatrix=r.a6.invert(new Float64Array(16),this.projMatrix),a){let ce=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ce[8]=2*-n.x/this.width,ce[9]=2*n.y/this.height,this.expandedFarZProjMatrix=r.a6.mul([],ce,x)}else this.expandedFarZProjMatrix=this.projMatrix;let P=r.a6.invert([],T);this.frustumCorners=r.bD.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);let L=new Float32Array(16);r.a6.identity(L),r.a6.scale(L,L,[1,-1,1]),r.a6.rotateX(L,L,this._pitch),r.a6.rotateZ(L,L,this.angle);let B=r.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.a6.clone(B);let H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;B[8]=2*-n.x/this.width,B[9]=2*(n.y+H)/this.height,this.skyboxMatrix=r.a6.multiply(L,B,L);let G=this.point,$=G.x,j=G.y,W=this.width%2/2,ee=this.height%2/2,X=Math.cos(this.angle),te=Math.sin(this.angle),q=$-Math.round($)+X*W+te*ee,ne=j-Math.round(j)+X*ee+te*W,le=new Float64Array(k);if(r.a6.translate(le,le,[q>.5?q-1:q,ne>.5?ne-1:ne,0]),this.alignedProjMatrix=le,k=r.a6.create(),r.a6.scale(k,k,[this.width/2,-this.height/2,1]),r.a6.translate(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=r.a6.create(),r.a6.scale(k,k,[1,-1,1]),r.a6.translate(k,k,[-1,-1,0]),r.a6.scale(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=r.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,A),this._calcFogMatrices(),this._distanceTileDataCache={},k=r.a6.invert(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.bE(this);let ce=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.N.transformMat4(ce,ce,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let n=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,h=this._camera.position,f=1/this.height/this._pixelsPerMercatorPixel,b=[n,n,a];r.N.scale(b,b,f),r.N.scale(h,h,-1),r.N.multiply(h,h,b);let x=r.a6.create();r.a6.translate(x,x,h),r.a6.scale(x,x,b),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,f)}_computeCameraPosition(n){let a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),f=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[f.x/this.worldSize-h[0]*b,f.y/this.worldSize-h[1]*b,n/this.worldSize*this._centerAltitude-h[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){let a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],f=n[2],b=1;this.projection.wrap&&(this.center=this.center.wrap()),f>0&&(b=Math.min((a-h)/f,1)),this._camera.position=r.N.scaleAndAdd([],this._camera.position,n,b),this._updateStateFromCamera()}_updateStateFromCamera(){let n=this._camera.position,a=this._camera.forward(),{pitch:h,bearing:f}=this._camera.getPitchBearing(),b=r.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.bj(this._maxPitch)),T=Math.max((n[2]-b)/Math.cos(h),x),I=this._zoomFromMercatorZ(T);r.N.scaleAndAdd(n,n,a,T),this._pitch=r.aa(h,r.bj(this.minPitch),r.bj(this.maxPitch)),this.angle=r.bh(f,-Math.PI,Math.PI),this._setZoom(r.aa(I,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.L(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){let n=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let a=0,h=r.bx,f=0,b=1/0;for(;h-a>1e-6&&h>a;){let x=a+.5*(h-a),T=this.tileSize*Math.pow(2,x),I=this.getCameraToCenterDistance(this.projection,x,T),A=this.scaleZoom(I/(n*this.tileSize)),k=Math.abs(x-A);k<b&&(b=k,f=x),x<A?a=x:h=x}return f}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){let h=Math.min(n.x,a.x),f=Math.max(n.x,a.x),b=Math.min(n.y,a.y),x=Math.max(n.y,a.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let T=[new r.P(h,b),new r.P(f,x),new r.P(h,x),new r.P(f,b)],I=this.renderWorldCopies?-3:0,A=this.renderWorldCopies?4:1;for(let k of T){let P=this.pointRayIntersection(k);if(P.t<0)return!0;let L=this.rayIntersectionCoordinate(P);if(L.x<I||L.y<0||L.x>A||L.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(n,a){let h=r.N.length(r.N.sub([],this._camera.position,n)),f=this._zoomFromMercatorZ(h)+a;return h-this._mercatorZfromZoom(f)}getCameraPoint(){if(this.projection.name==="globe"){let n=function([a,h,f],b){let x=[a,h,f,1];r.a7.transformMat4(x,x,b);let T=x[3]=Math.max(x[3],1e-6);return x[0]/=T,x[1]/=T,x[2]/=T,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(n[0],n[1])}{let n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,n))}}getCameraToCenterDistance(n,a=this.zoom,h=this.worldSize){let f=r.bA(n,a,this.width,this.height,1024),b=n.pixelSpaceConversion(this.center.lat,h,f),x=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(x=Kn(1,x,_r(this.pitch>=15?1:this.pitch/15))),x}getWorldToCameraMatrix(){let n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.a6.multiply(n,n,this.globeMatrix),n}getFrustum(n){return r.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,this.projection.zAxisUnit==="meters")}}let wn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},ir=(u,n)=>{if(n>0&&u.terrain&&r.w("Cutoff is currently disabled on terrain"),n<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let a=u.transform,h=Math.max(Math.abs(a._zoom-(u.minCutoffZoom-1)),1),f=a.isLODDisabled(!1)?r.O(60,45,a.pitch):r.O(30,15,a.pitch),b=a._farZ-a._nearZ,x=n*a.height,T=((1-(I=f))*a.cameraToCenterDistance+I*(a._farZ+x))*h;var I;return{shouldRenderCutoff:f<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(T-a._nearZ)/b,(T-x-a._nearZ)/b]}}},br={cascadeCount:2,shadowMapResolution:2048};class ba{constructor(n,a){this.aabb=n,this.lastCascade=a}}class go{add(n,a){let h=this.receivers[n.key];h!==void 0?(h.aabb.min[0]=Math.min(h.aabb.min[0],a.min[0]),h.aabb.min[1]=Math.min(h.aabb.min[1],a.min[1]),h.aabb.min[2]=Math.min(h.aabb.min[2],a.min[2]),h.aabb.max[0]=Math.max(h.aabb.max[0],a.max[0]),h.aabb.max[1]=Math.max(h.aabb.max[1],a.max[1]),h.aabb.max[2]=Math.max(h.aabb.max[2],a.max[2])):this.receivers[n.key]=new ba(a,null)}clear(){this.receivers={}}get(n){return this.receivers[n.key]}computeRequiredCascades(n,a,h){let f=r.bS.fromPoints(n.points),b=0;for(let x in this.receivers){let T=this.receivers[x];if(!T||!f.intersectsAabb(T.aabb))continue;T.aabb.min=f.closestPoint(T.aabb.min),T.aabb.max=f.closestPoint(T.aabb.max);let I=T.aabb.getCorners();for(let A=0;A<h.length;A++){let k=!0;for(let P of I){let L=[P[0]*a,P[1]*a,P[2]];if(r.N.transformMat4(L,L,h[A].matrix),L[0]<-1||L[0]>1||L[1]<-1||L[1]>1){k=!1;break}}if(T.lastCascade=A,b=Math.max(b,A),k)break}}return b+1}}class ya{constructor(n){this.painter=n,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new go,this._depthMode=new ot(n.context.gl.LEQUAL,ot.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,n.tp.registerParameter(br,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),n.tp.registerParameter(br,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(let n of this._cascades)n.texture.destroy(),n.framebuffer.destroy();this._cascades=[]}updateShadowParameters(n,a){let h=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;let f=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||f<=0||(this._shadowLayerCount=h.style.order.reduce((H,G)=>{let $=h.style._mergedLayers[G];return H+($.hasShadowPass()&&!$.isHidden(n.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;let b=h.context,x=br.shadowMapResolution,T=br.shadowMapResolution;if(this._cascades.length===0||br.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let H=0;H<br.cascadeCount;++H){let G=h._shadowMapDebug,$=b.gl,j=b.createFramebuffer(x,T,G,"texture"),W=new r.T(b,{width:x,height:T,data:null},$.DEPTH_COMPONENT);if(j.depthAttachment.set(W.texture),G){let ee=new r.T(b,{width:x,height:T,data:null},$.RGBA);j.colorAttachment.set(ee.texture)}this._cascades.push({framebuffer:j,texture:W,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bq,scale:0})}}this.shadowDirection=Ys(a);let I=0;if(n.elevation){let H=n.elevation,G=[1e4,-1e4];H.visibleDemTiles.filter($=>$.dem).forEach($=>{let j=$.dem.tree;G[0]=Math.min(G[0],j.minimums[0]),G[1]=Math.max(G[1],j.maximums[0])}),G[0]!==1e4&&(I=(G[1]-G[0])*H.exaggeration())}let A=1.5*n.cameraToCenterDistance,k=3*A,P=new Float64Array(16);for(let H=0;H<this._cascades.length;++H){let G=this._cascades[H],$=n.height/50,j=1;br.cascadeCount===1?j=k:H===0?j=A:($=A,j=k);let[W,ee]=Rl(n,this.shadowDirection,$,j,br.shadowMapResolution,I);G.scale=n.scale,G.matrix=W,G.boundingSphereRadius=ee,r.a6.invert(P,G.matrix),G.frustum=r.bq.fromInvProjectionMatrix(P,1,0,!0),G.far=j}let L=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[L].far,this._cascades[L].far],this._uniformValues.u_shadow_intensity=f,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/br.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=br.shadowMapResolution,this._uniformValues.u_shadowmap_0=wn.ShadowMap0,this._uniformValues.u_shadowmap_1=wn.ShadowMap0+1,this._groundShadowTiles=h.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let B=h.transform.elevation;for(let H of this._groundShadowTiles){let G={min:0,max:0};if(B){let $=B.getMinMaxForTile(H);$&&(G=$)}this.addShadowReceiver(H.toUnwrapped(),G.min,G.max)}}get enabled(){return this._enabled}set enabled(n){this._enabled=n}drawShadowPass(n,a){if(!this._enabled)return;let h=this.painter,f=h.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(h.transform.getFrustum(0),h.transform.worldSize,this._cascades),f.viewport.set([0,0,br.shadowMapResolution,br.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){h.currentShadowCascade=b,f.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),f.clear({color:r.ax.white,depth:1});for(let x of n.order){let T=n._mergedLayers[x];if(!T.hasShadowPass()||T.isHidden(h.transform.zoom))continue;let I=n.getLayerSourceCache(T),A=I?a[I.id]:void 0;(T.type==="model"||A&&A.length)&&h.renderLayer(h,I,T,A)}}h.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;let n=this.painter,a=n.style,h=n.context,f=a.directionalLight,b=a.ambientLight;if(!f||!b)return;let x=[],T=ir(n,n.longestCutoffRange);T.shouldRenderCutoff&&x.push("RENDER_CUTOFF");let I=Oa(f,b),A=new ot(h.gl.LEQUAL,ot.ReadOnly,n.depthRangeFor3D);for(let k of this._groundShadowTiles){let P=k.toUnwrapped(),L=n.isTileAffectedByFog(k),B=n.getOrCreateProgram("groundShadow",{defines:x,overrideFog:L});this.setupShadows(P,B),n.uploadCommonUniforms(h,B,P,null,T);let H={u_matrix:n.transform.calculateProjMatrix(P),u_ground_shadow_factor:I};B.draw(n,h.gl.TRIANGLES,A,ke.disabled,Gt.multiply,qt.disabled,H,"ground_shadow",n.tileExtentBuffer,n.quadTriangleIndexBuffer,n.tileExtentSegments,{},n.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Gt.unblended:Gt.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(n){let a=this.painter.transform,h=a.calculatePosMatrix(n,a.worldSize);return r.a6.multiply(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}calculateShadowPassMatrixFromMatrix(n){return r.a6.multiply(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}setupShadows(n,a,h,f=0){if(!this._enabled)return;let b=this.painter.transform,x=this.painter.context,T=x.gl,I=this._uniformValues,A=new Float64Array(16),k=b.calculatePosMatrix(n,b.worldSize);for(let P=0;P<this._cascades.length;P++)r.a6.multiply(A,this._cascades[P].matrix,k),I[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),x.activeTexture.set(T.TEXTURE0+wn.ShadowMap0+P),this._cascades[P].texture.bind(T.NEAREST,T.CLAMP_TO_EDGE);if(this.useNormalOffset=!!h,this.useNormalOffset){let P=r.bR(n.canonical),L=2/b.tileSize*r.V/br.shadowMapResolution,B=L*this._cascades[0].boundingSphereRadius,H=L*this._cascades[this._cascades.length-1].boundingSphereRadius,G=(h==="vector-tile"?1:3)/Math.pow(2,f-n.canonical.z-(1-b.zoom+Math.floor(b.zoom)));I.u_shadow_normal_offset=[P,B*G,H*G],I.u_shadow_bias=[6e-5,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(x,I)}setupShadowsFromMatrix(n,a,h=!1){if(!this._enabled)return;let f=this.painter.context,b=f.gl,x=this._uniformValues,T=new Float64Array(16);for(let I=0;I<br.cascadeCount;I++)r.a6.multiply(T,this._cascades[I].matrix,n),x[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(T),f.activeTexture.set(b.TEXTURE0+wn.ShadowMap0+I),this._cascades[I].texture.bind(b.NEAREST,b.CLAMP_TO_EDGE);this.useNormalOffset=h,h?(x.u_shadow_normal_offset=[1,5,5],x.u_shadow_bias=[6e-5,.0012,.012]):x.u_shadow_bias=[36e-5,.0012,.012],a.setShadowUniformValues(f,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(n,a,h,f){if(f[2]>=0)return{};let b=function(I,A,k){let P=k/(1<<I.canonical.z);return new r.bS([I.canonical.x*P+I.wrap*k,I.canonical.y*P+I.wrap*k,0],[(I.canonical.x+1)*P+I.wrap*k,(I.canonical.y+1)*P+I.wrap*k,A])}(n,a,h).getCorners(),x=a/-f[2];f[0]<0?(r.N.add(b[0],b[0],[f[0]*x,0,0]),r.N.add(b[3],b[3],[f[0]*x,0,0])):f[0]>0&&(r.N.add(b[1],b[1],[f[0]*x,0,0]),r.N.add(b[2],b[2],[f[0]*x,0,0])),f[1]<0?(r.N.add(b[0],b[0],[0,f[1]*x,0]),r.N.add(b[1],b[1],[0,f[1]*x,0])):f[1]>0&&(r.N.add(b[2],b[2],[0,f[1]*x,0]),r.N.add(b[3],b[3],[0,f[1]*x,0]));let T={};return T.vertices=b,T.planes=[ia(b[1],b[0],b[4]),ia(b[2],b[1],b[5]),ia(b[3],b[2],b[6]),ia(b[0],b[3],b[7])],T}addShadowReceiver(n,a,h){this._receivers.add(n,r.bS.fromTileIdAndHeight(n,a,h))}getMaxCascadeForTile(n){let a=this._receivers.get(n);return a&&a.lastCascade?a.lastCascade:0}}function ia(u,n,a){let h=r.N.sub([],a,n),f=r.N.sub([],u,n),b=r.N.cross([],h,f),x=r.N.length(b);return x===0?[0,0,1,0]:(r.N.scale(b,b,1/x),[b[0],b[1],b[2],-r.N.dot(b,n)])}function Ys(u){let n=u.properties.get("direction"),a=r.bQ(n.x,n.y,n.z);a[2]=r.aa(a[2],0,75);let h=r.bT([a[0],a[1],a[2]]);return r.N.fromValues(h.x,h.y,h.z)}function Oa(u,n){let a=u.properties.get("color"),h=u.properties.get("intensity"),f=u.properties.get("direction"),b=[f.x,f.y,f.z],x=n.properties.get("color"),T=n.properties.get("intensity"),I=Math.max(r.N.dot([0,0,1],b),0),A=[0,0,0];r.N.scale(A,x.toArray01Linear().slice(0,3),T);let k=[0,0,0];return r.N.scale(k,a.toArray01Linear().slice(0,3),I*h),r.bU([A[0]>0?A[0]/(A[0]+k[0]):0,A[1]>0?A[1]/(A[1]+k[1]):0,A[2]>0?A[2]/(A[2]+k[2]):0])}function Rl(u,n,a,h,f,b){let x=u.zoom,T=u.scale,I=u.worldSize,A=1/I,k=u.aspect,P=Math.sqrt(1+k*k)*Math.tan(.5*u.fovX),L=P*P,B=h-a,H=h+a,G,$;L>B/H?(G=h,$=h*P):(G=.5*H*(1+L),$=.5*Math.sqrt(B*B+2*(h*h+a*a)*L+H*H*L*L));let j=u.projection.pixelsPerMeter(u.center.lat,I),W=u._camera.getCameraToWorldMercator(),ee=[0,0,-G*A];r.N.transformMat4(ee,ee,W);let X=$*A,te=u._edgeInsets;if(!(te.left===0&&te.top===0&&te.right===0&&te.bottom===0||te.left===te.right&&te.top===te.bottom)){let at=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?j:1),nt=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,a,h);nt[8]=2*-u.centerOffset.x/u.width,nt[9]=2*u.centerOffset.y/u.height;let _t=new Float64Array(16);r.a6.mul(_t,nt,at);let Rt=new Float64Array(16);r.a6.invert(Rt,_t);let Wt=r.bq.fromInvProjectionMatrix(Rt,I,x,!0);for(let Nt of Wt.points){let Ut=((q=Nt)[0]/=T,q[1]/=T,q[2]=r.bl(q[2],u._center.lat),q);X=Math.max(X,r.N.len(r.N.subtract([],ee,Ut)))}}var q;X*=f/(f-1);let ne=Math.acos(n[2]),le=Math.atan2(-n[0],-n[1]),ce=new an;ce.position=ee,ce.setPitchBearing(ne,le);let me=ce.getWorldToCamera(I,j),Ie=X*I,be=Math.min(u._mercatorZfromZoom(17)*I*-2,-2*Ie),Fe=ce.getCameraToClipOrthographic(-Ie,Ie,-Ie,Ie,be,(Ie+b*j)/n[2]),Re=new Float64Array(16);r.a6.multiply(Re,Fe,me);let Ye=r.N.fromValues(Math.floor(1e6*ee[0])/1e6*I,Math.floor(1e6*ee[1])/1e6*I,0),ve=.5*f,Ae=[0,0,0];r.N.transformMat4(Ae,Ye,Re),r.N.scale(Ae,Ae,ve);let he=[Math.floor(Ae[0]),Math.floor(Ae[1]),Math.floor(Ae[2])],Ce=[0,0,0];r.N.sub(Ce,Ae,he),r.N.scale(Ce,Ce,-1/ve);let Xe=new Float64Array(16);return r.a6.identity(Xe),r.a6.translate(Xe,Xe,Ce),r.a6.multiply(Re,Xe,Re),[Re,Ie]}let Wa=(u,n)=>Pt(u,n&&n.filter(a=>a.identifier!=="source.canvas")),oh=r.ac(Di,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Pl=r.ac(Di,["setCenter","setZoom","setBearing","setPitch"]),$n={version:8,layers:[],sources:{}},Vn={duration:300,delay:0},Zc=new Set(["fill","line","background","hillshade","raster"]);class Xr extends r.E{constructor(n,a={}){super(),this.map=n,this.scope=a.scope||"",this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=r.e({},Vn),this._buildingIndex=new Qu(this),this.crossTileSymbolIndex=new Bd,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new ja,this.dispatcher=a.dispatcher?a.dispatcher:new r.bW(r.bX(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new Nc,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new r.bY(n._requestManager,a.localFontFamily?r.bZ.all:a.localIdeographFontFamily?r.bZ.ideographs:r.bZ.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new Cl(n._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this.dispatcher.broadcast("setReferrer",r.b_());let h=this;this._rtlTextPluginCallback=Xr.registerForPluginStateChange(f=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(b,x)=>{if(r.b$(b),x&&x.every(T=>T))for(let T in h._sourceCaches){let I=h._sourceCaches[T],A=I.getSource().type;A!=="vector"&&A!=="geojson"||I.reload()}})}),this.on("data",f=>{if(f.dataType!=="source"||f.sourceDataType!=="metadata")return;let b=this.getOwnSource(f.sourceId);if(b&&b.vectorLayerIds)for(let x in this._layers){let T=this._layers[x];T.source===b.id&&this._validateLayer(T)}})}loadURL(n,a={}){this.fire(new r.b("dataloading",{dataType:"style"}));let h=typeof a.validate=="boolean"?a.validate:!r.c0(n);n=this.map._requestManager.normalizeStyleURL(n,a.accessToken),this.resolvedImports.add(n);let f=this.importsCache.get(n);if(f)return this._load(f,h);let b=this.map._requestManager.transformRequest(n,r.R.Style);this._request=r.g(b,(x,T)=>{if(this._request=null,x)this.fire(new r.a(x));else if(T)return this.importsCache.set(n,T),this._load(T,h)})}loadJSON(n,a={}){this.fire(new r.b("dataloading",{dataType:"style"})),this._request=r.f.frame(()=>{this._request=null,this._load(n,a.validate!==!1)})}loadEmpty(){this.fire(new r.b("dataloading",{dataType:"style"})),this._load($n,!1)}_loadImports(n,a,h){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let f=[];for(let b of n){let x=this._createFragmentStyle(b),T=new Promise(k=>{x.once("style.import.load",k),x.once("error",k)}).then(()=>this.mergeAll());if(f.push(T),this.resolvedImports.has(b.url)){x.loadEmpty();continue}let I=b.data||this.importsCache.get(b.url);I?x.loadJSON(I,{validate:a}):b.url?x.loadURL(b.url,{validate:a}):x.loadEmpty();let A={style:x,id:b.id,config:b.config};if(h){let k=this.fragments.findIndex(({id:P})=>P===h);this.fragments=this.fragments.slice(0,k).concat(A).concat(this.fragments.slice(k))}else this.fragments.push(A)}return Promise.allSettled(f)}_createFragmentStyle(n){let a=this.scope?r.ag(n.id,this.scope):n.id,h=new Xr(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:n.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return h.setEventedParent(this.map,{style:h}),h}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});let n=this.isRootStyle();this._shouldPrecompile=n,this.fire(new r.b(n?"style.load":"style.import.load"))}_load(n,a){let h=n.schema;if(this.isRootStyle()&&(n.fragment||h&&n.fragment!==!1)){let x=r.e({},$n,{imports:[{id:"basemap",data:n,url:""}]});return void this._load(x,a)}if(this.setConfig(this._config,h),a&&Wa(this,Ko(n)))return;this._loaded=!0,this.stylesheet=r.c1(n);for(let x in n.sources)this.addSource(x,n.sources[x],{validate:!1,isInitialLoad:!0});n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(n.glyphs,this.scope);let f=cc(this.stylesheet.layers);if(this._order=f.map(x=>x.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let x=this.stylesheet.lights[0];this.light=new Dt(x.properties,x.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Dt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let x of f){let T=r.c2(x,this.scope,this.options);T.isConfigDependent&&this._configDependentLayers.add(T.fqid),T.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=T,this._serializedLayers[T.id]=T.serialize();let I=this.getOwnLayerSourceCache(T),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&T.canCastShadows()&&A&&(I.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let b=this.stylesheet.terrain;b&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(b,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.b("data",{dataType:"style"})),n.imports?this._loadImports(n.imports,a).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let n,a,h,f,b,x,T,I;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(A=>{if(A.stylesheet){if(A.light!=null&&(n=A.light),A.stylesheet.lights)for(let k of A.stylesheet.lights)k.type==="ambient"&&A.ambientLight!=null&&(a=A.ambientLight),k.type==="directional"&&A.directionalLight!=null&&(h=A.directionalLight);f=this._prioritizeTerrain(f,A.terrain,A.stylesheet.terrain),A.stylesheet.fog&&A.fog!=null&&(b=A.fog),A.stylesheet.camera!=null&&(I=A.stylesheet.camera),A.stylesheet.projection!=null&&(x=A.stylesheet.projection),A.stylesheet.transition!=null&&(T=A.stylesheet.transition)}}),this.light=n,this.ambientLight=a,this.directionalLight=h,this.fog=b,f===null?delete this.terrain:this.terrain=f,this.camera=I||{"camera-projection":"perspective"},this.projection=x||{name:"mercator"},this.transition=r.e({},Vn,T),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(n){let a=h=>{for(let f of h.fragments)a(f.style);n(h)};a(this)}_prioritizeTerrain(n,a,h){let f=n&&n.drapeRenderMode===0;return h===null?a&&a.drapeRenderMode===0?a:f?n:null:a!=null&&(!n||f||a&&a.drapeRenderMode===1)?a:n}mergeTerrain(){let n;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{n=this._prioritizeTerrain(n,a.terrain,a.stylesheet.terrain)}),n===null?delete this.terrain:this.terrain=n}mergeProjection(){let n;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(n=a.stylesheet.projection)}),this.projection=n||{name:"mercator"}}mergeSources(){let n={},a={},h={};this.forEachFragmentStyle(f=>{for(let b in f._sourceCaches){let x=r.ag(b,f.scope);n[x]=f._sourceCaches[b]}for(let b in f._otherSourceCaches){let x=r.ag(b,f.scope);a[x]=f._otherSourceCaches[b]}for(let b in f._symbolSourceCaches){let x=r.ag(b,f.scope);h[x]=f._symbolSourceCaches[b]}}),this._mergedSourceCaches=n,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=h}mergeLayers(){let n={},a=[],h={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(let x of b._order){let T=b._layers[x];if(T.type==="slot"){let I=r.c3(x);if(n[I])continue;n[I]=[]}T.slot&&n[T.slot]?n[T.slot].push(T):a.push(T)}}),this._mergedOrder=[];let f=(b=[])=>{for(let x of b)if(x.type==="slot"){let T=r.c3(x.id);n[T]&&f(n[T])}else{let T=r.ag(x.id,x.scope);this._mergedOrder.push(T),h[T]=x,x.is3D()&&(this._has3DLayers=!0),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0)}};f(a),this._mergedLayers=h,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(n){return this.stylesheet.camera=r.e({},this.stylesheet.camera,n),this.camera=this.stylesheet.camera,this}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(n){this._spriteRequest=function(a,h,f){let b,x,T,I=r.f.devicePixelRatio>1?"@2x":"",A=r.g(h.transformRequest(h.normalizeSpriteURL(a,I,".json"),r.R.SpriteJSON),(L,B)=>{A=null,T||(T=L,b=B,P())}),k=r.d(h.transformRequest(h.normalizeSpriteURL(a,I,".png"),r.R.SpriteImage),(L,B)=>{k=null,T||(T=L,x=B,P())});function P(){if(T)f(T);else if(b&&x){let L=r.f.getImageData(x),B={};for(let H in b){let{width:G,height:$,x:j,y:W,sdf:ee,pixelRatio:X,stretchX:te,stretchY:q,content:ne}=b[H],le=new r.h({width:G,height:$});r.h.copy(L,le,{x:j,y:W},{x:0,y:0},{width:G,height:$}),B[H]={data:le,pixelRatio:X,sdf:ee,stretchX:te,stretchY:q,content:ne}}f(null,B)}}return{cancel(){A&&(A.cancel(),A=null),k&&(k.cancel(),k=null)}}}(n,this.map._requestManager,(a,h)=>{if(this._spriteRequest=null,a)this.fire(new r.a(a));else if(h)for(let f in h)this.imageManager.addImage(f,this.scope,h[f]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.b("data",{dataType:"style"}))})}_validateLayer(n){let a=this.getOwnSource(n.source);if(!a)return;let h=n.sourceLayer;h&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(h)===-1)&&this.fire(new r.a(new Error(`Source layer "${h}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:n}of this.fragments)if(!n.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((n,a)=>{let h=this.fragments[a];return h&&h.style&&(n.data=h.style.serialize()),n})}_serializeSources(){let n={};for(let a in this._sourceCaches){let h=this._sourceCaches[a].getSource();n[h.id]||(n[h.id]=h.serialize())}return n}_serializeLayers(n){let a=[];for(let h of n){let f=this._layers[h];f&&f.type!=="custom"&&a.push(f.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(let n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(n){return!!this.terrain&&(typeof n.isLayerDraped=="function"?n.isLayerDraped(this.getLayerSourceCache(n)):Zc.has(n.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(n){let a=this.getOwnLayer(n);if(a)return a;this.fire(new r.a(new Error(`The layer '${n}' does not exist in the map's style.`)))}_checkSource(n){let a=this.getOwnSource(n);if(a)return a;this.fire(new r.a(new Error(`The source '${n}' does not exist in the map's style.`)))}update(n){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(n),this.directionalLight&&this.directionalLight.recalculate(n);let a=this.calculateLightsBrightness();n.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));let h=this._changes.isDirty();if(this._changes.isDirty()){let b=this._changes.getLayerUpdatesByScope();for(let x in b){let{updatedIds:T,removedIds:I}=b[x];(T||I)&&this._updateWorkerLayers(x,T,I)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(n),this.light&&this.light.updateTransitions(n),this.ambientLight&&this.ambientLight.updateTransitions(n),this.directionalLight&&this.directionalLight.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._changes.reset()}let f={};for(let b in this._mergedSourceCaches){let x=this._mergedSourceCaches[b];f[b]=x.used,x.used=!1,x.tileCoverLift=0}for(let b of this._mergedOrder){let x=this._mergedLayers[b];if(x.recalculate(n,this._availableImages),!x.isHidden(n.zoom)){let T=this.getLayerSourceCache(x);T&&(T.used=!0,T.tileCoverLift=Math.max(T.tileCoverLift,x.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let T=x.minzoom||0;T<(x.maxzoom||25.5);T++){let I=this.map.painter;if(I){let A=x.getProgramIds();if(!A)continue;for(let k of A){let P=x.getDefaultProgramParams(k,n.zoom);P&&(I.style=this,this.fog&&(I._fogVisible=!0,P.overrideFog=!0,I.getOrCreateProgram(k,P)),I._fogVisible=!1,P.overrideFog=!1,I.getOrCreateProgram(k,P),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(P.overrideRtt=!0,I.getOrCreateProgram(k,P)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let b in f){let x=this._mergedSourceCaches[b];f[b]!==x.used&&x.getSource().fire(new r.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light&&this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new r.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){let n=this._changes.getUpdatedImages();if(n.length){for(let a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n);this._changes.resetUpdatedImages()}}_updateWorkerLayers(n,a,h){let f=this.getFragmentStyle(n);f&&this.dispatcher.broadcast("updateLayers",{layers:a?f._serializeLayers(a):[],scope:n,removedIds:h||[],options:f.options})}setState(n){if(this._checkLoaded(),Wa(this,Ko(n)))return!1;(n=r.c1(n)).layers=cc(n.layers);let a=function(f,b){if(!f)return[{command:Di.setStyle,args:[b]}];let x=[];try{if(!M(f.version,b.version))return[{command:Di.setStyle,args:[b]}];M(f.center,b.center)||x.push({command:Di.setCenter,args:[b.center]}),M(f.zoom,b.zoom)||x.push({command:Di.setZoom,args:[b.zoom]}),M(f.bearing,b.bearing)||x.push({command:Di.setBearing,args:[b.bearing]}),M(f.pitch,b.pitch)||x.push({command:Di.setPitch,args:[b.pitch]}),M(f.sprite,b.sprite)||x.push({command:Di.setSprite,args:[b.sprite]}),M(f.glyphs,b.glyphs)||x.push({command:Di.setGlyphs,args:[b.glyphs]}),M(f.imports,b.imports)||function(P=[],L=[],B){L=L||[];let H=(P=P||[]).map(Ha),G=L.map(Ha),$=P.reduce(Vs,{}),j=L.reduce(Vs,{}),W=H.slice(),ee,X,te,q;for(ee=0,X=0;ee<H.length;ee++)te=H[ee],j.hasOwnProperty(te)?X++:(B.push({command:Di.removeImport,args:[te]}),W.splice(W.indexOf(te,X),1));for(ee=0,X=0;ee<G.length;ee++)te=G[G.length-1-ee],W[W.length-1-ee]!==te&&($.hasOwnProperty(te)?(B.push({command:Di.removeImport,args:[te]}),W.splice(W.lastIndexOf(te,W.length-X),1)):X++,q=W[W.length-ee],B.push({command:Di.addImport,args:[j[te],q]}),W.splice(W.length-ee,0,te));for(let ne of L){let le=$[ne.id];le&&!M(le,ne)&&B.push({command:Di.updateImport,args:[ne.id,ne]})}}(f.imports,b.imports,x),M(f.transition,b.transition)||x.push({command:Di.setTransition,args:[b.transition]}),M(f.light,b.light)||x.push({command:Di.setLight,args:[b.light]}),M(f.fog,b.fog)||x.push({command:Di.setFog,args:[b.fog]}),M(f.projection,b.projection)||x.push({command:Di.setProjection,args:[b.projection]}),M(f.lights,b.lights)||x.push({command:Di.setLights,args:[b.lights]}),M(f.camera,b.camera)||x.push({command:Di.setCamera,args:[b.camera]});let T={},I=[];(function(P,L,B,H){let G;for(G in L=L||{},P=P||{})P.hasOwnProperty(G)&&(L.hasOwnProperty(G)||ea(G,B,H));for(G in L){if(!L.hasOwnProperty(G))continue;let $=L[G];P.hasOwnProperty(G)?M(P[G],$)||(P[G].type==="geojson"&&$.type==="geojson"&&eh(P,L,G)?B.push({command:Di.setGeoJSONSourceData,args:[G,$.data]}):Ju(G,L,B,H)):Ml(G,L,B)}})(f.sources,b.sources,I,T);let A=[];f.layers&&f.layers.forEach(P=>{P.source&&T[P.source]?x.push({command:Di.removeLayer,args:[P.id]}):A.push(P)});let k=f.terrain;k&&T[k.source]&&(x.push({command:Di.setTerrain,args:[void 0]}),k=void 0),x=x.concat(I),M(k,b.terrain)||x.push({command:Di.setTerrain,args:[b.terrain]}),function(P,L,B){L=L||[];let H=(P=P||[]).map(Ha),G=L.map(Ha),$=P.reduce(Vs,{}),j=L.reduce(Vs,{}),W=H.slice(),ee=Object.create(null),X,te,q,ne,le,ce,me;for(X=0,te=0;X<H.length;X++)q=H[X],j.hasOwnProperty(q)?te++:(B.push({command:Di.removeLayer,args:[q]}),W.splice(W.indexOf(q,te),1));for(X=0,te=0;X<G.length;X++)q=G[G.length-1-X],W[W.length-1-X]!==q&&($.hasOwnProperty(q)?(B.push({command:Di.removeLayer,args:[q]}),W.splice(W.lastIndexOf(q,W.length-te),1)):te++,ce=W[W.length-X],B.push({command:Di.addLayer,args:[j[q],ce]}),W.splice(W.length-X,0,q),ee[q]=!0);for(X=0;X<G.length;X++)if(q=G[X],ne=$[q],le=j[q],!ee[q]&&!M(ne,le))if(M(ne.source,le.source)&&M(ne["source-layer"],le["source-layer"])&&M(ne.type,le.type)){for(me in ps(ne.layout,le.layout,B,q,null,Di.setLayoutProperty),ps(ne.paint,le.paint,B,q,null,Di.setPaintProperty),M(ne.slot,le.slot)||B.push({command:Di.setSlot,args:[q,le.slot]}),M(ne.filter,le.filter)||B.push({command:Di.setFilter,args:[q,le.filter]}),M(ne.minzoom,le.minzoom)&&M(ne.maxzoom,le.maxzoom)||B.push({command:Di.setLayerZoomRange,args:[q,le.minzoom,le.maxzoom]}),ne)ne.hasOwnProperty(me)&&me!=="layout"&&me!=="paint"&&me!=="filter"&&me!=="metadata"&&me!=="minzoom"&&me!=="maxzoom"&&me!=="slot"&&(me.indexOf("paint.")===0?ps(ne[me],le[me],B,q,me.slice(6),Di.setPaintProperty):M(ne[me],le[me])||B.push({command:Di.setLayerProperty,args:[q,me,le[me]]}));for(me in le)le.hasOwnProperty(me)&&!ne.hasOwnProperty(me)&&me!=="layout"&&me!=="paint"&&me!=="filter"&&me!=="metadata"&&me!=="minzoom"&&me!=="maxzoom"&&me!=="slot"&&(me.indexOf("paint.")===0?ps(ne[me],le[me],B,q,me.slice(6),Di.setPaintProperty):M(ne[me],le[me])||B.push({command:Di.setLayerProperty,args:[q,me,le[me]]}))}else B.push({command:Di.removeLayer,args:[q]}),ce=W[W.lastIndexOf(q)+1],B.push({command:Di.addLayer,args:[le,ce]})}(A,b.layers,x)}catch(T){console.warn("Unable to compute style diff:",T),x=[{command:Di.setStyle,args:[b]}]}return x}(this.serialize(),n).filter(f=>!(f.command in Pl));if(a.length===0)return!1;let h=a.filter(f=>!(f.command in oh));if(h.length>0)throw new Error(`Unimplemented: ${h.map(f=>f.command).join(", ")}.`);return a.forEach(f=>{this[f.command].apply(this,f.args)}),this.stylesheet=n,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(n,a){return this.getImage(n)?this.fire(new r.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,this.scope,a),this._afterImageUpdated(n),this)}updateImage(n,a){this.imageManager.updateImage(n,this.scope,a)}getImage(n){return this.imageManager.getImage(n,this.scope)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n,this.scope),this._afterImageUpdated(n),this):this.fire(new r.a(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(n),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(n,a,h={}){return this._checkLoaded(),this._validate(St,`models.${n}`,a,null,h)||(this.modelManager.addModel(n,a,this.scope),this._changes.setDirty()),this}hasModel(n){return this.modelManager.hasModel(n,this.scope)}removeModel(n){return this.hasModel(n)?(this.modelManager.removeModel(n,this.scope),this):this.fire(new r.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(n,a,h={}){if(this._checkLoaded(),this.getOwnSource(n)!==void 0)throw new Error(`There is already a source with ID "${n}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(Sa,`sources.${n}`,a,null,h))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);let f=Sr(n,a,this.dispatcher,this);f.scope=this.scope,f.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(f.id),source:f.serialize(),sourceId:f.id}));let b=x=>{let T=(x?"symbol:":"other:")+f.id,I=r.ag(T,this.scope),A=this._sourceCaches[T]=new _a(I,f,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[f.id]=A,A.onAdd(this.map)};b(!1),a.type!=="vector"&&a.type!=="geojson"||b(!0),f.onAdd&&f.onAdd(this.map),h.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(n){this._checkLoaded();let a=this.getOwnSource(n);if(!a)throw new Error("There is no source with this ID");for(let f in this._layers)if(this._layers[f].source===n)return this.fire(new r.a(new Error(`Source "${n}" cannot be removed while layer "${f}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===n)return this.fire(new r.a(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));let h=this.getOwnSourceCaches(n);for(let f of h){let b=r.c3(f.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(f.id),f.fire(new r.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:f.getSource().id})),f.setEventedParent(null),f.clearTiles()}return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getOwnSource(n).setData(a),this._changes.setDirty()}getOwnSource(n){let a=this.getOwnSourceCache(n);return a&&a.getSource()}getOwnSources(){let n=[];for(let a in this._otherSourceCaches){let h=this.getOwnSourceCache(a);h&&n.push(h.getSource())}return n}areTilesLoaded(){let n=this._mergedSourceCaches;for(let a in n){let h=n[a]._tiles;for(let f in h){let b=h[f];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(n){if(this._checkLoaded(),!n)return delete this.ambientLight,void delete this.directionalLight;let a=this._getTransitionParameters();for(let f of n){if(this._validate(Ue,"lights",f))return;switch(f.type){case"ambient":if(this.ambientLight){let b=this.ambientLight;b.set(f),b.updateTransitions(a)}else this.ambientLight=new ho(f,to,this.scope,this.options);break;case"directional":if(this.directionalLight){let b=this.directionalLight;b.set(f),b.updateTransitions(a)}else this.directionalLight=new ho(f,kr,this.scope,this.options)}}let h=new r.K(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(h),this.directionalLight&&this.directionalLight.recalculate(h),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let n=this.directionalLight,a=this.ambientLight;if(!n||!a)return;let h=P=>.2126*(P[0]<=.03928?P[0]/12.92:Math.pow((P[0]+.055)/1.055,2.4))+.7152*(P[1]<=.03928?P[1]/12.92:Math.pow((P[1]+.055)/1.055,2.4))+.0722*(P[2]<=.03928?P[2]/12.92:Math.pow((P[2]+.055)/1.055,2.4)),f=n.properties.get("color").toArray01(),b=n.properties.get("intensity"),x=n.properties.get("direction"),T=1-r.bQ(x.x,x.y,x.z)[2]/90,I=h(f)*b*T,A=a.properties.get("color").toArray01(),k=a.properties.get("intensity");return(I+h(A)*k)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let n=[];return this.directionalLight&&n.push(this.directionalLight.get()),this.ambientLight&&n.push(this.ambientLight.get()),n}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(n){if(!n)return this;if(r.c4(n)){let a=r.c5(n),h=this.fragments.find(({id:b})=>b===a);if(!h)throw new Error(`Style import not found: ${n}`);let f=r.c3(n);return h.style.getFragmentStyle(f)}{let a=this.fragments.find(({id:h})=>h===n);if(!a)throw new Error(`Style import not found: ${n}`);return a.style}}getConfigProperty(n,a){let h=this.getFragmentStyle(n);if(!h)return null;let f=r.ag(a,h.scope),b=h.options.get(f),x=b?b.value||b.default:null;return x?x.serialize():null}setConfigProperty(n,a,h){let f=r.r(h);if(f.result!=="success")return void Wa(this,f.value);let b=f.value.expression,x=this.getFragmentStyle(n);if(!x)return;let T=r.ag(a,x.scope),I=x.options.get(T);I&&(this.options.set(T,Ar(Ht({},I),{value:b})),this.updateConfigDependencies())}setConfig(n,a){if(this._config=n,n||a)if(a)for(let h in a){let f,b,x=r.r(a[h].default);if(x.result==="success"&&(f=x.value.expression),n&&n[h]!==void 0){let L=r.r(n[h]);L.result==="success"&&(b=L.value.expression)}let{minValue:T,maxValue:I,stepValue:A,type:k,values:P}=a[h];if(f){let L=r.ag(h,this.scope);this.options.set(L,{default:f,value:b,minValue:T,maxValue:I,stepValue:A,type:k,values:P})}else this.fire(new r.a(new Error(`No schema defined for config option "${h}".`)))}else this.fire(new r.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let n of this._configDependentLayers){let a=this.getLayer(n);a&&(a.possiblyEvaluateVisibility(),this._updateLayer(a))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(n,a,h={}){this._checkLoaded();let f=n.id;if(this._layers[f])return void this.fire(new r.a(new Error(`Layer with id "${f}" already exists on this map`)));let b;if(n.type==="custom"){if(Wa(this,r.c6(n)))return;b=r.c2(n,this.scope,this.options)}else{if(typeof n.source=="object"&&(this.addSource(f,n.source),n=r.c1(n),n=r.e(n,{source:f})),this._validate(fe,`layers.${f}`,n,{arrayIndex:-1},h))return;b=r.c2(n,this.scope,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:f}}),this._serializedLayers[b.id]=b.serialize()}b.isConfigDependent&&this._configDependentLayers.add(b.fqid);let x=this._order.length;if(a){let k=this._order.indexOf(a);if(k===-1)return void this.fire(new r.a(new Error(`Layer with id "${a}" does not exist on this map.`)));b.slot===this._layers[a].slot?x=k:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,f),this._layerOrderChanged=!0,this._layers[f]=b;let T=this.getOwnLayerSourceCache(b),I=!!this.directionalLight&&this.directionalLight.shadowsEnabled();T&&b.canCastShadows()&&I&&(T.castsShadows=!0);let A=this._changes.getRemovedLayer(b);if(A&&b.source&&T&&b.type!=="custom"){this._changes.discardLayerRemoval(b);let k=r.ag(b.source,b.scope);A.type!==b.type?this._changes.updateSourceCache(k,"clear"):(this._changes.updateSourceCache(k,"reload"),T.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(n,a){this._checkLoaded();let h=this._checkLayer(n);if(!h||n===a)return;let f=this._order.indexOf(n);this._order.splice(f,1);let b=this._order.length;if(a){let x=this._order.indexOf(a);if(x===-1)return void this.fire(new r.a(new Error(`Layer with id "${a}" does not exist on this map.`)));h.slot===this._layers[a].slot?b=x:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,n),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(n){this._checkLoaded();let a=this._checkLayer(n);if(!a)return;a.setEventedParent(null);let h=this._order.indexOf(n);this._order.splice(h,1),delete this._layers[n],delete this._serializedLayers[n],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);let f=this.getOwnLayerSourceCache(a);if(f&&f.castsShadows){let b=!1;for(let x in this._layers)if(this._layers[x].source===a.source&&this._layers[x].canCastShadows()){b=!0;break}f.castsShadows=b}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(n){return this._layers[n]}hasLayer(n){return n in this._mergedLayers}hasLayerType(n){for(let a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,h){this._checkLoaded();let f=this._checkLayer(n);f&&(f.minzoom===a&&f.maxzoom===h||(a!=null&&(f.minzoom=a),h!=null&&(f.maxzoom=h),this._updateLayer(f)))}setSlot(n,a){this._checkLoaded();let h=this._checkLayer(n);h&&h.slot!==a&&(h.slot=a,this._updateLayer(h))}setFilter(n,a,h={}){this._checkLoaded();let f=this._checkLayer(n);if(f&&!M(f.filter,a))return a==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(Be,`layers.${f.id}.filter`,a,{layerType:f.type},h)||(f.filter=r.c1(a),this._updateLayer(f)))}getFilter(n){let a=this._checkLayer(n);if(a)return r.c1(a.filter)}setLayoutProperty(n,a,h,f={}){this._checkLoaded();let b=this._checkLayer(n);if(b&&!M(b.getLayoutProperty(a),h)){if(h!=null&&(!f||f.validate!==!1)&&Wa(b,et.call(Ko,{key:`layers.${n}.layout.${a}`,layerType:b.type,objectKey:a,value:h,styleSpec:r.D,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(a,h),b.isConfigDependent&&this._configDependentLayers.add(b.fqid),this._updateLayer(b)}}getLayoutProperty(n,a){let h=this._checkLayer(n);if(h)return h.getLayoutProperty(a)}setPaintProperty(n,a,h,f={}){this._checkLoaded();let b=this._checkLayer(n);if(!b||M(b.getPaintProperty(a),h)||h!=null&&(!f||f.validate!==!1)&&Wa(b,Ge.call(Ko,{key:`layers.${n}.paint.${a}`,layerType:b.type,objectKey:a,value:h,styleSpec:r.D})))return;let x=b.setPaintProperty(a,h);b.isConfigDependent&&this._configDependentLayers.add(b.fqid),x&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(n,a){let h=this._checkLayer(n);if(h)return h.getPaintProperty(a)}setFeatureState(n,a){this._checkLoaded();let h=n.source,f=n.sourceLayer,b=this._checkSource(h);if(!b)return;let x=b.type;if(x==="geojson"&&f)return void this.fire(new r.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!f)return void this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new r.a(new Error("The feature id parameter must be provided.")));let T=this.getOwnSourceCaches(h);for(let I of T)I.setFeatureState(f,n.id,a)}removeFeatureState(n,a){this._checkLoaded();let h=n.source,f=this._checkSource(h);if(!f)return;let b=f.type,x=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!x)return void this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new r.a(new Error("A feature id is required to remove its specific state property.")));let T=this.getOwnSourceCaches(h);for(let I of T)I.removeFeatureState(x,n.id,a)}getFeatureState(n){this._checkLoaded();let a=n.source,h=n.sourceLayer,f=this._checkSource(a);if(f){if(f.type!=="vector"||h)return n.id===void 0&&this.fire(new r.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(h,n.id);this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(n){return this.stylesheet.transition=r.e({},this.stylesheet.transition,n),this.transition=this.stylesheet.transition,this}getTransition(){return r.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();let n=this.getTerrain(),a=n&&this.terrain&&this.terrain.scope===this.scope?n:this.stylesheet.terrain;return r.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateLayer(n){this._changes.updateLayer(n);let a=this.getLayerSourceCache(n),h=r.ag(n.source,n.scope),f=this._changes.getUpdatedSourceCaches();n.source&&!f[h]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(h,"reload"),a.pause()),n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){let a=T=>this._mergedLayers[T].type==="fill-extrusion"||this._mergedLayers[T].type==="model",h=this.order,f={},b=[];for(let T=h.length-1;T>=0;T--){let I=h[T];if(a(I)){f[I]=T;for(let A of n){let k=A[I];if(k)for(let P of k)b.push(P)}}}b.sort((T,I)=>I.intersectionZ-T.intersectionZ);let x=[];for(let T=h.length-1;T>=0;T--){let I=h[T];if(a(I))for(let A=b.length-1;A>=0;A--){let k=b[A].feature;if(f[k.layer.id]<T)break;x.push(k),b.pop()}else for(let A of n){let k=A[I];if(k)for(let P of k)x.push(P.feature)}}return x}queryRenderedFeatures(n,a,h){a&&a.filter&&this._validate(Be,"queryRenderedFeatures.filter",a.filter,null,a),a.scope=this.scope,a.availableImages=this._availableImages,a.serializedLayers=this._serializedLayers;let f={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new r.a(new Error("parameters.layers must be an Array."))),[];for(let A of a.layers){let k=this._mergedLayers[A];if(!k)return this.fire(new r.a(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];f[k.source]=!0}}let b=[],x=a.serializedLayers||{},T=a&&a.layers?a.layers.some(A=>{let k=this.getLayer(A);return k&&k.is3D()}):this.has3DLayers(),I=gr.createFromScreenPoints(n,h);for(let A in this._mergedSourceCaches){let k=this._mergedSourceCaches[A].getSource();if(!k||k.scope!==a.scope)continue;let P=this._mergedSourceCaches[A].getSource().id;a.layers&&!f[P]||b.push(sc(this._mergedSourceCaches[A],this._mergedLayers,x,I,a,h,T,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(A,k,P,L,B,H,G){let $={},j=H.queryRenderedSymbols(L),W=[];for(let ee of Object.keys(j).map(Number))W.push(G[ee]);W.sort(zs);for(let ee of W){let X=ee.featureIndex.lookupSymbolFeatures(j[ee.bucketInstanceId],k,ee.bucketIndex,ee.sourceLayerIndex,B.filter,B.layers,B.availableImages,A);for(let te in X){let q=$[te]=$[te]||[],ne=X[te];ne.sort((le,ce)=>{let me=ee.featureSortOrder;if(me){let Ie=me.indexOf(le.featureIndex);return me.indexOf(ce.featureIndex)-Ie}return ce.featureIndex-le.featureIndex});for(let le of ne)q.push(le)}}for(let ee in $)$[ee].forEach(X=>{let te=X.feature,q=P(A[ee]);if(!q)return;let ne=q.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=ne});return $}(this._mergedLayers,x,this.getLayerSourceCache.bind(this),I.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(n,a){a&&a.filter&&this._validate(Be,"querySourceFeatures.filter",a.filter,null,a);let h=this.getOwnSourceCaches(n),f=[];for(let b of h)f=f.concat(Da(b,a));return f}addSourceType(n,a,h){return Xr.getSourceType(n)?h(new Error(`A source type called "${n}" already exists.`)):(Xr.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},h):h(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(n,a,h={}){this._checkLoaded();let f=this.light.getLight(),b=!1;for(let T in n)if(!M(n[T],f[T])){b=!0;break}if(!b)return;let x=this._getTransitionParameters();this.light.setLight(n,a,h),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,a=1){if(this._checkLoaded(),!n)return this.terrainSetForDrapingOnly()&&a!==0||delete this.terrain,n===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let h=n,f=n.source==null;if(a===1){if(typeof h.source=="object"){let T="terrain-dem-src";this.addSource(T,h.source),h=r.c1(h),h=r.e(h,{source:T})}let b=r.e({},h),x={};if(this.terrain&&f){b.source=this.terrain.get().source;let T=this.terrain?this.getFragmentStyle(this.terrain.scope):null;T&&(x.style=T.serialize())}if(this._validate(Y,"terrain",b,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!f||this.terrain&&a!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,a),this.fire(new r.b("data",{dataType:"style"}))}else{let b=this.terrain,x=b.get();for(let T of Object.keys(r.D.terrain))!h.hasOwnProperty(T)&&r.D.terrain[T].default&&(h[T]=r.D.terrain[T].default);for(let T in n)if(!M(n[T],x[T])){b.set(n,this.options),this.stylesheet.terrain=n;let I=this._getTransitionParameters({duration:0});b.updateTransitions(I),this.fire(new r.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){let a=this.fog=new To(n,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();let h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let a=this.fog;if(!M(a.get(),n)){a.set(n,this.options),this.stylesheet.fog=a.get();let h=this._getTransitionParameters({duration:0});a.updateTransitions(h)}}else this._createFog(n);this._markersNeedUpdate=!0}_getTransitionParameters(n){return{now:r.f.now(),transition:r.e(this.transition,n)}}updateDrapeFirstLayers(){if(!this.terrain)return;let n=[],a=[];for(let h in this._mergedLayers)this.isLayerDraped(this._mergedLayers[h])?n.push(h):a.push(h);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){let h=this.terrain=new mn(n,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=n),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let f=this._getTransitionParameters({duration:0});h.updateTransitions(f)}_force3DLayerUpdate(){for(let n in this._layers){let a=this._layers[n];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(let n in this._layers){let a=this._layers[n];a.type==="symbol"&&this._updateLayer(a)}}_validate(n,a,h,f,b={}){if(b&&b.validate===!1)return!1;let x=r.e({},this.serialize());return Wa(this,n.call(Ko,r.e({key:a,style:x,value:h,styleSpec:r.D},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(let n in this._mergedLayers)this._mergedLayers[n].setEventedParent(null);for(let n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles(),this._mergedSourceCaches[n].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(n){let a=this.getSourceCaches(n);for(let h of a)h.clearTiles()}clearSources(){for(let n in this._mergedSourceCaches)this._mergedSourceCaches[n].clearTiles()}reloadSource(n){let a=this.getSourceCaches(n);for(let h of a)h.resume(),h.reload()}reloadSources(){for(let n of this.getSources())n.reload&&n.reload()}updateSources(n){let a;this.directionalLight&&(a=Ys(this.directionalLight));for(let h in this._mergedSourceCaches)this._mergedSourceCaches[h].update(n,void 0,void 0,a)}_generateCollisionBoxes(){for(let n in this._sourceCaches){let a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,h,f,b=!1){let x=!1,T=!1,I={},A={};for(let k of this._mergedOrder){let P=this._mergedLayers[k];if(P.type!=="symbol")continue;let L=r.ag(P.source,P.scope),B=I[L];if(!B){let G=this.getLayerSourceCache(P);if(!G)continue;let $=G.getRenderableIds(!0).map(j=>G.getTileByID(j));A[L]=$.slice(),B=I[L]=$.sort((j,W)=>W.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(W.tileID)?-1:1))}let H=this.crossTileSymbolIndex.addLayer(P,B,n.center.lng,n.projection);x=x||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),b=b||this._layerOrderChanged||h===0,this._layerOrderChanged&&this.fire(new r.b("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.f.now(),n.zoom))&&(this.pauseablePlacement=new fc(n,this._mergedOrder,b,a,h,f,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,I,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.f.now()),T=!0),x&&this.pauseablePlacement.placement.setStale()),T||x){this._buildingIndex.onNewFrame(n.zoom);for(let k of this._mergedOrder){let P=this._mergedLayers[k];P.type==="symbol"&&this.placement.updateLayerOpacities(P,I[r.ag(P.source,P.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.f.now())}_releaseSymbolFadeTiles(){for(let n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}addImport(n,a){this._checkLoaded();let h=this.stylesheet.imports=this.stylesheet.imports||[];if(h.findIndex(({id:b})=>b===n.id)!==-1)return this.fire(new r.a(new Error(`Import with id '${n.id}' already exists in the map's style.`)));if(!a)return h.push(n),this._loadImports([n],!0),this;let f=h.findIndex(({id:b})=>b===a);return f===-1?this.fire(new r.a(new Error(`Import with id "${a}" does not exist on this map.`))):(this.stylesheet.imports=h.slice(0,f).concat(n).concat(h.slice(f)),this._loadImports([n],!0,a),this)}updateImport(n,a){this._checkLoaded();let h=this.stylesheet.imports||[],f=this.getImportIndex(n);return f===-1?this:typeof a=="string"?(this.setImportUrl(n,a),this):(a.url&&a.url!==h[f].url&&this.setImportUrl(n,a.url),M(a.config,h[f].config)||this.setImportConfig(n,a.config),M(a.data,h[f].data)||this.setImportData(n,a.data),this)}moveImport(n,a){this._checkLoaded();let h=this.stylesheet.imports||[],f=this.getImportIndex(n);if(f===-1)return this;let b=this.getImportIndex(a);if(b===-1)return this;let x=h[f],T=this.fragments[f];return h=h.filter(({id:I})=>I!==n),this.fragments=this.fragments.filter(({id:I})=>I!==n),this.stylesheet.imports=h.slice(0,b).concat(x).concat(h.slice(b)),this.fragments=this.fragments.slice(0,b).concat(T).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(n,a){this._checkLoaded();let h=this.stylesheet.imports||[],f=this.getImportIndex(n);if(f===-1)return this;h[f].url=a;let b=this.fragments[f];return b.style=this._createFragmentStyle(h[f]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(a),this}setImportData(n,a){this._checkLoaded();let h=this.getImportIndex(n),f=this.stylesheet.imports||[];return h===-1?this:a?(this.fragments[h].style.setState(a),this._reloadImports(),this):(delete f[h].data,this.setImportUrl(n,f[h].url))}setImportConfig(n,a){this._checkLoaded();let h=this.getImportIndex(n),f=this.stylesheet.imports||[];if(h===-1)return this;a?f[h].config=a:delete f[h].config;let b=this.fragments[h],x=b.style.stylesheet&&b.style.stylesheet.schema;return b.config=a,b.style.setConfig(a,x),this.updateConfigDependencies(),this}removeImport(n){this._checkLoaded();let a=this.stylesheet.imports||[],h=this.getImportIndex(n);return h===-1||(a.splice(h,1),this.fragments[h].style._remove(),this.fragments.splice(h,1),this._reloadImports()),this}getImportIndex(n){let a=(this.stylesheet.imports||[]).findIndex(h=>h.id===n);return a===-1&&this.fire(new r.a(new Error(`Import '${n}' does not exist in the map's style and cannot be updated.`))),a}getLayer(n){return this._mergedLayers[n]}getSources(){let n=[];for(let a in this._mergedOtherSourceCaches){let h=this._mergedOtherSourceCaches[a];h&&n.push(h.getSource())}return n}getSource(n,a){let h=this.getSourceCache(n,a);return h&&h.getSource()}getLayerSource(n){let a=this.getLayerSourceCache(n);return a&&a.getSource()}getSourceCache(n,a){let h=r.ag(n,a);return this._mergedOtherSourceCaches[h]}getLayerSourceCache(n){let a=r.ag(n.source,n.scope);return n.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(n){let a=[];return this._mergedOtherSourceCaches[n]&&a.push(this._mergedOtherSourceCaches[n]),this._mergedSymbolSourceCaches[n]&&a.push(this._mergedSymbolSourceCaches[n]),a}updateSourceCaches(){let n=this._changes.getUpdatedSourceCaches();for(let a in n){let h=n[a];h==="reload"?this.reloadSource(a):h==="clear"&&this.clearSource(a)}}updateLayers(n){let a=this._changes.getUpdatedPaintProperties();for(let h of a){let f=this.getLayer(h);f&&f.updateTransitions(n)}}getImages(n,a,h){this.imageManager.getImages(a.icons,a.scope,h),this._updateTilesForChangedImages();let f=b=>{b&&b.setDependencies(a.tileID.key,a.type,a.icons)};f(this._otherSourceCaches[a.source]),f(this._symbolSourceCaches[a.source])}getGlyphs(n,a,h){this.glyphManager.getGlyphs(a.stacks,a.scope,h)}getResource(n,a,h){return r.c9(a,h)}getOwnSourceCache(n){return this._otherSourceCaches[n]}getOwnLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}getOwnSourceCaches(n){let a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){let a=this.getOwnSourceCaches(n);return a.length===0?(this.fire(new r.a(new Error(`There is no source with ID '${n}'`))),!1):a.every(h=>h.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(n=>{n.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Xr.getSourceType=function(u){return Aa[u]},Xr.setSourceType=function(u,n){Aa[u]=n},Xr.registerForPluginStateChange=r.bV;var Ol=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,So=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,na=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,va="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Xs=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Fl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ks=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,ra=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Qs=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);
#ifdef DATA_FORMAT_UINT32
vec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;
#else
vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));
#endif
return velocity/max(u_max_speed,length(velocity));}
#endif`,Ll=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Js=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Za=[];Nl(Ol,Za),Nl(na,Za),Nl(So,Za);let _o={"_prelude_fog.vertex.glsl":Fl,"_prelude_terrain.vertex.glsl":Xs,"_prelude_shadow.vertex.glsl":Ll,"_prelude_fog.fragment.glsl":Ks,"_prelude_shadow.fragment.glsl":Js,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":ra,"_prelude_raster_particle.glsl":Qs},el={};qi("",Xs),qi(Ks,Fl),qi(Js,Ll),qi(ra,""),qi(Qs,"");let zl=qi(So,na),tl=Ol;var Ap={background:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:qi("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:qi(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:qi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:qi("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:qi("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:qi("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:qi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:qi(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:qi(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:qi(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
vec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:qi("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`precision highp float;
#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}`),rasterParticleTexture:qi("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:qi("void main() {}",`#include "_prelude_raster_array.glsl"
#include "_prelude_raster_particle.glsl"
in vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);
#ifdef DATA_FORMAT_UINT32
vec2 dp=vec2(0);
#else
vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;
#endif
vec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(
vec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)
);}`),symbolIcon:qi(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:qi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:qi(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:qi("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:qi(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,va),skyboxGradient:qi(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,va),skyboxCapture:qi(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:qi(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:qi(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:qi(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:qi(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Nl(u,n){let a=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of a)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let f=h.split(" ");for(let b of f)n.includes(b)||n.push(b)}}function qi(u,n){let a=/#include\s+"([^"]+)"/g,h=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,f=n.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);f&&(f=f.map(A=>{let k=A.split(" ");return k[k.length-1]}),f=[...new Set(f)]);let b={},x=[],T=[];if(u=u.replace(a,(A,k)=>(T.push(k),"")),(n=n.replace(a,(A,k)=>(x.push(k),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let I=[...Za];Nl(u,I),Nl(n,I);for(let A of[...x,...T])_o[A]||console.error(`Undefined include: ${A}`),el[A]||(el[A]=[],Nl(_o[A],el[A])),I=[...I,...el[A]];return{fragmentSource:u=u.replace(h,(A,k,P,L,B)=>(b[B]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${B}
in ${P} ${L} ${B};
#else
uniform ${P} ${L} u_${B};
#endif
`:k==="initialize"?`
#ifdef HAS_UNIFORM_u_${B}
    ${P} ${L} ${B} = u_${B};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${P} ${L} ${B};
#endif
`:k==="initialize-attribute"?"":void 0)),vertexSource:n=n.replace(h,(A,k,P,L,B)=>{let H=L==="float"?"vec2":L,G=B.match(/color/)?"color":H;return k==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${B}
in ${P} ${L} a_${B};
#endif
`:b[B]?k==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${P} ${H} a_${B};
out ${P} ${L} ${B};
#else
uniform ${P} ${L} u_${B};
#endif
`:k==="initialize"?G==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${P} ${L} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${G}(a_${B}, u_${B}_t);
#else
    ${P} ${L} ${B} = u_${B};
#endif
`:k==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${P} ${L} a_${B};
    out ${P} ${L} ${B};
#endif
`:k==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${B} = a_${B};
#endif
`:void 0:k==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
in ${P} ${H} a_${B};
#else
uniform ${P} ${L} u_${B};
#endif
`:k==="define-instanced"?G==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${B}0;
in vec4 a_${B}1;
in vec4 a_${B}2;
in vec4 a_${B}3;
#else
uniform ${P} ${L} u_${B};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${P} ${H} a_${B};
#else
uniform ${P} ${L} u_${B};
#endif
`:k==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${P} ${L} ${B} = a_${B};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${P} ${L} ${B} = a_${B};
#else
    ${P} ${L} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${P} ${L} ${B} = unpack_mix_${G}(a_${B}, u_${B}_t);
#else
    ${P} ${L} ${B} = u_${B};
#endif
`}),staticAttributes:f,usedDefines:I,vertexIncludes:x,fragmentIncludes:T}}class Dp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,h,f,b,x,T,I){this.context=n;let A=this.boundPaintVertexBuffers.length!==f.length;for(let P=0;!A&&P<f.length;P++)this.boundPaintVertexBuffers[P]!==f[P]&&(A=!0);let k=this.boundDynamicVertexBuffers.length!==T.length;for(let P=0;!k&&P<T.length;P++)this.boundDynamicVertexBuffers[P]!==T[P]&&(k=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==h||A||k||this.boundIndexBuffer!==b||this.boundVertexOffset!==x)this.freshBind(a,h,f,b,x,T,I);else{n.bindVertexArrayOES.set(this.vao);for(let P of T)P&&(P.bind(),I&&P.instanceCount&&P.setVertexAttribDivisor(n.gl,a,I));b&&b.dynamicDraw&&b.bind()}}freshBind(n,a,h,f,b,x,T){let I=n.numAttributes,A=this.context,k=A.gl;this.vao&&this.destroy(),this.vao=A.gl.createVertexArray(),A.bindVertexArrayOES.set(this.vao),this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=f,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=x,a.enableAttributes(k,n),a.bind(),a.setVertexAttribPointers(k,n,b);for(let P of h)P.enableAttributes(k,n),P.bind(),P.setVertexAttribPointers(k,n,b);for(let P of x)P&&(P.enableAttributes(k,n),P.bind(),P.setVertexAttribPointers(k,n,b),T&&P.instanceCount&&P.setVertexAttribDivisor(k,n,T));f&&f.bind(),A.currentNumAttributes=I}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Jb(u,n){let a=Math.pow(2,n.canonical.z),h=n.canonical.y;return[new r.L(0,h/a).toLngLat().lat,new r.L(0,(h+1)/a).toLngLat().lat]}function ah(u,n,a,h,f,b,x){let T=u.context,I=T.gl,A=a.hillshadeFBO;if(!A)return;u.prepareDrawTile();let k=u.isTileAffectedByFog(n),P=u.getOrCreateProgram("hillshade",{overrideFog:k});T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,A.colorAttachment.get());let L=(($,j,W,ee)=>{let X=W.paint.get("hillshade-shadow-color"),te=W.paint.get("hillshade-highlight-color"),q=W.paint.get("hillshade-accent-color"),ne=W.paint.get("hillshade-emissive-strength"),le=r.bj(W.paint.get("hillshade-illumination-direction"));if(W.paint.get("hillshade-illumination-anchor")==="viewport")le-=$.transform.angle;else if($.style&&$.style.enable3dLights()&&$.style.directionalLight){let me=$.style.directionalLight.properties.get("direction"),Ie=r.bQ(me.x,me.y,me.z);le=r.bj(Ie[1])}let ce=!$.options.moving;return{u_matrix:ee||$.transform.calculateProjMatrix(j.tileID.toUnwrapped(),ce),u_image:0,u_latrange:Jb(0,j.tileID),u_light:[W.paint.get("hillshade-exaggeration"),le],u_shadow:X,u_highlight:te,u_emissive_strength:ne,u_accent:q}})(u,a,h,u.terrain?n.projMatrix:null);u.uploadCommonUniforms(T,P,n.toUnwrapped());let{tileBoundsBuffer:B,tileBoundsIndexBuffer:H,tileBoundsSegments:G}=u.getTileBoundsBuffers(a);P.draw(u,I.TRIANGLES,f,b,x,qt.disabled,L,h.id,B,H,G)}function ig(u,n,a){if(!n.needsDEMTextureUpload)return;let h=u.context,f=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||u.getTileTexture(a.stride);let b=a.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new r.T(h,b,f.R32F,{premultiply:!1}),n.needsDEMTextureUpload=!1}function kp(u,n,a){let h=u.context,f=h.gl;if(!n.dem)return;let b=n.dem;if(h.activeTexture.set(f.TEXTURE1),ig(u,n,b),!n.demTexture)return;n.demTexture.bind(f.NEAREST,f.CLAMP_TO_EDGE);let x=b.dim;h.activeTexture.set(f.TEXTURE0);let T=n.hillshadeFBO;if(!T){let L=new r.T(h,{width:x,height:x,data:null},f.RGBA);L.bind(f.LINEAR,f.CLAMP_TO_EDGE),T=n.hillshadeFBO=h.createFramebuffer(x,x,!0,"renderbuffer"),T.colorAttachment.set(L.texture)}h.bindFramebuffer.set(T.framebuffer),h.viewport.set([0,0,x,x]);let{tileBoundsBuffer:I,tileBoundsIndexBuffer:A,tileBoundsSegments:k}=u.getMercatorTileBoundsBuffers(),P=[];u.linearFloatFilteringSupported()&&P.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:P}).draw(u,f.TRIANGLES,ot.disabled,ke.disabled,Gt.unblended,qt.disabled,((L,B)=>{let H=B.stride,G=r.a6.create();return r.a6.ortho(G,0,r.V,-r.V,0,0,1),r.a6.translate(G,G,[0,-r.V,0]),{u_matrix:G,u_image:1,u_dimension:[H,H],u_zoom:L.overscaledZ}})(n.tileID,b),a.id,I,A,k),n.needsHillshadePrepare=!1}let ng=u=>({u_matrix:new r.bK(u),u_image0:new r.bO(u),u_skirt_height:new r.bN(u),u_ground_shadow_factor:new r.bM(u)}),sh=(u,n,a)=>({u_matrix:u,u_image0:0,u_skirt_height:n,u_ground_shadow_factor:a}),rg=(u,n,a,h,f,b,x,T,I,A,k,P,L,B,H,G)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:a,u_zoom_transition:f,u_merc_center:b,u_image0:0,u_frustum_tl:x,u_frustum_tr:T,u_frustum_br:I,u_frustum_bl:A,u_globe_pos:k,u_globe_radius:P,u_viewport:L,u_grid_matrix:G?Float32Array.from(G):new Float32Array(9),u_skirt_height:B,u_far_z_cutoff:H});function Vd(u,n){return u!=null&&n!=null&&!(!u.hasData()||!n.hasData())&&u.demTexture!=null&&n.demTexture!=null&&u.tileID.key!==n.tileID.key}let Yc=new class{constructor(){this.operations={}}newMorphing(u,n,a,h,f){if(u in this.operations){let b=this.operations[u];b.to.tileID.key!==a.tileID.key&&(b.queued=a)}else this.operations[u]={startTime:h,phase:0,duration:f,from:n,to:a,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;let n=this.operations[u];return{from:n.from,to:n.to,phase:n.phase}}update(u){for(let n in this.operations){let a=this.operations[n];for(a.phase=(u-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,u)){delete this.operations[n];break}}}_nextOp(u,n){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=n,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},Rp={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Pp(u,n,a){if(n===0)return 0;let h=n<1&&a===514?.25/n:1;return 6*Math.pow(1.5,22-u)*Math.max(n,1)*h}function Xc(u,n){let a=1<<u.z;return!n&&(u.x===0||u.x===a-1)||u.y===0||u.y===a-1}let Op=u=>({u_matrix:u});function Fp(u,n,a,h,f){if(f>0){let b=r.f.now(),x=(b-u.timeAdded)/f,T=n?(b-n.timeAdded)/f:-1,I=a.getSource(),A=h.coveringZoomLevel({tileSize:I.tileSize,roundZoom:I.roundZoom}),k=!n||Math.abs(n.tileID.overscaledZ-A)>Math.abs(u.tileID.overscaledZ-A),P=k&&u.refreshedUponExpiration?1:r.aa(k?x:1-T,0,1);return u.refreshedUponExpiration&&x>=1&&(u.refreshedUponExpiration=!1),n?{opacity:1,mix:1-P}:{opacity:P,mix:0}}return{opacity:1,mix:0}}class ey extends _a{constructor(n){let a={type:"raster-dem",maxzoom:n.transform.maxZoom},h=new r.bW(r.bX(),null),f=Sr("mock-dem",a,h,n.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class ty extends _a{constructor(n){let a=Sr("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new r.bW(r.bX(),null),n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,h){if(n.freezeTileCoverage)return;this.transform=n;let f=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,x)=>{if(b[x.key]="",!this._tiles[x.key]){let T=new fo(x,this._source.tileSize*x.overscaleFactor(),n.tileZoom);T.state="loaded",this._tiles[x.key]=T}return b},{});for(let b in this._tiles)b in f||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){let a=this.proxyCachedFBO[n];if(a!==void 0){let h=Object.values(a);this.renderCachePool.push(...h),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class og extends r.am{constructor(n,a,h){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=h}}class iy extends r.ck{constructor(n,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},n.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),n.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[h,f,b]=function(I){let A=new r.aN,k=new r.aw,P=131;A.reserve(17161),k.reserve(33800);let L=r.V/128,B=r.V+L/2,H=B+L;for(let $=-L;$<H;$+=L)for(let j=-L;j<H;j+=L){let W=j<0||j>B||$<0||$>B?24575:0,ee=r.aa(Math.round(j),0,r.V),X=r.aa(Math.round($),0,r.V);A.emplaceBack(ee+W,X)}let G=($,j)=>{let W=j*P+$;k.emplaceBack(W+1,W,W+P),k.emplaceBack(W+P,W+P+1,W+1)};for(let $=1;$<129;$++)for(let j=1;j<129;j++)G(j,$);return[0,129].forEach($=>{for(let j=0;j<130;j++)G(j,$),G($,j)}),[A,k,32768]}(),x=n.context;this.gridBuffer=x.createVertexBuffer(h,r.aP.members),this.gridIndexBuffer=x.createIndexBuffer(f),this.gridSegments=r.aB.simpleSegment(0,0,h.length,f.length),this.gridNoSkirtSegments=r.aB.simpleSegment(0,0,h.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ty(a.map),this.orthoMatrix=r.a6.create(),r.a6.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.V,0,r.V,0,1);let T=x.gl;this._overlapStencilMode=new ke({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ey(a.map),this._pendingGroundEffectLayers=[]}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),this._style=n,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,a,h){if(n&&n.terrain){this._style!==n&&(this.style=n,this._evaluationZoom=void 0);let f=n.terrain.properties,b=n.terrain.drapeRenderMode===0,x=n.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.f.now();let T=n.terrain&&n.terrain.scope,I=f.get("source"),A=b?this._mockSourceCache:n.getSourceCache(I,T);if(!A)return void r.w(`Couldn't find terrain source "${I}".`);if(this.sourceCache=A,this._exaggeration=x?this.calculateExaggeration(a):f.get("exaggeration"),!a.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;let k=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let P=this.getScaledDemTileSize();this.sourceCache.update(a,P,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),a.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(n){let a=this._previousCameraAltitude,h=n.getFreeCameraOptions().position.z/n.pixelsPerMeter*n.worldSize;this._previousCameraAltitude=h;let f=a!=null?h-a:Number.MAX_VALUE;if(Math.abs(f)<2)return this._exaggeration;let b=n.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(b);let T=b-this._previousZoom,I=this._previousUpdateTimestamp,A=b;this._evaluationZoom!=null&&(A=this._evaluationZoom,Math.abs(b-A)>.5&&(T=.5*(b-A+T)),T*f<0&&(A+=T)),this._evaluationZoom=A;let k=x.getExaggeration(A),P=k===x.getExaggeration(Math.max(0,A-.1));if(P&&Math.abs(k-this._exaggeration)<.01)return k;let L=Math.min(.1,.00375*(this._updateTimestamp-I));return(P||k<.1||Math.abs(T)<1e-4)&&(L=Math.min(.2,4*L)),r.U(this._exaggeration,k,L)}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let n in this._style._mergedSourceCaches)this._style._mergedSourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let a=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(r.L.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let f=this.proxyCoords=a.getIds().map(I=>{let A=a.getTileByID(I).tileID;return A.projMatrix=h.calculateProjMatrix(A.toUnwrapped()),A});(function(I,A){let k=A.transform.pointCoordinate(A.transform.getCameraPoint()),P=new r.P(k.x,k.y);I.sort((L,B)=>{if(B.overscaledZ-L.overscaledZ)return B.overscaledZ-L.overscaledZ;let H=new r.P(L.canonical.x+(1<<L.canonical.z)*L.wrap,L.canonical.y),G=new r.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),$=P.mult(1<<L.canonical.z);return $.x-=.5,$.y-=.5,$.distSqr(H)-$.distSqr(G)})})(f,this.painter);let b=this.proxyToSource||{};this.proxyToSource={},f.forEach(I=>{this.proxyToSource[I.key]={}}),this.terrainTileForTile={};let x=this._style._mergedSourceCaches;for(let I in x){let A=x[I];if(!A.used||(A!==this.sourceCache&&this.resetTileLookupCache(A.id),this._setupProxiedCoordsForOrtho(A,n[I],b),A.usedForTerrain))continue;let k=n[I];A.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[a.id]=f.map(I=>new og(I,I.key,this.orthoMatrix)),this._assignTerrainTiles(f),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;let T={};this._visibleDemTiles=[];for(let I of this.proxyCoords){let A=this.terrainTileForTile[I.key];if(!A)continue;let k=A.tileID.key;k in T||(this._visibleDemTiles.push(A),T[k]=k)}}_assignTerrainTiles(n){this._initializing||n.forEach(a=>{if(this.terrainTileForTile[a.key])return;let h=this._findTileCoveringTileID(a,this.sourceCache);h&&(this.terrainTileForTile[a.key]=h)})}_prepareDEMTextures(){let n=this.painter.context,a=n.gl;for(let h in this.terrainTileForTile){let f=this.terrainTileForTile[h],b=f.dem;!b||f.demTexture&&!f.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),ig(this.painter,f,b))}}_prepareDemTileUniforms(n,a,h,f){if(!a||a.demTexture==null)return!1;let b=n.tileID.canonical,x=Math.pow(2,a.tileID.canonical.z-b.z),T=f||"";return h[`u_dem_tl${T}`]=[b.x*x%1,b.y*x%1],h[`u_dem_scale${T}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let n=this.painter.context,a=n.gl;if(!this._emptyDepthBufferTexture){let h=new r.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.T(n,h,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0,a=this._visibleDemTiles.reduce((h,f)=>{if(!f.dem)return h;let b=f.dem.tree.minimums[0];return b>0&&n++,h+b},0);return n?a/n:0}_updateEmptyDEMTexture(){let n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);let h=this._getLoadedAreaMinimum(),[f,b]=(()=>{let T=new r.cm({width:1,height:1},new Float32Array([h]));return[a.R32F,T]})();this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(b,{premultiply:!1}):x=this._emptyDEMTexture=new r.T(n,b,f,{premultiply:!1}),x}setupElevationDraw(n,a,h){let f=this.painter.context,b=f.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};x.u_exaggeration=this.exaggeration();let T=null,I=null,A=1;if(h&&h.morphing&&this._useVertexMorphing){let L=h.morphing.srcDemTile,B=h.morphing.dstDemTile;A=h.morphing.phase,L&&B&&(this._prepareDemTileUniforms(n,L,x,"_prev")&&(I=L),this._prepareDemTileUniforms(n,B,x)&&(T=B))}let k=L=>L&&L.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST,P=L=>{x.u_dem_size=L.size[0]===1?1:L.size[0]-2};if(I&&T)f.activeTexture.set(b.TEXTURE2),T.demTexture.bind(k(T),b.CLAMP_TO_EDGE),f.activeTexture.set(b.TEXTURE4),I.demTexture.bind(k(I),b.CLAMP_TO_EDGE),T.demTexture&&P(T.demTexture),x.u_dem_lerp=A;else{T=this.terrainTileForTile[n.tileID.key],f.activeTexture.set(b.TEXTURE2);let L=this._prepareDemTileUniforms(n,T,x)?T.demTexture:this.emptyDEMTexture;L.bind(k(T),b.CLAMP_TO_EDGE),P(L)}if(f.activeTexture.set(b.TEXTURE3),h&&h.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(x.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),x.u_depth_size_inv=[1,1]),h&&h.useMeterToDem&&T){let L=(1<<T.tileID.canonical.z)*r.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=L}if(h&&h.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),a.setTerrainUniformValues(f,x),this.painter.transform.projection.name==="globe"){let L=this.globeUniformValues(this.painter.transform,n.tileID.canonical,h&&h.useDenormalizedUpVectorScale);a.setGlobeUniformValues(f,L)}}globeUniformValues(n,a,h){let f=n.projection;return{u_tile_tl_up:f.upVector(a,0,0),u_tile_tr_up:f.upVector(a,r.V,0),u_tile_br_up:f.upVector(a,r.V,r.V),u_tile_bl_up:f.upVector(a,0,r.V),u_tile_up_scale:h?r.cl(1):f.upVectorScale(a,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){let a=this.painter,h=this.painter.context;n.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(f,b,x,T,I){if(f.transform.projection.name==="globe")(function(A,k,P,L,B){let H=A.context,G=H.gl,$,j,W=A.transform,ee=r.cd(A,H,W),X=(Fe,Re)=>{if(j===Re)return;let Ye=[Rp[Re],"PROJECTION_GLOBE_VIEW"];ee&&Ye.push("CUSTOM_ANTIALIASING");let ve=A.isTileAffectedByFog(Fe);$=A.getOrCreateProgram("globeRaster",{defines:Ye,overrideFog:ve}),j=Re},te=A.colorModeForRenderPass(),q=new ot(G.LEQUAL,ot.ReadWrite,A.depthRangeFor3D);Yc.update(B);let ne=r.ce(W),le=[r.a5(W.center.lng),r.ae(W.center.lat)],ce=A.globeSharedBuffers,me=[W.width*r.f.devicePixelRatio,W.height*r.f.devicePixelRatio],Ie=Float32Array.from(W.globeMatrix),be={useDenormalizedUpVectorScale:!0};{let Fe=A.transform,Re=Pp(Fe.zoom,k.exaggeration(),k.sourceCache._source.tileSize);j=-1;let Ye=G.TRIANGLES;for(let ve of L){let Ae=P.getTile(ve),he=ke.disabled,Ce=k.prevTerrainTileForTile[ve.key],Xe=k.terrainTileForTile[ve.key];Vd(Ce,Xe)&&Yc.newMorphing(ve.key,Ce,Xe,B,250),H.activeTexture.set(G.TEXTURE0),Ae.texture&&Ae.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let at=Yc.getMorphValuesForProxy(ve.key),nt=at?1:0;at&&r.j(be,{morphing:{srcDemTile:at.from,dstDemTile:at.to,phase:r.cc(at.phase)}});let _t=r.cf(ve.canonical),Rt=r.cg(_t.getCenter().lat),Wt=r.ch(ve.canonical,_t,Rt,Fe.worldSize/Fe._pixelsPerMercatorPixel),Nt=r.aT(r.ci(ve.canonical)),Ut=rg(Fe.expandedFarZProjMatrix,Ie,ne,Nt,r.S(Fe.zoom),le,Fe.frustumCorners.TL,Fe.frustumCorners.TR,Fe.frustumCorners.BR,Fe.frustumCorners.BL,Fe.globeCenterInViewSpace,Fe.globeRadius,me,Re,Fe._farZ,Wt);if(X(ve,nt),$&&(k.setupElevationDraw(Ae,$,be),A.uploadCommonUniforms(H,$,ve.toUnwrapped()),ce)){let[_i,ri,ci]=ce.getGridBuffers(Rt,Re!==0);$.draw(A,Ye,q,he,te,qt.backCCW,Ut,"globe_raster",_i,ri,ci)}}}if(ce&&(A.renderDefaultNorthPole||A.renderDefaultSouthPole)){let Fe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ee&&Fe.push("CUSTOM_ANTIALIASING"),$=A.getOrCreateProgram("globeRaster",{defines:Fe});for(let Re of L){let{x:Ye,y:ve,z:Ae}=Re.canonical,he=ve===0,Ce=ve===(1<<Ae)-1,[Xe,at,nt,_t]=ce.getPoleBuffers(Ae,!1);if(_t&&(he||Ce)){let Rt=P.getTile(Re);H.activeTexture.set(G.TEXTURE0),Rt.texture&&Rt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let Wt=r.cj(Ae,Ye,W),Nt=r.aT(r.ci(Re.canonical)),Ut=(_i,ri)=>_i.draw(A,G.TRIANGLES,q,ke.disabled,te,qt.disabled,rg(W.expandedFarZProjMatrix,Wt,Wt,Nt,0,le,W.frustumCorners.TL,W.frustumCorners.TR,W.frustumCorners.BR,W.frustumCorners.BL,W.globeCenterInViewSpace,W.globeRadius,me,0,W._farZ),"globe_pole_raster",ri,nt,_t);k.setupElevationDraw(Rt,$,be),A.uploadCommonUniforms(H,$,Re.toUnwrapped()),he&&A.renderDefaultNorthPole&&Ut($,Xe),Ce&&A.renderDefaultSouthPole&&(Wt=r.a6.scale(r.a6.create(),Wt,[1,-1,1]),Ut($,at))}}}})(f,b,x,T,I);else{let A=f.context,k=A.gl,P,L,B=f.shadowRenderer,H=ir(f,f.longestCutoffRange),G=te=>{if(L===te)return;let q=[];q.push(Rp[te]),H.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),P=f.getOrCreateProgram("terrainRaster",{defines:q}),L=te},$=f.colorModeForRenderPass(),j=new ot(k.LEQUAL,ot.ReadWrite,f.depthRangeFor3D);Yc.update(I);let W=f.transform,ee=Pp(W.zoom,b.exaggeration(),b.sourceCache._source.tileSize),X=[0,0,0];if(B){let te=f.style.directionalLight,q=f.style.ambientLight;te&&q&&(X=Oa(te,q))}{L=-1;let te=k.TRIANGLES,[q,ne]=[b.gridIndexBuffer,b.gridSegments];for(let le of T){let ce=x.getTile(le),me=ke.disabled,Ie=b.prevTerrainTileForTile[le.key],be=b.terrainTileForTile[le.key];Vd(Ie,be)&&Yc.newMorphing(le.key,Ie,be,I,250),A.activeTexture.set(k.TEXTURE0),ce.texture&&ce.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);let Fe=Yc.getMorphValuesForProxy(le.key),Re=Fe?1:0,Ye;Fe&&(Ye={morphing:{srcDemTile:Fe.from,dstDemTile:Fe.to,phase:r.cc(Fe.phase)}});let ve=sh(le.projMatrix,Xc(le.canonical,W.renderWorldCopies)?ee/10:ee,X);if(G(Re),!P)continue;b.setupElevationDraw(ce,P,Ye);let Ae=le.toUnwrapped();B&&B.setupShadows(Ae,P),f.uploadCommonUniforms(A,P,Ae,null,H),P.draw(f,te,j,me,$,qt.backCCW,ve,"terrain_raster",b.gridBuffer,q,ne)}}}}(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;let a=this.painter,h=this.painter.context,f=this.proxySourceCache,b=this.proxiedCoords[f.id],x=this._drapedRenderBatches.shift(),T=a.style.order,I=[],A=0;for(let k of b){let P=f.getTileByID(k.proxyTileKey),L=f.proxyCachedFBO[k.key]?f.proxyCachedFBO[k.key][n]:void 0,B=L!==void 0?f.renderCache[L]:this.pool[A++],H=L!==void 0;if(P.texture=B.tex,H&&!B.dirty){I.push(P.tileID);continue}let G;h.bindFramebuffer.set(B.fb.framebuffer),this.renderedToTile=!1,B.dirty&&(h.clear({color:r.ax.transparent,stencil:0}),B.dirty=!1);for(let $=x.start;$<=x.end;++$){let j=a.style._mergedLayers[T[$]];if(j.isHidden(a.transform.zoom))continue;let W=a.style.getLayerSourceCache(j),ee=W?this.proxyToSource[k.key][W.id]:[k];if(!ee)continue;let X=ee;h.viewport.set([0,0,B.fb.width,B.fb.height]),G!==(W?W.id:null)&&(this._setupStencil(B,ee,j,W),G=W?W.id:null),a.renderLayer(a,W,j,X)}if(this._drapedRenderBatches.length===0)for(let $ of this._pendingGroundEffectLayers){let j=a.style._mergedLayers[T[$]];if(j.isHidden(a.transform.zoom))continue;let W=a.style.getLayerSourceCache(j),ee=W?this.proxyToSource[k.key][W.id]:[k];if(!ee)continue;let X=ee;h.viewport.set([0,0,B.fb.width,B.fb.height]),G!==(W?W.id:null)&&(this._setupStencil(B,ee,j,W),G=W?W.id:null),a.renderLayer(a,W,j,X)}this.renderedToTile?(B.dirty=!0,I.push(P.tileID)):H||--A,A===5&&(A=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,a.width,a.height]),x.end+1}postRender(){}isLayerOrderingCorrect(n){let a=n.order.length,h=-1,f=a;for(let b=0;b<a;++b)this._style.isLayerDraped(n._mergedLayers[n.order[b]])?h=Math.max(h,b):f=Math.min(f,b);return f>h}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{n=Math.min(n,a.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,a,h){if(!this._visibleDemTiles)return null;let f=this._visibleDemTiles.filter(b=>b.dem).map(b=>{let x=b.tileID,T=1<<x.overscaledZ,{x:I,y:A}=x.canonical,k=I/T,P=(I+1)/T,L=A/T,B=(A+1)/T;return{minx:k,miny:L,maxx:P,maxy:B,t:b.dem.tree.raycastRoot(k,L,P,B,n,a,h),tile:b}});f.sort((b,x)=>(b.t!==null?b.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(let b of f){if(b.t==null)return null;let x=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,a,h);if(x!=null)return x}return null}_createFBO(){let n=this.painter.context,a=n.gl,h=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);let f=new r.T(n,{width:h[0],height:h[1],data:null},a.RGBA);f.bind(a.LINEAR,a.CLAMP_TO_EDGE);let b=n.createFramebuffer(h[0],h[1],!0,null);return b.colorAttachment.set(f.texture),b.depthAttachment=new oi(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:f,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let n in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{let a=this._style._mergedLayers[n],h=a.isHidden(this.painter.transform.zoom);return a.type==="custom"?!h&&a.shouldRedrape():!h&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(let h of this._style.getSources())if(h instanceof ht){n=!0;break}if(!n)return;let a={};for(let h=0;h<this._style.order.length;++h){let f=this._style._mergedLayers[this._style.order[h]],b=this._style.getLayerSourceCache(f);if(b&&!a[b.id]&&!f.isHidden(this.painter.transform.zoom)&&f.type==="line"&&f.widthExpression()instanceof r.Z){a[b.id]=!0;for(let x of this.proxyCoords){let T=this.proxyToSource[x.key][b.id];if(T)for(let I of T)this._clearRenderCacheForTile(b.id,I)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(let h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h]._source instanceof gt){n=!0;break}if(!n)return;let a={};for(let h=0;h<this._style.order.length;++h){let f=this._style._mergedLayers[this._style.order[h]],b=this._style.getLayerSourceCache(f);if(!b||a[b.id]||f.isHidden(this.painter.transform.zoom)||f.type!=="raster")continue;let x=f.paint.get("raster-fade-duration");for(let T of this.proxyCoords){let I=this.proxyToSource[T.key][b.id];if(I)for(let A of I){let k=Fp(b.getTile(A),b.findLoadedParent(A,0),b,this.painter.transform,x);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(b.id,A)}}}}_setupDrapedRenderBatches(){let n=this._style.order,a=n.length;if(a===0)return;let h=[];this._pendingGroundEffectLayers=[];let f,b=0,x=this._style._mergedLayers[n[b]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++b<a;)x=this._style._mergedLayers[n[b]];for(;b<a;++b){let T=this._style._mergedLayers[n[b]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?f===void 0&&(f=b):(T.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),f!==void 0&&(h.push({start:f,end:b-1}),f=void 0)))}if(f!==void 0&&h.push({start:f,end:b-1}),h.length!==0){let T=h[h.length-1];this._pendingGroundEffectLayers.every(I=>I>T.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=h}_setupRenderCache(n){let a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){let x=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let T=0;T<x.length;++T){let I=Object.values(x[T]);a.renderCachePool.push(...I)}}return}this._clearRasterLayersFromRenderCache();let h=this.proxyCoords,f=this._tilesDirty;for(let x=h.length-1;x>=0;x--){let T=h[x];if(a.getTileByID(T.key),a.proxyCachedFBO[T.key]!==void 0){let I=n[T.key],A=this.proxyToSource[T.key],k=0;for(let P in A){let L=A[P],B=I[P];if(!B||B.length!==L.length||L.some((H,G)=>H!==B[G]||f[P]&&f[P].hasOwnProperty(H.key))){k=-1;break}++k}for(let P in a.proxyCachedFBO[T.key])a.renderCache[a.proxyCachedFBO[T.key][P]].dirty=k<0||k!==Object.values(I).length}}let b=[...this._drapedRenderBatches];b.sort((x,T)=>T.end-T.start-(x.end-x.start));for(let x of b)for(let T of h){if(a.proxyCachedFBO[T.key])continue;let I=a.renderCachePool.pop();I===void 0&&a.renderCache.length<50&&(I=a.renderCache.length,a.renderCache.push(this._createFBO())),I!==void 0&&(a.proxyCachedFBO[T.key]={},a.proxyCachedFBO[T.key][x.start]=I,a.renderCache[I].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,h,f){if(!f||!this._sourceTilesOverlap[f.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let b=this.painter.context,x=b.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let T;if(h.isTileClipped())T=a.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):ke.disabled}_renderTileClippingMasks(n,a){let h=this.painter,f=this.painter.context,b=f.gl;h._tileClippingMaskIDs={},f.setColorMode(Gt.disabled),f.setDepthMode(ot.disabled);let x=h.getOrCreateProgram("clippingMask");for(let T of n){let I=h._tileClippingMaskIDs[T.key]=--a;x.draw(h,b.TRIANGLES,ot.disabled,new ke({func:b.ALWAYS,mask:0},I,255,b.KEEP,b.KEEP,b.REPLACE),Gt.disabled,qt.disabled,Op(T.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(n){let a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;let h=[n.x,n.y,1,1];r.a7.transformMat4(h,h,a.pixelMatrixInverse),r.a7.scale(h,h,1/h[3]),h[0]/=a.worldSize,h[1]/=a.worldSize;let f=a._camera.position,b=r.bl(1,a.center.lat),x=[f[0],f[1],f[2]/b,0],T=r.N.subtract([],h.slice(0,3),x);r.N.normalize(T,T);let I=this.raycast(x,T,this._exaggeration);return I!==null&&I?(r.N.scaleAndAdd(x,x,T,I),x[3]=x[2],x[2]*=b,x):null}drawDepth(){let n=this.painter,a=n.context,h=this.proxySourceCache,f=Math.ceil(n.width),b=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===f&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let x=a.gl,T=a.createFramebuffer(f,b,!0,"renderbuffer");a.activeTexture.set(x.TEXTURE0);let I=new r.T(a,{width:f,height:b,data:null},x.RGBA);I.bind(x.NEAREST,x.CLAMP_TO_EDGE),T.colorAttachment.set(I.texture);let A=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,f,b);T.depthAttachment.set(A),this._depthFBO=T,this._depthTexture=I}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,f,b]),function(x,T,I,A){if(x.transform.projection.name==="globe")return;let k=x.context,P=k.gl;k.clear({depth:1});let L=x.getOrCreateProgram("terrainDepth"),B=new ot(P.LESS,ot.ReadWrite,x.depthRangeFor3D);for(let H of A){let G=I.getTile(H),$=sh(H.projMatrix,0,[0,0,0]);T.setupElevationDraw(G,L),L.draw(x,P.TRIANGLES,B,ke.disabled,Gt.unblended,qt.backCCW,$,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(n,this,h,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,a,h){if(n.getSource()instanceof r.ap)return this._setupProxiedCoordsForImageSource(n,a,h);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};let f=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let I=0;I<b.length;I++){let A=b[I],k=this._findTileCoveringTileID(A,n);if(k){let P=this._createProxiedId(A,k,h[A.key]&&h[A.key][n.id]);f.push(P),this.proxyToSource[A.key][n.id]=[P]}}let x=!1,T=new Set;for(let I=0;I<a.length;I++){let A=n.getTile(a[I]);if(!A||!A.hasData())continue;let k=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==A.tileID.canonical.z){let P=this.proxyToSource[k.tileID.key][n.id],L=this._createProxiedId(k.tileID,A,h[k.tileID.key]&&h[k.tileID.key][n.id]);P?P.splice(P.length-1,0,L):this.proxyToSource[k.tileID.key][n.id]=[L];let B=this.proxyToSource[k.tileID.key][n.id];T.has(B)||T.add(B),f.push(L),x=!0}}if(this._sourceTilesOverlap[n.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(let I of T)I.sort((A,k)=>k.overscaledZ-A.overscaledZ)}_setupProxiedCoordsForImageSource(n,a,h){if(!n.getSource().loaded())return;let f=this.proxiedCoords[n.id]=[],b=this.proxyCoords,x=n.getSource(),T=x.tileID;if(!T)return;let I=new r.P(T.x,T.y)._div(1<<T.z),A=x.coordinates.map(r.L.fromLngLat).reduce((P,L)=>(P.min.x=Math.min(P.min.x,L.x-I.x),P.min.y=Math.min(P.min.y,L.y-I.y),P.max.x=Math.max(P.max.x,L.x-I.x),P.max.y=Math.max(P.max.y,L.y-I.y),P),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(P,L)=>{let B=P.wrap+P.canonical.x/(1<<P.canonical.z),H=P.canonical.y/(1<<P.canonical.z),G=r.V/(1<<P.canonical.z),$=L.wrap+L.canonical.x/(1<<L.canonical.z),j=L.canonical.y/(1<<L.canonical.z);return B+G<$+A.min.x||B>$+A.max.x||H+G<j+A.min.y||H>j+A.max.y};for(let P=0;P<b.length;P++){let L=b[P];for(let B=0;B<a.length;B++){let H=n.getTile(a[B]);if(!H||!H.hasData()||k(L,H.tileID))continue;let G=this._createProxiedId(L,H,h[L.key]&&h[L.key][n.id]),$=this.proxyToSource[L.key][n.id];$?$.push(G):this.proxyToSource[L.key][n.id]=[G],f.push(G)}}}_createProxiedId(n,a,h){let f=this.orthoMatrix;if(h){let b=h.find(x=>x.key===a.tileID.key);if(b)return b}if(a.tileID.key!==n.key){let b=n.canonical.z-a.tileID.canonical.z,x,T,I;f=r.a6.create();let A=a.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(x=r.V>>b,T=x*((a.tileID.canonical.x<<b)-n.canonical.x+A),I=x*((a.tileID.canonical.y<<b)-n.canonical.y)):(x=r.V<<-b,T=r.V*(a.tileID.canonical.x-(n.canonical.x+A<<-b)),I=r.V*(a.tileID.canonical.y-(n.canonical.y<<-b))),r.a6.ortho(f,0,x,0,x,0,1),r.a6.translate(f,f,[T,I,0])}return new og(a.tileID,n.key,f)}_findTileCoveringTileID(n,a){let h=a.getTile(n);if(h&&h.hasData())return h;let f=this._findCoveringTileCache[a.id],b=f[n.key];if(h=b?a.getTileByID(b):null,h&&h.hasData()||b===null)return h;let x=h?h.tileID:n,T=x.overscaledZ,I=a.getSource().minzoom,A=[];if(!b){let P=a.getSource().maxzoom;if(n.canonical.z>=P){let L=n.canonical.z-P;a.getSource().reparseOverscaled?(T=Math.max(n.canonical.z+2,a.transform.tileZoom),x=new r.am(T,n.wrap,P,n.canonical.x>>L,n.canonical.y>>L)):L!==0&&(T=P,x=new r.am(T,n.wrap,P,n.canonical.x>>L,n.canonical.y>>L))}x.key!==n.key&&(A.push(x.key),h=a.getTile(x))}let k=P=>{A.forEach(L=>{f[L]=P}),A.length=0};for(T-=1;T>=I&&(!h||!h.hasData());T--){h&&k(h.tileID.key);let P=x.calculateScaledKey(T);if(h=a.getTileByID(P),h&&h.hasData())break;let L=f[P];if(L===null)break;L===void 0?A.push(P):h=a.getTileByID(L)}return k(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let h=this._tilesDirty[n];h||(h=this._tilesDirty[n]={}),h[a.key]=!0}}function Lp(u,n,a){let h=function(T,I,A){let k=r.N.dot(I,T),P=r.N.dot(A,[.2126,.7152,.0722]),L=(H,G,$)=>(1-$)*H+$*G,B=L(1-.3*Math.min(P,1),1,Math.min(k+1,1));return L(.92,1,Math.asin(r.aa(I[2],-1,1))/Math.PI+.5)*B}(u,[0,0,1],n),f=[0,0,0];r.N.scale(f,a.slice(0,3),h);let b=[0,0,0];r.N.scale(b,n.slice(0,3),u[2]);let x=[0,0,0];return r.N.add(x,f,b),r.bU(x)}let zp=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ag=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Np{static cacheKey(n,a,h,f){let b=`${a}${f?f.cacheKey:""}`;for(let x of h)n.usedDefines.includes(x)&&(b+=`/${x}`);return b}constructor(n,a,h,f,b,x,T){let I=n.gl;this.program=I.createProgram(),this.configuration=f,this.name=a,this.fixedDefines=[...x];let A=f?f.getBinderAttributes():[],k=(h.staticAttributes||[]).concat(A),P=f?f.defines():[];P=P.concat(x.map(j=>`#define ${j}`));let L=`#version 300 es
`,B=L+P.concat("precision mediump float;",tl,zl.fragmentSource).join(`
`);for(let j of h.fragmentIncludes)B+=`
${_o[j]}`;B+=`
${h.fragmentSource}`;let H=L+P.concat("precision highp float;",tl,zl.vertexSource).join(`
`);for(let j of h.vertexIncludes)H+=`
${_o[j]}`;H+=`
${h.vertexSource}`;let G=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(G,B),I.compileShader(G),I.attachShader(this.program,G);let $=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource($,H),I.compileShader($),I.attachShader(this.program,$),this.attributes={},this.numAttributes=k.length;for(let j=0;j<this.numAttributes;j++)if(k[j]){let W=k[j].startsWith("a_")?k[j]:`a_${k[j]}`;I.bindAttribLocation(this.program,j,W),this.attributes[W]=j}T&&T.shaderVaryings.length>0&&I.transformFeedbackVaryings(this.program,T.shaderVaryings,T.bufferMode),I.linkProgram(this.program),I.deleteShader($),I.deleteShader(G),this.fixedUniforms=b(n),this.binderUniforms=f?f.getUniforms(n):[],x.includes("TERRAIN")&&(this.terrainUniforms=(j=>({u_dem:new r.bO(j),u_dem_prev:new r.bO(j),u_dem_tl:new r.bL(j),u_dem_scale:new r.bN(j),u_dem_tl_prev:new r.bL(j),u_dem_scale_prev:new r.bN(j),u_dem_size:new r.bN(j),u_dem_lerp:new r.bN(j),u_exaggeration:new r.bN(j),u_depth:new r.bO(j),u_depth_size_inv:new r.bL(j),u_meter_to_dem:new r.bN(j),u_label_plane_matrix_inv:new r.bK(j)}))(n)),x.includes("GLOBE")&&(this.globeUniforms=(j=>({u_tile_tl_up:new r.bM(j),u_tile_tr_up:new r.bM(j),u_tile_br_up:new r.bM(j),u_tile_bl_up:new r.bM(j),u_tile_up_scale:new r.bN(j)}))(n)),x.includes("FOG")&&(this.fogUniforms=(j=>({u_fog_matrix:new r.bK(j),u_fog_range:new r.bL(j),u_fog_color:new r.bP(j),u_fog_horizon_blend:new r.bN(j),u_fog_vertical_limit:new r.bL(j),u_fog_temporal_offset:new r.bN(j),u_frustum_tl:new r.bM(j),u_frustum_tr:new r.bM(j),u_frustum_br:new r.bM(j),u_frustum_bl:new r.bM(j),u_globe_pos:new r.bM(j),u_globe_radius:new r.bN(j),u_globe_transition:new r.bN(j),u_is_globe:new r.bO(j),u_viewport:new r.bL(j)}))(n)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(j=>({u_cutoff_params:new r.bP(j)}))(n)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(j=>({u_lighting_ambient_color:new r.bM(j),u_lighting_directional_dir:new r.bM(j),u_lighting_directional_color:new r.bM(j),u_ground_radiance:new r.bM(j)}))(n)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(j=>({u_light_matrix_0:new r.bK(j),u_light_matrix_1:new r.bK(j),u_fade_range:new r.bL(j),u_shadow_normal_offset:new r.bM(j),u_shadow_intensity:new r.bN(j),u_shadow_texel_size:new r.bN(j),u_shadow_map_resolution:new r.bN(j),u_shadow_direction:new r.bM(j),u_shadow_bias:new r.bM(j),u_shadowmap_0:new r.bO(j),u_shadowmap_1:new r.bO(j)}))(n))}}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;let h=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let f in a)h[f]&&h[f].set(this.program,f,a[f])}}setGlobeUniformValues(n,a){if(!this.globeUniforms)return;let h=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let f in a)h[f]&&h[f].set(this.program,f,a[f])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;let h=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let f in a)h[f].set(this.program,f,a[f])}}setCutoffUniformValues(n,a){if(!this.cutoffUniforms)return;let h=this.cutoffUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let f in a)h[f].set(this.program,f,a[f])}}setLightsUniformValues(n,a){if(!this.lightsUniforms)return;let h=this.lightsUniforms;if(!this.failedToCreate){n.program.set(this.program);for(let f in a)h[f].set(this.program,f,a[f])}}setShadowUniformValues(n,a){if(this.failedToCreate||!this.shadowUniforms)return;let h=this.shadowUniforms;n.program.set(this.program);for(let f in a)h[f].set(this.program,f,a[f])}_drawDebugWireframe(n,a,h,f,b,x,T,I,A,k){let P=n.options.wireframe;if(P.terrain===!1&&P.layers2D===!1&&P.layers3D===!1)return;let L=n.context;if(!(!(!P.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!P.layers2D||n._terrain&&n._terrain.renderingToTexture||!zp.includes(this.name))||!(!P.layers3D||!ag.includes(this.name))))return;let B=L.gl,H=n.wireframeDebugCache.getLinesFromTrianglesBuffer(n.frameCounter,b,L);if(!H)return;let G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");let $=n.getOrCreateProgram(this.name,{config:this.configuration,defines:G});L.program.set($.program);let j=(X,te,q)=>{if(te[X]&&q[X])for(let ne in te[X])q[X][ne]&&q[X][ne].set(q.program,ne,te[X][ne].current)};A&&A.setUniforms($.program,L,$.binderUniforms,T,{zoom:I}),j("fixedUniforms",this,$),j("terrainUniforms",this,$),j("globeUniforms",this,$),j("fogUniforms",this,$),j("lightsUniforms",this,$),j("shadowUniforms",this,$),H.bind(),L.setColorMode(new Gt([B.ONE,B.ONE_MINUS_SRC_ALPHA,B.ZERO,B.ONE],r.ax.transparent,[!0,!0,!0,!1])),L.setDepthMode(new ot(a.func===B.LESS?B.LEQUAL:a.func,ot.ReadOnly,a.range)),L.setStencilMode(ke.disabled);let W=3*x.primitiveLength*2,ee=3*x.primitiveOffset*2*2;k&&k>1?B.drawElementsInstanced(B.LINES,W,B.UNSIGNED_SHORT,ee,k):B.drawElements(B.LINES,W,B.UNSIGNED_SHORT,ee),b.bind(),L.program.set(this.program),L.setDepthMode(a),L.setStencilMode(h),L.setColorMode(f)}draw(n,a,h,f,b,x,T,I,A,k,P,L,B,H,G,$,j){let W=n.context,ee=W.gl;if(this.failedToCreate)return;W.program.set(this.program),W.setDepthMode(h),W.setStencilMode(f),W.setColorMode(b),W.setCullFace(x);for(let ne of Object.keys(this.fixedUniforms))this.fixedUniforms[ne].set(this.program,ne,T[ne]);H&&H.setUniforms(this.program,W,this.binderUniforms,L,{zoom:B});let X={[ee.POINTS]:1,[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[a],te=j&&j.length>0;if(te){for(let ne of j)ee.bindBufferBase(ee.TRANSFORM_FEEDBACK_BUFFER,ne.targetIndex,ne.buffer.buffer);ee.beginTransformFeedback(a)}let q=$&&$>0?1:void 0;for(let ne of P.get()){let le=ne.vaos||(ne.vaos={});(le[I]||(le[I]=new Dp)).bind(W,this,A,H?H.getPaintVertexBuffers():[],k,ne.vertexOffset,G||[],q),$&&$>1?ee.drawElementsInstanced(a,ne.primitiveLength*X,ee.UNSIGNED_SHORT,ne.primitiveOffset*X*2,$):k?ee.drawElements(a,ne.primitiveLength*X,ee.UNSIGNED_SHORT,ne.primitiveOffset*X*2):ee.drawArrays(a,ne.vertexOffset,ne.vertexLength),a===ee.TRIANGLES&&k&&this._drawDebugWireframe(n,h,f,b,k,ne,L,B,H,$)}te&&ee.endTransformFeedback()}}function Bp(u,n){let a=Math.pow(2,n.tileID.overscaledZ),h=n.tileSize*Math.pow(2,u.transform.tileZoom)/a,f=h*(n.tileID.canonical.x+n.tileID.wrap*a),b=h*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.a3(n,1,u.transform.tileZoom),u_pixel_coord_upper:[f>>16,b>>16],u_pixel_coord_lower:[65535&f,65535&b]}}let sg=r.a6.create(),Vp=(u,n,a,h,f,b,x,T,I,A,k,P,L,B,H,G)=>{let $=n.style.light,j=$.properties.get("position"),W=[j.x,j.y,j.z],ee=r.co.create();$.properties.get("anchor")==="viewport"&&(r.co.fromRotation(ee,-n.transform.angle),r.N.transformMat3(W,W,ee));let X=$.properties.get("color"),te=n.transform,q={u_matrix:u,u_lightpos:W,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[X.r,X.g,X.b],u_vertical_gradient:+a,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:sg,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:f,u_edge_radius:b,u_flood_light_color:P,u_vertical_scale:L,u_flood_light_intensity:B,u_ground_shadow_factor:H,u_emissive_strength:G};return te.projection.name==="globe"&&(q.u_tile_id=[x.canonical.x,x.canonical.y,1<<x.canonical.z],q.u_zoom_transition=I,q.u_inv_rot_matrix=k,q.u_merc_center=A,q.u_up_dir=te.projection.upVector(new r.bs(0,0,0),A[0]*r.V,A[1]*r.V),q.u_height_lift=T),q},jp=(u,n,a)=>({u_matrix:u,u_edge_radius:n,u_vertical_scale:a}),_c=(u,n,a,h,f,b,x,T,I,A,k,P,L,B)=>{let H=Vp(u,n,a,h,f,b,x,I,A,k,P,L,B,1,[0,0,0],0),G={u_height_factor:-Math.pow(2,x.overscaledZ)/T.tileSize/8};return r.e(H,Bp(n,T),G)},Kc=(u,n)=>({u_matrix:u,u_emissive_strength:n}),Up=(u,n,a,h)=>r.e(Kc(u,n),Bp(a,h)),bc=(u,n,a)=>({u_matrix:u,u_world:a,u_emissive_strength:n}),lg=(u,n,a,h,f)=>r.e(Up(u,n,a,h),{u_world:f}),lh=(u,n,a,h)=>{let f=r.V/a.tileSize;return{u_matrix:u,u_camera_to_center_distance:n.getCameraToCenterDistance(h),u_extrude_scale:[n.pixelsToGLUnits[0]/f,n.pixelsToGLUnits[1]/f]}},Gp=(u,n,a=1)=>({u_matrix:u,u_color:n,u_overlay:0,u_overlay_scale:a}),cg=r.a6.create(),Hp=(u,n,a,h,f,b,x)=>{let T=u.transform,I=T.projection.name==="globe",A=I?r.cp(T.zoom,n.canonical)*T._pixelsPerMercatorPixel:r.a3(a,1,b),k={u_matrix:n.projMatrix,u_extrude_scale:A,u_intensity:x,u_inv_rot_matrix:cg,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(I){k.u_inv_rot_matrix=h,k.u_merc_center=f,k.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],k.u_zoom_transition=r.S(T.zoom);let P=f[0]*r.V,L=f[1]*r.V;k.u_up_dir=T.projection.upVector(new r.bs(0,0,0),P,L)}return k};function ch(u,[n,a,h,f],[b,x]){if(b===x)return[0,0,0,0];let T=255*(u-1)/(u*(x-b));return[n*T,a*T,h*T,f*T]}function dg(u,n,[a,h]){return a===h?0:.5/u+(n-a)*(u-1)/(u*(h-a))}let $p=(u,n,a,h,f,b,x,T,I,A,k,P,L,B,H,G,$,j,W,ee,X)=>{return{u_matrix:u,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:h,u_grid_matrix:f,u_tl_parent:b,u_scale_parent:A,u_fade_t:k.mix,u_opacity:k.opacity*P.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:P.paint.get("raster-brightness-min"),u_brightness_high:P.paint.get("raster-brightness-max"),u_saturation_factor:(q=P.paint.get("raster-saturation"),q>0?1-1/(1.001-q):-q),u_contrast_factor:(te=P.paint.get("raster-contrast"),te>0?1/(1-te):1+te),u_spin_weights:jd(P.paint.get("raster-hue-rotate")),u_perspective_transform:L,u_raster_elevation:B,u_zoom_transition:x,u_merc_center:T,u_cutoff_params:I,u_colorization_mix:ch(r.cq,G,j),u_colorization_offset:dg(r.cq,$,j),u_color_ramp:H,u_texture_offset:[ee/(W+2*ee),W/(W+2*ee)],u_texture_res:[W+2*ee,W+2*ee],u_emissive_strength:X};var te,q};function jd(u){u*=Math.PI/180;let n=Math.sin(u),a=Math.cos(u);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}let ny=(u,n,a,h,f,b,x,T,I,A,k,P)=>({u_matrix:u,u_normalize_matrix:n,u_globe_matrix:a,u_merc_matrix:h,u_grid_matrix:f,u_tl_parent:b,u_scale_parent:A,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:P,u_zoom_transition:x,u_merc_center:T,u_cutoff_params:I}),ry=(u,n,a,h,f,b,x,T)=>({u_tile_offset:u,u_velocity:n,u_color_ramp:h,u_velocity_res:a,u_max_speed:f,u_texture_offset:b,u_data_scale:x,u_data_offset:T}),ug=(u,n,a,h,f,b,x,T)=>({u_velocity:u,u_velocity_res:n,u_max_speed:a,u_speed_factor:h,u_lifetime_delta:f,u_rand_seed:Math.random(),u_texture_offset:b,u_data_scale:x,u_data_offset:T}),hg=r.a6.create(),dh=(u,n,a,h,f,b,x,T,I,A,k,P,L,B,H,G,$,j)=>{let W=f.transform,ee={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:W.getCameraToCenterDistance(G),u_rotate_symbol:+a,u_aspect_ratio:W.width/W.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:x,u_coord_matrix:T,u_is_text:+I,u_pitch_with_map:+h,u_texsize:A,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:hg,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:hg,u_up_vector:[0,-1,0],u_icon_transition:j||0,u_icon_saturation:$};return G.name==="globe"&&(ee.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],ee.u_zoom_transition=P,ee.u_inv_rot_matrix=B,ee.u_merc_center=L,ee.u_camera_forward=W._camera.forward(),ee.u_ecef_origin=r.cr(W.globeMatrix,k.toUnwrapped()),ee.u_tile_matrix=Float32Array.from(W.globeMatrix),ee.u_up_vector=H),ee},Ud=(u,n,a,h,f,b,x,T,I,A,k,P,L,B,H,G,$)=>r.e(dh(u,n,a,h,f,b,x,T,I,A,P,L,B,H,G,$,1),{u_gamma_scale:h?f.transform.getCameraToCenterDistance($)*Math.cos(f.terrain?0:f.transform._pitch):1,u_device_pixel_ratio:r.f.devicePixelRatio,u_is_halo:+k,undefined:void 0}),uh=(u,n,a,h,f,b,x,T,I,A,k,P,L,B,H,G)=>r.e(Ud(u,n,a,h,f,b,x,T,!0,I,!0,k,P,L,B,H,G),{u_texsize_icon:A,u_texture_icon:1}),qp=(u,n,a,h)=>({u_matrix:u,u_emissive_strength:n,u_opacity:a,u_color:h}),Gd=(u,n,a,h,f,b,x)=>r.e(function(T,I,A,k){let P=A.imageManager.getPattern(T.toString(),I),{width:L,height:B}=A.imageManager.getPixelSize(I),H=Math.pow(2,k.tileID.overscaledZ),G=k.tileSize*Math.pow(2,A.transform.tileZoom)/H,$=G*(k.tileID.canonical.x+k.tileID.wrap*H),j=G*k.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[L,B],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/r.a3(k,1,A.transform.tileZoom),u_pixel_coord_upper:[$>>16,j>>16],u_pixel_coord_lower:[65535&$,65535&j]}}(f,b,h,x),{u_matrix:u,u_emissive_strength:n,u_opacity:a}),hh=(u,n,a,h,f,b,x,T,I,A,k,P,L=[0,0,0],B)=>{let H=h.style.light,G=H.properties.get("position"),$=[-G.x,-G.y,G.z],j=r.co.create();H.properties.get("anchor")==="viewport"&&(r.co.fromRotation(j,-h.transform.angle),r.N.transformMat3($,$,j));let W=A.alphaMode==="MASK",ee=H.properties.get("color"),X=P.paint.get("model-ambient-occlusion-intensity"),te=P.paint.get("model-color").constantOr(r.ax.white),q=P.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:u,u_lighting_matrix:n,u_normal_matrix:a,u_lightpos:$,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[ee.r,ee.g,ee.b],u_camera_pos:L,u_opacity:f,u_baseTextureIsAlpha:0,u_alphaMask:+W,u_alphaCutoff:A.alphaCutoff,u_baseColorFactor:[b.r,b.g,b.b,b.a],u_emissiveFactor:[x[0],x[1],x[2],1],u_metallicFactor:T,u_roughnessFactor:I,u_baseColorTexture:wn.BaseColor,u_metallicRoughnessTexture:wn.MetallicRoughness,u_normalTexture:wn.Normal,u_occlusionTexture:wn.Occlusion,u_emissionTexture:wn.Emission,u_color_mix:[te.r,te.g,te.b,q],u_aoIntensity:X,u_emissive_strength:k,u_occlusionTextureTransform:B||[0,0,0,0]}},Hd=new Float32Array(16),$d=(u,n=Hd,a=Hd)=>({u_matrix:u,u_instance:n,u_node_matrix:a}),oy={fillExtrusion:u=>({u_matrix:new r.bK(u),u_lightpos:new r.bM(u),u_lightintensity:new r.bN(u),u_lightcolor:new r.bM(u),u_vertical_gradient:new r.bN(u),u_opacity:new r.bN(u),u_edge_radius:new r.bN(u),u_ao:new r.bL(u),u_tile_id:new r.bM(u),u_zoom_transition:new r.bN(u),u_inv_rot_matrix:new r.bK(u),u_merc_center:new r.bL(u),u_up_dir:new r.bM(u),u_height_lift:new r.bN(u),u_flood_light_color:new r.bM(u),u_vertical_scale:new r.bN(u),u_flood_light_intensity:new r.bN(u),u_ground_shadow_factor:new r.bM(u),u_emissive_strength:new r.bN(u)}),fillExtrusionDepth:u=>({u_matrix:new r.bK(u),u_edge_radius:new r.bN(u),u_vertical_scale:new r.bN(u)}),fillExtrusionPattern:u=>({u_matrix:new r.bK(u),u_lightpos:new r.bM(u),u_lightintensity:new r.bN(u),u_lightcolor:new r.bM(u),u_vertical_gradient:new r.bN(u),u_height_factor:new r.bN(u),u_edge_radius:new r.bN(u),u_ao:new r.bL(u),u_tile_id:new r.bM(u),u_zoom_transition:new r.bN(u),u_inv_rot_matrix:new r.bK(u),u_merc_center:new r.bL(u),u_up_dir:new r.bM(u),u_height_lift:new r.bN(u),u_image:new r.bO(u),u_texsize:new r.bL(u),u_pixel_coord_upper:new r.bL(u),u_pixel_coord_lower:new r.bL(u),u_tile_units_to_pixels:new r.bN(u),u_opacity:new r.bN(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new r.bK(u),u_opacity:new r.bN(u),u_ao_pass:new r.bN(u),u_meter_to_tile:new r.bN(u),u_ao:new r.bL(u),u_flood_light_intensity:new r.bN(u),u_flood_light_color:new r.bM(u),u_attenuation:new r.bN(u),u_edge_radius:new r.bN(u),u_fb:new r.bO(u),u_fb_size:new r.bN(u)}),fill:u=>({u_matrix:new r.bK(u),u_emissive_strength:new r.bN(u)}),fillPattern:u=>({u_matrix:new r.bK(u),u_emissive_strength:new r.bN(u),u_image:new r.bO(u),u_texsize:new r.bL(u),u_pixel_coord_upper:new r.bL(u),u_pixel_coord_lower:new r.bL(u),u_tile_units_to_pixels:new r.bN(u)}),fillOutline:u=>({u_matrix:new r.bK(u),u_emissive_strength:new r.bN(u),u_world:new r.bL(u)}),fillOutlinePattern:u=>({u_matrix:new r.bK(u),u_emissive_strength:new r.bN(u),u_world:new r.bL(u),u_image:new r.bO(u),u_texsize:new r.bL(u),u_pixel_coord_upper:new r.bL(u),u_pixel_coord_lower:new r.bL(u),u_tile_units_to_pixels:new r.bN(u)}),circle:r.cs,collisionBox:u=>({u_matrix:new r.bK(u),u_camera_to_center_distance:new r.bN(u),u_extrude_scale:new r.bL(u)}),collisionCircle:u=>({u_matrix:new r.bK(u),u_inv_matrix:new r.bK(u),u_camera_to_center_distance:new r.bN(u),u_viewport_size:new r.bL(u)}),debug:u=>({u_color:new r.ca(u),u_matrix:new r.bK(u),u_overlay:new r.bO(u),u_overlay_scale:new r.bN(u)}),clippingMask:u=>({u_matrix:new r.bK(u)}),heatmap:u=>({u_extrude_scale:new r.bN(u),u_intensity:new r.bN(u),u_matrix:new r.bK(u),u_inv_rot_matrix:new r.bK(u),u_merc_center:new r.bL(u),u_tile_id:new r.bM(u),u_zoom_transition:new r.bN(u),u_up_dir:new r.bM(u)}),heatmapTexture:u=>({u_image:new r.bO(u),u_color_ramp:new r.bO(u),u_opacity:new r.bN(u)}),hillshade:u=>({u_matrix:new r.bK(u),u_image:new r.bO(u),u_latrange:new r.bL(u),u_light:new r.bL(u),u_shadow:new r.ca(u),u_highlight:new r.ca(u),u_emissive_strength:new r.bN(u),u_accent:new r.ca(u)}),hillshadePrepare:u=>({u_matrix:new r.bK(u),u_image:new r.bO(u),u_dimension:new r.bL(u),u_zoom:new r.bN(u)}),line:r.ct,linePattern:r.cu,raster:u=>({u_matrix:new r.bK(u),u_normalize_matrix:new r.bK(u),u_globe_matrix:new r.bK(u),u_merc_matrix:new r.bK(u),u_grid_matrix:new r.cb(u),u_tl_parent:new r.bL(u),u_scale_parent:new r.bN(u),u_fade_t:new r.bN(u),u_opacity:new r.bN(u),u_image0:new r.bO(u),u_image1:new r.bO(u),u_brightness_low:new r.bN(u),u_brightness_high:new r.bN(u),u_saturation_factor:new r.bN(u),u_contrast_factor:new r.bN(u),u_spin_weights:new r.bM(u),u_perspective_transform:new r.bL(u),u_raster_elevation:new r.bN(u),u_zoom_transition:new r.bN(u),u_merc_center:new r.bL(u),u_cutoff_params:new r.bP(u),u_colorization_mix:new r.bP(u),u_colorization_offset:new r.bN(u),u_color_ramp:new r.bO(u),u_texture_offset:new r.bL(u),u_texture_res:new r.bL(u),u_emissive_strength:new r.bN(u)}),rasterParticle:u=>({u_matrix:new r.bK(u),u_normalize_matrix:new r.bK(u),u_globe_matrix:new r.bK(u),u_merc_matrix:new r.bK(u),u_grid_matrix:new r.cb(u),u_tl_parent:new r.bL(u),u_scale_parent:new r.bN(u),u_fade_t:new r.bN(u),u_opacity:new r.bN(u),u_image0:new r.bO(u),u_image1:new r.bO(u),u_raster_elevation:new r.bN(u),u_zoom_transition:new r.bN(u),u_merc_center:new r.bL(u),u_cutoff_params:new r.bP(u)}),rasterParticleTexture:u=>({u_texture:new r.bO(u),u_opacity:new r.bN(u)}),rasterParticleDraw:u=>({u_tile_offset:new r.bL(u),u_velocity:new r.bO(u),u_color_ramp:new r.bO(u),u_velocity_res:new r.bL(u),u_max_speed:new r.bN(u),u_texture_offset:new r.bL(u),u_data_scale:new r.bP(u),u_data_offset:new r.bN(u)}),rasterParticleUpdate:u=>({u_velocity:new r.bO(u),u_velocity_res:new r.bL(u),u_max_speed:new r.bN(u),u_speed_factor:new r.bN(u),u_lifetime_delta:new r.bN(u),u_rand_seed:new r.bN(u),u_texture_offset:new r.bL(u),u_data_scale:new r.bP(u),u_data_offset:new r.bN(u)}),symbolIcon:u=>({u_is_size_zoom_constant:new r.bO(u),u_is_size_feature_constant:new r.bO(u),u_size_t:new r.bN(u),u_size:new r.bN(u),u_camera_to_center_distance:new r.bN(u),u_rotate_symbol:new r.bO(u),u_aspect_ratio:new r.bN(u),u_fade_change:new r.bN(u),u_matrix:new r.bK(u),u_label_plane_matrix:new r.bK(u),u_coord_matrix:new r.bK(u),u_is_text:new r.bO(u),u_pitch_with_map:new r.bO(u),u_texsize:new r.bL(u),u_tile_id:new r.bM(u),u_zoom_transition:new r.bN(u),u_inv_rot_matrix:new r.bK(u),u_merc_center:new r.bL(u),u_camera_forward:new r.bM(u),u_tile_matrix:new r.bK(u),u_up_vector:new r.bM(u),u_ecef_origin:new r.bM(u),u_texture:new r.bO(u),u_icon_transition:new r.bN(u),u_icon_saturation:new r.bN(u)}),symbolSDF:u=>({u_is_size_zoom_constant:new r.bO(u),u_is_size_feature_constant:new r.bO(u),u_size_t:new r.bN(u),u_size:new r.bN(u),u_camera_to_center_distance:new r.bN(u),u_rotate_symbol:new r.bO(u),u_aspect_ratio:new r.bN(u),u_fade_change:new r.bN(u),u_matrix:new r.bK(u),u_label_plane_matrix:new r.bK(u),u_coord_matrix:new r.bK(u),u_is_text:new r.bO(u),u_pitch_with_map:new r.bO(u),u_texsize:new r.bL(u),u_texture:new r.bO(u),u_gamma_scale:new r.bN(u),u_device_pixel_ratio:new r.bN(u),u_tile_id:new r.bM(u),u_zoom_transition:new r.bN(u),u_inv_rot_matrix:new r.bK(u),u_merc_center:new r.bL(u),u_camera_forward:new r.bM(u),u_tile_matrix:new r.bK(u),u_up_vector:new r.bM(u),u_ecef_origin:new r.bM(u),u_is_halo:new r.bO(u)}),symbolTextAndIcon:u=>({u_is_size_zoom_constant:new r.bO(u),u_is_size_feature_constant:new r.bO(u),u_size_t:new r.bN(u),u_size:new r.bN(u),u_camera_to_center_distance:new r.bN(u),u_rotate_symbol:new r.bO(u),u_aspect_ratio:new r.bN(u),u_fade_change:new r.bN(u),u_matrix:new r.bK(u),u_label_plane_matrix:new r.bK(u),u_coord_matrix:new r.bK(u),u_is_text:new r.bO(u),u_pitch_with_map:new r.bO(u),u_texsize:new r.bL(u),u_texsize_icon:new r.bL(u),u_texture:new r.bO(u),u_texture_icon:new r.bO(u),u_gamma_scale:new r.bN(u),u_device_pixel_ratio:new r.bN(u),u_is_halo:new r.bO(u)}),background:u=>({u_matrix:new r.bK(u),u_emissive_strength:new r.bN(u),u_opacity:new r.bN(u),u_color:new r.ca(u)}),backgroundPattern:u=>({u_matrix:new r.bK(u),u_emissive_strength:new r.bN(u),u_opacity:new r.bN(u),u_image:new r.bO(u),u_pattern_tl:new r.bL(u),u_pattern_br:new r.bL(u),u_texsize:new r.bL(u),u_pattern_size:new r.bL(u),u_pixel_coord_upper:new r.bL(u),u_pixel_coord_lower:new r.bL(u),u_tile_units_to_pixels:new r.bN(u)}),terrainRaster:ng,terrainDepth:ng,skybox:u=>({u_matrix:new r.bK(u),u_sun_direction:new r.bM(u),u_cubemap:new r.bO(u),u_opacity:new r.bN(u),u_temporal_offset:new r.bN(u)}),skyboxGradient:u=>({u_matrix:new r.bK(u),u_color_ramp:new r.bO(u),u_center_direction:new r.bM(u),u_radius:new r.bN(u),u_opacity:new r.bN(u),u_temporal_offset:new r.bN(u)}),skyboxCapture:u=>({u_matrix_3f:new r.cb(u),u_sun_direction:new r.bM(u),u_sun_intensity:new r.bN(u),u_color_tint_r:new r.bP(u),u_color_tint_m:new r.bP(u),u_luminance:new r.bN(u)}),globeRaster:u=>({u_proj_matrix:new r.bK(u),u_globe_matrix:new r.bK(u),u_normalize_matrix:new r.bK(u),u_merc_matrix:new r.bK(u),u_zoom_transition:new r.bN(u),u_merc_center:new r.bL(u),u_image0:new r.bO(u),u_grid_matrix:new r.cb(u),u_skirt_height:new r.bN(u),u_far_z_cutoff:new r.bN(u),u_frustum_tl:new r.bM(u),u_frustum_tr:new r.bM(u),u_frustum_br:new r.bM(u),u_frustum_bl:new r.bM(u),u_globe_pos:new r.bM(u),u_globe_radius:new r.bN(u),u_viewport:new r.bL(u)}),globeAtmosphere:u=>({u_frustum_tl:new r.bM(u),u_frustum_tr:new r.bM(u),u_frustum_br:new r.bM(u),u_frustum_bl:new r.bM(u),u_horizon:new r.bN(u),u_transition:new r.bN(u),u_fadeout_range:new r.bN(u),u_color:new r.bP(u),u_high_color:new r.bP(u),u_space_color:new r.bP(u),u_temporal_offset:new r.bN(u),u_horizon_angle:new r.bN(u)}),model:u=>({u_matrix:new r.bK(u),u_lighting_matrix:new r.bK(u),u_normal_matrix:new r.bK(u),u_lightpos:new r.bM(u),u_lightintensity:new r.bN(u),u_lightcolor:new r.bM(u),u_camera_pos:new r.bM(u),u_opacity:new r.bN(u),u_baseColorFactor:new r.bP(u),u_emissiveFactor:new r.bP(u),u_metallicFactor:new r.bN(u),u_roughnessFactor:new r.bN(u),u_baseTextureIsAlpha:new r.bO(u),u_alphaMask:new r.bO(u),u_alphaCutoff:new r.bN(u),u_baseColorTexture:new r.bO(u),u_metallicRoughnessTexture:new r.bO(u),u_normalTexture:new r.bO(u),u_occlusionTexture:new r.bO(u),u_emissionTexture:new r.bO(u),u_color_mix:new r.bP(u),u_aoIntensity:new r.bN(u),u_emissive_strength:new r.bN(u),u_occlusionTextureTransform:new r.bP(u)}),modelDepth:u=>({u_matrix:new r.bK(u),u_instance:new r.bK(u),u_node_matrix:new r.bK(u)}),groundShadow:u=>({u_matrix:new r.bK(u),u_ground_shadow_factor:new r.bM(u)}),stars:u=>({u_matrix:new r.bK(u),u_up:new r.bM(u),u_right:new r.bM(u),u_intensity_multiplier:new r.bN(u)})},Ya;function Xa(u,n,a,h,f,b,x){let T=u.context,I=T.gl,A=u.transform,k=u.getOrCreateProgram("collisionBox"),P=[],L=0,B=0;for(let X=0;X<h.length;X++){let te=h[X],q=n.getTile(te),ne=q.getBucket(a);if(!ne)continue;let le=qa(te,ne,A),ce=le;f[0]===0&&f[1]===0||(ce=u.translatePosMatrix(le,q,f,b));let me=x?ne.textCollisionBox:ne.iconCollisionBox,Ie=ne.collisionCircleArray;if(Ie.length>0){let be=r.a6.create(),Fe=ce;r.a6.mul(be,ne.placementInvProjMatrix,A.glCoordMatrix),r.a6.mul(be,be,ne.placementViewportMatrix),P.push({circleArray:Ie,circleOffset:B,transform:Fe,invTransform:be,projection:ne.getProjection()}),L+=Ie.length/4,B=L}me&&(u.terrain&&u.terrain.setupElevationDraw(q,k),k.draw(u,I.LINES,ot.disabled,ke.disabled,u.colorModeForRenderPass(),qt.disabled,lh(ce,A,q,ne.getProjection()),a.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,null,A.zoom,null,[me.collisionVertexBuffer,me.collisionVertexBufferExt]))}if(!x||!P.length)return;let H=u.getOrCreateProgram("collisionCircle"),G=new r.cv;G.resize(4*L),G._trim();let $=0;for(let X of P)for(let te=0;te<X.circleArray.length/4;te++){let q=4*te,ne=X.circleArray[q+0],le=X.circleArray[q+1],ce=X.circleArray[q+2],me=X.circleArray[q+3];G.emplace($++,ne,le,ce,me,0),G.emplace($++,ne,le,ce,me,1),G.emplace($++,ne,le,ce,me,2),G.emplace($++,ne,le,ce,me,3)}(!Ya||Ya.length<2*L)&&(Ya=function(X){let te=2*X,q=new r.aw;q.resize(te),q._trim();for(let ne=0;ne<te;ne++){let le=6*ne;q.uint16[le+0]=4*ne+0,q.uint16[le+1]=4*ne+1,q.uint16[le+2]=4*ne+2,q.uint16[le+3]=4*ne+2,q.uint16[le+4]=4*ne+3,q.uint16[le+5]=4*ne+0}return q}(L));let j=T.createIndexBuffer(Ya,!0),W=T.createVertexBuffer(G,r.cw.members,!0);for(let X of P){let te={u_matrix:X.transform,u_inv_matrix:X.invTransform,u_camera_to_center_distance:(ee=A).getCameraToCenterDistance(X.projection),u_viewport_size:[ee.width,ee.height]};H.draw(u,I.TRIANGLES,ot.disabled,ke.disabled,u.colorModeForRenderPass(),qt.disabled,te,a.id,W,j,r.aB.simpleSegment(0,2*X.circleOffset,X.circleArray.length,X.circleArray.length/2),null,A.zoom)}var ee;W.destroy(),j.destroy()}let il=r.a6.create();function qd(u){let n=u._camera.getWorldToCamera(u.worldSize,1),a=r.a6.multiply([],n,u.globeMatrix);r.a6.invert(a,a);let h=[0,0,0],f=[0,1,0,0];return r.a7.transformMat4(f,f,a),h[0]=f[0],h[1]=f[1],h[2]=f[2],r.N.normalize(h,h),h}function Et({width:u,height:n,anchor:a,textOffset:h,textScale:f},b){let{horizontalAlign:x,verticalAlign:T}=r.bf(a),I=-(x-.5)*u,A=-(T-.5)*n,k=r.bd(a,h);return new r.P((I/f+k[0])*b,(A/f+k[1])*b)}function pg(u,n,a,h,f,b,x,T,I,A,k){let P=u.text.placedSymbolArray,L=u.text.dynamicLayoutVertexArray,B=u.icon.dynamicLayoutVertexArray,H={},G=u.getProjection(),$=fs(T,G,b),j=b.elevation,W=G.upVectorScale(T.canonical,b.center.lat,b.worldSize).metersToTile;L.clear();for(let ee=0;ee<P.length;ee++){let X=P.get(ee),{tileAnchorX:te,tileAnchorY:q,numGlyphs:ne}=X,le=X.hidden||!X.crossTileID||u.allowVerticalPlacement&&!X.placedOrientation?null:h[X.crossTileID];if(le){let ce=0,me=0,Ie=0;if(j){let Xe=j?j.getAtTileOffset(T,te,q):0,[at,nt,_t]=G.upVector(T.canonical,te,q);ce=Xe*at*W,me=Xe*nt*W,Ie=Xe*_t*W}let[be,Fe,Re,Ye]=ko(X.projectedAnchorX+ce,X.projectedAnchorY+me,X.projectedAnchorZ+Ie,a?$:x),ve=Dl(b.getCameraToCenterDistance(G),Ye),Ae=f.evaluateSizeForFeature(u.textSizeData,A,X)*ve/r.bc;a&&(Ae*=u.tilePixelRatio/I);let he=Et(le,Ae);a?({x:be,y:Fe,z:Re}=G.projectTilePoint(te+he.x,q+he.y,T.canonical),[be,Fe,Re]=ko(be+ce,Fe+me,Re+Ie,x)):(n&&he._rotate(-b.angle),be+=he.x,Fe+=he.y,Re=0);let Ce=u.allowVerticalPlacement&&X.placedOrientation===r.b6.vertical?Math.PI/2:0;for(let Xe=0;Xe<ne;Xe++)r.b9(L,be,Fe,Re,Ce);k&&X.associatedIconIndex>=0&&(H[X.associatedIconIndex]={x:be,y:Fe,z:Re,angle:Ce})}else ms(ne,L)}if(k){B.clear();let ee=u.icon.placedSymbolArray;for(let X=0;X<ee.length;X++){let te=ee.get(X),{numGlyphs:q}=te,ne=H[X];if(te.hidden||!ne)ms(q,B);else{let{x:le,y:ce,z:me,angle:Ie}=ne;for(let be=0;be<q;be++)r.b9(B,le,ce,me,Ie)}}u.icon.dynamicLayoutVertexBuffer.updateData(B)}u.text.dynamicLayoutVertexBuffer.updateData(L)}function ph(u,n,a,h,f,b,x={}){let T=a.paint.get("icon-translate"),I=a.paint.get("text-translate"),A=a.paint.get("icon-translate-anchor"),k=a.paint.get("text-translate-anchor"),P=a.layout.get("icon-rotation-alignment"),L=a.layout.get("text-rotation-alignment"),B=a.layout.get("icon-pitch-alignment"),H=a.layout.get("text-pitch-alignment"),G=a.layout.get("icon-keep-upright"),$=a.layout.get("text-keep-upright"),j=a.paint.get("icon-color-saturation"),W=u.context,ee=W.gl,X=u.transform,te=P==="map",q=L==="map",ne=B==="map",le=H==="map",ce=a.layout.get("symbol-sort-key").constantOr(1)!==void 0,me=!1,Ie=u.depthModeForSublayer(0,ot.ReadOnly),be=[r.a5(X.center.lng),r.ae(X.center.lat)],Fe=a.layout.get("text-variable-anchor"),Re=X.projection.name==="globe",Ye=[],ve=[0,-1,0];for(let Ae of h){let he=n.getTile(Ae),Ce=he.getBucket(a);if(!Ce||Ce.projection.name==="mercator"&&Re||Ce.fullyClipped)continue;let Xe=Ce.projection.name==="globe",at=Xe?r.S(X.zoom):0,nt=fs(Ae,Ce.getProjection(),X),_t=X.calculatePixelsToTileUnitsMatrix(he),Rt=Fe&&Ce.hasTextData(),Wt=Ce.hasIconTextFit()&&Rt&&Ce.hasIconData(),Nt=Ce.getProjection().createInversionMatrix(X,Ae.canonical),Ut=()=>{let or=te&&a.layout.get("symbol-placement")!=="point",Ri=[],Yi=or||Wt,Pi=a.paint.get("icon-image-cross-fade").constantOr(0);u.terrainRenderModeElevated()&&ne&&Ri.push("PITCH_WITH_MAP_TERRAIN"),Xe&&(Ri.push("PROJECTION_GLOBE_VIEW"),Yi&&Ri.push("PROJECTED_POS_ON_VIEWPORT")),Pi>0&&Ri.push("ICON_TRANSITION"),Ce.icon.zOffsetVertexBuffer&&Ri.push("Z_OFFSET"),j<1&&Ri.push("SATURATION");let Wi=Ce.icon.programConfigurations.get(a.id),jn=u.getOrCreateProgram(Ce.sdfIcons?"symbolSDF":"symbolIcon",{config:Wi,defines:Ri}),sn,Qr=he.imageAtlasTexture?he.imageAtlasTexture.size:[0,0],bo=Ce.iconSizeData,sa=r.b5(bo,X.zoom),vs=ne||X.pitch!==0,la=Al(nt,he.tileID.canonical,ne,te,X,Ce.getProjection(),_t),Jr=Od(nt,he.tileID.canonical,ne,te,X,Ce.getProjection(),_t),Vr=u.translatePosMatrix(Jr,he,T,A,!0),Fo=u.translatePosMatrix(nt,he,T,A),Uo=Yi?il:la,ca=te&&!ne&&!or,xs=ve;!Re&&!X.mercatorFromTransition||te||(xs=qd(X));let Wl=Xe?xs:ve;sn=Ce.sdfIcons&&!Ce.iconsInText?Ud(bo.kind,sa,ca,ne,u,Fo,Uo,Vr,!1,Qr,!0,Ae,at,be,Nt,Wl,Ce.getProjection()):dh(bo.kind,sa,ca,ne,u,Fo,Uo,Vr,!1,Qr,Ae,at,be,Nt,Wl,Ce.getProjection(),j,Pi);let Cc=he.imageAtlasTexture?he.imageAtlasTexture:null,uu=a.layout.get("icon-size").constantOr(0)!==1||Ce.iconsNeedLinear,hu=Ce.sdfIcons||u.options.rotating||u.options.zooming||uu||vs?ee.LINEAR:ee.NEAREST,wm=Ce.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,pu=u.terrain&&ne&&or?r.a6.invert(r.a6.create(),la):il;if(or&&Ce.icon){let id=X.elevation,Ch=id?id.getAtTileOffsetFunc(Ae,X.center.lat,X.worldSize,Ce.getProjection()):null,al=Pd(nt,he.tileID.canonical,ne,te,X,Ce.getProjection(),_t);uc(Ce,nt,u,!1,al,Jr,ne,G,Ch,Ae)}return{program:jn,buffers:Ce.icon,uniformValues:sn,atlasTexture:Cc,atlasTextureIcon:null,atlasInterpolation:hu,atlasInterpolationIcon:null,isSDF:Ce.sdfIcons,hasHalo:wm,tile:he,labelPlaneMatrixInv:pu}},_i=()=>{let or=q&&a.layout.get("symbol-placement")!=="point",Ri=[],Yi=or||Fe||Wt;u.terrainRenderModeElevated()&&le&&Ri.push("PITCH_WITH_MAP_TERRAIN"),Xe&&(Ri.push("PROJECTION_GLOBE_VIEW"),Yi&&Ri.push("PROJECTED_POS_ON_VIEWPORT")),Ce.text.zOffsetVertexBuffer&&Ri.push("Z_OFFSET");let Pi=Ce.text.programConfigurations.get(a.id),Wi=u.getOrCreateProgram(Ce.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Pi,defines:Ri}),jn,sn=[0,0],Qr=null,bo=Ce.textSizeData;Ce.iconsInText&&(sn=he.imageAtlasTexture?he.imageAtlasTexture.size:[0,0],Qr=he.imageAtlasTexture?he.imageAtlasTexture:null,jn=le||X.pitch!==0||u.options.rotating||u.options.zooming||bo.kind==="composite"||bo.kind==="camera"?ee.LINEAR:ee.NEAREST);let sa=he.glyphAtlasTexture?he.glyphAtlasTexture.size:[0,0],vs=r.b5(bo,X.zoom),la=Al(nt,he.tileID.canonical,le,q,X,Ce.getProjection(),_t),Jr=Od(nt,he.tileID.canonical,le,q,X,Ce.getProjection(),_t),Vr=u.translatePosMatrix(Jr,he,I,k,!0),Fo=u.translatePosMatrix(nt,he,I,k),Uo=Yi?il:la,ca=q&&!le&&!or,xs=ve;!Re&&!X.mercatorFromTransition||q||(xs=qd(X));let Wl=Xe?xs:ve,Cc;Cc=Ce.iconsInText?uh(bo.kind,vs,ca,le,u,Fo,Uo,Vr,sa,sn,Ae,at,be,Nt,Wl,Ce.getProjection()):Ud(bo.kind,vs,ca,le,u,Fo,Uo,Vr,!0,sa,!0,Ae,at,be,Nt,Wl,Ce.getProjection());let uu=he.glyphAtlasTexture?he.glyphAtlasTexture:null,hu=ee.LINEAR,wm=a.paint.get("text-halo-width").constantOr(1)!==0,pu=u.terrain&&le&&or?r.a6.invert(r.a6.create(),la):il;if(or&&Ce.text){let id=X.elevation,Ch=id?id.getAtTileOffsetFunc(Ae,X.center.lat,X.worldSize,Ce.getProjection()):null,al=Pd(nt,he.tileID.canonical,le,q,X,Ce.getProjection(),_t);uc(Ce,nt,u,!0,al,Jr,le,$,Ch,Ae)}return{program:Wi,buffers:Ce.text,uniformValues:Cc,atlasTexture:uu,atlasTextureIcon:Qr,atlasInterpolation:hu,atlasInterpolationIcon:jn,isSDF:!0,hasHalo:wm,tile:he,labelPlaneMatrixInv:pu}},ri=Ce.icon.segments.get().length,ci=Ce.text.segments.get().length,li=ri&&!x.onlyText?Ut():null,Ui=ci&&!x.onlyIcons?_i():null,On=a.paint.get("icon-opacity").constantOr(1),ki=a.paint.get("text-opacity").constantOr(1);if(ce&&Ce.canOverlap){me=!0;let or=On&&!x.onlyText?Ce.icon.segments.get():[],Ri=ki&&!x.onlyIcons?Ce.text.segments.get():[];for(let Yi of or)Ye.push({segments:new r.aB([Yi]),sortKey:Yi.sortKey,state:li});for(let Yi of Ri)Ye.push({segments:new r.aB([Yi]),sortKey:Yi.sortKey,state:Ui})}else x.onlyText||Ye.push({segments:On?Ce.icon.segments:new r.aB([]),sortKey:0,state:li}),x.onlyIcons||Ye.push({segments:ki?Ce.text.segments:new r.aB([]),sortKey:0,state:Ui})}me&&Ye.sort((Ae,he)=>Ae.sortKey-he.sortKey);for(let Ae of Ye){let he=Ae.state;if(he)if(u.terrain&&u.terrain.setupElevationDraw(he.tile,he.program,{useDepthForOcclusion:X.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:he.labelPlaneMatrixInv}),W.activeTexture.set(ee.TEXTURE0),he.atlasTexture&&he.atlasTexture.bind(he.atlasInterpolation,ee.CLAMP_TO_EDGE,!0),he.atlasTextureIcon&&(W.activeTexture.set(ee.TEXTURE1),he.atlasTextureIcon&&he.atlasTextureIcon.bind(he.atlasInterpolationIcon,ee.CLAMP_TO_EDGE,!0)),u.uploadCommonLightUniforms(u.context,he.program),he.hasHalo){let Ce=he.uniformValues;Ce.u_is_halo=1,Bl(he.buffers,Ae.segments,a,u,he.program,Ie,f,b,Ce,2),Ce.u_is_halo=0}else{if(he.isSDF){let Ce=he.uniformValues;he.hasHalo&&(Ce.u_is_halo=1,Bl(he.buffers,Ae.segments,a,u,he.program,Ie,f,b,Ce,1)),Ce.u_is_halo=0}Bl(he.buffers,Ae.segments,a,u,he.program,Ie,f,b,he.uniformValues,1)}}}function Bl(u,n,a,h,f,b,x,T,I,A){let k=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer];f.draw(h,h.context.gl.TRIANGLES,b,x,T,qt.disabled,I,a.id,u.layoutVertexBuffer,u.indexBuffer,n,a.paint,h.transform.zoom,u.programConfigurations.get(a.id),k,A)}function yc(u,n,a,h,f,b,x){let T=u.context.gl,I=a.paint.get("fill-pattern"),A=I&&I.constantOr(1),k,P,L,B,H;x?(P=A&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=T.LINES):(P=A?"fillPattern":"fill",k=T.TRIANGLES);for(let G of h){let $=n.getTile(G);if(A&&!$.patternsLoaded())continue;let j=$.getBucket(a);if(!j)continue;u.prepareDrawTile();let W=j.programConfigurations.get(a.id),ee=u.isTileAffectedByFog(G),X=u.getOrCreateProgram(P,{config:W,overrideFog:ee});A&&(u.context.activeTexture.set(T.TEXTURE0),$.imageAtlasTexture&&$.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),W.updatePaintBuffers());let te=I.constantOr(null);if(te&&$.imageAtlas){let le=$.imageAtlas.patternPositions[te.toString()];le&&W.setConstantPatternPositions(le)}let q=u.translatePosMatrix(G.projMatrix,$,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),ne=a.paint.get("fill-emissive-strength");if(x){B=j.indexBuffer2,H=j.segments2;let le=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];L=P==="fillOutlinePattern"&&A?lg(q,ne,u,$,le):bc(q,ne,le)}else B=j.indexBuffer,H=j.segments,L=A?Up(q,ne,u,$):Kc(q,ne);u.uploadCommonUniforms(u.context,X,G.toUnwrapped()),X.draw(u,k,f,u.stencilModeForClipping(G),b,qt.disabled,L,a.id,j.layoutVertexBuffer,B,H,a.paint,u.transform.zoom,W,void 0)}}function Ot(u,n,a,h,f,b,x,T){a.resetLayerRenderingStats(u);let I=u.context,A=I.gl,k=u.transform,P=a.paint.get("fill-extrusion-pattern"),L=P.constantOr(1),B=a.paint.get("fill-extrusion-opacity"),H=u.style.enable3dLights(),G=a.paint.get(H&&!L?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),$=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),G],j=a.layout.get("fill-extrusion-edge-radius"),W=j>0&&!a.paint.get("fill-extrusion-rounded-roof"),ee=W?0:j,X=k.projection.name==="globe"?r.cF():0,te=k.projection.name==="globe",q=te?r.S(k.zoom):0,ne=[r.a5(k.center.lng),r.ae(k.center.lat)],le=a.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),ce=a.paint.get("fill-extrusion-flood-light-intensity"),me=a.paint.get("fill-extrusion-vertical-scale"),Ie=ir(u,a.paint.get("fill-extrusion-cutoff-fade-range")),be=a.paint.get("fill-extrusion-emissive-strength"),Fe=[],Re;te&&Fe.push("PROJECTION_GLOBE_VIEW"),$[0]>0&&Fe.push("FAUX_AO"),W&&Fe.push("ZERO_ROOF_RADIUS"),T&&Fe.push("HAS_CENTROID"),ce>0&&Fe.push("FLOOD_LIGHT"),Ie.shouldRenderCutoff&&Fe.push("RENDER_CUTOFF");let Ye=u.renderPass==="shadow",ve=u.shadowRenderer,Ae=Ye&&!!ve;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let he=[0,0,0];if(ve){let at=u.style.directionalLight,nt=u.style.ambientLight;at&&nt&&(he=Oa(at,nt)),Re=Fe.concat(["SHADOWS_SINGLE_CASCADE"])}let Ce=Ae?"fillExtrusionDepth":L?"fillExtrusionPattern":"fillExtrusion",Xe=a.getLayerRenderingStats();for(let at of h){let nt=n.getTile(at),_t=nt.getBucket(a);if(!_t||_t.projection.name!==k.projection.name)continue;let Rt=!1;ve&&(Rt=ve.getMaxCascadeForTile(at.toUnwrapped())===0);let Wt=u.isTileAffectedByFog(at),Nt=_t.programConfigurations.get(a.id),Ut=u.getOrCreateProgram(Ce,{config:Nt,defines:Rt?Re:Fe,overrideFog:Wt});if(u.terrain&&u.terrain.setupElevationDraw(nt,Ut,{useMeterToDem:!0}),!_t.centroidVertexBuffer){let On=Ut.attributes.a_centroid_pos;On!==void 0&&A.vertexAttrib2f(On,0,0)}!Ye&&ve&&ve.setupShadows(nt.tileID.toUnwrapped(),Ut,"vector-tile",nt.tileID.overscaledZ),L&&(u.context.activeTexture.set(A.TEXTURE0),nt.imageAtlasTexture&&nt.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Nt.updatePaintBuffers());let _i=P.constantOr(null);if(_i&&nt.imageAtlas){let On=nt.imageAtlas.patternPositions[_i.toString()];On&&Nt.setConstantPatternPositions(On)}let ri=a.paint.get("fill-extrusion-vertical-gradient"),ci;if(Ye&&ve){if(fg(nt.tileID,_t,u))continue;let On=ve.calculateShadowPassMatrixFromTile(nt.tileID.toUnwrapped());ci=jp(On,ee,me)}else{let On=u.translatePosMatrix(at.expandedProjMatrix,nt,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ki=k.projection.createInversionMatrix(k,at.canonical);ci=L?_c(On,u,ri,B,$,ee,at,nt,X,q,ne,ki,le,me):Vp(On,u,ri,B,$,ee,at,X,q,ne,ki,le,me,ce,he,be)}u.uploadCommonUniforms(I,Ut,at.toUnwrapped(),null,Ie);let li=_t.segments;if(k.projection.name==="mercator"&&!Ye&&(li=_t.getVisibleSegments(nt.tileID,u.terrain,u.transform.getFrustum(0)),!li.get().length))continue;if(Xe)if(Ye)for(let On of li.get())Xe.numRenderedVerticesInShadowPass+=On.primitiveLength;else for(let On of li.get())Xe.numRenderedVerticesInTransparentPass+=On.primitiveLength;let Ui=[];(u.terrain||T)&&Ui.push(_t.centroidVertexBuffer),te&&Ui.push(_t.layoutVertexExtBuffer),Ut.draw(u,I.gl.TRIANGLES,f,b,x,qt.backCCW,ci,a.id,_t.layoutVertexBuffer,_t.indexBuffer,li,a.paint,u.transform.zoom,Nt,Ui)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}function Vl(u,n,a,h,f,b,x,T,I,A,k,P,L,B,H,G,$,j,W){let ee=u.context,X=ee.gl,te=u.transform,q=u.transform.zoom,ne=[],le=ir(u,a.paint.get("fill-extrusion-cutoff-fade-range"));A==="clear"?(ne.push("CLEAR_SUBPASS"),W&&(ne.push("CLEAR_FROM_TEXTURE"),ee.activeTexture.set(X.TEXTURE0),W.bind(X.LINEAR,X.CLAMP_TO_EDGE))):A==="sdf"&&ne.push("SDF_SUBPASS"),$&&ne.push("HAS_CENTROID"),le.shouldRenderCutoff&&ne.push("RENDER_CUTOFF");let ce=a.layout.get("fill-extrusion-edge-radius"),me=(Ie,be,Fe,Re,Ye)=>{let ve=be.programConfigurations.get(a.id),Ae=u.isTileAffectedByFog(Ie),he=u.getOrCreateProgram("fillExtrusionGroundEffect",{config:ve,defines:ne,overrideFog:Ae}),Ce=((at,nt,_t,Rt,Wt,Nt,Ut,_i,ri,ci,li)=>({u_matrix:nt,u_opacity:_t,u_ao_pass:Rt?1:0,u_meter_to_tile:Wt,u_ao:Nt,u_flood_light_intensity:Ut,u_flood_light_color:_i,u_attenuation:ri,u_edge_radius:ci,u_fb:0,u_fb_size:li}))(0,Re,k,I,Ye,[P,L*Ye],B,H,G,q>=17?0:ce*Ye,W?W.size[0]:0),Xe=[];$&&Xe.push(be.hiddenByLandmarkVertexBuffer),u.uploadCommonUniforms(ee,he,Ie.toUnwrapped(),null,le),he.draw(u,ee.gl.TRIANGLES,f,b,x,T,Ce,a.id,be.vertexBuffer,be.indexBuffer,Fe,a.paint,q,ve,Xe)};for(let Ie of h){let be=n.getTile(Ie),Fe=be.getBucket(a);if(!Fe||Fe.projection.name!==te.projection.name||!Fe.groundEffect||Fe.groundEffect&&!Fe.groundEffect.hasData())continue;let Re=Fe.groundEffect,Ye=1/Fe.tileToMeter;{let ve=u.translatePosMatrix(Ie.projMatrix,be,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ae=Re.getDefaultSegment();me(Ie,Re,Ae,ve,Ye)}if(j)for(let ve=0;ve<4;ve++){let Ae=r.cG[ve](Ie),he=n.getTile(Ae);if(!he)continue;let Ce=he.getBucket(a);if(!Ce||Ce.projection.name!==te.projection.name||!Ce.groundEffect||Ce.groundEffect&&!Ce.groundEffect.hasData())continue;let Xe=Ce.groundEffect,at,nt;ve===0?(at=[-r.V,0,0],nt=1):ve===1?(at=[r.V,0,0],nt=0):ve===2?(at=[0,-r.V,0],nt=3):(at=[0,r.V,0],nt=2);let _t=Xe.regionSegments[nt];if(!_t)continue;let Rt=new Float32Array(16);r.a6.translate(Rt,Ie.projMatrix,at),me(Ie,Xe,_t,u.translatePosMatrix(Rt,be,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Ye)}}}function ay(u,n,a,h,f,b,x){h.centroidVertexArray.length===0&&h.createCentroidsBuffer();let T=b?b.findDEMTileFor(a):null;if(!(T&&T.dem||x))return;let I=j=>new r.P(Math.ceil((j+r.cJ)*r.cK),0),A=j=>{let W=n.getSource().minzoom,ee=te=>{let q=n.getTileByID(te);if(q&&q.hasData())return q.getBucket(f)},X=[0,-1,1];for(let te of X){if(j.overscaledZ+te<W)continue;let q=ee(j.calculateScaledKey(j.overscaledZ+te));if(q)return q}},k=[0,0,0],P=(j,W)=>(k[0]=Math.min(j.min.y,W.min.y),k[1]=Math.max(j.max.y,W.max.y),k[2]=r.V-W.min.x>j.max.x?W.min.x-r.V:j.max.x,k),L=(j,W)=>(k[0]=Math.min(j.min.x,W.min.x),k[1]=Math.max(j.max.x,W.max.x),k[2]=r.V-W.min.y>j.max.y?W.min.y-r.V:j.max.y,k),B=[(j,W)=>P(j,W),(j,W)=>P(W,j),(j,W)=>L(j,W),(j,W)=>L(W,j)],H=(j,W,ee,X,te,q,ne)=>{if(!b)return 0;let le=[[q?ee:j,q?j:ee,0],[q?ee:W,q?W:ee,0]],ce=ne<0?r.V+ne:ne,me=[q?ce:(j+W)/2,q?(j+W)/2:ce,0];return ee===0&&ne<0||ee!==0&&ne>0?b.getForTilePoints(te,[me],!0,X):le.push(me),b.getForTilePoints(a,le,!0,T),Math.max(le[0][2],le[1][2],me[2])/b.exaggeration()};for(let j=0;j<4;j++){let W=h.borderFeatureIndices[j];if(W.length===0)continue;let ee=r.cG[j](a),X=A(ee);if(!(X&&X instanceof r.cH)||h.borderDoneWithNeighborZ[j]===X.canonical.z)continue;X.centroidVertexArray.length===0&&X.createCentroidsBuffer();let te=b?b.findDEMTileFor(ee):null;if(!(te&&te.dem||x))continue;let q=(j<2?1:5)-j,ne=X.borderDoneWithNeighborZ[q]!==h.canonical.z,le=X.borderFeatureIndices[q],ce=0;if(h.canonical.z!==X.canonical.z){for(let me of W)h.showCentroid(h.featuresOnBorder[me]);if(ne)for(let me of le)X.showCentroid(X.featuresOnBorder[me]);h.borderDoneWithNeighborZ[j]=X.canonical.z,X.borderDoneWithNeighborZ[q]=h.canonical.z}for(let me of W){let Ie=h.featuresOnBorder[me],be=h.centroidData[Ie.centroidDataIndex],Fe=Ie.borders[j],Re;for(;ce<le.length;){Re=X.featuresOnBorder[le[ce]];let Ye=Re.borders[q];if(Ye[1]>Fe[0]+3||Ye[0]>Fe[0]-3)break;X.showCentroid(Re),ce++}if(Re&&ce<le.length){let Ye=ce,ve=0;for(;!(Re.borders[q][0]>Fe[1]-3)&&(ve++,++ce!==le.length);)Re=X.featuresOnBorder[le[ce]];if(Re=X.featuresOnBorder[le[Ye]],ve>1){let Ce=Re.borders[q];Math.abs(Fe[0]-Ce[0])<3&&Math.abs(Fe[1]-Ce[1])<3&&(ve=1,ce=Ye+1)}else if(ve===0){h.showCentroid(Ie);continue}let Ae=X.centroidData[Re.centroidDataIndex];x&&ve===1&&(((G=be).flags|($=Ae).flags)&r.cI?(G.flags|=r.cI,$.flags|=r.cI):(G.flags&=~r.cI,$.flags&=~r.cI));let he=Ie.intersectsCount()>1||Re.intersectsCount()>1;if(ve>1)ce=Ye,be.centroidXY=Ae.centroidXY=new r.P(0,0);else if(te&&te.dem&&!he){let Ce=B[j](be,Ae),Xe=j%2?r.V-1:0,at=H(Ce[0],Math.min(r.V-1,Ce[1]),Xe,te,ee,j<2,Ce[2]);be.centroidXY=Ae.centroidXY=I(at)}else he?be.centroidXY=Ae.centroidXY=new r.P(0,0):(be.centroidXY=h.encodeBorderCentroid(Ie),Ae.centroidXY=X.encodeBorderCentroid(Re));h.writeCentroidToBuffer(be),X.writeCentroidToBuffer(Ae)}else h.showCentroid(Ie)}h.borderDoneWithNeighborZ[j]=X.canonical.z,X.borderDoneWithNeighborZ[q]=h.canonical.z}var G,$;(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(u)}let sy=[1,0,0],Wp=[0,1,0],mg=[0,0,1];function fg(u,n,a){let h=a.transform,f=a.shadowRenderer;if(!f)return!0;let b=u.toUnwrapped(),x=h.tileSize*f._cascades[a.currentShadowCascade].scale,T=n.maxHeight;if(h.elevation){let G=h.elevation.getMinMaxForTile(u);G&&(T+=G.max)}let I=[...f.shadowDirection];I[2]=-I[2];let A=f.computeSimplifiedTileShadowVolume(b,T,x,I);if(!A)return!1;let k=[sy,Wp,mg,I,[I[0],0,I[2]],[0,I[1],I[2]]],P=h.projection.name==="globe",L=h.scaleZoom(x),B=r.bq.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,L,!P),H=f.getCurrentCascadeFrustum();return B.intersectsPrecise(A.vertices,A.planes,k)===0||H.intersectsPrecise(A.vertices,A.planes,k)===0}function gg(u){return[u[0]*r.cL,u[1]*r.cL,u[2]*r.cL,0]}function Zp(u,n,a,h,f,b,x,T,I){let A=h.getSource(),k=a.globeSharedBuffers;if(!k)return;let P,L,B;if(n&&(P=h.getTile(n)),A instanceof r.ap?(L=A.texture,B=r.cj(0,0,a.transform)):P&&n&&(L=P.texture,B=r.cj(n.canonical.z,n.canonical.x,a.transform)),!L||!B)return;u||(B=r.a6.scale(r.a6.create(),B,[1,-1,1]));let H=a.context,G=H.gl,$=f.paint.get("raster-resampling")==="nearest"?G.NEAREST:G.LINEAR,j=a.colorModeForDrapableLayerRenderPass(b),W=x.defines;W.push("GLOBE_POLES");let ee=new ot(G.LEQUAL,ot.ReadWrite,a.depthRangeFor3D),X=Float32Array.from(a.transform.expandedFarZProjMatrix),te=Float32Array.from(r.aT(r.ci(new r.bs(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),H.activeTexture.set(G.TEXTURE0),L.bind($,G.CLAMP_TO_EDGE),H.activeTexture.set(G.TEXTURE1),L.bind($,G.CLAMP_TO_EDGE),L.useMipmap&&H.extTextureFilterAnisotropic&&a.transform.pitch>20&&G.texParameterf(G.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax);let[q,ne,le,ce]=n?k.getPoleBuffers(n.canonical.z,!1):k.getPoleBuffers(0,!0),me=f.paint.get("raster-elevation"),Ie;u?(Ie=q,a.renderDefaultNorthPole=me!==0):(Ie=ne,a.renderDefaultSouthPole=me!==0);let be=gg(x.mix),Fe=((Ye,ve,Ae,he,Ce,Xe,at,nt,_t,Rt,Wt,Nt,Ut)=>$p(Ye,ve,Ae,new Float32Array(16),new Float32Array(9),[0,0],he,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Xe,[0,0],nt,2,Rt,Wt,Nt,1,0,Ut))(X,te,B,r.S(a.transform.zoom),0,f,0,me,0,be,x.offset,x.range,b),Re=a.getOrCreateProgram("raster",{defines:W});a.uploadCommonUniforms(H,Re,null),Re.draw(a,G.TRIANGLES,ee,I,j,T,Fe,f.id,Ie,le,ce)}function Yp(u){let n=u._nearZ,a=u.projection.farthestPixelDistance(u),h=a-n,f=.2*u.height,b=n+f;return[n,a,(b-f-n)/h,(b-n)/h]}function Xp(u,n,a,h){if(u)return n instanceof rt&&u instanceof Ns?n.getTextureDescriptor(u,a,!0):{texture:u.texture,mix:gg(h.mix),offset:h.offset,buffer:0,tileSize:1}}function Kp(u,n,a){if(!u)return null;let h=n.getTextureDescriptor(u,a,!0);if(!h)return null;let{texture:f,mix:b,offset:x,tileSize:T,buffer:I,format:A}=h;if(!f||!A)return null;let k=!1;return A==="uint32"&&(k=!0,b[3]=0,b=ch(r.cM,b,[0,a.paint.get("raster-particle-max-speed")]),x=dg(r.cM,x,[0,a.paint.get("raster-particle-max-speed")])),{texture:f,textureOffset:[I/(T+2*I),T/(T+2*I)],tileSize:T,scalarData:k,scale:b,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[A]]}}function Qp(u){let n=u._nearZ,a=u.projection.farthestPixelDistance(u),h=a-n,f=.2*u.height,b=n+f;return[n,a,(b-f-n)/h,(b-n)/h]}let oa=new r.ax(1,0,0,1),jl=new r.ax(0,1,0,1),_g=new r.ax(0,0,1,1),Jp=new r.ax(1,0,1,1),em=new r.ax(0,1,1,1);function Ul(u,n,a,h,f,b,x){let T=u.context,I=u.transform,A=T.gl,k=I.projection.name==="globe",P=k?["PROJECTION_GLOBE_VIEW"]:[],L=r.a6.clone(a.projMatrix);if(k&&r.S(I.zoom)>0){let be=r.aS(a.canonical,I),Fe=r.cN(be);L=r.a6.multiply(new Float32Array(16),I.globeMatrix,Fe),r.a6.multiply(L,I.projMatrix,L)}let B=r.a6.create();B[12]+=2*f/(r.f.devicePixelRatio*I.width),B[13]+=2*b/(r.f.devicePixelRatio*I.height),r.a6.multiply(L,B,L);let H=u.getOrCreateProgram("debug",{defines:P}),G=n.getTileByID(a.key);u.terrain&&u.terrain.setupElevationDraw(G,H);let $=ot.disabled,j=ke.disabled,W=u.colorModeForRenderPass(),ee="$debug";T.activeTexture.set(A.TEXTURE0),u.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),k?G._makeGlobeTileDebugBuffers(u.context,I):G._makeDebugTileBoundsBuffers(u.context,I.projection);let X=G._tileDebugBuffer||u.debugBuffer,te=G._tileDebugIndexBuffer||u.debugIndexBuffer,q=G._tileDebugSegments||u.debugSegments;if(H.draw(u,A.LINE_STRIP,$,j,W,qt.disabled,Gp(L,h),ee,X,te,q,null,null,null,[G._globeTileDebugBorderBuffer]),x){let be=G.latestRawTileData,Fe=Math.floor((be&&be.byteLength||0)/1024),Re=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Re+=` => ${a.overscaledZ}`),Re+=` ${G.state}`,Re+=` ${Fe}kb`,function(Ye,ve){Ye.initDebugOverlayCanvas();let Ae=Ye.debugOverlayCanvas,he=Ye.context.gl,Ce=Ye.debugOverlayCanvas.getContext("2d");Ce.clearRect(0,0,Ae.width,Ae.height),Ce.shadowColor="white",Ce.shadowBlur=2,Ce.lineWidth=1.5,Ce.strokeStyle="white",Ce.textBaseline="top",Ce.font="bold 36px Open Sans, sans-serif",Ce.fillText(ve,5,5),Ce.strokeText(ve,5,5),Ye.debugOverlayTexture.update(Ae),Ye.debugOverlayTexture.bind(he.LINEAR,he.CLAMP_TO_EDGE)}(u,Re)}let ne=n.getTile(a).tileSize,le=512/Math.min(ne,512)*(a.overscaledZ/I.zoom)*.5,ce=G._tileDebugTextBuffer||u.debugBuffer,me=G._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,Ie=G._tileDebugTextSegments||u.debugSegments;H.draw(u,A.TRIANGLES,$,j,Gt.alphaBlended,qt.disabled,Gp(L,r.ax.transparent,le),ee,ce,me,Ie,null,null,null,[G._globeTileDebugTextBuffer])}function tm(u,n,a,h){nr(u,0,n+a/2,u.transform.width,a,h)}function xa(u,n,a,h){nr(u,n-a/2,0,a,u.transform.height,h)}function nr(u,n,a,h,f,b){let x=u.context,T=x.gl;T.enable(T.SCISSOR_TEST),T.scissor(n*r.f.devicePixelRatio,a*r.f.devicePixelRatio,h*r.f.devicePixelRatio,f*r.f.devicePixelRatio),x.clear({color:b}),T.disable(T.SCISSOR_TEST)}let mh=r.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:im}=mh;function nl(u,n,a,h){u.emplaceBack(n,a,h)}class nm{constructor(n){this.vertexArray=new r.az,this.indices=new r.aw,nl(this.vertexArray,-1,-1,1),nl(this.vertexArray,1,-1,1),nl(this.vertexArray,-1,1,1),nl(this.vertexArray,1,1,1),nl(this.vertexArray,-1,-1,-1),nl(this.vertexArray,1,-1,-1),nl(this.vertexArray,-1,1,-1),nl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,im),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=r.aB.simpleSegment(0,0,36,12)}}function vc(u,n,a,h,f,b){let x=u.context.gl,T=n.paint.get("sky-atmosphere-color"),I=n.paint.get("sky-atmosphere-halo-color"),A=n.paint.get("sky-atmosphere-sun-intensity"),k=((P,L,B,H,G)=>({u_matrix_3f:P,u_sun_direction:L,u_sun_intensity:B,u_color_tint_r:[H.r,H.g,H.b,H.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(r.co.fromMat4(r.co.create(),h),f,A,T,I);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),a.draw(u,x.TRIANGLES,ot.disabled,ke.disabled,Gt.unblended,qt.frontCW,k,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}let ly=r.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Qc{constructor(n){let a=new r.cO;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);let h=new r.aw;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,ly.members),this.indexBuffer=n.createIndexBuffer(h),this.segments=r.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Wd=r.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class ct{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Zt{constructor(n){this.colorModeAlphaBlendedWriteRGB=new Gt([1,Kt,1,Kt],r.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Gt([1,0,1,0],r.ax.transparent,[!1,!1,!1,!0]),this.params=new ct,this.updateNeeded=!0,n.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),n.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),n.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(n){let a=n.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Qc(a);let h=this.params.sizeRange,f=this.params.intensityRange,b=function(k){let P=r.aA(30),L=[];for(let B=0;B<k;++B){let H=2*Math.PI*P(),G=Math.acos(1-2*P())-.5*Math.PI;L.push(r.N.fromValues(Math.cos(G)*Math.cos(H),Math.cos(G)*Math.sin(H),Math.sin(G)))}return L}(this.params.starsCount),x=r.aA(300),T=new r.cP,I=new r.aw,A=0;for(let k=0;k<b.length;++k){let P=r.N.scale([],b[k],200),L=Math.max(0,1+.01*h*(1*x()-.5)),B=Math.max(0,1+.01*f*(1*x()-.5));T.emplaceBack(P[0],P[1],P[2],-1,-1,L,B),T.emplaceBack(P[0],P[1],P[2],1,-1,L,B),T.emplaceBack(P[0],P[1],P[2],1,1,L,B),T.emplaceBack(P[0],P[1],P[2],-1,1,L,B),I.emplaceBack(A+0,A+1,A+2),I.emplaceBack(A+0,A+2,A+3),A+=4}this.starsVx=a.createVertexBuffer(T,Wd.members),this.starsIdx=a.createIndexBuffer(I),this.starsSegments=r.aB.simpleSegment(0,0,T.length,I.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(n,a){let h=n.context,f=h.gl,b=n.transform,x=new ot(f.LEQUAL,ot.ReadOnly,[0,1]),T=r.S(b.zoom),I=a.properties.get("color").toArray01(),A=a.properties.get("high-color").toArray01(),k=a.properties.get("space-color").toArray01PremultipliedAlpha(),P=5e-4,L=r.cQ(a.properties.get("horizon-blend"),0,1,P,.25),B=r.cd(n,h,b)&&L===P?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,H=n.frameCounter/1e3%1,G=r.N.length(b.globeCenterInViewSpace),$=Math.sqrt(Math.pow(G,2)-Math.pow(B,2)),j=Math.acos($/G),W=ee=>{let X=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ee&&X.push("ALPHA_PASS");let te=n.getOrCreateProgram("globeAtmosphere",{defines:X}),q=((le,ce,me,Ie,be,Fe,Re,Ye,ve,Ae,he,Ce)=>({u_frustum_tl:le,u_frustum_tr:ce,u_frustum_br:me,u_frustum_bl:Ie,u_horizon:be,u_transition:Fe,u_fadeout_range:Re,u_color:Ye,u_high_color:ve,u_space_color:Ae,u_temporal_offset:he,u_horizon_angle:Ce}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,T,L,I,A,k,H,j);n.uploadCommonUniforms(h,te);let ne=this.atmosphereBuffer;ne&&te.draw(n,f.TRIANGLES,x,ke.disabled,ee?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,qt.backCW,q,ee?"atmosphere_glow_alpha":"atmosphere_glow",ne.vertexBuffer,ne.indexBuffer,ne.segments)};W(!1),W(!0)}drawStars(n,a){let h=r.aa(a.properties.get("star-intensity"),0,1);if(h===0)return;let f=n.context,b=f.gl,x=n.transform,T=n.getOrCreateProgram("stars"),I=r.bi.identity([]);r.bi.rotateX(I,I,-x._pitch),r.bi.rotateZ(I,I,-x.angle),r.bi.rotateX(I,I,r.bj(x._center.lat)),r.bi.rotateY(I,I,-r.bj(x._center.lng));let A=r.a6.fromQuat(new Float32Array(16),I),k=r.a6.multiply([],x.starsProjMatrix,A),P=r.co.fromMat4([],A),L=r.co.invert([],P),B=[0,1,0];r.N.transformMat3(B,B,L),r.N.scale(B,B,this.params.sizeMultiplier);let H=[1,0,0];r.N.transformMat3(H,H,L),r.N.scale(H,H,this.params.sizeMultiplier);let G=($=B,j=H,W=h,{u_matrix:Float32Array.from(k),u_up:$,u_right:j,u_intensity_multiplier:W});var $,j,W;n.uploadCommonUniforms(f,T),this.starsVx&&this.starsIdx&&T.draw(n,b.TRIANGLES,ot.disabled,ke.disabled,this.colorModeAlphaBlendedWriteRGB,qt.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function xc(u,n){let a=[...u],h=n.cameraWorldSizeForFog/n.worldSize,f=r.a6.identity([]);return r.a6.scale(f,f,[h,h,1]),r.a6.multiply(a,f,a),r.a6.multiply(a,n.worldToFogMatrix,a),a}function rr(u,n,a,h){let f=a.material,b=h.context,{baseColorTexture:x,metallicRoughnessTexture:T}=f.pbrMetallicRoughness,{normalTexture:I,occlusionTexture:A,emissionTexture:k}=f;function P(L,B,H){if(L&&(u.push(B),b.activeTexture.set(b.gl.TEXTURE0+H),L.gfxTexture)){let{minFilter:G,magFilter:$,wrapS:j,wrapT:W}=L.sampler;L.gfxTexture.bindExtraParam(G,$,j,W)}}P(x,"HAS_TEXTURE_u_baseColorTexture",wn.BaseColor),P(T,"HAS_TEXTURE_u_metallicRoughnessTexture",wn.MetallicRoughness),P(I,"HAS_TEXTURE_u_normalTexture",wn.Normal),P(A,"HAS_TEXTURE_u_occlusionTexture",wn.Occlusion),P(k,"HAS_TEXTURE_u_emissionTexture",wn.Emission),a.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),n.push(a.texcoordBuffer)),a.colorBuffer&&(u.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),n.push(a.colorBuffer)),a.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),n.push(a.normalBuffer)),a.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),n.push(a.pbrBuffer)),f.alphaMode!=="OPAQUE"&&f.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),f.defined||u.push("DIFFUSE_SHADED"),u.push("USE_STANDARD_DERIVATIVES")}function Zd(u,n,a,h,f,b){let x=a.paint.get("model-opacity"),T=n.context,I=new ot(n.context.gl.LEQUAL,ot.ReadWrite,n.depthRangeFor3D),A=n.transform,k=u.mesh,P=k.material,L=P.pbrMetallicRoughness,B=n.style.fog,H;H=n.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:r.a6.multiply([],h.zScaleMatrix,u.nodeModelMatrix),r.a6.multiply(H,h.negCameraPosMatrix,H);let G=r.a6.invert([],H);r.a6.transpose(G,G);let $=a.paint.get("model-emissive-strength").constantOr(0),j=hh(new Float32Array(u.worldViewProjection),new Float32Array(H),new Float32Array(G),n,x,L.baseColorFactor,P.emissiveFactor,L.metallicFactor,L.roughnessFactor,P,$,a),W={defines:[]},ee=[];rr(W.defines,ee,k,n);let X=n.shadowRenderer;X&&(X.useNormalOffset=!1);let te=null;if(B){let le=xc(u.nodeModelMatrix,n.transform);if(te=new Float32Array(le),A.projection.name!=="globe"){let ce=k.aabb.min,me=k.aabb.max,[Ie,be]=B.getOpacityForBounds(le,ce[0],ce[1],me[0],me[1]);W.overrideFog=Ie>=$i||be>=$i}}let q=ir(n,a.paint.get("model-cutoff-fade-range"));q.shouldRenderCutoff&&W.defines.push("RENDER_CUTOFF");let ne=n.getOrCreateProgram("model",W);n.uploadCommonUniforms(T,ne,null,te,q),n.renderPass!=="shadow"&&X&&X.setupShadowsFromMatrix(u.nodeModelMatrix,ne),ne.draw(n,T.gl.TRIANGLES,I,f,b,k.material.doubleSided?qt.disabled:qt.backCCW,j,a.id,k.vertexBuffer,k.indexBuffer,k.segments,a.paint,n.transform.zoom,void 0,ee)}function Yd(u,n,a,h,f,b,x){let T;T=u.projection.name==="globe"?r.cS(a,u):[...a],r.a6.multiply(T,T,n.matrix);let I=r.a6.multiply([],h,T);if(n.meshes)for(let A of n.meshes){if(A.material.alphaMode!=="BLEND"){x.push({mesh:A,depth:0,modelIndex:f,worldViewProjection:I,nodeModelMatrix:T});continue}let k=r.N.transformMat4([],A.centroid,I);k[2]>0&&b.push({mesh:A,depth:k[2],modelIndex:f,worldViewProjection:I,nodeModelMatrix:T})}if(n.children)for(let A of n.children)Yd(u,A,a,h,f,b,x)}function Te(u,n,a,h){let f=a.shadowRenderer;if(!f)return;let b=f.getShadowPassDepthMode(),x=f.getShadowPassColorMode(),T=f.calculateShadowPassMatrixFromMatrix(n),I=$d(T);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,b,ke.disabled,x,qt.backCCW,I,h.id,u.vertexBuffer,u.indexBuffer,u.segments,h.paint,a.transform.zoom,void 0,void 0)}function rm(u,n,a){let h=n.updateZoomBasedPaintProperties(),f=function(b,x,T){let I,A,k,P=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&P>0){let L=b.terrain,B=L.findDEMTileFor(T);B&&B.dem?I=r.cU.create(L,T,B):P=0}if(P===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),P===x.validForExaggeration&&(P===0||I&&I._demTile&&I._demTile.tileID===x.validForDEMTile.id&&I._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(let L in x.instancesPerModel){let B=x.instancesPerModel[L];for(let H=0;H<B.instancedDataArray.length;++H){let G=(I?P*I.getElevationAt(0|B.instancedDataArray.float32[16*H],0|B.instancedDataArray.float32[16*H+1],!0,!0):0)+B.instancesEvaluatedElevation[H];B.instancedDataArray.float32[16*H+6]=G,A=A?Math.min(x.terrainElevationMin,G):G,k=k?Math.max(x.terrainElevationMax,G):G}}return x.terrainElevationMin=A||0,x.terrainElevationMax=k||0,x.validForExaggeration=P,x.validForDEMTile=I&&I._demTile?{id:I._demTile.tileID,timestamp:I._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,n,a);(h||f)&&(n.uploaded=!1,n.upload(u.context))}let wa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.bS([0,0,0],[r.V,r.V,0])};function bg(u,n){let a=1<<u.canonical.z,h=n.getFreeCameraOptions().position,f=n.elevation,b=u.canonical.x/a,x=(u.canonical.x+1)/a,T=u.canonical.y/a,I=(u.canonical.y+1)/a,A=n._centerAltitude;if(f){let B=f.getMinMaxForTile(u);B&&B.max>A&&(A=B.max)}let k=r.aa(h.x,b,x)-h.x,P=r.aa(h.y,T,I)-h.y,L=r.bl(A,n.center.lat)-h.z;return n._zoomFromMercatorZ(Math.sqrt(k*k+P*P+L*L))}function om(u,n,a,h,f,b,x){let T=u.context,I=u.renderPass==="shadow",A=u.shadowRenderer,k=I&&A?A.getShadowPassDepthMode():new ot(T.gl.LEQUAL,ot.ReadWrite,u.depthRangeFor3D),P=u.isTileAffectedByFog(b);if(a.meshes)for(let L of a.meshes){let B=["MODEL_POSITION_ON_GPU"],H=[],G,$,j;h.instancedDataArray.length>20&&B.push("INSTANCED_ARRAYS");let W=ir(u,n.paint.get("model-cutoff-fade-range"));if(W.shouldRenderCutoff&&B.push("RENDER_CUTOFF"),I&&A)G=u.getOrCreateProgram("modelDepth",{defines:B}),$=$d(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(a.matrix)),j=A.getShadowPassColorMode();else{rr(B,H,L,u),G=u.getOrCreateProgram("model",{defines:B,overrideFog:P});let X=L.material,te=X.pbrMetallicRoughness,q=n.paint.get("model-opacity"),ne=n.paint.get("model-emissive-strength").constantOr(0);$=hh(b.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),u,q,te.baseColorFactor,X.emissiveFactor,te.metallicFactor,te.roughnessFactor,X,ne,n,f),A&&(x.shadowUniformsInitialized?G.setShadowUniformValues(T,A.getShadowUniformValues()):(A.setupShadows(b.toUnwrapped(),G,"model-tile",b.overscaledZ),x.shadowUniformsInitialized=!0)),j=W.shouldRenderCutoff||q<1||X.alphaMode!=="OPAQUE"?Gt.alphaBlended:Gt.unblended}u.uploadCommonUniforms(T,G,b.toUnwrapped(),null,W);let ee=L.material.doubleSided?qt.disabled:qt.backCCW;if(h.instancedDataArray.length>20)H.push(h.instancedDataBuffer),G.draw(u,T.gl.TRIANGLES,k,ke.disabled,j,ee,$,n.id,L.vertexBuffer,L.indexBuffer,L.segments,n.paint,u.transform.zoom,void 0,H,h.instancedDataArray.length);else{let X=I?"u_instance":"u_normal_matrix";for(let te=0;te<h.instancedDataArray.length;++te)$[X]=new Float32Array(h.instancedDataArray.arrayBuffer,64*te,16),G.draw(u,T.gl.TRIANGLES,k,ke.disabled,j,ee,$,n.id,L.vertexBuffer,L.indexBuffer,L.segments,n.paint,u.transform.zoom,void 0,H)}}if(a.children)for(let L of a.children)om(u,n,L,h,f,b,x)}let Jc=[1,-1,1];function cy(u,n,a,h){if(!a.modelManager)return!0;let f=a.modelManager;if(!a.shadowRenderer)return!0;let b=a.shadowRenderer,x=n.aabb,T=!0,I=u.maxHeight;if(I===0){let k=0;for(let P in u.instancesPerModel){let L=f.getModel(P,h);L?k=Math.max(k,Math.max(Math.max(L.aabb.max[0],L.aabb.max[1]),L.aabb.max[2])):T=!1}I=u.maxScale*k*1.41+u.maxVerticalOffset,T&&(u.maxHeight=I)}x.max[2]=I,x.min[2]+=u.terrainElevationMin,x.max[2]+=u.terrainElevationMax,r.N.transformMat4(x.min,x.min,n.tileMatrix),r.N.transformMat4(x.max,x.max,n.tileMatrix);let A=x.intersects(b.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=A===2),A===0}class dy{}class yg{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(n,a,h){{let P=this._storage.get(a.id);if(P)return P.lastUsedFrameIdx=n,P.buf}let f=h.gl,b=f.getBufferParameter(f.ELEMENT_ARRAY_BUFFER,f.BUFFER_SIZE),x=new ArrayBuffer(b),T=new Int16Array(x);f.getBufferSubData(f.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));let I=new r.cW;for(let P=0;P<b/2;P+=3){let L=T[P],B=T[P+1],H=T[P+2];I.emplaceBack(L,B),I.emplaceBack(B,H),I.emplaceBack(H,L)}let A=h.bindVertexArrayOES.current,k=new dy;return k.buf=new Wn(h,I),k.lastUsedFrameIdx=n,this._storage.set(a.id,k),h.bindVertexArrayOES.set(A),k.buf}update(n){for(let[a,h]of this._storage)n-h.lastUsedFrameIdx>30&&(h.buf.destroy(),this._storage.delete(a))}destroy(){for(let[n,a]of this._storage)a.buf.destroy(),this._storage.delete(n)}}class Xd{registerParameter(n,a,h,f,b){}registerButton(n,a,h){}}let Kd={symbol:function(u,n,a,h,f){if(u.renderPass!=="translucent")return;let b=ke.disabled,x=u.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(A,k,P,L,B,H,G){let $=k.transform,j=B==="map",W=H==="map";for(let ee of A){let X=L.getTile(ee),te=X.getBucket(P);if(!te||!te.text||!te.text.segments.get().length)continue;let q=r.b5(te.textSizeData,$.zoom),ne=fs(ee,te.getProjection(),$),le=$.calculatePixelsToTileUnitsMatrix(X),ce=Al(ne,X.tileID.canonical,W,j,$,te.getProjection(),le),me=te.hasIconTextFit()&&te.hasIconData();if(q){let Ie=Math.pow(2,$.zoom-X.tileID.overscaledZ);pg(te,j,W,G,r.cx,$,ce,ee,Ie,q,me)}}}(h,u,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),f);let T=a.paint.get("icon-opacity").constantOr(1)!==0,I=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(T||I)?ph(u,n,a,h,b,x):(T&&ph(u,n,a,h,b,x,{onlyIcons:!0}),I&&ph(u,n,a,h,b,x,{onlyText:!0})),n.map.showCollisionBoxes&&(Xa(u,n,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Xa(u,n,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(u,n,a,h){if(u.renderPass!=="translucent")return;let f=a.paint.get("circle-opacity"),b=a.paint.get("circle-stroke-width"),x=a.paint.get("circle-stroke-opacity"),T=a.layout.get("circle-sort-key").constantOr(1)!==void 0,I=a.paint.get("circle-emissive-strength");if(f.constantOr(1)===0&&(b.constantOr(1)===0||x.constantOr(1)===0))return;let A=u.context,k=A.gl,P=u.transform,L=u.depthModeForSublayer(0,ot.ReadOnly),B=ke.disabled,H=u.colorModeForDrapableLayerRenderPass(I),G=P.projection.name==="globe",$=[r.a5(P.center.lng),r.ae(P.center.lat)],j=[];for(let ee=0;ee<h.length;ee++){let X=h[ee],te=n.getTile(X),q=te.getBucket(a);if(!q||q.projection.name!==P.projection.name)continue;let ne=q.programConfigurations.get(a.id),le=r.cy(a),ce=u.isTileAffectedByFog(X);G&&le.push("PROJECTION_GLOBE_VIEW");let me=u.getOrCreateProgram("circle",{config:ne,defines:le,overrideFog:ce}),Ie=q.layoutVertexBuffer,be=q.globeExtVertexBuffer,Fe=q.indexBuffer,Re=P.projection.createInversionMatrix(P,X.canonical),Ye={programConfiguration:ne,program:me,layoutVertexBuffer:Ie,globeExtVertexBuffer:be,indexBuffer:Fe,uniformValues:r.cz(u,X,te,Re,$,a),tile:te};if(T){let ve=q.segments.get();for(let Ae of ve)j.push({segments:new r.aB([Ae]),sortKey:Ae.sortKey,state:Ye})}else j.push({segments:q.segments,sortKey:0,state:Ye})}T&&j.sort((ee,X)=>ee.sortKey-X.sortKey);let W={useDepthForOcclusion:P.depthOcclusionForSymbolsAndCircles};for(let ee of j){let{programConfiguration:X,program:te,layoutVertexBuffer:q,globeExtVertexBuffer:ne,indexBuffer:le,uniformValues:ce,tile:me}=ee.state,Ie=ee.segments;u.terrain&&u.terrain.setupElevationDraw(me,te,W),u.uploadCommonUniforms(A,te,me.tileID.toUnwrapped()),te.draw(u,k.TRIANGLES,L,B,H,qt.disabled,ce,a.id,q,le,Ie,a.paint,P.zoom,X,[ne])}},heatmap:function(u,n,a,h){if(a.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){let f=u.context,b=f.gl,x=ke.disabled,T=new Gt([b.ONE,b.ONE,b.ONE,b.ONE],r.ax.transparent,[!0,!0,!0,!0]);(function(B,H,G,$){let j=B.gl,W=H.width*$,ee=H.height*$;B.activeTexture.set(j.TEXTURE1),B.viewport.set([0,0,W,ee]);let X=G.heatmapFbo;if(!X||X&&(X.width!==W||X.height!==ee)){X&&X.destroy();let te=j.createTexture();j.bindTexture(j.TEXTURE_2D,te),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),X=G.heatmapFbo=B.createFramebuffer(W,ee,!0,null),function(q,ne,le,ce,me,Ie){let be=q.gl;be.texImage2D(be.TEXTURE_2D,0,q.extRenderToTextureHalfFloat?be.RGBA16F:be.RGBA,me,Ie,0,be.RGBA,q.extRenderToTextureHalfFloat?be.HALF_FLOAT:be.UNSIGNED_BYTE,null),ce.colorAttachment.set(le)}(B,0,te,X,W,ee)}else j.bindTexture(j.TEXTURE_2D,X.colorAttachment.get()),B.bindFramebuffer.set(X.framebuffer)})(f,u,a,u.transform.projection.name==="globe"?.5:.25),f.clear({color:r.ax.transparent});let I=u.transform,A=I.projection.name==="globe",k=A?["PROJECTION_GLOBE_VIEW"]:[],P=A?qt.frontCCW:qt.disabled,L=[r.a5(I.center.lng),r.ae(I.center.lat)];for(let B=0;B<h.length;B++){let H=h[B];if(n.hasRenderableParent(H))continue;let G=n.getTile(H),$=G.getBucket(a);if(!$||$.projection.name!==I.projection.name)continue;let j=u.isTileAffectedByFog(H),W=$.programConfigurations.get(a.id),ee=u.getOrCreateProgram("heatmap",{config:W,defines:k,overrideFog:j}),{zoom:X}=u.transform;u.terrain&&u.terrain.setupElevationDraw(G,ee),u.uploadCommonUniforms(f,ee,H.toUnwrapped());let te=I.projection.createInversionMatrix(I,H.canonical);ee.draw(u,b.TRIANGLES,ot.disabled,x,T,P,Hp(u,H,G,te,L,X,a.paint.get("heatmap-intensity")),a.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,a.paint,u.transform.zoom,W,A?[$.globeExtVertexBuffer]:null)}f.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(f,b){let x=f.context,T=x.gl,I=b.heatmapFbo;if(!I)return;x.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,I.colorAttachment.get()),x.activeTexture.set(T.TEXTURE1);let A=b.colorRampTexture;A||(A=b.colorRampTexture=new r.T(x,b.colorRamp,T.RGBA)),A.bind(T.LINEAR,T.CLAMP_TO_EDGE),f.getOrCreateProgram("heatmapTexture").draw(f,T.TRIANGLES,ot.disabled,ke.disabled,f.colorModeForRenderPass(),qt.disabled,((k,P,L,B)=>({u_image:0,u_color_ramp:1,u_opacity:P.paint.get("heatmap-opacity")}))(0,b),b.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,b.paint,f.transform.zoom)}(u,a))},line:function(u,n,a,h){if(u.renderPass!=="translucent")return;let f=a.paint.get("line-opacity"),b=a.paint.get("line-width");if(f.constantOr(1)===0||b.constantOr(1)===0)return;let x=a.paint.get("line-emissive-strength"),T=u.depthModeForSublayer(0,ot.ReadOnly),I=u.colorModeForDrapableLayerRenderPass(x),A=u.terrain&&u.terrain.renderingToTexture?1:r.f.devicePixelRatio,k=a.paint.get("line-dasharray"),P=k.constantOr(1),L=a.layout.get("line-cap"),B=a.paint.get("line-pattern"),H=B.constantOr(1),G=a.paint.get("line-pattern").constantOr(1),$=a.paint.get("line-opacity").constantOr(1)!==1,j=!G&&$,W=a.paint.get("line-gradient"),ee=H?"linePattern":"line",X=u.context,te=X.gl,q=r.cA(a);u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(j=!1);for(let ne of h){let le=n.getTile(ne);if(H&&!le.patternsLoaded())continue;let ce=le.getBucket(a);if(!ce)continue;u.prepareDrawTile();let me=ce.programConfigurations.get(a.id),Ie=u.isTileAffectedByFog(ne),be=u.getOrCreateProgram(ee,{config:me,defines:q,overrideFog:Ie}),Fe=B.constantOr(null);if(Fe&&le.imageAtlas){let at=le.imageAtlas.patternPositions[Fe.toString()];at&&me.setConstantPatternPositions(at)}let Re=k.constantOr(null),Ye=L.constantOr(null);if(!H&&Re&&Ye&&le.lineAtlas){let at=le.lineAtlas.getDash(Re,Ye);at&&me.setConstantPatternPositions(at)}let[ve,Ae]=a.paint.get("line-trim-offset");(Ye==="round"||Ye==="square")&&ve!==Ae&&(ve===0&&(ve-=1),Ae===1&&(Ae+=1));let he=u.terrain?ne.projMatrix:null,Ce=H?r.cB(u,le,a,he,A,[ve,Ae]):r.cC(u,le,a,he,ce.lineClipsArray.length,A,[ve,Ae]);if(W){let at=ce.gradients[a.id],nt=at.texture;if(a.gradientVersion!==at.version){let _t=256;if(a.stepInterpolant){let Rt=n.getSource().maxzoom,Wt=ne.canonical.z===Rt?Math.ceil(1<<u.transform.maxZoom-ne.canonical.z):1;_t=r.aa(r.cD(ce.maxLineLength/r.V*1024*Wt),256,X.maxTextureSize)}at.gradient=r.cE({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:_t,image:at.gradient||void 0,clips:ce.lineClipsArray}),at.texture?at.texture.update(at.gradient):at.texture=new r.T(X,at.gradient,te.RGBA),at.version=a.gradientVersion,nt=at.texture}X.activeTexture.set(te.TEXTURE1),nt.bind(a.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}P&&(X.activeTexture.set(te.TEXTURE0),le.lineAtlasTexture&&le.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),me.updatePaintBuffers()),H&&(X.activeTexture.set(te.TEXTURE0),le.imageAtlasTexture&&le.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),me.updatePaintBuffers()),u.uploadCommonUniforms(X,be,ne.toUnwrapped());let Xe=at=>{be.draw(u,te.TRIANGLES,T,at,I,qt.disabled,Ce,a.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,a.paint,u.transform.zoom,me,[ce.layoutVertexBuffer2])};if(j){let at=u.stencilModeForClipping(ne).ref;at===0&&u.terrain&&X.clear({stencil:0});let nt={func:te.EQUAL,mask:255};Ce.u_alpha_discard_threshold=.8,Xe(new ke(nt,at,255,te.KEEP,te.KEEP,te.INVERT)),Ce.u_alpha_discard_threshold=0,Xe(new ke(nt,at,255,te.KEEP,te.KEEP,te.KEEP))}else Xe(u.stencilModeForClipping(ne))}j&&(u.resetStencilClippingMasks(),u.terrain&&X.clear({stencil:0}))},fill:function(u,n,a,h){let f=a.paint.get("fill-color"),b=a.paint.get("fill-opacity");if(b.constantOr(1)===0)return;let x=a.paint.get("fill-emissive-strength"),T=u.colorModeForDrapableLayerRenderPass(x),I=a.paint.get("fill-pattern"),A=u.opaquePassEnabledForLayer()&&!I.constantOr(1)&&f.constantOr(r.ax.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===A){let k=u.depthModeForSublayer(1,u.renderPass==="opaque"?ot.ReadWrite:ot.ReadOnly);yc(u,n,a,h,k,T,!1)}if(u.renderPass==="translucent"&&a.paint.get("fill-antialias")){let k=u.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,ot.ReadOnly);yc(u,n,a,h,k,T,!0)}},"fill-extrusion":function(u,n,a,h){let f=a.paint.get("fill-extrusion-opacity"),b=u.context,x=b.gl,T=u.terrain,I=T&&T.renderingToTexture;if(f===0)return;let A=u.conflationActive&&u.layerUsedInConflation(a,n.getSource());if(A&&function(k,P,L,B){for(let H of B){let G=P.getTile(H).getBucket(L);G&&(G.updateReplacement(H,k.replacementSource),G.uploadCentroid(k.context))}}(u,n,a,h),T||A)for(let k of h){let P=n.getTile(k).getBucket(a);P&&ay(u.context,n,k,P,a,T,A)}if(u.renderPass==="shadow"&&u.shadowRenderer){let k=u.shadowRenderer;if(T&&f<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.Z)return;let P=k.getShadowPassDepthMode(),L=k.getShadowPassColorMode();Ot(u,n,a,h,P,ke.disabled,L,A)}else if(u.renderPass==="translucent"){let k=!a.paint.get("fill-extrusion-pattern").constantOr(1),P=a.paint.get("fill-extrusion-color").constantOr(r.ax.white);if(!I&&P.a!==0){let L=new ot(u.context.gl.LEQUAL,ot.ReadWrite,u.depthRangeFor3D);f===1&&k?Ot(u,n,a,h,L,ke.disabled,Gt.unblended,A):(Ot(u,n,a,h,L,ke.disabled,Gt.disabled,A),Ot(u,n,a,h,L,u.stencilModeFor3D(),u.colorModeForRenderPass(),A),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&k&&(!T&&u.transform.projection.name!=="globe"||I)){let L=a.paint.get("fill-extrusion-opacity"),B=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),H=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),G=a.paint.get("fill-extrusion-flood-light-intensity"),$=a.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),j=B>0&&H>0,W=G>0,ee=(te,q,ne)=>(1-ne)*te+ne*q,X=te=>{let q=u.depthModeForSublayer(1,ot.ReadOnly,x.LEQUAL,!0),ne=a.paint.get(te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),le=ee(.1,3,ne),ce=u._showOverdrawInspector;if(!ce){let me=new ke({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Ie=new Gt([x.ONE,x.ONE,x.ONE,x.ONE],r.ax.transparent,[!1,!1,!1,!0],x.MIN);Vl(u,n,a,h,q,me,Ie,qt.disabled,te,"sdf",L,B,H,G,$,le,A,!1)}{let me=ce?ke.disabled:new ke({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Ie=ce?u.colorModeForRenderPass():new Gt([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],r.ax.transparent,[!0,!0,!0,!0]);Vl(u,n,a,h,q,me,Ie,qt.disabled,te,"color",L,B,H,G,$,le,A,!1)}};if(I){let te=(q,ne,le)=>{let ce=u.depthModeForSublayer(1,ot.ReadOnly,x.LEQUAL,!1),me=a.paint.get(q?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ie=ee(.1,3,me);{let be=new Gt([x.ONE,x.ONE,x.ONE,x.ONE],r.ax.transparent,[!1,!1,!1,!0]);Vl(u,n,a,h,ce,ke.disabled,be,qt.disabled,q,"clear",L,B,H,G,$,Ie,A,ne)}{let be=new ke({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Fe=new Gt([x.ONE,x.ONE,x.ONE,x.ONE],r.ax.transparent,[!1,!1,!1,!0],x.MIN);Vl(u,n,a,h,ce,be,Fe,qt.disabled,q,"sdf",L,B,H,G,$,Ie,A,ne)}{let be=q?x.ZERO:x.ONE_MINUS_DST_ALPHA,Fe=new ke({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Re=new Gt([be,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],r.ax.transparent,[!0,!0,!0,!0]);Vl(u,n,a,h,ce,Fe,Re,qt.disabled,q,"color",L,B,H,G,$,Ie,A,ne)}{let be=new Gt([x.ONE,x.ONE,x.ONE,q?x.ZERO:x.ONE],r.ax.transparent,[!1,!1,!1,!0],q?x.FUNC_ADD:x.MAX);Vl(u,n,a,h,ce,ke.disabled,be,qt.disabled,q,"clear",L,B,H,G,$,Ie,A,ne,le)}};if(j||W){let q;if(u.prepareDrawTile(),T){let ne=T.drapeBufferSize[0],le=T.drapeBufferSize[1];q=T.framebufferCopyTexture,q&&(!q||q.size[0]===ne&&q.size[1]===le)||(q&&q.destroy(),q=T.framebufferCopyTexture=new r.T(b,new r.h({width:ne,height:le}),x.RGBA)),q.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexImage2D(x.TEXTURE_2D,0,x.RGBA,0,0,ne,le,0)}j&&te(!0,!1,q),W&&te(!1,!0,q)}}else j&&X(!0),W&&X(!1)}}},hillshade:function(u,n,a,h){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;let f=u.context,b=u.terrain&&u.terrain.renderingToTexture,[x,T]=u.renderPass!=="translucent"||b?[{},h]:u.stencilConfigForOverlap(h);for(let I of T){let A=n.getTile(I);if(A.needsHillshadePrepare&&u.renderPass==="offscreen")kp(u,A,a);else if(u.renderPass==="translucent"){let k=u.depthModeForSublayer(0,ot.ReadOnly),P=a.paint.get("hillshade-emissive-strength"),L=u.colorModeForDrapableLayerRenderPass(P),B=b&&u.terrain?u.terrain.stencilModeForRTTOverlap(I):x[I.overscaledZ];ah(u,I,A,a,k,B,L)}}f.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,n,a,h,f,b){if(u.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;let x=u.transform.projection.name==="globe",T=a.paint.get("raster-elevation")!==0,I=T&&x;if(u.renderElevatedRasterBackface&&!I)return;let A=u.context,k=A.gl,P=n.getSource(),L=function(q,ne,le,ce){let me=ne.paint.get("raster-color"),Ie=q.type==="raster-array",be=[],Fe=ne.paint.get("raster-resampling"),Re=ne.paint.get("raster-color-mix"),Ye=ne.paint.get("raster-color-range"),ve=[Re[0],Re[1],Re[2],0],Ae=Re[3],he=Fe==="nearest"?ce.NEAREST:ce.LINEAR;if(Ie&&(be.push("RASTER_ARRAY"),me||be.push("RASTER_COLOR"),Fe==="linear"&&be.push("RASTER_ARRAY_LINEAR"),he=ce.NEAREST,!Ye&&q.rasterLayers)){let Ce=q.rasterLayers.find(({id:Xe})=>Xe===ne.sourceLayer);Ce&&Ce.fields&&Ce.fields.range&&(Ye=Ce.fields.range)}if(Ye=Ye||[0,1],me){be.push("RASTER_COLOR"),le.activeTexture.set(ce.TEXTURE2),ne.updateColorRamp(Ye);let Ce=ne.colorRampTexture;Ce||(Ce=ne.colorRampTexture=new r.T(le,ne.colorRamp,ce.RGBA)),Ce.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}return{mix:ve,range:Ye,offset:Ae,defines:be,resampling:he}}(P,a,A,k);if(P instanceof r.ap&&!h.length&&!x)return;let B=a.paint.get("raster-emissive-strength"),H=u.colorModeForDrapableLayerRenderPass(B),G=u.terrain&&u.terrain.renderingToTexture,$=!u.options.moving,j=a.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(P instanceof r.ap&&!h.length&&(P.onNorthPole||P.onSouthPole)){let q=T?u.stencilModeFor3D():ke.disabled;return void Zp(!!P.onNorthPole,null,u,n,a,B,L,qt.disabled,q)}if(!h.length)return;let[W,ee]=P instanceof r.ap||G?[{},h]:u.stencilConfigForOverlap(h),X=ee[ee.length-1].overscaledZ;I&&L.defines.push("PROJECTION_GLOBE_VIEW"),T&&L.defines.push("RENDER_CUTOFF");let te=(q,ne,le)=>{for(let ce of q){let me=ce.toUnwrapped(),Ie=n.getTile(ce);if(G&&(!Ie||!Ie.hasData()))continue;A.activeTexture.set(k.TEXTURE0);let be=Xp(Ie,P,a,L);if(!be||!be.texture)continue;let{texture:Fe,mix:Re,offset:Ye,tileSize:ve,buffer:Ae}=be,he,Ce;G?(he=ot.disabled,Ce=ce.projMatrix):T?(he=new ot(k.LEQUAL,ot.ReadWrite,u.depthRangeFor3D),Ce=x?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(me,$)):(he=u.depthModeForSublayer(ce.overscaledZ-X,a.paint.get("raster-opacity")===1?ot.ReadWrite:ot.ReadOnly,k.LESS),Ce=u.transform.calculateProjMatrix(me,$));let Xe=u.terrain&&G?u.terrain.stencilModeForRTTOverlap(ce):W[ce.overscaledZ],at=b?0:a.paint.get("raster-fade-duration");Ie.registerFadeDuration(at);let nt=n.findLoadedParent(ce,0),_t=Fp(Ie,nt,n,u.transform,at),Rt,Wt;u.terrain&&u.terrain.prepareDrawTile(),A.activeTexture.set(k.TEXTURE0),Fe.bind(j,k.CLAMP_TO_EDGE),A.activeTexture.set(k.TEXTURE1),nt?(nt.texture&&nt.texture.bind(j,k.CLAMP_TO_EDGE),Rt=Math.pow(2,nt.tileID.overscaledZ-Ie.tileID.overscaledZ),Wt=[Ie.tileID.canonical.x*Rt%1,Ie.tileID.canonical.y*Rt%1]):Fe.bind(j,k.CLAMP_TO_EDGE),Fe.useMipmap&&A.extTextureFilterAnisotropic&&u.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);let Nt=u.transform,Ut,_i=T?Yp(Nt):[0,0,0,0],ri,ci,li,Ui,On,ki=0;if(I&&P instanceof r.ap&&P.coordinates.length>3)ri=Float32Array.from(r.aT(r.ci(new r.bs(0,0,0)))),ci=Float32Array.from(Nt.globeMatrix),li=Float32Array.from(r.ce(Nt)),Ui=[r.a5(Nt.center.lng),r.ae(Nt.center.lat)],Ut=P.elevatedGlobePerspectiveTransform,On=P.elevatedGlobeGridMatrix||new Float32Array(9);else if(I){let Pi=r.cf(ce.canonical);ki=r.cg(Pi.getCenter().lat),ri=Float32Array.from(r.aT(r.ci(ce.canonical))),ci=Float32Array.from(Nt.globeMatrix),li=Float32Array.from(r.ce(Nt)),Ui=[r.a5(Nt.center.lng),r.ae(Nt.center.lat)],Ut=[0,0],On=Float32Array.from(r.ch(ce.canonical,Pi,ki,Nt.worldSize/Nt._pixelsPerMercatorPixel))}else Ut=P instanceof r.ap?P.perspectiveTransform:[0,0],ri=new Float32Array(16),ci=new Float32Array(9),li=new Float32Array(16),Ui=[0,0],On=new Float32Array(9);let or=$p(Ce,ri,ci,li,On,Wt||[0,0],r.S(u.transform.zoom),Ui,_i,Rt||1,_t,a,Ut,T?a.paint.get("raster-elevation"):0,2,Re,Ye,L.range,ve,Ae,B),Ri=u.isTileAffectedByFog(ce),Yi=u.getOrCreateProgram("raster",{defines:L.defines,overrideFog:Ri});if(u.uploadCommonUniforms(A,Yi,me),P instanceof r.ap){let Pi=P.elevatedGlobeVertexBuffer,Wi=P.elevatedGlobeIndexBuffer;if(G||!x)P.boundsBuffer&&P.boundsSegments&&Yi.draw(u,k.TRIANGLES,he,ke.disabled,H,qt.disabled,or,a.id,P.boundsBuffer,u.quadTriangleIndexBuffer,P.boundsSegments);else if(Pi&&Wi){let jn=Nt.zoom<=r.bG?P.elevatedGlobeSegments:P.getSegmentsForLongitude(Nt.center.lng);jn&&Yi.draw(u,k.TRIANGLES,he,ke.disabled,H,ne,or,a.id,Pi,Wi,jn)}}else if(I){he=new ot(k.LEQUAL,ot.ReadOnly,u.depthRangeFor3D);let Pi=u.globeSharedBuffers;if(Pi){let[Wi,jn,sn]=Pi.getGridBuffers(ki,!1);Yi.draw(u,k.TRIANGLES,he,le||Xe,u.colorModeForRenderPass(),ne,or,a.id,Wi,jn,sn)}}else{let{tileBoundsBuffer:Pi,tileBoundsIndexBuffer:Wi,tileBoundsSegments:jn}=u.getTileBoundsBuffers(Ie);Yi.draw(u,k.TRIANGLES,he,Xe,H,qt.disabled,or,a.id,Pi,Wi,jn)}}if(!(P instanceof r.ap)&&I)for(let ce of q){let me=ce.canonical.y===(1<<ce.canonical.z)-1;ce.canonical.y===0&&Zp(!0,ce,u,n,a,B,L,ne,le||ke.disabled),me&&Zp(!1,ce,u,n,a,B,L,ne===qt.frontCW?qt.backCW:qt.frontCW,le||ke.disabled)}};I?te(ee,u.renderElevatedRasterBackface?qt.backCW:qt.frontCW,u.stencilModeFor3D()):te(ee,qt.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,n,a,h,f,b){u.renderPass==="offscreen"&&function(x,T,I,A){if(!A.length)return;let k=x.context,P=k.gl,L=T.getSource();if(!(L instanceof rt))return;let B=[];for(let $ of A){let j=T.getTile($);if(!(j instanceof Ns))continue;let W=Kp(j,L,I);if(!W)continue;let ee=[W.tileSize,W.tileSize],X=I.tileFramebuffer;X||(X=I.tileFramebuffer=k.createFramebuffer(ee[0],ee[1],!0,null));let te=j.rasterParticleState,q=I.paint.get("raster-particle-count");te||(te=j.rasterParticleState=new Ir(k,$,ee,q));let ne=te.update(I.lastInvalidatedAt);te.numParticles!==q&&te.setNumParticles($,q);let le=te.targetColorTexture;te.targetColorTexture=te.backgroundColorTexture,te.backgroundColorTexture=le;let ce=te.particleVertices0;te.particleVertices0=te.particleVertices1,te.particleVertices1=ce,B.push([$,W,te,ne])}if(B.length===0)return;let H=r.f.now(),G=I.previousDrawTimestamp?.001*(H-I.previousDrawTimestamp):.0167;if(I.previousDrawTimestamp=H,I.hasColorMap()){k.activeTexture.set(P.TEXTURE0+2);let $=I.colorRampTexture;$||($=I.colorRampTexture=new r.T(k,I.colorRamp,P.RGBA)),$.bind(P.LINEAR,P.CLAMP_TO_EDGE)}k.bindFramebuffer.set(I.tileFramebuffer.framebuffer),k.activeTexture.set(P.TEXTURE0),function($,j,W){let ee=$.context,X=ee.gl,te=j.tileFramebuffer;ee.activeTexture.set(X.TEXTURE0);let q={u_texture:0,u_opacity:1.05*(le=j.paint.get("raster-particle-fade-opacity-factor"))/(le+.05)},ne=$.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var le;for(let ce of W){let[,,me,Ie]=ce;te.colorAttachment.set(me.targetColorTexture.texture),ee.viewport.set([0,0,te.width,te.height]),ee.clear({color:r.ax.transparent}),Ie&&(me.backgroundColorTexture.bind(X.NEAREST,X.CLAMP_TO_EDGE),ne.draw($,X.TRIANGLES,ot.disabled,ke.disabled,Gt.alphaBlended,qt.disabled,q,j.id,$.viewportBuffer,$.quadTriangleIndexBuffer,$.viewportSegments))}}(x,I,B),function($,j,W,ee){let X=$.context.gl,te=W.tileFramebuffer,q=$.transform.projection.name==="globe",ne=W.paint.get("raster-particle-max-speed");for(let le of ee){let[ce,me,Ie]=le;me.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE),te.colorAttachment.set(Ie.targetColorTexture.texture);let be=$.getOrCreateProgram("rasterParticleDraw",{defines:me.defines,overrideFog:!1}),Fe=me.scalarData?[]:[0,1,2,3].map(ve=>r.cG[ve](ce));Fe.push(ce);let Re=ce.canonical.x,Ye=ce.canonical.y;for(let ve of Fe){let Ae=j.getTile(q?ve.wrapped():ve);if(!Ae)continue;let he=Ae.rasterParticleState;if(!he)continue;let Ce=ry([ve.canonical.x+(1<<ve.canonical.z)*(ve.wrap-ce.wrap)-Re,ve.canonical.y-Ye],0,me.texture.size,2,ne,me.textureOffset,me.scale,me.offset);be.draw($,X.POINTS,ot.disabled,ke.disabled,Gt.alphaBlended,qt.disabled,Ce,W.id,he.particleVertices0,void 0,he.particleSegment)}}}(x,T,I,B),function($,j,W,ee){let X=$.context.gl,te=j.transformFeedbackObject;te||(te=j.transformFeedbackObject=X.createTransformFeedback()),X.bindTransformFeedback(X.TRANSFORM_FEEDBACK,j.transformFeedbackObject);let q=j.paint.get("raster-particle-max-speed"),ne=ee*j.paint.get("raster-particle-speed-factor")*.3,le=(ce=j.paint.get("raster-particle-reset-rate-factor"),Math.pow(ce,6));var ce;for(let me of W){let[,Ie,be]=me;Ie.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let Fe=ug(0,Ie.texture.size,q,ne,le,Ie.textureOffset,Ie.scale,Ie.offset);$.getOrCreateProgram("rasterParticleUpdate",{defines:Ie.defines,transformFeedback:{bufferMode:X.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw($,X.POINTS,ot.disabled,ke.disabled,Gt.disabled,qt.disabled,Fe,j.id,be.particleVertices0,void 0,be.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:be.particleVertices1,targetIndex:0}])}X.bindTransformFeedback(X.TRANSFORM_FEEDBACK,null)}(x,I,B,G)}(u,n,a,h),u.renderPass==="translucent"&&(function(x,T,I,A,k){let P=x.context,L=P.gl,B=!x.options.moving,H=x.transform.projection.name==="globe";if(!A.length)return;let[G,$]=x.stencilConfigForOverlap(A),j=[];H&&j.push("PROJECTION_GLOBE_VIEW");for(let W of $){let ee=W.toUnwrapped(),X=T.getTile(W);if(!X.rasterParticleState)continue;let te=X.rasterParticleState,q=100;X.registerFadeDuration(q);let ne=T.findLoadedParent(W,0),le=Fp(X,ne,T,x.transform,q),ce,me;x.terrain&&x.terrain.prepareDrawTile(),P.activeTexture.set(L.TEXTURE0),te.targetColorTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),P.activeTexture.set(L.TEXTURE1),ne&&ne.rasterParticleState?(ne.rasterParticleState.targetColorTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),ce=Math.pow(2,ne.tileID.overscaledZ-X.tileID.overscaledZ),me=[X.tileID.canonical.x*ce%1,X.tileID.canonical.y*ce%1]):te.targetColorTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);let Ie=H?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(ee,B),be=x.transform,Fe=Qp(be),Re=r.cf(W.canonical),Ye=r.cg(Re.getCenter().lat),ve,Ae,he,Ce,Xe;H?(ve=Float32Array.from(r.aT(r.ci(W.canonical))),Ae=Float32Array.from(be.globeMatrix),he=Float32Array.from(r.ce(be)),Ce=[r.a5(be.center.lng),r.ae(be.center.lat)],Xe=Float32Array.from(r.ch(W.canonical,Re,Ye,be.worldSize/be._pixelsPerMercatorPixel))):(ve=new Float32Array(16),Ae=new Float32Array(9),he=new Float32Array(16),Ce=[0,0],Xe=new Float32Array(9));let at=ny(Ie,ve,Ae,he,Xe,me||[0,0],r.S(x.transform.zoom),Ce,Fe,ce||1,le,250),nt=x.isTileAffectedByFog(W),_t=x.getOrCreateProgram("rasterParticle",{defines:j,overrideFog:nt});if(x.uploadCommonUniforms(P,_t,ee),H){let Rt=new ot(L.LEQUAL,ot.ReadWrite,x.depthRangeFor3D),Wt=0,Nt=x.globeSharedBuffers;if(Nt){let[Ut,_i,ri]=Nt.getGridBuffers(Ye,Wt!==0);_t.draw(x,L.TRIANGLES,Rt,ke.disabled,Gt.alphaBlended,qt.backCCW,at,I.id,Ut,_i,ri)}}else{let Rt=x.depthModeForSublayer(0,ot.ReadOnly),Wt=G[W.overscaledZ],{tileBoundsBuffer:Nt,tileBoundsIndexBuffer:Ut,tileBoundsSegments:_i}=x.getTileBoundsBuffers(X);_t.draw(x,L.TRIANGLES,Rt,Wt,Gt.alphaBlended,qt.disabled,at,I.id,Nt,Ut,_i)}}x.resetStencilClippingMasks()}(u,n,a,h),u.style.map.triggerRepaint())},background:function(u,n,a,h){let f=a.paint.get("background-color"),b=a.paint.get("background-opacity"),x=a.paint.get("background-emissive-strength");if(b===0)return;let T=u.context,I=T.gl,A=u.transform,k=A.tileSize,P=a.paint.get("background-pattern");if(u.isPatternMissing(P,a.scope))return;let L=!P&&f.a===1&&b===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==L)return;let B=ke.disabled,H=u.depthModeForSublayer(0,L==="opaque"?ot.ReadWrite:ot.ReadOnly),G=u.colorModeForDrapableLayerRenderPass(x),$=P?"backgroundPattern":"background",j,W=h;W||(j=u.getBackgroundTiles(),W=Object.values(j).map(ee=>ee.tileID)),P&&(T.activeTexture.set(I.TEXTURE0),u.imageManager.bind(u.context,a.scope));for(let ee of W){let X=u.isTileAffectedByFog(ee),te=u.getOrCreateProgram($,{overrideFog:X}),q=ee.toUnwrapped(),ne=h?ee.projMatrix:u.transform.calculateProjMatrix(q);u.prepareDrawTile();let le=n?n.getTile(ee):j?j[ee.key]:new fo(ee,k,A.zoom,u),ce=P?Gd(ne,x,b,u,P,a.scope,{tileID:ee,tileSize:k}):qp(ne,x,b,f);u.uploadCommonUniforms(T,te,q);let{tileBoundsBuffer:me,tileBoundsIndexBuffer:Ie,tileBoundsSegments:be}=u.getTileBoundsBuffers(le);te.draw(u,I.TRIANGLES,H,B,G,qt.disabled,ce,a.id,me,Ie,be)}},sky:function(u,n,a){let h=u._atmosphere?r.S(u.transform.zoom):1,f=a.paint.get("sky-opacity")*h;if(f===0)return;let b=u.context,x=a.paint.get("sky-type"),T=new ot(b.gl.LEQUAL,ot.ReadOnly,[0,1]),I=u.frameCounter/1e3%1;x==="atmosphere"?u.renderPass==="offscreen"?a.needsSkyboxCapture(u)&&(function(A,k,P,L){let B=A.context,H=B.gl,G=k.skyboxFbo;if(!G){G=k.skyboxFbo=B.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new nm(B),k.skyboxTexture=B.gl.createTexture(),H.bindTexture(H.TEXTURE_CUBE_MAP,k.skyboxTexture),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_CUBE_MAP,H.TEXTURE_MAG_FILTER,H.LINEAR);for(let ee=0;ee<6;++ee)H.texImage2D(H.TEXTURE_CUBE_MAP_POSITIVE_X+ee,0,H.RGBA,32,32,0,H.RGBA,H.UNSIGNED_BYTE,null)}B.bindFramebuffer.set(G.framebuffer),B.viewport.set([0,0,32,32]);let $=k.getCenter(A,!0),j=A.getOrCreateProgram("skyboxCapture"),W=new Float64Array(16);r.a6.identity(W),r.a6.rotateY(W,W,.5*-Math.PI),vc(A,k,j,W,$,0),r.a6.identity(W),r.a6.rotateY(W,W,.5*Math.PI),vc(A,k,j,W,$,1),r.a6.identity(W),r.a6.rotateX(W,W,.5*-Math.PI),vc(A,k,j,W,$,2),r.a6.identity(W),r.a6.rotateX(W,W,.5*Math.PI),vc(A,k,j,W,$,3),r.a6.identity(W),vc(A,k,j,W,$,4),r.a6.identity(W),r.a6.rotateY(W,W,Math.PI),vc(A,k,j,W,$,5),B.viewport.set([0,0,A.width,A.height])}(u,a),a.markSkyboxValid(u)):u.renderPass==="sky"&&function(A,k,P,L,B){let H=A.context,G=H.gl,$=A.transform,j=A.getOrCreateProgram("skybox");H.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,k.skyboxTexture);let W=((ee,X,te,q,ne)=>({u_matrix:ee,u_sun_direction:X,u_cubemap:0,u_opacity:q,u_temporal_offset:ne}))($.skyboxMatrix,k.getCenter(A,!1),0,L,B);A.uploadCommonUniforms(H,j),j.draw(A,G.TRIANGLES,P,ke.disabled,A.colorModeForRenderPass(),qt.backCW,W,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(u,a,T,f,I):x==="gradient"&&u.renderPass==="sky"&&function(A,k,P,L,B){let H=A.context,G=H.gl,$=A.transform,j=A.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new nm(H)),H.activeTexture.set(G.TEXTURE0);let W=k.colorRampTexture;W||(W=k.colorRampTexture=new r.T(H,k.colorRamp,G.RGBA)),W.bind(G.LINEAR,G.CLAMP_TO_EDGE);let ee=((X,te,q,ne,le)=>({u_matrix:X,u_color_ramp:0,u_center_direction:te,u_radius:r.bj(q),u_opacity:ne,u_temporal_offset:le}))($.skyboxMatrix,k.getCenter(A,!1),k.paint.get("sky-gradient-radius"),L,B);A.uploadCommonUniforms(H,j),j.draw(A,G.TRIANGLES,P,ke.disabled,A.colorModeForRenderPass(),qt.backCW,ee,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)}(u,a,T,f,I)},debug:function(u,n,a,h,f,b){for(let x=0;x<a.length;x++)if(f){let A=new r.ax(h.r*.8,h.g*.8,h.b*.8,1);Ul(u,n,a[x],h,-1,-1,b),Ul(u,n,a[x],h,-1,1,b),Ul(u,n,a[x],h,1,1,b),Ul(u,n,a[x],h,1,-1,b),Ul(u,n,a[x],A,0,0,b)}else Ul(u,n,a[x],h,0,0,b)},custom:function(u,n,a,h){let f=u.context,b=a.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&a.isLayerDraped(n)){if(u.renderPass==="offscreen"){let x=b.prerender;if(x){if(u.setCustomLayerDefaults(),f.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){let T=u.transform.pointMerc;x.call(b,f.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),r.S(u.transform.zoom),[T.x,T.y],u.transform.pixelsPerMeterRatio)}else x.call(b,f.gl,u.transform.customLayerMatrix());f.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){let T=b.renderToTile;if(T){let I=h[0].canonical,A=new r.L(I.x+h[0].wrap*(1<<I.z),I.y,I.z);f.setDepthMode(ot.disabled),f.setStencilMode(ke.disabled),f.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),T.call(b,f.gl,A),f.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),f.setColorMode(u.colorModeForRenderPass()),f.setStencilMode(ke.disabled);let x=b.renderingMode==="3d"?new ot(u.context.gl.LEQUAL,ot.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,ot.ReadOnly);if(f.setDepthMode(x),u.transform.projection.name==="globe"){let T=u.transform.pointMerc;b.render(f.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),r.S(u.transform.zoom),[T.x,T.y],u.transform.pixelsPerMeterRatio)}else b.render(f.gl,u.transform.customLayerMatrix());f.setDirty(),u.setBaseState(),f.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,n,a,h){if(u.renderPass==="opaque")return;let f=a.paint.get("model-opacity");if(f===0)return;let b=a.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!b||u.terrain&&f<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof r.Z))return;let x=u.shadowRenderer,T=a.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,T||(x.enabled=!1));let I=()=>{x&&(x.useNormalOffset=!0,T||(x.enabled=!0))},A=n.getSource();if(u.renderPass==="light-beam"&&A.type!=="batched-model")return;if(A.type==="vector"||A.type==="geojson")return function(j,W,ee,X){let te=j.transform;if(te.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${te.projection.name} projection is not yet implemented`);let q=te.getFreeCameraOptions().position;if(!j.modelManager)return;let ne=j.modelManager;ee.modelManager=ne;let le=j.shadowRenderer;if(!ee._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let ce=ee._unevaluatedLayout._values["model-id"],me=Ht({},ee.layout.get("model-id").parameters);for(let Ie of X){let be=W.getTile(Ie).getBucket(ee);if(!be||be.projection.name!==te.projection.name)continue;let Fe=bg(Ie,te);me.zoom=Fe;let Re=ce.possiblyEvaluate(me);if(rm(j,be,Ie),wa.shadowUniformsInitialized=!1,wa.useSingleShadowCascade=!!le&&le.getMaxCascadeForTile(Ie.toUnwrapped())===0,j.renderPass==="shadow"&&le){if(j.currentShadowCascade===1&&be.isInsideFirstShadowMapFrustum)continue;let Ae=te.calculatePosMatrix(Ie.toUnwrapped(),te.worldSize);if(wa.tileMatrix.set(Ae),wa.shadowTileMatrix=Float32Array.from(le.calculateShadowPassMatrixFromMatrix(Ae)),wa.aabb.min.fill(0),wa.aabb.max[0]=wa.aabb.max[1]=r.V,wa.aabb.max[2]=0,cy(be,wa,j,ee.scope))continue}let Ye=1<<Ie.canonical.z,ve=[((q.x-Ie.wrap)*Ye-Ie.canonical.x)*r.V,(q.y*Ye-Ie.canonical.y)*r.V,q.z*Ye*r.V];for(let Ae in be.instancesPerModel){let he=be.instancesPerModel[Ae];he.features.length>0&&(Ae=Re.evaluate(he.features[0].feature,{}));let Ce=ne.getModel(Ae,ee.scope);if(Ce&&Ce.uploaded)for(let Xe of Ce.nodes)om(j,ee,Xe,he,ve,Ie,wa)}}}(u,n,a,h),void I();if(!A.loaded())return;if(A.type==="batched-model")return function(j,W,ee,X){ee.resetLayerRenderingStats(j);let te=j.context,q=j.transform,ne=j.style.fog,le=j.shadowRenderer;if(q.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${q.projection.name} projection is not yet implemented`);let ce=j.transform.getFreeCameraOptions().position,me=r.N.scale([],[ce.x,ce.y,ce.z],j.transform.worldSize);r.N.negate(me,me);let Ie=r.a6.identity([]),be=r.cR(q.center.lat,q.zoom),Fe=r.a6.fromScaling([],[1,1,1/be]);r.a6.translate(Ie,Ie,me);let Re=ee.paint.get("model-opacity"),Ye=new ot(te.gl.LEQUAL,ot.ReadWrite,j.depthRangeFor3D),ve=new ot(te.gl.LEQUAL,ot.ReadOnly,j.depthRangeFor3D),Ae=new r.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),he=j.renderPass==="shadow",Ce=he&&le?le.getCurrentCascadeFrustum():q.getFrustum(q.scaleZoom(q.worldSize)),Xe=ee.getLayerRenderingStats(),at=function(nt,_t){for(let Rt of X){let Wt=W.getTile(Rt).getBucket(ee);if(!Wt||!Wt.uploaded)continue;let Nt=!1;le&&(Nt=le.getMaxCascadeForTile(Rt.toUnwrapped())===0);let Ut=q.calculatePosMatrix(Rt.toUnwrapped(),q.worldSize),_i=Wt.modelTraits;for(let ri of Wt.getNodesInfo()){if(ri.hiddenByReplacement||!ri.node.meshes)continue;let ci=ri.evaluatedScale,li=ri.node,Ui=0;if(j.terrain&&li.elevation&&(Ui=li.elevation*j.terrain.exaggeration()),ci[0]<=1&&ci[1]<=1&&ci[2]<=1&&(()=>{let jn=ri.getLocalBounds();return Ae.min=[...jn.min],Ae.max=[...jn.max],Ae.min[2]+=Ui,Ae.max[2]+=Ui,r.N.transformMat4(Ae.min,Ae.min,Ut),r.N.transformMat4(Ae.max,Ae.max,Ut),Ae})().intersects(Ce)===0)continue;let On=j.renderPass==="light-beam",ki=[...Ut];r.a6.translate(ki,ki,[(li.anchor?li.anchor[0]:0)*(ci[0]-1),(li.anchor?li.anchor[1]:0)*(ci[1]-1),Ui]),r.N.exactEquals(ci,r.cT)||r.a6.scale(ki,ki,ci),r.a6.multiply(ki,ki,li.matrix);let or=r.a6.multiply([],Fe,ki);r.a6.multiply(or,Ie,or);let Ri=r.a6.invert([],or);r.a6.transpose(Ri,Ri),r.a6.scale(Ri,Ri,Jc);let Yi=r.a6.multiply([],q.expandedFarZProjMatrix,ki),Pi=_i&r.cV.HasMapboxMeshFeatures,Wi=Pi?0:ri.evaluatedRMEA[0][2];for(let jn=0;jn<li.meshes.length;++jn){let sn=li.meshes[jn],Qr=jn===li.lightMeshIndex;if(Qr){if(!On&&!j.terrain&&j.shadowRenderer){j.currentLayer<j.firstLightBeamLayer&&(j.firstLightBeamLayer=j.currentLayer);continue}}else if(On)continue;let bo={defines:[]},sa=[];if(rr(bo.defines,sa,sn,j),Pi||bo.defines.push("DIFFUSE_SHADED"),Nt&&bo.defines.push("SHADOWS_SINGLE_CASCADE"),Xe&&(he?Xe.numRenderedVerticesInShadowPass+=sn.vertexArray.length:Xe.numRenderedVerticesInTransparentPass+=sn.vertexArray.length),he){Te(sn,ki,j,ee);continue}let vs=null;if(ne){let ca=xc(ki,j.transform);if(vs=new Float32Array(ca),q.projection.name!=="globe"){let xs=sn.aabb.min,Wl=sn.aabb.max,[Cc,uu]=ne.getOpacityForBounds(ca,xs[0],xs[1],Wl[0],Wl[1]);bo.overrideFog=Cc>=$i||uu>=$i}}let la=sn.material,Jr;la.occlusionTexture&&la.occlusionTexture.offsetScale&&(Jr=la.occlusionTexture.offsetScale,bo.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!he&&le&&(le.useNormalOffset=!!sn.normalBuffer);let Vr=j.getOrCreateProgram("model",bo);!he&&le&&le.setupShadowsFromMatrix(ki,Vr,le.useNormalOffset),j.uploadCommonUniforms(te,Vr,Rt.toUnwrapped(),vs);let Fo=la.pbrMetallicRoughness;Fo.metallicFactor=.9,Fo.roughnessFactor=.5;let Uo=hh(new Float32Array(Yi),new Float32Array(or),new Float32Array(Ri),j,Re,Fo.baseColorFactor,la.emissiveFactor,Fo.metallicFactor,Fo.roughnessFactor,la,Wi,ee,[0,0,0],Jr);Vr.draw(j,te.gl.TRIANGLES,_t&&!Qr?Ye:ve,ke.disabled,nt?Qr||Re<1||ri.hasTranslucentParts?Gt.alphaBlended:Gt.unblended:Gt.disabled,qt.backCCW,Uo,ee.id,sn.vertexBuffer,sn.indexBuffer,sn.segments,ee.paint,j.transform.zoom,void 0,sa)}}}};(function(nt,_t,Rt,Wt){let Nt=nt.terrain?nt.terrain.exaggeration():0,Ut=nt.transform.zoom;for(let _i of Wt){let ri=_t.getTile(_i).getBucket(Rt);ri&&(nt.conflationActive&&ri.updateReplacement(_i,nt.replacementSource),ri.evaluateScale(nt,Rt),nt.terrain&&Nt>0&&ri.elevationUpdate(nt.terrain,Nt,_i,Rt.source),ri.needsReEvaluation(nt,Ut,Rt)&&ri.evaluate(Rt))}})(j,W,ee,X),Re===1?at(!0,!0):(at(!1,!0),at(!0,!1))}(u,n,a,h),void I();let k=A.getModels(),P=[],L=u.transform.getFreeCameraOptions().position,B=r.N.scale([],[L.x,L.y,L.z],u.transform.worldSize);r.N.negate(B,B);let H=[],G=[],$=0;for(let j of k){let W=a.paint.get("model-rotation").constantOr(null),ee=a.paint.get("model-scale").constantOr(null),X=a.paint.get("model-translation").constantOr(null);j.computeModelMatrix(u,W,ee,X,!0,!0,!1);let te=r.a6.identity([]),q=r.cR(j.position.lat,u.transform.zoom),ne=r.a6.fromScaling([],[1,1,1/q]);r.a6.translate(te,te,B),P.push({zScaleMatrix:ne,negCameraPosMatrix:te});for(let le of j.nodes)Yd(u.transform,le,j.matrix,u.transform.expandedFarZProjMatrix,$,H,G);$++}if(H.sort((j,W)=>W.depth-j.depth),u.renderPass!=="shadow"){if(f===1)for(let j of G)Zd(j,u,a,P[j.modelIndex],ke.disabled,u.colorModeForRenderPass());else{for(let j of G)Zd(j,u,a,P[j.modelIndex],ke.disabled,Gt.disabled);for(let j of G)Zd(j,u,a,P[j.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(let j of H)Zd(j,u,a,P[j.modelIndex],ke.disabled,u.colorModeForRenderPass());I()}else{for(let j of G)Te(j.mesh,j.nodeModelMatrix,u,a);for(let j of H)Te(j.mesh,j.nodeModelMatrix,u,a);I()}}},am={model:function(u,n,a){let h=u.scope,f=n.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,h));if(f.type==="batched-model")return;let b=f.getModels();for(let x of b)x.upload(a.context)},raster:function(u,n,a){let h=n.getSource();if(!(h instanceof rt&&h.loaded()))return;let f=u.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!f)return;let b=u.paint.get("raster-array-band")||h.getInitialBand(f);if(b==null)return;let x=n.getIds().map(T=>n.getTileByID(T));for(let T of x)T.updateNeeded(f,b)&&h.prepareTile(T,f,b)},"raster-particle":function(u,n,a){let h=n.getSource();if(!(h instanceof rt&&h.loaded()))return;let f=u.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!f)return;let b=u.paint.get("raster-particle-array-band")||h.getInitialBand(f);if(b==null)return;let x=n.getIds().map(T=>n.getTileByID(T));for(let T of x)T.updateNeeded(f,b)&&h.prepareTile(T,f,b)}};class vg{constructor(n,a,h,f){this.context=new Ku(n,a),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=f,this._debugParams={showTerrainProxyTiles:!1},f.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=_a.maxUnderzooming+_a.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ya(this),this._wireframeDebugCache=new yg,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(n,a){let h=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new iy(this,n));let f=this._terrain;this.transform.elevation=h?f:null,f.update(n,this.transform,a),this.transform.elevation&&!f.enabled&&(this.transform.elevation=null)}_updateFog(n){let a=n.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[h,f]=a.getFovAdjustedRange(this.transform._fov);if(h>f)return void(this.transform.fogCullDistSq=null);let b=h+.78*(f-h);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(n,a){if(this.width=n*r.f.devicePixelRatio,this.height=a*r.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let h of this.style.order)this.style._mergedLayers[h].resize()}setup(){let n=this.context,a=new r.aN;a.emplaceBack(0,0),a.emplaceBack(r.V,0),a.emplaceBack(0,r.V),a.emplaceBack(r.V,r.V),this.tileExtentBuffer=n.createVertexBuffer(a,r.aP.members),this.tileExtentSegments=r.aB.simpleSegment(0,0,4,2);let h=new r.aN;h.emplaceBack(0,0),h.emplaceBack(r.V,0),h.emplaceBack(0,r.V),h.emplaceBack(r.V,r.V),this.debugBuffer=n.createVertexBuffer(h,r.aP.members),this.debugSegments=r.aB.simpleSegment(0,0,4,5);let f=new r.aN;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(-1,1),f.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(f,r.aP.members),this.viewportSegments=r.aB.simpleSegment(0,0,4,2);let b=new r.av;b.emplaceBack(0,0,0,0),b.emplaceBack(r.V,0,r.V,0),b.emplaceBack(0,r.V,0,r.V),b.emplaceBack(r.V,r.V,r.V,r.V),this.mercatorBoundsBuffer=n.createVertexBuffer(b,r.aR.members),this.mercatorBoundsSegments=r.aB.simpleSegment(0,0,4,2);let x=new r.aw;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(x);let T=new r.aO;for(let A of[0,1,3,2,0])T.emplaceBack(A);this.debugIndexBuffer=n.createIndexBuffer(T),this.emptyTexture=new r.T(n,new r.h({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=r.a6.create();let I=this.context.gl;this.stencilClearMode=new ke({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let n=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,n.TRIANGLES,ot.disabled,this.stencilClearMode,Gt.disabled,qt.disabled,Op(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,h){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(let I of h)if(this._tileClippingMaskIDs[I.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=a.id;let f=this.context,b=f.gl;this.nextStencilID+h.length>256&&this.clearStencil(),f.setColorMode(Gt.disabled),f.setDepthMode(ot.disabled);let x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let T of h){let I=a.getTile(T),A=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:P,tileBoundsSegments:L}=this.getTileBoundsBuffers(I);x.draw(this,b.TRIANGLES,ot.disabled,new ke({func:b.ALWAYS,mask:0},A,255,b.KEEP,b.KEEP,b.REPLACE),Gt.disabled,qt.disabled,Op(T.projMatrix),"$clipping",k,P,L)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let n=this.nextStencilID++,a=this.context.gl;return new ke({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);let a=this.context.gl;return new ke({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){let a=this.context.gl,h=n.sort((x,T)=>T.overscaledZ-x.overscaledZ),f=h[h.length-1].overscaledZ,b=h[0].overscaledZ-f+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();let x={};for(let T=0;T<b;T++)x[T+f]=new ke({func:a.GEQUAL,mask:255},T+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[x,h]}return[{[f]:ke.disabled},h]}colorModeForRenderPass(){let n=this.context.gl;return this._showOverdrawInspector?new Gt([n.CONSTANT_COLOR,n.ONE,n.CONSTANT_COLOR,n.ONE],new r.ax(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Gt.unblended:Gt.alphaBlended}colorModeForDrapableLayerRenderPass(n){let a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Gt([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new r.ax(0,0,0,n===void 0?0:n),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(n,a,h,f=!1){if(!this.opaquePassEnabledForLayer()&&!f)return ot.disabled;let b=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new ot(h||this.context.gl.LEQUAL,a,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,a){this._wireframeDebugCache.update(this.frameCounter),this.style=n,this.options=a;let h=this.style._mergedLayers,f=this.style.order,b=f.map(q=>h[q]),x=this.style._mergedSourceCaches;this.imageManager=n.imageManager,this.modelManager=n.modelManager,this.symbolFadeChange=n.placement.symbolFadeChange(r.f.now()),this.imageManager.beginFrame();let T=0,I=!1;for(let q in x){let ne=x[q];ne.used&&(ne.prepare(this.context),ne.getSource().usedInConflation&&++T)}for(let q of b)q.isHidden(this.transform.zoom)||this.prepareLayer(q);let A={},k={},P={},L={},B={};for(let q in x){let ne=x[q];A[q]=ne.getVisibleCoordinates(),k[q]=A[q].slice().reverse(),P[q]=ne.getVisibleCoordinates(!0).reverse(),L[q]=ne.getShadowCasterCoordinates(),B[q]=ne.sortCoordinatesByDistance(A[q])}let H=q=>{let ne=this.style.getLayerSourceCache(q);return ne&&ne.used?ne.getSource():null};if(T){let q=[];for(let ne of b)this.layerUsedInConflation(ne,H(ne))&&q.push(ne);if(q&&q.length>1){let ne=[];for(let le of q){let ce=this.style.getLayerSourceCache(le);ce&&ce.used&&ce.getSource().usedInConflation&&ne.push({layer:le.fqid,cache:ce})}this.replacementSource.setSources(ne),I=!0}}I||this.replacementSource.clear(),this.conflationActive=I,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let q of b){let ne=q.cutoffRange();if(this.longestCutoffRange=Math.max(ne,this.longestCutoffRange),ne>0){let le=H(q);le&&(this.minCutoffZoom=Math.max(le.minzoom,this.minCutoffZoom)),q.minzoom&&(this.minCutoffZoom=Math.max(q.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let q=0;q<b.length;q++)if(b[q].is3D()){this.opaquePassCutoff=q;break}let G=this.style&&this.style.fog;G?(this._fogVisible=G.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=G.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(P),this.opaquePassCutoff=0);let $=this._shadowRenderer;if($){$.updateShadowParameters(this.transform,this.style.directionalLight);for(let q in x)for(let ne of A[q]){let le={min:0,max:0};this.terrain&&(le=this.terrain.getMinMaxForTile(ne)||le),$.addShadowReceiver(ne.toUnwrapped(),le.min,le.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Zt(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.cZ(this.context.gl))return;this.renderPass="offscreen";for(let q of b){let ne=n.getLayerSourceCache(q);if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;let le=ne?k[ne.id]:void 0;(q.type==="custom"||q.type==="raster"||q.type==="raster-particle"||q.isSky()||le&&le.length)&&this.renderLayer(this,ne,q,le)}this.depthRangeFor3D=[0,1-(b.length+2)*this.numSublayers*this.depthEpsilon];let j=this.terrain;j&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&j.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,L)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let W=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ee=(()=>{if(a.showOverdrawInspector)return r.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!W){let q=this.style.fog.properties.get("color").toArray01();return new r.ax(...q)}if(this.style.fog&&this.transform.projection.supportsFog&&W){let q=this.style.fog.properties.get("space-color").toArray01();return new r.ax(...q)}return r.ax.transparent})();if(this.context.clear({color:ee,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&W&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){let q=b[this.currentLayer],ne=n.getLayerSourceCache(q);if(q.isSky())continue;let le=ne?(q.is3D()?B:k)[ne.id]:void 0;this._renderTileClippingMasks(q,ne,le),this.renderLayer(this,ne,q,le)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&W&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.S(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){let q=b[this.currentLayer],ne=n.getLayerSourceCache(q);q.isSky()&&this.renderLayer(this,ne,q,ne?k[ne.id]:void 0)}function X(q,ne){let le;return ne&&(le=(q.type==="symbol"?P:q.is3D()?B:k)[ne.id]),le}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<f.length;){let q=b[this.currentLayer];if(q.type==="raster"){let ne=n.getLayerSourceCache(q);this.renderLayer(this,ne,q,X(q,ne))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let te=0;for($&&(te=$.getShadowCastingLayerCount());this.currentLayer<f.length;){let q=b[this.currentLayer],ne=n.getLayerSourceCache(q);if(q.isSky())++this.currentLayer;else if(j&&this.style.isLayerDraped(q)){if(q.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=j.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(q,ne,ne?A[ne.id]:void 0),this.renderLayer(this,ne,q,X(q,ne)),!j&&$&&te>0&&q.hasShadowPass()&&--te==0&&($.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let le=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=le;this.currentLayer++){let ce=b[this.currentLayer];if(!ce.hasLightBeamPass())continue;let me=n.getLayerSourceCache(ce);this.renderLayer(this,me,ce,me?k[me.id]:void 0)}this.currentLayer=le,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let q=null;b.forEach(ne=>{let le=n.getLayerSourceCache(ne);le&&!ne.isHidden(this.transform.zoom)&&le.getVisibleCoordinates().length&&(!q||q.getSource().maxzoom<le.getSource().maxzoom)&&(q=le)}),q&&this.options.showTileBoundaries&&Kd.debug(this,q,q.getVisibleCoordinates(),r.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Kd.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(q){let ne=q.transform.padding;tm(q,q.transform.height-(ne.top||0),3,oa),tm(q,ne.bottom||0,3,jl),xa(q,ne.left||0,3,_g),xa(q,q.transform.width-(ne.right||0),3,Jp);let le=q.transform.centerPoint;(function(ce,me,Ie,be){nr(ce,me-1,Ie-10,2,20,be),nr(ce,me-10,Ie-1,20,2,be)})(q,le.x,q.transform.height-le.y,em)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),I||(this.conflationActive=!1)}prepareLayer(n){this.gpuTimingStart(n);let{unsupportedLayers:a}=this.transform.projection,h=!a||!a.includes(n.type);if(am[n.type]&&(h||this.terrain&&n.type==="custom")){let f=this.style.getLayerSourceCache(n);am[n.type](n,f,this)}this.gpuTimingEnd()}renderLayer(n,a,h,f){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||h.type==="model"||h.type==="raster"||h.type==="raster-particle"||f&&f.length)&&(this.id=h.id,this.gpuTimingStart(h),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(h.type)||n.terrain&&h.type==="custom")&&Kd[h.type](n,a,h,f,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;let a=this.context.extTimerQuery,h=this.context.gl,f=this.gpuTimers[n.id];f||(f=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:h.createQuery()}),f.calls++,h.beginQuery(a.TIME_ELAPSED_EXT,f.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let n=this.context.extTimerQuery,a=this.context.gl,h=a.createQuery();this.deferredRenderGpuTimeQueries.push(h),a.beginQuery(n.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){let n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){let a={};for(let h in n){let f=n[h],b=this.context.extTimerQuery,x=b.getQueryParameter(f.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(f.query),a[h]=x}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;let a=this.context.extTimerQuery,h=this.context.gl,f=0;for(let b of n)f+=a.getQueryParameter(b,h.QUERY_RESULT)/1e6,a.deleteQueryEXT(b);return f}translatePosMatrix(n,a,h,f,b){if(!h[0]&&!h[1])return n;let x=b?f==="map"?this.transform.angle:0:f==="viewport"?-this.transform.angle:0;if(x){let A=Math.sin(x),k=Math.cos(x);h=[h[0]*k-h[1]*A,h[0]*A+h[1]*k]}let T=[b?h[0]:r.a3(a,h[0],this.transform.zoom),b?h[1]:r.a3(a,h[1],this.transform.zoom),0],I=new Float32Array(16);return r.a6.translate(I,n,T),I}saveTileTexture(n){let a=n.size[0],h=this._tileTextures[a];h?h.push(n):this._tileTextures[a]=[n]}getTileTexture(n){let a=this._tileTextures[n];return a&&a.length>0?a.pop():null}isPatternMissing(n,a){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString(),a)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(n,a,h){let f=h===void 0?this.terrain&&this.terrain.renderingToTexture:h,b=this.terrain&&this.terrain.exaggeration()===0,x=[];return this.style&&this.style.enable3dLights()&&(n==="globeRaster"||n==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):f||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT"),b&&x.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||f||a!==void 0&&!a||x.push("FOG","FOG_DITHERING"),f&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(n,a){this.cache=this.cache||{};let h=a&&a.defines||[],f=a&&a.config,b=a&&a.transformFeedback,x=this.currentGlobalDefines(n,a&&a.overrideFog,a&&a.overrideRtt).concat(h),T=Np.cacheKey(Ap[n],n,x,f);return this.cache[T]||(this.cache[T]=new Np(this.context,n,Ap[n],f,oy[n],x,b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(n,a){if(this.style.enable3dLights()){let h=this.style.directionalLight,f=this.style.ambientLight;if(h&&f){let b=((x,T)=>{let I=x.properties.get("direction"),A=x.properties.get("color").toArray01(),k=x.properties.get("intensity"),P=T.properties.get("color").toArray01(),L=T.properties.get("intensity"),B=[I.x,I.y,I.z],H=r.cn(P,L),G=r.cn(A,k);return{u_lighting_ambient_color:H,u_lighting_directional_dir:B,u_lighting_directional_color:G,u_ground_radiance:Lp(B,G,H)}})(h,f);a.setLightsUniformValues(n,b)}}}uploadCommonUniforms(n,a,h,f,b){if(this.uploadCommonLightUniforms(n,a),this.terrain&&this.terrain.renderingToTexture)return;let x=this.style.fog;if(x){let T=x.getOpacity(this.transform.pitch),I=((A,k,P,L,B,H,G,$,j,W,ee,X)=>{let te=A.transform,q=k.properties.get("color").toArray01();q[3]=L;let ne=A.frameCounter/1e3%1,[le,ce]=k.properties.get("vertical-range");return{u_fog_matrix:P?te.calculateFogTileMatrix(P):X||A.identityMat,u_fog_range:k.getFovAdjustedRange(te._fov),u_fog_color:q,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(le,ce),ce],u_fog_temporal_offset:ne,u_frustum_tl:B,u_frustum_tr:H,u_frustum_br:G,u_frustum_bl:$,u_globe_pos:j,u_globe_radius:W,u_viewport:ee,u_globe_transition:r.S(te.zoom),u_is_globe:+(te.projection.name==="globe")}})(this,x,h,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.f.devicePixelRatio,this.transform.height*r.f.devicePixelRatio],f);a.setFogUniformValues(n,I)}b&&a.setCutoffUniformValues(n,b.uniformValues)}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){let n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){let n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let n=this._backgroundTiles,a=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(let f of h)a[f.key]=n[f.key]||new fo(f,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(n,a){return!(!n.is3D()||n.minzoom&&n.minzoom>this.transform.zoom||n.sourceLayer!=="building"&&(!a||a.type!=="batched-model"))}isTileAffectedByFog(n){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[n.key];return a||(this._cachedTileFogOpacities[n.key]=a=this.style.fog.getOpacityForTile(n)),a[0]>=$i||a[1]>=$i}}function Qd(u,n){let a=!1,h=null,f=()=>{h=null,a&&(u(),h=setTimeout(f,n),a=!1)};return()=>(a=!0,h||f(),h)}class fh{constructor(n){this._hashName=n&&encodeURIComponent(n),r.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Qd(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let n=this._map;if(!n)return"";let a=sm(n);if(this._hashName){let h=this._hashName,f=!1,b=location.hash.slice(1).split("&").map(x=>{let T=x.split("=")[0];return T===h?(f=!0,`${T}=${a}`):x}).filter(x=>x);return f||b.push(`${h}=${a}`),`#${b.join("&")}`}return`#${a}`}_getCurrentHash(){let n=location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(a=h)}),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){let n=this._map;if(!n)return!1;let a=this._getCurrentHash();if(a.length>=3&&!a.some(h=>isNaN(h))){let h=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:h,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function sm(u,n){let a=u.getCenter(),h=Math.round(100*u.getZoom())/100,f=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,f),x=Math.round(a.lng*b)/b,T=Math.round(a.lat*b)/b,I=u.getBearing(),A=u.getPitch(),k=n?`/${x}/${T}/${h}`:`${h}/${T}/${x}`;return(I||A)&&(k+="/"+Math.round(10*I)/10),A&&(k+=`/${Math.round(A)}`),k}let Jd={linearity:.3,easing:r.c_(0,0,.3,1)},aa=r.e({deceleration:2500,maxSpeed:1400},Jd),uy=r.e({deceleration:20,maxSpeed:1400},Jd),gh=r.e({deceleration:1e3,maxSpeed:360},Jd),Zn=r.e({deceleration:1e3,maxSpeed:90},Jd);class fn{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.f.now(),settings:n})}_drainInertiaBuffer(){let n=this._inertiaBuffer,a=r.f.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let a={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);let h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(a.pan.mag()){let b=Ka(a.pan.mag(),h,r.e({},aa,n||{}));f.offset=a.pan.mult(b.amount/a.pan.mag()),f.center=this._map.transform.center,eu(f,b)}if(a.zoom){let b=Ka(a.zoom,h,uy);f.zoom=this._map.transform.zoom+b.amount,eu(f,b)}if(a.bearing){let b=Ka(a.bearing,h,gh);f.bearing=this._map.transform.bearing+r.aa(b.amount,-179,179),eu(f,b)}if(a.pitch){let b=Ka(a.pitch,h,Zn);f.pitch=this._map.transform.pitch+b.amount,eu(f,b)}if(f.zoom||f.bearing){let b=a.pinchAround===void 0?a.around:a.pinchAround;f.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),f.noMoveStart=!0,f}}function eu(u,n){(!u.duration||u.duration<n.duration)&&(u.duration=n.duration,u.easing=n.easing)}function Ka(u,n,a){let{maxSpeed:h,linearity:f,deceleration:b}=a,x=r.aa(u*f/(n/1e3),-h,h),T=Math.abs(x)/(b*f);return{easing:a.easing,duration:1e3*T,amount:x*(T/2)}}class jo extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,h,f={}){let b=Wo(a.getCanvasContainer(),h),x=a.unproject(b);super(n,r.e({point:b,lngLat:x,originalEvent:h},f)),this._defaultPrevented=!1,this.target=a}}class rl extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,h){let f=n==="touchend"?h.changedTouches:h.touches,b=ur(a.getCanvasContainer(),f),x=b.map(I=>a.unproject(I)),T=b.reduce((I,A,k,P)=>I.add(A.div(P.length)),new r.P(0,0));super(n,{points:b,point:T,lngLats:x,lngLat:a.unproject(T),originalEvent:h}),this._defaultPrevented=!1}}class lm extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,h){super(n,{originalEvent:h}),this._defaultPrevented=!1}}class cm{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new lm(n.type,this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new jo(n.type,this._map,n))}mouseup(n){this._map.fire(new jo(n.type,this._map,n))}preclick(n){let a=r.e({},n);a.type="preclick",this._map.fire(new jo(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new jo(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new jo(n.type,this._map,n))}mouseover(n){this._map.fire(new jo(n.type,this._map,n))}mouseout(n){this._map.fire(new jo(n.type,this._map,n))}touchstart(n){return this._firePreventable(new rl(n.type,this._map,n))}touchmove(n){this._map.fire(new rl(n.type,this._map,n))}touchend(n){this._map.fire(new rl(n.type,this._map,n))}touchcancel(n){this._map.fire(new rl(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Gl{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new jo(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new jo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new jo(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hl{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&n.button===0&&(Oi(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;let h=a,f=this._startPos,b=this._lastPos;if(!f||!b||b.equals(h)||!this._box&&h.dist(f)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=ye("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));let x=Math.min(f.x,h.x),T=Math.max(f.x,h.x),I=Math.min(f.y,h.y),A=Math.max(f.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${I}px)`,this._box.style.width=T-x+"px",this._box.style.height=A-I+"px")})}mouseupWindow(n,a){if(!this._active)return;let h=this._startPos,f=a;if(h&&n.button===0){if(this.reset(),xn(),h.x!==f.x||h.y!==f.y)return this._map.fire(new r.b("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(h,f,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),vi(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new r.b(n,{originalEvent:a}))}}function ed(u,n){let a={};for(let h=0;h<u.length;h++)a[u[h].identifier]=n[h];return a}class _h{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),h.length===this.numTouches&&(this.centroid=function(f){let b=new r.P(0,0);for(let x of f)b._add(x);return b.div(f.length)}(a),this.touches=ed(h,a)))}touchmove(n,a,h){if(this.aborted||!this.centroid)return;let f=ed(h,a);for(let b in this.touches){let x=f[b];(!x||x.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,a,h){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){let f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class tu{constructor(n){this.singleTap=new _h(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,h){this.singleTap.touchstart(n,a,h)}touchmove(n,a,h){this.singleTap.touchmove(n,a,h)}touchend(n,a,h){let f=this.singleTap.touchend(n,a,h);if(f){let b=n.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(f)<30;if(b&&x||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class dm{constructor(){this._zoomIn=new tu({numTouches:1,numTaps:2}),this._zoomOut=new tu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,h){this._zoomIn.touchstart(n,a,h),this._zoomOut.touchstart(n,a,h)}touchmove(n,a,h){this._zoomIn.touchmove(n,a,h),this._zoomOut.touchmove(n,a,h)}touchend(n,a,h){let f=this._zoomIn.touchend(n,a,h),b=this._zoomOut.touchend(n,a,h);return f?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(f)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let um={0:1,2:2};class ys{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;let h=Lo(n);this._correctButton(n,h)&&(this._lastPoint=a,this._eventButton=h)}mousemoveWindow(n,a){let h=this._lastPoint;if(h){if(n.preventDefault(),this._eventButton!=null&&function(f,b){let x=um[b];return f.buttons===void 0||(f.buttons&x)!==x}(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(h,a)}}mouseupWindow(n){this._lastPoint&&Lo(n)===this._eventButton&&(this._moved&&xn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hm extends ys{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return a===0&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class iu extends ys{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){let h=.8*(a.x-n.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(n){n.preventDefault()}}class bh extends ys{_correctButton(n,a){return a===0&&n.ctrlKey||a===2}_move(n,a){let h=-.5*(a.y-n.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(n){n.preventDefault()}}class pm{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),r.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(n,a,h){return this._calculateTransform(n,a,h)}touchmove(n,a,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!r.c$())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,h)}}touchend(n,a,h){this._calculateTransform(n,a,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,h){h.length>0&&(this._active=!0);let f=ed(h,a),b=new r.P(0,0),x=new r.P(0,0),T=0;for(let A in f){let k=f[A],P=this._touches[A];P&&(b._add(k),x._add(k.sub(P)),T++,f[A]=k)}if(this._touches=f,T<this._minTouches||!x.mag())return;let I=x.div(T);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(T),panDelta:I}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ye("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Kr{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,h){return{}}touchstart(n,a,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,h){let f=this._firstTwoTouches;if(!f)return;n.preventDefault();let[b,x]=f,T=td(h,a,b),I=td(h,a,x);if(!T||!I)return;let A=this._aroundCenter?null:T.add(I).div(2);return this._move([T,I],A,n)}touchend(n,a,h){if(!this._firstTwoTouches)return;let[f,b]=this._firstTwoTouches,x=td(h,a,f),T=td(h,a,b);x&&T||(this._active&&xn(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function td(u,n,a){for(let h=0;h<u.length;h++)if(u[h].identifier===a)return n[h]}function yh(u,n){return Math.log(u/n)/Math.LN2}class nu extends Kr{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){let h=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(yh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:yh(this._distance,h),pinchAround:a}}}function $l(u,n){return 180*u.angleWith(n)/Math.PI}class mm extends Kr{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){let h=this._vector;if(this._vector=n[0].sub(n[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:$l(this._vector,h),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());let a=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;let f=$l(n,h);return Math.abs(f)<a}}function ru(u){return Math.abs(u.y)>Math.abs(u.x)}class fm extends Kr{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,ru(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,h){let f=this._lastPoints;if(!f)return;let b=n[0].sub(f[0]),x=n[1].sub(f[1]);return this._map._cooperativeGestures&&!r.c$()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(b,x,h.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+x.y)/2*-.5})}gestureBeginsVertically(n,a,h){if(this._valid!==void 0)return this._valid;let f=n.mag()>=2,b=a.mag()>=2;if(!f&&!b)return;if(!f||!b)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;let x=n.y>0==a.y>0;return ru(n)&&ru(a)&&x}}let wc={panStep:100,bearingStep:15,pitchStep:10};class ou{constructor(){let n=wc;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,h=0,f=0,b=0,x=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?h=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?h=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?f=1:(n.preventDefault(),x=-1);break;case 40:n.shiftKey?f=-1:(n.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(h=0,f=0),{cameraAnimation:T=>{let I=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:gm,zoom:a?Math.round(I)+a*(n.shiftKey?2:1):I,bearing:T.getBearing()+h*this._bearingStep,pitch:T.getPitch()+f*this._pitchStep,offset:[-b*this._panStep,-x*this._panStep],center:T.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gm(u){return u*(2-u)}let au=4.000244140625,_m=1/450;class xg{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=_m,r.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||r.c$()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY,h=r.f.now(),f=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,a!==0&&a%au==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(f*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let a=Wo(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){let A=this._type==="wheel"&&Math.abs(this._delta)>au?this._wheelZoomRate:this._defaultZoomRate,k=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&k!==0&&(k=1/k);let P=a(),L=Math.pow(2,P),B=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):L;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(B*k))),this._type==="wheel"&&(this._startZoom=P,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let h=typeof this._targetZoom=="number"?this._targetZoom:a(),f=this._startZoom,b=this._easing,x,T=!1;if(this._type==="wheel"&&f&&b){let A=Math.min((r.f.now()-this._lastWheelEventTime)/200,1),k=b(A);x=r.U(f,h,k),A<1?this._frameId||(this._frameId=!0):T=!0}else x=h,T=!0;this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let I=x-a();return I*this._lastDelta<0&&(I=0),{noInertia:!0,needsRenderFrame:!T,zoomDelta:I,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=r.d0;if(this._prevEase){let h=this._prevEase,f=(r.f.now()-h.start)/h.duration,b=h.easing(f+.01)-h.easing(f),x=.27/Math.sqrt(b*b+1e-4)*.01,T=Math.sqrt(.0729-x*x);a=r.c_(x,T,.25,1)}return this._prevEase={start:r.f.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ye("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class wg{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Cg{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(n.shiftKey?-1:1),around:h.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tg{constructor(){this._tap=new tu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,h){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=a[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(n,a,h))}touchmove(n,a,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;let f=a[0],b=f.y-this._swipePoint.y;return this._swipePoint=f,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,a,h)}touchend(n,a,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(n,a,h)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eg{constructor(n,a,h){this._el=n,this._mousePan=a,this._touchPan=h}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ig{constructor(n,a,h){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Sg{constructor(n,a,h,f){this._el=n,this._touchZoom=a,this._touchRotate=h,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let su=u=>u.zoom||u.drag||u.pitch||u.rotate;class Mg extends r.b{}class Ag{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){let h=r.N.sub([],a,n);this.radius=r.N.length(h[2]<0?r.N.div([],h,this.constants):[h[0],h[1],0])}projectRay(n){r.N.div(n,n,this.constants),r.N.normalize(n,n),r.N.mul(n,n,this.constants);let a=r.N.scale([],n,this.radius);if(a[2]>0){let h=r.N.scale([],[0,0,1],r.N.dot(a,[0,0,1])),f=r.N.scale([],r.N.normalize([],[a[0],a[1],0]),this.radius),b=r.N.add([],a,r.N.scale([],r.N.sub([],r.N.add([],f,h),a),2));a[0]=b[0],a[1]=b[1]}return a}}function lu(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class hy{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fn(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ag,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),r.aY(["handleEvent","handleWindowEvent"],this);let h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(let[f,b,x]of this._listeners){let T=f===document?this.handleWindowEvent:this.handleEvent;f.addEventListener(b,T,x)}}destroy(){for(let[n,a,h]of this._listeners){let f=n===document?this.handleWindowEvent:this.handleEvent;n.removeEventListener(a,f,h)}}_addDefaultHandlers(n){let a=this._map,h=a.getCanvasContainer();this._add("mapEvent",new cm(a,n));let f=a.boxZoom=new Hl(a,n);this._add("boxZoom",f);let b=new dm,x=new Cg;a.doubleClickZoom=new wg(x,b),this._add("tapZoom",b),this._add("clickZoom",x);let T=new Tg;this._add("tapDragZoom",T);let I=a.touchPitch=new fm(a);this._add("touchPitch",I);let A=new iu(n),k=new bh(n);a.dragRotate=new Ig(n,A,k),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);let P=new hm(n),L=new pm(a,n);a.dragPan=new Eg(h,P,L),this._add("mousePan",P),this._add("touchPan",L,["touchZoom","touchRotate"]);let B=new mm,H=new nu;a.touchZoomRotate=new Sg(h,H,B,T),this._add("touchRotate",B,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Gl(a));let G=a.scrollZoom=new xg(a,this);this._add("scrollZoom",G,["mousePan"]);let $=a.keyboard=new ou;this._add("keyboard",$);for(let j of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[j]&&a[j].enable(n[j])}_add(n,a,h){this._handlers.push({handlerName:n,handler:a,allowed:h}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(let{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!su(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,a,h){for(let f in n)if(f!==h&&(!a||a.indexOf(f)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){let a=[];for(let h of n)this._el.contains(h.target)&&a.push(h);return a}handleEvent(n,a){this._updatingCamera=!0;let h=n.type==="renderFrame",f=h?void 0:n,b={needsRenderFrame:!1},x={},T={},I=n.touches?this._getMapTouches(n.touches):void 0,A=I?ur(this._el,I):h?void 0:Wo(this._el,n);for(let{handlerName:L,handler:B,allowed:H}of this._handlers){if(!B.isEnabled())continue;let G;this._blockedByActive(T,H,L)?B.reset():B[a||n.type]&&(G=B[a||n.type](n,A,I),this.mergeHandlerResult(b,x,G,L,f),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||B.isActive())&&(T[L]=B)}let k={};for(let L in this._previousActiveHandlers)T[L]||(k[L]=f);this._previousActiveHandlers=T,(Object.keys(k).length||lu(b))&&(this._changes.push([b,x,k]),this._triggerRenderFrame()),(Object.keys(T).length||lu(b))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:P}=b;P&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],P(this._map))}mergeHandlerResult(n,a,h,f,b){if(!h)return;r.e(n,h);let x={handlerName:f,originalEvent:h.originalEvent||b};h.zoomDelta!==void 0&&(a.zoom=x),h.panDelta!==void 0&&(a.drag=x),h.pitchDelta!==void 0&&(a.pitch=x),h.bearingDelta!==void 0&&(a.rotate=x)}_applyChanges(){let n={},a={},h={};for(let[f,b,x]of this._changes)f.panDelta&&(n.panDelta=(n.panDelta||new r.P(0,0))._add(f.panDelta)),f.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+f.pitchDelta),f.around!==void 0&&(n.around=f.around),f.aroundCoord!==void 0&&(n.aroundCoord=f.aroundCoord),f.pinchAround!==void 0&&(n.pinchAround=f.pinchAround),f.noInertia&&(n.noInertia=f.noInertia),r.e(a,b),r.e(h,x);this._updateMapTransform(n,a,h),this._changes=[]}_updateMapTransform(n,a,h){let f=this._map,b=f.transform,x=W=>[W.x,W.y,W.z];if((W=>{let ee=this._eventsInProgress.drag;return ee&&!this._handlersById[ee.handlerName].isActive()})()&&!lu(n)){let W=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),W!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&f._stop(!0),!lu(n))return void this._fireEvents(a,h,!0);let{panDelta:T,zoomDelta:I,bearingDelta:A,pitchDelta:k,around:P,aroundCoord:L,pinchAround:B}=n;b._isCameraConstrained&&(I>0&&(I=0),b._isCameraConstrained=!1),B!==void 0&&(P=B),(I||(W=>a[W]&&!this._eventsInProgress[W])("drag"))&&P&&(this._dragOrigin=x(b.pointCoordinate3D(P)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",f._stop(!0),P=P||f.transform.centerPoint,A&&(b.bearing+=A),k&&(b.pitch+=k),b._updateCameraState();let H=[0,0,0];if(T)if(b.projection.name==="mercator"){let W=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(P).dir),ee=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(P.sub(T)).dir);H[0]=ee[0]-W[0],H[1]=ee[1]-W[1]}else{let W=b.pointCoordinate(P);if(b.projection.name==="globe"){T=T.rotate(-b.angle);let ee=b._pixelsPerMercatorPixel/b.worldSize;H[0]=-T.x*r.d1(r.au(W.y))*ee,H[1]=-T.y*r.d1(b.center.lat)*ee}else{let ee=b.pointCoordinate(P.sub(T));W&&ee&&(H[0]=ee.x-W.x,H[1]=ee.y-W.y)}}let G=b.zoom,$=[0,0,0];if(I){let W=x(L||b.pointCoordinate3D(P)),ee={dir:r.N.normalize([],r.N.sub([],W,b._camera.position))};if(ee.dir[2]<0){let X=b.zoomDeltaToMovement(W,I);r.N.scale($,ee.dir,X)}}let j=r.N.add(H,H,$);b._translateCameraConstrained(j),I&&Math.abs(b.zoom-G)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,h,!0)}_fireEvents(n,a,h){let f=su(this._eventsInProgress),b=su(n),x={};for(let k in n){let{originalEvent:P}=n[k];this._eventsInProgress[k]||(x[`${k}start`]=P),this._eventsInProgress[k]=n[k]}!f&&b&&this._fireEvent("movestart",b.originalEvent);for(let k in x)this._fireEvent(k,x[k]);b&&this._fireEvent("move",b.originalEvent);for(let k in n){let{originalEvent:P}=n[k];this._fireEvent(k,P)}let T={},I;for(let k in this._eventsInProgress){let{handlerName:P,originalEvent:L}=this._eventsInProgress[k];this._handlersById[P].isActive()||(delete this._eventsInProgress[k],I=a[P]||L,T[`${k}end`]=I)}for(let k in T)this._fireEvent(k,T[k]);let A=su(this._eventsInProgress);if(h&&(f||b)&&!A){this._updatingCamera=!0;let k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=L=>L!==0&&-this._bearingSnap<L&&L<this._bearingSnap;k?(P(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:I})):(this._map.fire(new r.b("moveend",{originalEvent:I})),P(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new r.b(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Mg("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let Dg="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class yr extends r.E{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,r.aY(["_renderFrameCallback"],this)}getCenter(){return new r.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,h){return n=r.P.convert(n).mult(-1),this.panTo(this.transform.center,r.e({offset:n},a),h)}panTo(n,a,h){return this.easeTo(r.e({center:n},a),h)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,h){return this.easeTo(r.e({zoom:n},a),h)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,h){return this.easeTo(r.e({bearing:n},a),h)}resetNorth(n,a){return this.rotateTo(0,r.e({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(r.e({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){n=r.ad.convert(n);let h=a&&a.bearing||0,f=a&&a.pitch||0,b=n.getNorthWest(),x=n.getSouthEast();return this._cameraForBounds(this.transform,b,x,h,f,a)}_extendCameraOptions(n){let a={top:0,bottom:0,right:0,left:0};if(typeof(n=r.e({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){let h=n.padding;n.padding={top:h,bottom:h,right:h,left:h}}return n.padding=r.e(a,n.padding),n}_minimumAABBFrustumDistance(n,a){let h=a.max[0]-a.min[0],f=a.max[1]-a.min[1];return h/f>n.aspect?h/(2*Math.tan(.5*n.fovX)*n.aspect):f/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,a,h,f,b,x){let T=n.clone(),I=this._extendCameraOptions(x);T.bearing=f,T.pitch=b;let A=r.bn.convert(a),k=r.bn.convert(h),P=.5*(A.lat+k.lat),L=.5*(A.lng+k.lng),B=r.d2(P,L),H=r.N.normalize([],B),G=r.N.normalize([],r.N.cross([],H,[0,1,0])),$=r.N.cross([],G,H),j=[G[0],G[1],G[2],0,$[0],$[1],$[2],0,H[0],H[1],H[2],0,0,0,0,1],W=[B,r.d2(A.lat,A.lng),r.d2(k.lat,A.lng),r.d2(k.lat,k.lng),r.d2(A.lat,k.lng),r.d2(P,A.lng),r.d2(P,k.lng),r.d2(A.lat,L),r.d2(k.lat,L)],ee=r.bS.fromPoints(W.map(Ce=>[r.N.dot(G,Ce),r.N.dot($,Ce),r.N.dot(H,Ce)])),X=r.N.transformMat4([],ee.center,j);r.N.squaredLength(X)===0&&r.N.set(X,0,0,1),r.N.normalize(X,X),r.N.scale(X,X,r.ab),T.center=r.d3(X);let te=T.getWorldToCameraMatrix(),q=r.a6.invert(new Float64Array(16),te);ee=r.bS.applyTransform(ee,r.a6.multiply([],te,j)),r.N.transformMat4(X,X,te);let ne=.5*(ee.max[2]-ee.min[2]),le=this._minimumAABBFrustumDistance(T,ee),ce=r.N.scale([],[0,0,1],ne),me=r.N.add(ce,X,ce),Ie=le+(T.pitch===0?0:r.N.distance(X,me)),be=T.globeCenterInViewSpace,Fe=r.N.sub([],X,[be[0],be[1],be[2]]);r.N.normalize(Fe,Fe),r.N.scale(Fe,Fe,Ie);let Re=r.N.add([],X,Fe);r.N.transformMat4(Re,Re,q);let Ye=r.d4/r.ab,ve=r.N.length(Re),Ae=r.bl(Math.max(ve*Ye-r.d4,Number.EPSILON),0),he=Math.min(T.zoomFromMercatorZAdjusted(Ae),I.maxZoom);return he>.5*(r.bG+r.bx)?(T.setProjection({name:"mercator"}),T.zoom=he,this._cameraForBounds(T,a,h,f,b,x)):{center:T.center,zoom:he,bearing:f,pitch:b}}queryTerrainElevation(n,a){let h=this.transform.elevation;return h?(a=r.e({},{exaggerated:!0},a),h.getAtPoint(r.L.fromLngLat(n),null,a.exaggerated)):null}_cameraForBounds(n,a,h,f,b,x){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,a,h,f,b,x);let T=n.clone(),I=this._extendCameraOptions(x),A=T.padding;T.bearing=f,T.pitch=b;let k=r.bn.convert(a),P=r.bn.convert(h),L=new r.bn(k.lng,P.lat),B=new r.bn(P.lng,k.lat),H=T.project(k),G=T.project(P),$=this.queryTerrainElevation(k),j=this.queryTerrainElevation(P),W=this.queryTerrainElevation(L),ee=this.queryTerrainElevation(B),X=[[H.x,H.y,Math.min($||0,j||0,W||0,ee||0)],[G.x,G.y,Math.max($||0,j||0,W||0,ee||0)]],te=r.bS.fromPoints(X),q=T.getWorldToCameraMatrix(),ne=r.a6.invert(new Float64Array(16),q);te=r.bS.applyTransform(te,q);let le=r.N.sub([],te.max,te.min),ce=A.left||0,me=A.right||0,Ie=A.bottom||0,be=A.top||0,{left:Fe,right:Re,top:Ye,bottom:ve}=I.padding,Ae=.5*(ce+me),he=.5*(be+Ie),Ce=Math.min(T.scaleZoom(T.scale*Math.min((T.width-(ce+me+Fe+Re))/le[0],(T.height-(Ie+be+ve+Ye))/le[1])),I.maxZoom),Xe=T.scale/T.zoomScale(Ce);te=new r.bS([te.min[0]-(Fe+Ae)*Xe,te.min[1]-(ve+he)*Xe,te.min[2]],[te.max[0]+(Re+Ae)*Xe,te.max[1]+(Ye+he)*Xe,te.max[2]]);let at=.5*le[2],nt=this._minimumAABBFrustumDistance(T,te),_t=[0,0,1,0];r.a7.transformMat4(_t,_t,q),r.a7.normalize(_t,_t);let Rt=r.N.scale([],_t,nt+at),Wt=r.N.add([],te.center,Rt),Nt=(typeof I.offset.x=="number"&&typeof I.offset.y=="number"?new r.P(I.offset.x,I.offset.y):r.P.convert(I.offset)).rotate(-r.bj(f));te.center[0]-=Nt.x*Xe,te.center[1]+=Nt.y*Xe,r.N.transformMat4(te.center,te.center,ne),r.N.transformMat4(Wt,Wt,ne);let Ut=[te.center[0],te.center[1],Wt[2]*T.pixelsPerMeter];r.N.scale(Ut,Ut,1/T.worldSize);let _i=r.at(Ut[0]),ri=r.au(Ut[1]),ci=Math.min(T._zoomFromMercatorZ(Ut[2]),I.maxZoom),li=new r.bn(_i,ri);return T.mercatorFromTransition&&ci<.5*(r.bG+r.bx)?(T.setProjection({name:"globe"}),T.zoom=ci,this._cameraForBounds(T,a,h,f,b,x)):{center:li,zoom:ci,bearing:f,pitch:b}}fitBounds(n,a,h){let f=this.cameraForBounds(n,a);return this._fitInternal(f,a,h)}fitScreenCoordinates(n,a,h,f,b){let x=r.P.convert(n),T=r.P.convert(a),I=new r.P(Math.min(x.x,T.x),Math.min(x.y,T.y)),A=new r.P(Math.max(x.x,T.x),Math.max(x.y,T.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,T))return this;let k=this.transform.pointLocation3D(I),P=this.transform.pointLocation3D(A),L=this.transform.pointLocation3D(new r.P(I.x,A.y)),B=this.transform.pointLocation3D(new r.P(A.x,I.y)),H=[Math.min(k.lng,P.lng,L.lng,B.lng),Math.min(k.lat,P.lat,L.lat,B.lat)],G=[Math.max(k.lng,P.lng,L.lng,B.lng),Math.max(k.lat,P.lat,L.lat,B.lat)],$=f&&f.pitch?f.pitch:this.getPitch(),j=this._cameraForBounds(this.transform,H,G,h,$,f);return this._fitInternal(j,f,b)}_fitInternal(n,a,h){return n?(delete(a=r.e(n,a)).padding,a.linear?this.easeTo(a,h):this.flyTo(a,h)):this}jumpTo(n,a){this.stop();let h=n.preloadOnly?this.transform.clone():this.transform,f=!1,b=!1,x=!1;return"zoom"in n&&h.zoom!==+n.zoom&&(f=!0,h.zoom=+n.zoom),n.center!==void 0&&(h.center=r.bn.convert(n.center)),"bearing"in n&&h.bearing!==+n.bearing&&(b=!0,h.bearing=+n.bearing),"pitch"in n&&h.pitch!==+n.pitch&&(x=!0,h.pitch=+n.pitch),n.padding==null||h.isPaddingEqual(n.padding)||(h.padding=n.padding),n.preloadOnly?(this._preloadTiles(h),this):(this.fire(new r.b("movestart",a)).fire(new r.b("move",a)),f&&this.fire(new r.b("zoomstart",a)).fire(new r.b("zoom",a)).fire(new r.b("zoomend",a)),b&&this.fire(new r.b("rotatestart",a)).fire(new r.b("rotate",a)).fire(new r.b("rotateend",a)),x&&this.fire(new r.b("pitchstart",a)).fire(new r.b("pitch",a)).fire(new r.b("pitchend",a)),this.fire(new r.b("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(Dg),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){let h=this.transform;if(!h.projection.supportsFreeCamera)return r.w(Dg),this;this.stop();let f=h.zoom,b=h.pitch,x=h.bearing;h.setFreeCameraOptions(n);let T=f!==h.zoom,I=b!==h.pitch,A=x!==h.bearing;return this.fire(new r.b("movestart",a)).fire(new r.b("move",a)),T&&this.fire(new r.b("zoomstart",a)).fire(new r.b("zoom",a)).fire(new r.b("zoomend",a)),A&&this.fire(new r.b("rotatestart",a)).fire(new r.b("rotate",a)).fire(new r.b("rotateend",a)),I&&this.fire(new r.b("pitchstart",a)).fire(new r.b("pitch",a)).fire(new r.b("pitchend",a)),this.fire(new r.b("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),((n=r.e({offset:[0,0],duration:500,easing:r.d0},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);let h=this.transform,f=this.getZoom(),b=this.getBearing(),x=this.getPitch(),T=this.getPadding(),I="zoom"in n?+n.zoom:f,A="bearing"in n?this._normalizeBearing(n.bearing,b):b,k="pitch"in n?+n.pitch:x,P="padding"in n?n.padding:h.padding,L=r.P.convert(n.offset),B,H,G;if(h.projection.name==="globe"){let ce=r.L.fromLngLat(h.center),me=L.rotate(-h.angle);ce.x+=me.x/h.worldSize,ce.y+=me.y/h.worldSize;let Ie=ce.toLngLat(),be=r.bn.convert(n.center||Ie);this._normalizeCenter(be),B=h.centerPoint.add(me),H=new r.P(ce.x,ce.y).mult(h.worldSize),G=new r.P(r.a5(be.lng),r.ae(be.lat)).mult(h.worldSize).sub(H)}else{B=h.centerPoint.add(L);let ce=h.pointLocation(B),me=r.bn.convert(n.center||ce);this._normalizeCenter(me),H=h.project(ce),G=h.project(me).sub(H)}let $=h.zoomScale(I-f),j,W;n.around&&(j=r.bn.convert(n.around),W=h.locationPoint(j));let ee=this._zooming||I!==f,X=this._rotating||b!==A,te=this._pitching||k!==x,q=!h.isPaddingEqual(P),ne=ce=>me=>{if(ee&&(ce.zoom=r.U(f,I,me)),X&&(ce.bearing=r.U(b,A,me)),te&&(ce.pitch=r.U(x,k,me)),q&&(ce.interpolatePadding(T,P,me),B=ce.centerPoint.add(L)),j)ce.setLocationAtPoint(j,W);else{let Ie=ce.zoomScale(ce.zoom-f),be=I>f?Math.min(2,$):Math.max(.5,$),Fe=Math.pow(be,1-me),Re=ce.unproject(H.add(G.mult(me*Fe)).mult(Ie));ce.setLocationAtPoint(ce.renderWorldCopies?Re.wrap():Re,B)}return n.preloadOnly||this._fireMoveEvents(a),ce};if(n.preloadOnly){let ce=this._emulate(ne,n.duration,h);return this._preloadTiles(ce),this}let le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ee,this._rotating=X,this._pitching=te,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,le),this._ease(ne(h),ce=>{h.cameraElevationReference==="sea"&&h.recenterOnTerrain(),this._afterEase(a,ce)},n),this}_prepareEase(n,a,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||h.moving||this.fire(new r.b("movestart",n)),this._zooming&&!h.zooming&&this.fire(new r.b("zoomstart",n)),this._rotating&&!h.rotating&&this.fire(new r.b("rotatestart",n)),this._pitching&&!h.pitching&&this.fire(new r.b("pitchstart",n))}_fireMoveEvents(n){this.fire(new r.b("move",n)),this._zooming&&this.fire(new r.b("zoom",n)),this._rotating&&this.fire(new r.b("rotate",n)),this._pitching&&this.fire(new r.b("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let h=this._zooming,f=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,h&&this.fire(new r.b("zoomend",n)),f&&this.fire(new r.b("rotateend",n)),b&&this.fire(new r.b("pitchend",n)),this.fire(new r.b("moveend",n))}flyTo(n,a){if(this._prefersReducedMotion(n)){let ve=r.ac(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ve,a)}this.stop(),n=r.e({offset:[0,0],speed:1.2,curve:1.42,easing:r.d0},n);let h=this.transform,f=this.getZoom(),b=this.getBearing(),x=this.getPitch(),T="zoom"in n?r.aa(+n.zoom,h.minZoom,h.maxZoom):f,I="bearing"in n?this._normalizeBearing(n.bearing,b):b,A="pitch"in n?+n.pitch:x,k=h.zoomScale(T-f),P=r.P.convert(n.offset),L=h.centerPoint.add(P),B=h.pointLocation(L),H=n.center;if(H&&n.padding){let ve=this._cameraForBounds(this.transform,H,H,I,A,n);ve&&(H=ve.center)}H=r.bn.convert(H||B),this._normalizeCenter(H);let G=h.project(B),$=h.project(H).sub(G),j=n.curve,W=Math.max(h.width,h.height),ee=W/k,X=$.mag();if("minZoom"in n){let ve=r.aa(Math.min(n.minZoom,f,T),h.minZoom,h.maxZoom),Ae=W/h.zoomScale(ve-f);j=Math.sqrt(Ae/X*2)}let te=j*j;function q(ve){let Ae=(ee*ee-W*W+(ve?-1:1)*te*te*X*X)/(2*(ve?ee:W)*te*X);return Math.log(Math.sqrt(Ae*Ae+1)-Ae)}function ne(ve){return(Math.exp(ve)-Math.exp(-ve))/2}function le(ve){return(Math.exp(ve)+Math.exp(-ve))/2}let ce=q(0),me=function(ve){return le(ce)/le(ce+j*ve)},Ie=function(ve){return W*((le(ce)*(ne(Ae=ce+j*ve)/le(Ae))-ne(ce))/te)/X;var Ae},be=(q(1)-ce)/j;if(Math.abs(X)<1e-6||!isFinite(be)){if(Math.abs(W-ee)<1e-6)return this.easeTo(n,a);let ve=ee<W?-1:1;be=Math.abs(Math.log(ee/W))/j,Ie=function(){return 0},me=function(Ae){return Math.exp(ve*j*Ae)}}n.duration="duration"in n?+n.duration:1e3*be/("screenSpeed"in n?+n.screenSpeed/j:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);let Fe=b!==I,Re=A!==x,Ye=ve=>Ae=>{let he=Ae*be,Ce=1/me(he);ve.zoom=Ae===1?T:f+ve.scaleZoom(Ce),Fe&&(ve.bearing=r.U(b,I,Ae)),Re&&(ve.pitch=r.U(x,A,Ae));let Xe=Ae===1?H:ve.unproject(G.add($.mult(Ie(he))).mult(Ce));return ve.setLocationAtPoint(ve.renderWorldCopies?Xe.wrap():Xe,L),ve._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),ve};if(n.preloadOnly){let ve=this._emulate(Ye,n.duration,h);return this._preloadTiles(ve),this}return this._zooming=!0,this._rotating=Fe,this._pitching=Re,this._prepareEase(a,!1),this._ease(Ye(h),()=>this._afterEase(a),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,a)}if(!n){let h=this.handlers;h&&h.stop(!1)}return this}_ease(n,a,h){h.animate===!1||h.duration===0?(n(1),a()):(this._easeStart=r.f.now(),this._easeOptions=h,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let n=Math.min((r.f.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=r.bh(n,-180,180);let h=Math.abs(n-a);return Math.abs(n-360-a)<h&&(n-=360),Math.abs(n+360-a)<h&&(n+=360),n}_normalizeCenter(n){let a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;let h=n.lng-a.center.lng;n.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&r.f.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,a,h){let f=Math.ceil(15*a/1e3),b=[],x=n(h.clone());for(let T=0;T<=f;T++){let I=x(T/f);b.push(I.clone())}return b}}class bm{constructor(n={}){this.options=n,r.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){let a=this.options&&this.options.compact;return this._map=n,this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ye("button","mapboxgl-ctrl-attrib-button",this._container),ye("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ye("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,a){let h=this._map._getUIString(`AttributionControl.${a}`);n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",h)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));let a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.d5.ACCESS_TOKEN}];if(n){let h=a.reduce((f,b,x)=>(b.value&&(f+=`${b.key}=${b.value}${x<a.length-1?"&":""}`),f),"?");n.href=`${r.d5.FEEDBACK_URL}/${h}#${sm(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){let f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}let a=this._map.style._mergedSourceCaches;for(let f in a){let b=a[f];if(b.used){let x=b.getSource();x.attribution&&n.indexOf(x.attribution)<0&&n.push(x.attribution)}}n.sort((f,b)=>f.length-b.length),n=n.filter((f,b)=>{for(let x=b+1;x<n.length;x++)if(n[x].indexOf(f)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));let h=n.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,n.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class kg{constructor(){r.aY(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=ye("div","mapboxgl-ctrl");let a=ye("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(let a in n){let h=n[a].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){let n=this._container.children;if(n.length){let a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Rg{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){let a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){let a=this._currentlyRunning,h=a?this._queue.concat(a):this._queue;for(let f of h)if(f.id===n)return void(f.cancelled=!0)}run(n=0){let a=this._currentlyRunning=this._queue;this._queue=[];for(let h of a)if(!h.cancelled&&(h.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function cu(u,n,a){if(u=new r.bn(u.lng,u.lat),n){let h=new r.bn(u.lng-360,u.lat),f=new r.bn(u.lng+360,u.lat),b=360*Math.ceil(Math.abs(u.lng-a.center.lng)/360),x=a.locationPoint(u).distSqr(n),T=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint(h).distSqr(n)<x&&(T||Math.abs(h.lng-a.center.lng)<b)?u=h:a.locationPoint(f).distSqr(n)<x&&(T||Math.abs(f.lng-a.center.lng)<b)&&(u=f)}for(;Math.abs(u.lng-a.center.lng)>180;){let h=a.locationPoint(u);if(h.x>=0&&h.y>=0&&h.x<=a.width&&h.y<=a.height)break;u.lng>a.center.lng?u.lng-=360:u.lng+=360}return u}let vh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ym extends r.E{constructor(n,a){if(super(),(n instanceof HTMLElement||a)&&(n=r.e({element:n},a)),r.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=r.P.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=ye("div");let b=41,x=27,T=Je("svg",{display:"block",height:b*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${b}`},this._element),I=Je("radialGradient",{id:"shadowGradient"},Je("defs",{},T));Je("stop",{offset:"10%","stop-opacity":.4},I),Je("stop",{offset:"100%","stop-opacity":.05},I),Je("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),Je("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),Je("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),Je("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=r.P.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});let h=this._element.classList;for(let b in vh)h.remove(`mapboxgl-marker-anchor-${b}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`);let f=n&&n.className?n.className.trim().split(/\s+/):[];h.add(...f),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){let n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=r.bn.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){let f=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){let a=n.code,h=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(n){let a=n.originalEvent.target,h=this._element;this._popup&&(a===h||h.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let n=this._map,a=this._pos;if(!n||!a)return!1;let h=n.unproject(a),f=n.getFreeCameraOptions();if(!f.position)return!1;let b=f.position.toLngLat();return b.distanceTo(h)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){let n=this._map;if(!n)return;let a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();let h=n.unproject(a),f;n._showingGlobe()&&r.d6(n.transform,this._lngLat)?f=0:(f=1-n._queryFogOpacity(h),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(f*=this._occludedOpacity)),this._element.style.opacity=`${f}`,this._element.style.pointerEvents=f>0?"auto":"none",this._popup&&this._popup._setOpacity(f),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let n=this._pos;if(!n||!this._map)return;let a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${vh[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){let n=this._pos,a=this._map,h=this.getPitchAlignment();if(!a||!n||h!=="map")return"";if(!a._showingGlobe()){let I=a.getPitch();return I?`rotateX(${I}deg)`:""}let f=r.bF(r.d7(a.transform,this._lngLat)),b=n.sub(r.d8(a.transform)),x=Math.abs(b.x)+Math.abs(b.y);if(x===0)return"";let T=f/x;return`rotateX(${-b.y*T}deg) rotateY(${b.x*T}deg)`}_calculateZTransform(){let n=this._pos,a=this._map;if(!a||!n)return"";let h=0,f=this.getRotationAlignment();if(f==="map")if(a._showingGlobe()){let b=a.project(new r.bn(this._lngLat.lng,this._lngLat.lat+.001)),x=a.project(new r.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);h=r.bF(Math.atan2(x.y,x.x))-90}else h=-a.getBearing();else if(f==="horizon"){let b=r.O(4,6,a.getZoom()),x=r.d8(a.transform);x.y+=b*a.transform.height;let T=n.sub(x),I=r.bF(Math.atan2(T.y,T.x));h=(I>90?I-270:I+90)*(1-b)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(n){cancelAnimationFrame(this._updateFrameId);let a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=cu(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),n===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=r.P.convert(n),this._update(),this}addClassName(n){return this._element.classList.add(n),this}removeClassName(n){return this._element.classList.remove(n),this}toggleClassName(n){return this._element.classList.toggle(n)}_onMove(n){let a=this._map;if(!a)return;let h=this._pointerdownPos,f=this._positionDelta;if(h&&f){if(!this._isDragging){let b=this._clickTolerance||a._clickTolerance;if(n.point.dist(h)<b)return;this._isDragging=!0}this._pos=n.point.sub(f),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.b("dragstart"))),this.fire(new r.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.b("dragend")),this._state="inactive"}_addDragHandler(n){let a=this._map,h=this._pos;a&&h&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(h),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;let a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let Pg={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Og=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Fg(u=new r.P(0,0),n="bottom"){if(typeof u=="number"){let a=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(n){case"top":return new r.P(0,u);case"top-left":return new r.P(a,a);case"top-right":return new r.P(-a,a);case"bottom":return new r.P(0,-u);case"bottom-left":return new r.P(a,-a);case"bottom-right":return new r.P(-a,-a);case"left":return new r.P(u,0);case"right":return new r.P(-u,0)}return new r.P(0,0)}return u instanceof r.P||Array.isArray(u)?r.P.convert(u):r.P.convert(u[n]||[0,0])}class vm{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;let a=r.cc((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,h){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+h}}let du={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Lg={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class xm{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}let xh={showCompass:!0,showZoom:!0,visualizePitch:!1};class ol{constructor(n,a,h=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new iu({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,h&&(this.mousePitch=new bh({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),r.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),Oi()}move(n,a){let h=this.map,f=this.mouseRotate.mousemoveWindow(n,a),b=f&&f.bearingDelta;if(b&&h.setBearing(h.getBearing()+b),this.mousePitch){let x=this.mousePitch.mousemoveWindow(n,a),T=x&&x.pitchDelta;T&&h.setPitch(h.getPitch()+T)}}off(){let n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){vi(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(r.e({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Wo(this.element,n)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Wo(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ur(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=ur(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let wh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Oo={maxWidth:100,unit:"metric"},ql={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.dk,supported:z,setRTLTextPlugin:r.dm,getRTLTextPluginStatus:r.dn,Map:class extends yr{constructor(u){let n=u;if((u=r.e({},Lg,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&r.d9(window)&&(u.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Io(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._repaint=!1,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new Rg,this._domRenderTaskQueue=new Rg,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aC(),this._locale=r.e({},du,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new vm(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new r.da(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?Ht({},u.contextCreateOptions):{},typeof u.container=="string"){let a=document.getElementById(u.container);if(!a)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=a}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),r.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new xm,this._tp=u.devtools?new Xd(this):new Xd,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,a=>{this.repaint=a}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,a=>{this.showTileAABBs=a}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,a=>{this.showPadding=a}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new hy(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||r.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),u.hash&&(this._hash=new fh(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){n.center==null&&n.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});let a=u.bounds;a&&(this.resize(),this.fitBounds(a,r.e({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new bm({customAttribution:u.customAttribution})),this._logoControl=new kg,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new r.b(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new r.b(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(u,n){if(n===void 0&&(n=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new r.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let a=u.onAdd(this);this._controls.push(u);let h=this._controlPositions[n];return n.indexOf("bottom")!==-1?h.insertBefore(a,h.firstChild):h.appendChild(a),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new r.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let n=this._controls.indexOf(u);return n>-1&&this._controls.splice(n,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let n=!this._moving;return n&&this.fire(new r.b("movestart",u)).fire(new r.b("move",u)),this.fire(new r.b("resize",u)),n&&this.fire(new r.b("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(r.ad.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new r.b("zoomstart")).fire(new r.b("zoom")).fire(new r.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new r.b("zoomstart")).fire(new r.b("zoom")).fire(new r.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new r.b("pitchstart")).fire(new r.b("pitch")).fire(new r.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new r.b("pitchstart")).fire(new r.b("pitch")).fire(new r.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(n=>n==="auto"?navigator.language:n):u}setLanguage(u){let n=this._parseLanguage(u);if(!this.style||n===this._language)return this;this._language=n,this.style.reloadSources();for(let a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let u=this.transform,n=u.projection.name,a;n==="globe"&&u.zoom>=r.bx?(u.setMercatorFromTransition(),a=!0):n==="mercator"&&u.zoom<r.bx&&(u.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,n){return this._updateProjection(u||n||{name:"mercator"})}_updateProjection(u){let n;return n=u.name==="globe"&&this.transform.zoom>=r.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),n&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u){return this.transform.locationPoint3D(r.bn.convert(u))}unproject(u){return this.transform.pointLocation3D(r.P.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,n,a){if(u==="mouseenter"||u==="mouseover"){let h=!1,f=x=>{let T=n.filter(A=>this.getLayer(A)),I=T.length?this.queryRenderedFeatures(x.point,{layers:T}):[];I.length?h||(h=!0,a.call(this,new jo(u,this,x.originalEvent,{features:I}))):h=!1},b=()=>{h=!1};return{layers:new Set(n),listener:a,delegates:{mousemove:f,mouseout:b}}}if(u==="mouseleave"||u==="mouseout"){let h=!1,f=x=>{let T=n.filter(I=>this.getLayer(I));(T.length?this.queryRenderedFeatures(x.point,{layers:T}):[]).length?h=!0:h&&(h=!1,a.call(this,new jo(u,this,x.originalEvent)))},b=x=>{h&&(h=!1,a.call(this,new jo(u,this,x.originalEvent)))};return{layers:new Set(n),listener:a,delegates:{mousemove:f,mouseout:b}}}{let h=f=>{let b=n.filter(T=>this.getLayer(T)),x=b.length?this.queryRenderedFeatures(f.point,{layers:b}):[];x.length&&(f.features=x,a.call(this,f),delete f.features)};return{layers:new Set(n),listener:a,delegates:{[u]:h}}}}on(u,n,a){if(a===void 0)return super.on(u,n);if(Array.isArray(n)||(n=[n]),n){for(let f of n)if(!this._isValidId(f))return this}let h=this._createDelegatedListener(u,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(h);for(let f in h.delegates)this.on(f,h.delegates[f]);return this}once(u,n,a){if(a===void 0)return super.once(u,n);if(Array.isArray(n)||(n=[n]),n){for(let f of n)if(!this._isValidId(f))return this}let h=this._createDelegatedListener(u,n,a);for(let f in h.delegates)this.once(f,h.delegates[f]);return this}off(u,n,a){if(a===void 0)return super.off(u,n);n=new Set(Array.isArray(n)?n:[n]);for(let b of n)if(!this._isValidId(b))return this;let h=(b,x)=>{if(b.size!==x.size)return!1;for(let T of b)if(!x.has(T))return!1;return!0},f=this._delegatedListeners?this._delegatedListeners[u]:void 0;return f&&(b=>{for(let x=0;x<b.length;x++){let T=b[x];if(T.listener===a&&h(T.layers,n)){for(let I in T.delegates)this.off(I,T.delegates[I]);return b.splice(x,1),this}}})(f),this}queryRenderedFeatures(u,n){if(!this.style)return[];if(n!==void 0||u===void 0||u instanceof r.P||Array.isArray(u)||(n=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],(n=n||{}).layers&&Array.isArray(n.layers)){for(let a of n.layers)if(!this._isValidId(a))return[]}return this.style.queryRenderedFeatures(u,n,this.transform)}querySourceFeatures(u,n){return this._isValidId(u)?this.style.querySourceFeatures(u,n):[]}isPointOnSurface(u){let{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&r.w(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(u))}setStyle(u,n){return(n=r.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&u?(this._diffStyle(u,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(u,n))}_getUIString(u){let n=this._locale[u];if(n==null)throw new Error(`Missing UI string '${u}'`);return n}_updateStyle(u,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u&&(this.style=new Xr(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u):this.style.loadJSON(u)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Xr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,n){if(typeof u=="string"){let a=this._requestManager.normalizeStyleURL(u),h=this._requestManager.transformRequest(a,r.R.Style);r.g(h,(f,b)=>{f?this.fire(new r.a(f)):b&&this._updateDiff(b,n)})}else typeof u=="object"&&this._updateDiff(u,n)}_updateDiff(u,n){try{this.style.setState(u)&&this._update(!0)}catch(a){r.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(u,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new r.a(new Error("IDs can't be empty."))),!1):!r.c4(u)||(this.fire(new r.a(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}addSource(u,n){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,n),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(u,n,a)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,n,{pixelRatio:a=1,sdf:h=!1,stretchX:f,stretchY:b,content:x}={}){if(this._lazyInitEmptyStyle(),n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap){let{width:T,height:I,data:A}=r.f.getImageData(n);this.style.addImage(u,{data:new r.h({width:T,height:I},A),pixelRatio:a,stretchX:f,stretchY:b,content:x,sdf:h,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new r.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:T,height:I}=n,A=n;this.style.addImage(u,{data:new r.h({width:T,height:I},new Uint8Array(A.data)),pixelRatio:a,stretchX:f,stretchY:b,content:x,sdf:h,version:0,userImage:A}),A.onAdd&&A.onAdd(this,u)}}updateImage(u,n){this._lazyInitEmptyStyle();let a=this.style.getImage(u);if(!a)return void this.fire(new r.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let h=n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap?r.f.getImageData(n):n,{width:f,height:b}=h,x=h.data;if(f===void 0||b===void 0)return void this.fire(new r.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==a.data.width||b!==a.data.height)return void this.fire(new r.a(new Error(`The width and height of the updated image (${f}, ${b})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`)));let T=!(n instanceof HTMLImageElement||ImageBitmap&&n instanceof ImageBitmap);a.data.replace(x,T),this.style.updateImage(u,a)}hasImage(u){return u?!!this.style&&!!this.style.getImage(u):(this.fire(new r.a(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,n){r.d(this._requestManager.transformRequest(u,r.R.Image),(a,h)=>{n(a,h instanceof HTMLImageElement?r.f.getImageData(h):h)})}listImages(){return this.style.listImages()}addModel(u,n){this._lazyInitEmptyStyle(),this.style.addModel(u,n)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new r.a(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,n){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,n),this._update(!0)):this}getSlot(u){let n=this.getLayer(u);return n&&n.slot||null}setSlot(u,n){return this.style.setSlot(u,n),this.style.mergeLayers(),this._update(!0)}addImport(u,n){return this.style.addImport(u,n),this}updateImport(u,n){return typeof n!="string"&&n.id!==u?(this.removeImport(u),this.addImport(n)):(this.style.updateImport(u,n),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,n){return this.style.moveImport(u,n),this._update(!0)}moveLayer(u,n){return this._isValidId(u)?(this.style.moveLayer(u,n),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){return this._isValidId(u)?this.style.getOwnLayer(u):null}setLayerZoomRange(u,n,a){return this._isValidId(u)?(this.style.setLayerZoomRange(u,n,a),this._update(!0)):this}setFilter(u,n,a={}){return this._isValidId(u)?(this.style.setFilter(u,n,a),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,n,a,h={}){return this._isValidId(u)?(this.style.setPaintProperty(u,n,a,h),this._update(!0)):this}getPaintProperty(u,n){return this._isValidId(u)?this.style.getPaintProperty(u,n):null}setLayoutProperty(u,n,a,h={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,n,a,h),this._update(!0)):this}getLayoutProperty(u,n){return this._isValidId(u)?this.style.getLayoutProperty(u,n):null}getConfigProperty(u,n){return this.style.getConfigProperty(u,n)}setConfigProperty(u,n,a){return this.style.setConfigProperty(u,n,a),this._update(!0)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){let n=u[0];n.properties?this.style.setFlatLight(n.properties,n.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,n={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bn.convert(u),this.transform):0}setFeatureState(u,n){return this._isValidId(u.source)?(this.style.setFeatureState(u,n),this._update()):this}removeFeatureState(u,n){return this._isValidId(u.source)?(this.style.removeFeatureState(u,n),this._update()):this}getFeatureState(u){return this._isValidId(u.source)?this.style.getFeatureState(u):null}_updateContainerDimensions(){if(!this._container)return;let u=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300,a,h,f,b=this._container;for(;b&&(!h||!f);){let x=window.getComputedStyle(b).transform;x&&x!=="none"&&(a=x.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(h=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(f=a[3])),b=b.parentElement}this._containerWidth=h?Math.abs(u/h):u,this._containerHeight=f?Math.abs(n/f):n}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=ye("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();let n=this._canvasContainer=ye("div","mapboxgl-canvas-container",u);this._canvas=ye("canvas","mapboxgl-canvas",n),this._interactive&&(n.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let a=this._controlContainer=ye("div","mapboxgl-control-container",u),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(f=>{h[f]=ye("div",`mapboxgl-ctrl-${f}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,n){let a=r.f.devicePixelRatio||1;this._canvas.width=a*Math.ceil(u),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${n}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){let n=this._markers.indexOf(u);n!==-1&&this._markers.splice(n,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){let n=this._popups.indexOf(u);n!==-1&&this._popups.splice(n,1)}_setupPainter(){let u=r.e({},z.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl2",u);n?(r.db(n,!0),this.painter=new vg(n,this._contextCreateOptions,this.transform,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.dc.testSupport(n)):this.fire(new r.a(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.b("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new r.b("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let n;this.fire(new r.b("renderstart"));let a=this.painter.context.extTimerQuery,h=r.f.now(),f=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=f.createQuery(),f.beginQuery(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();let b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let I=this.transform.zoom,A=this.transform.pitch,k=r.f.now(),P=new r.K(I,{now:k,fadeDuration:b,pitch:A,transition:this.style.transition});this.style.update(P)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(h),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(h),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new r.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){let I=r.f.now()-h;f.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{let A=f.getQueryParameter(n,f.QUERY_RESULT)/1e6;f.deleteQuery(n),this.fire(new r.b("gpu-timing-frame",{cpuTime:I,gpuTime:A}))},50)}if(this.listens("gpu-timing-layer")){let I=this.painter.collectGpuTimers();setTimeout(()=>{let A=this.painter.queryGpuTimers(I);this.fire(new r.b("gpu-timing-layer",{layerTimes:A}))},50)}if(this.listens("gpu-timing-deferred-render")){let I=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let A=this.painter.queryGpuTimeDeferredRender(I);this.fire(new r.b("gpu-timing-deferred-render",{gpuTime:A}))},50)}let T=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(T||this._repaint)this.triggerRepaint();else{let I=!this.isMoving()&&this.loaded();if(I&&(x=this._updateAverageElevation(h,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),I&&(this.fire(new r.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let A=this._calculateSpeedIndex();this.fire(new r.b("speedindexcompleted",{speedIndex:A})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,this._performanceMetricsCollection&&r.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(let n of this._markers)u&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(let n of this._popups)!u||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(u,n=!1){let a=f=>(this.transform.averageElevation=f,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);let h=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(h||(n||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){let f=this.transform.averageElevation,b=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=u;let x=Math.abs(f-b);if(x>1){if(this._isInitialLoad||h)return this._averageElevation.jumpTo(b),a(b);this._averageElevation.easeTo(b,u,300)}else if(x>1e-4)return this._averageElevation.jumpTo(b),a(b)}return!!this._averageElevation.isEasing(u)&&a(this._averageElevation.getValue(u))}_authenticate(){r.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===r.df||u.status===401)){let n=this.painter.context.gl;r.db(n,!1),this._logoControl instanceof kg&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){let u=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());let a=this.painter.context.gl,h=a.createFramebuffer();function f(b){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0);let x=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,x),x}return a.bindFramebuffer(a.FRAMEBUFFER,h),this._canvasPixelComparison(f(u),n.canvasCopies.map(f),n.timeStamps)}_canvasPixelComparison(u,n,a){let h=a[1]-a[0],f=u.length/4;for(let b=0;b<n.length;b++){let x=n[b],T=0;for(let I=0;I<x.length;I+=4)x[I]===u[I]&&x[I+1]===u[I+1]&&x[I+2]===u[I+2]&&x[I+3]===u[I+3]&&(T+=1);h+=(a[b+2]-a[b+1])*(1-T/f)}return h}remove(){this._hash&&this._hash.remove();for(let n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.dh(this.painter.context.gl),r.di.remove(),r.dj.remove(),this._removed=!0,this.fire(new r.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=r.f.frame(n=>{let a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)}))}_preloadTiles(u){let n=this.style?Object.values(this.style._sourceCaches):[];return r.b1(n,(a,h)=>a._preloadTiles(u,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,u&&this._update())}_setCacheLimits(u,n){r.dl(u,n)}get version(){return r.dk}},NavigationControl:class{constructor(u){this.options=r.e({},xh,u),this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(r.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),ye("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),ye("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{let a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))}),this._compassIcon=ye("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let u=this._map;if(!u)return;let n=u.getZoom(),a=n===u.getMaxZoom(),h=n===u.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){let u=this._map;if(!u)return;let n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ol(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){let u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,n){let a=ye("button",u,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(u,n){if(!this._map)return;let a=this._map._getUIString(`NavigationControl.${n}`);u.setAttribute("aria-label",a),u.firstElementChild&&u.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends r.E{constructor(u){super();let n=navigator.geolocation;this.options=r.e({geolocation:n},wh,u),r.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Qd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){let n=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,u(a)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>n(a.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(u){let n=this._map.getMaxBounds(),a=u.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new r.b("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.b("geolocate",u)),this._finish()}}_updateCamera(u){let n=new r.bn(u.coords.longitude,u.coords.latitude),a=u.coords.accuracy,h=this._map.getBearing(),f=r.e({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),f,{geolocateSource:!0})}_updateMarker(u){if(u){let n=new r.bn(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let u=this._map.transform,n=r.bl(1,u._center.lat)*u.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.b("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=ye("button","mapboxgl-ctrl-geolocate",this._container),ye("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{let n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ye("div","mapboxgl-user-location"),this._dotElement.appendChild(ye("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ye("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ym({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ye("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ym({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.b("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:bm,ScaleControl:class{constructor(u){this.options=r.e({},Oo,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let u=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,h=n._containerWidth/2-u/2,f=n.unproject([h,a]),b=n.unproject([h+u,a]),x=f.distanceTo(b);if(this.options.unit==="imperial"){let T=3.2808*x;T>5280?this._setScale(u,T/5280,"mile"):this._setScale(u,T,"foot")}else this.options.unit==="nautical"?this._setScale(u,x/1852,"nautical-mile"):x>=1e3?this._setScale(u,x/1e3,"kilometer"):this._setScale(u,x,"meter")}_setScale(u,n,a){this._map._requestDomTask(()=>{let h=function(b){let x=Math.pow(10,`${Math.floor(b)}`.length-1),T=b/x;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(I){let A=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*A)/A}(T),x*T}(n),f=h/n;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(h):`${h}&nbsp;${ql[a]}`,this._container.style.width=u*f+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:r.w("Full screen control 'container' must be a DOM element.")),r.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let u=this._fullscreenButton=ye("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ye("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(u){super(),this.options=r.e(Object.create(Pg),u),r.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new r.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new r.b("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=r.bn.convert(u),this._pos=null,this._trackPointer=!1,this._update();let n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){let n=document.createDocumentFragment(),a=document.createElement("body"),h;for(a.innerHTML=u;h=a.firstChild,h;)n.appendChild(h);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=ye("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(u),this.options.closeButton){let a=this._closeButton=ye("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let n;return this._classList.delete(u)?n=!1:(this._classList.add(u),n=!0),this._updateClassList(),n}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;let n=this._map,a=this._container,h=this._pos;if(!n||!a||!h)return"bottom";let f=a.offsetWidth,b=a.offsetHeight,x=h.x<f/2,T=h.x>n.transform.width-f/2;if(h.y+u<b)return x?"top-left":T?"top-right":"top";if(h.y>n.transform.height-b){if(x)return"bottom-left";if(T)return"bottom-right"}return x?"left":T?"right":"bottom"}_updateClassList(){let u=this._container;if(!u)return;let n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),u.className=n.join(" ")}_update(u){let n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let h=this._container;if(h||(h=this._container=ye("div","mapboxgl-popup",n.getContainer()),this._tip=ye("div","mapboxgl-popup-tip",h),h.appendChild(a)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=cu(this._lngLat,this._pos,n.transform)),!this._trackPointer||u){let f=this._pos=this._trackPointer&&u?u:n.project(this._lngLat),b=Fg(this.options.offset),x=this._anchor=this._getAnchor(b.y),T=Fg(this.options.offset,x),I=f.add(T).round();n._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${vh[x]} translate(${I.x}px,${I.y}px)`)})}if(!this._marker&&n._showingGlobe()){let f=r.d6(n.transform,this._lngLat)?0:1;this._setOpacity(f)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let u=this._container.querySelector(Og);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:ym,Style:Xr,LngLat:r.bn,LngLatBounds:r.ad,Point:r.P,MercatorCoordinate:r.L,FreeCameraOptions:Hn,Evented:r.E,config:r.d5,prewarm:r.dp,clearPrewarmedResources:r.dq,get accessToken(){return r.d5.ACCESS_TOKEN},set accessToken(u){r.d5.ACCESS_TOKEN=u},get baseApiUrl(){return r.d5.API_URL},set baseApiUrl(u){r.d5.API_URL=u},get workerCount(){return r.dr.workerCount},set workerCount(u){r.dr.workerCount=u},get maxParallelImageRequests(){return r.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){r.d5.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){r.ds(u)},get workerUrl(){return r.dt.workerUrl},set workerUrl(u){r.dt.workerUrl=u},get workerClass(){return r.dt.workerClass},set workerClass(u){r.dt.workerClass=u},get workerParams(){return r.dt.workerParams},set workerParams(u){r.dt.workerParams=u},get dracoUrl(){return r.du()},set dracoUrl(u){r.dv(u)},get meshoptUrl(){return r.dw()},set meshoptUrl(u){r.dx(u)},setNow:r.f.setNow,restoreNow:r.f.restoreNow}});var m=w;return m})});var QI=hE((ix,nx)=>{"use strict";(function(g,l){typeof ix=="object"&&typeof nx<"u"?nx.exports=l():typeof define=="function"&&define.amd?define(l):(g=typeof globalThis<"u"?globalThis:g||self).MapboxDraw=l()})(ix,function(){"use strict";var g=function(D,N){var J={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},re={on:function(ge,Ee,ft){if(J[ge]===void 0)throw new Error("Invalid event type: "+ge);J[ge].push({selector:Ee,fn:ft})},render:function(ge){N.store.featureChanged(ge)}},pe=function(ge,Ee){for(var ft=J[ge],Ze=ft.length;Ze--;){var Vt=ft[Ze];if(Vt.selector(Ee)){Vt.fn.call(re,Ee)||N.store.render(),N.ui.updateMapClasses();break}}};return D.start.call(re),{render:D.render,stop:function(){D.stop&&D.stop()},trash:function(){D.trash&&(D.trash(),N.store.render())},combineFeatures:function(){D.combineFeatures&&D.combineFeatures()},uncombineFeatures:function(){D.uncombineFeatures&&D.uncombineFeatures()},drag:function(ge){pe("drag",ge)},click:function(ge){pe("click",ge)},mousemove:function(ge){pe("mousemove",ge)},mousedown:function(ge){pe("mousedown",ge)},mouseup:function(ge){pe("mouseup",ge)},mouseout:function(ge){pe("mouseout",ge)},keydown:function(ge){pe("keydown",ge)},keyup:function(ge){pe("keyup",ge)},touchstart:function(ge){pe("touchstart",ge)},touchmove:function(ge){pe("touchmove",ge)},touchend:function(ge){pe("touchend",ge)},tap:function(ge){pe("tap",ge)}}};function l(D){return D&&D.__esModule&&Object.prototype.hasOwnProperty.call(D,"default")?D.default:D}function w(D){if(D.__esModule)return D;var N=D.default;if(typeof N=="function"){var J=function re(){if(this instanceof re){var pe=[null];pe.push.apply(pe,arguments);var ge=Function.bind.apply(N,pe);return new ge}return N.apply(this,arguments)};J.prototype=N.prototype}else J={};return Object.defineProperty(J,"__esModule",{value:!0}),Object.keys(D).forEach(function(re){var pe=Object.getOwnPropertyDescriptor(D,re);Object.defineProperty(J,re,pe.get?pe:{enumerable:!0,get:function(){return D[re]}})}),J}var c={},m={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},r=m;function M(D){var N=0;if(D&&D.length>0){N+=Math.abs(z(D[0]));for(var J=1;J<D.length;J++)N-=Math.abs(z(D[J]))}return N}function z(D){var N,J,re,pe,ge,Ee,ft=0,Ze=D.length;if(Ze>2){for(Ee=0;Ee<Ze;Ee++)Ee===Ze-2?(re=Ze-2,pe=Ze-1,ge=0):Ee===Ze-1?(re=Ze-1,pe=0,ge=1):(re=Ee,pe=Ee+1,ge=Ee+2),N=D[re],J=D[pe],ft+=(ie(D[ge][0])-ie(N[0]))*Math.sin(ie(J[1]));ft=ft*r.RADIUS*r.RADIUS/2}return ft}function ie(D){return D*Math.PI/180}c.geometry=function D(N){var J,re=0;switch(N.type){case"Polygon":return M(N.coordinates);case"MultiPolygon":for(J=0;J<N.coordinates.length;J++)re+=M(N.coordinates[J]);return re;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(J=0;J<N.geometries.length;J++)re+=D(N.geometries[J]);return re}},c.ring=z;var ue={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},ye={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Je={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},It={POLYGON:"polygon",LINE:"line_string",POINT:"point"},st={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},Xt={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},Oi={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},vi={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},Ti={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},xn={ACTIVE:"true",INACTIVE:"false"},Wo=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],ur=-85,Lo=Object.freeze({__proto__:null,classes:ue,sources:ye,cursors:Je,types:It,geojsonTypes:st,modes:Xt,events:Oi,updateActions:vi,meta:Ti,activeStates:xn,interactions:Wo,LAT_MIN:-90,LAT_RENDERED_MIN:ur,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),dt={Point:0,LineString:1,MultiLineString:1,Polygon:2};function ja(D,N){var J=dt[D.geometry.type]-dt[N.geometry.type];return J===0&&D.geometry.type===st.POLYGON?D.area-N.area:J}function Cl(D){return D.map(function(N){return N.geometry.type===st.POLYGON&&(N.area=c.geometry({type:st.FEATURE,property:{},geometry:N.geometry})),N}).sort(ja).map(function(N){return delete N.area,N})}function Fi(D,N){return N===void 0&&(N=0),[[D.point.x-N,D.point.y-N],[D.point.x+N,D.point.y+N]]}function qn(D){if(this._items={},this._nums={},this._length=D?D.length:0,D)for(var N=0,J=D.length;N<J;N++)this.add(D[N]),D[N]!==void 0&&(typeof D[N]=="string"?this._items[D[N]]=N:this._nums[D[N]]=N)}qn.prototype.add=function(D){return this.has(D)||(this._length++,typeof D=="string"?this._items[D]=this._length:this._nums[D]=this._length),this},qn.prototype.delete=function(D){return this.has(D)===!1||(this._length--,delete this._items[D],delete this._nums[D]),this},qn.prototype.has=function(D){return(typeof D=="string"||typeof D=="number")&&(this._items[D]!==void 0||this._nums[D]!==void 0)},qn.prototype.values=function(){var D=this,N=[];return Object.keys(this._items).forEach(function(J){N.push({k:J,v:D._items[J]})}),Object.keys(this._nums).forEach(function(J){N.push({k:JSON.parse(J),v:D._nums[J]})}),N.sort(function(J,re){return J.v-re.v}).map(function(J){return J.k})},qn.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Nc=[Ti.FEATURE,Ti.MIDPOINT,Ti.VERTEX],yt={click:function(D,N,J){return Zo(D,N,J,J.options.clickBuffer)},touch:function(D,N,J){return Zo(D,N,J,J.options.touchBuffer)}};function Zo(D,N,J,re){if(J.map===null)return[];var pe=D?Fi(D,re):N,ge={};J.options.styles&&(ge.layers=J.options.styles.map(function(Vt){return Vt.id}).filter(function(Vt){return J.map.getLayer(Vt)!=null}));var Ee=J.map.queryRenderedFeatures(pe,ge).filter(function(Vt){return Nc.indexOf(Vt.properties.meta)!==-1}),ft=new qn,Ze=[];return Ee.forEach(function(Vt){var zt=Vt.properties.id;ft.has(zt)||(ft.add(zt),Ze.push(Vt))}),Cl(Ze)}function Yr(D,N){var J=yt.click(D,null,N),re={mouse:Je.NONE};return J[0]&&(re.mouse=J[0].properties.active===xn.ACTIVE?Je.MOVE:Je.POINTER,re.feature=J[0].properties.meta),N.events.currentModeName().indexOf("draw")!==-1&&(re.mouse=Je.ADD),N.ui.queueMapClasses(re),N.ui.updateMapClasses(),J[0]}function gi(D,N){var J=D.x-N.x,re=D.y-N.y;return Math.sqrt(J*J+re*re)}function us(D,N,J){J===void 0&&(J={});var re=J.fineTolerance!=null?J.fineTolerance:4,pe=J.grossTolerance!=null?J.grossTolerance:12,ge=J.interval!=null?J.interval:500;D.point=D.point||N.point,D.time=D.time||N.time;var Ee=gi(D.point,N.point);return Ee<re||Ee<pe&&N.time-D.time<ge}function Ia(D,N,J){J===void 0&&(J={});var re=J.tolerance!=null?J.tolerance:25,pe=J.interval!=null?J.interval:250;return D.point=D.point||N.point,D.time=D.time||N.time,gi(D.point,N.point)<re&&N.time-D.time<pe}var Yo={exports:{}},Gr=Yo.exports=function(D,N){if(N||(N=16),D===void 0&&(D=128),D<=0)return"0";for(var J=Math.log(Math.pow(2,D))/Math.log(N),re=2;J===1/0;re*=2)J=Math.log(Math.pow(2,D/re))/Math.log(N)*re;var pe=J-Math.floor(J),ge="";for(re=0;re<Math.floor(J);re++)ge=Math.floor(Math.random()*N).toString(N)+ge;if(pe){var Ee=Math.pow(N,pe);ge=Math.floor(Math.random()*Ee).toString(N)+ge}var ft=parseInt(ge,N);return ft!==1/0&&ft>=Math.pow(2,D)?Gr(D,N):ge};Gr.rack=function(D,N,J){var re=function(ge){var Ee=0;do{if(Ee++>10){if(!J)throw new Error("too many ID collisions, use more bits");D+=J}var ft=Gr(D,N)}while(Object.hasOwnProperty.call(pe,ft));return pe[ft]=ge,ft},pe=re.hats={};return re.get=function(ge){return re.hats[ge]},re.set=function(ge,Ee){return re.hats[ge]=Ee,re},re.bits=D||128,re.base=N||16,re};var Ua=l(Yo.exports),Lr=function(D,N){this.ctx=D,this.properties=N.properties||{},this.coordinates=N.geometry.coordinates,this.id=N.id||Ua(),this.type=N.geometry.type};Lr.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Lr.prototype.incomingCoords=function(D){this.setCoordinates(D)},Lr.prototype.setCoordinates=function(D){this.coordinates=D,this.changed()},Lr.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Lr.prototype.setProperty=function(D,N){this.properties[D]=N},Lr.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:st.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Lr.prototype.internal=function(D){var N={id:this.id,meta:Ti.FEATURE,"meta:type":this.type,active:xn.INACTIVE,mode:D};if(this.ctx.options.userProperties)for(var J in this.properties)N["user_"+J]=this.properties[J];return{type:st.FEATURE,properties:N,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var ma=function(D,N){Lr.call(this,D,N)};(ma.prototype=Object.create(Lr.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},ma.prototype.updateCoordinate=function(D,N,J){this.coordinates=arguments.length===3?[N,J]:[D,N],this.changed()},ma.prototype.getCoordinate=function(){return this.getCoordinates()};var zo=function(D,N){Lr.call(this,D,N)};(zo.prototype=Object.create(Lr.prototype)).isValid=function(){return this.coordinates.length>1},zo.prototype.addCoordinate=function(D,N,J){this.changed();var re=parseInt(D,10);this.coordinates.splice(re,0,[N,J])},zo.prototype.getCoordinate=function(D){var N=parseInt(D,10);return JSON.parse(JSON.stringify(this.coordinates[N]))},zo.prototype.removeCoordinate=function(D){this.changed(),this.coordinates.splice(parseInt(D,10),1)},zo.prototype.updateCoordinate=function(D,N,J){var re=parseInt(D,10);this.coordinates[re]=[N,J],this.changed()};var co=function(D,N){Lr.call(this,D,N),this.coordinates=this.coordinates.map(function(J){return J.slice(0,-1)})};(co.prototype=Object.create(Lr.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(D){return D.length>2})},co.prototype.incomingCoords=function(D){this.coordinates=D.map(function(N){return N.slice(0,-1)}),this.changed()},co.prototype.setCoordinates=function(D){this.coordinates=D,this.changed()},co.prototype.addCoordinate=function(D,N,J){this.changed();var re=D.split(".").map(function(pe){return parseInt(pe,10)});this.coordinates[re[0]].splice(re[1],0,[N,J])},co.prototype.removeCoordinate=function(D){this.changed();var N=D.split(".").map(function(re){return parseInt(re,10)}),J=this.coordinates[N[0]];J&&(J.splice(N[1],1),J.length<3&&this.coordinates.splice(N[0],1))},co.prototype.getCoordinate=function(D){var N=D.split(".").map(function(re){return parseInt(re,10)}),J=this.coordinates[N[0]];return JSON.parse(JSON.stringify(J[N[1]]))},co.prototype.getCoordinates=function(){return this.coordinates.map(function(D){return D.concat([D[0]])})},co.prototype.updateCoordinate=function(D,N,J){this.changed();var re=D.split("."),pe=parseInt(re[0],10),ge=parseInt(re[1],10);this.coordinates[pe]===void 0&&(this.coordinates[pe]=[]),this.coordinates[pe][ge]=[N,J]};var Ps={MultiPoint:ma,MultiLineString:zo,MultiPolygon:co},Xo=function(D,N,J,re,pe){var ge=J.split("."),Ee=parseInt(ge[0],10),ft=ge[1]?ge.slice(1).join("."):null;return D[Ee][N](ft,re,pe)},Bn=function(D,N){if(Lr.call(this,D,N),delete this.coordinates,this.model=Ps[N.geometry.type],this.model===void 0)throw new TypeError(N.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(N.geometry.coordinates)};function Mi(D){this.map=D.map,this.drawConfig=JSON.parse(JSON.stringify(D.options||{})),this._ctx=D}(Bn.prototype=Object.create(Lr.prototype))._coordinatesToFeatures=function(D){var N=this,J=this.model.bind(this);return D.map(function(re){return new J(N.ctx,{id:Ua(),type:st.FEATURE,properties:{},geometry:{coordinates:re,type:N.type.replace("Multi","")}})})},Bn.prototype.isValid=function(){return this.features.every(function(D){return D.isValid()})},Bn.prototype.setCoordinates=function(D){this.features=this._coordinatesToFeatures(D),this.changed()},Bn.prototype.getCoordinate=function(D){return Xo(this.features,"getCoordinate",D)},Bn.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(D){return D.type===st.POLYGON?D.getCoordinates():D.coordinates})))},Bn.prototype.updateCoordinate=function(D,N,J){Xo(this.features,"updateCoordinate",D,N,J),this.changed()},Bn.prototype.addCoordinate=function(D,N,J){Xo(this.features,"addCoordinate",D,N,J),this.changed()},Bn.prototype.removeCoordinate=function(D){Xo(this.features,"removeCoordinate",D),this.changed()},Bn.prototype.getFeatures=function(){return this.features},Mi.prototype.setSelected=function(D){return this._ctx.store.setSelected(D)},Mi.prototype.setSelectedCoordinates=function(D){var N=this;this._ctx.store.setSelectedCoordinates(D),D.reduce(function(J,re){return J[re.feature_id]===void 0&&(J[re.feature_id]=!0,N._ctx.store.get(re.feature_id).changed()),J},{})},Mi.prototype.getSelected=function(){return this._ctx.store.getSelected()},Mi.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Mi.prototype.isSelected=function(D){return this._ctx.store.isSelected(D)},Mi.prototype.getFeature=function(D){return this._ctx.store.get(D)},Mi.prototype.select=function(D){return this._ctx.store.select(D)},Mi.prototype.deselect=function(D){return this._ctx.store.deselect(D)},Mi.prototype.deleteFeature=function(D,N){return N===void 0&&(N={}),this._ctx.store.delete(D,N)},Mi.prototype.addFeature=function(D){return this._ctx.store.add(D)},Mi.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Mi.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Mi.prototype.setActionableState=function(D){D===void 0&&(D={});var N={trash:D.trash||!1,combineFeatures:D.combineFeatures||!1,uncombineFeatures:D.uncombineFeatures||!1};return this._ctx.events.actionable(N)},Mi.prototype.changeMode=function(D,N,J){return N===void 0&&(N={}),J===void 0&&(J={}),this._ctx.events.changeMode(D,N,J)},Mi.prototype.updateUIClasses=function(D){return this._ctx.ui.queueMapClasses(D)},Mi.prototype.activateUIButton=function(D){return this._ctx.ui.setActiveButton(D)},Mi.prototype.featuresAt=function(D,N,J){if(J===void 0&&(J="click"),J!=="click"&&J!=="touch")throw new Error("invalid buffer type");return yt[J](D,N,this._ctx)},Mi.prototype.newFeature=function(D){var N=D.geometry.type;return N===st.POINT?new ma(this._ctx,D):N===st.LINE_STRING?new zo(this._ctx,D):N===st.POLYGON?new co(this._ctx,D):new Bn(this._ctx,D)},Mi.prototype.isInstanceOf=function(D,N){if(D===st.POINT)return N instanceof ma;if(D===st.LINE_STRING)return N instanceof zo;if(D===st.POLYGON)return N instanceof co;if(D==="MultiFeature")return N instanceof Bn;throw new Error("Unknown feature class: "+D)},Mi.prototype.doRender=function(D){return this._ctx.store.featureChanged(D)},Mi.prototype.onSetup=function(){},Mi.prototype.onDrag=function(){},Mi.prototype.onClick=function(){},Mi.prototype.onMouseMove=function(){},Mi.prototype.onMouseDown=function(){},Mi.prototype.onMouseUp=function(){},Mi.prototype.onMouseOut=function(){},Mi.prototype.onKeyUp=function(){},Mi.prototype.onKeyDown=function(){},Mi.prototype.onTouchStart=function(){},Mi.prototype.onTouchMove=function(){},Mi.prototype.onTouchEnd=function(){},Mi.prototype.onTap=function(){},Mi.prototype.onStop=function(){},Mi.prototype.onTrash=function(){},Mi.prototype.onCombineFeature=function(){},Mi.prototype.onUncombineFeature=function(){},Mi.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Ao={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Bc=Object.keys(Ao);function er(D){var N=Object.keys(D);return function(J,re){re===void 0&&(re={});var pe={},ge=N.reduce(function(Ee,ft){return Ee[ft]=D[ft],Ee},new Mi(J));return{start:function(){var Ee=this;pe=ge.onSetup(re),Bc.forEach(function(ft){var Ze,Vt=Ao[ft],zt=function(){return!1};D[Vt]&&(zt=function(){return!0}),Ee.on(ft,zt,(Ze=Vt,function(Mt){return ge[Ze](pe,Mt)}))})},stop:function(){ge.onStop(pe)},trash:function(){ge.onTrash(pe)},combineFeatures:function(){ge.onCombineFeatures(pe)},uncombineFeatures:function(){ge.onUncombineFeatures(pe)},render:function(Ee,ft){ge.toDisplayFeatures(pe,Ee,ft)}}}}function uo(D){return[].concat(D).filter(function(N){return N!==void 0})}function Os(){var D=this;if(!(D.ctx.map&&D.ctx.map.getSource(ye.HOT)!==void 0))return Ze();var N=D.ctx.events.currentModeName();D.ctx.ui.queueMapClasses({mode:N});var J=[],re=[];D.isDirty?re=D.getAllIds():(J=D.getChangedIds().filter(function(Vt){return D.get(Vt)!==void 0}),re=D.sources.hot.filter(function(Vt){return Vt.properties.id&&J.indexOf(Vt.properties.id)===-1&&D.get(Vt.properties.id)!==void 0}).map(function(Vt){return Vt.properties.id})),D.sources.hot=[];var pe=D.sources.cold.length;D.sources.cold=D.isDirty?[]:D.sources.cold.filter(function(Vt){var zt=Vt.properties.id||Vt.properties.parent;return J.indexOf(zt)===-1});var ge=pe!==D.sources.cold.length||re.length>0;function Ee(Vt,zt){var Mt=D.get(Vt).internal(N);D.ctx.events.currentModeRender(Mt,function(oi){D.sources[zt].push(oi)})}if(J.forEach(function(Vt){return Ee(Vt,"hot")}),re.forEach(function(Vt){return Ee(Vt,"cold")}),ge&&D.ctx.map.getSource(ye.COLD).setData({type:st.FEATURE_COLLECTION,features:D.sources.cold}),D.ctx.map.getSource(ye.HOT).setData({type:st.FEATURE_COLLECTION,features:D.sources.hot}),D._emitSelectionChange&&(D.ctx.map.fire(Oi.SELECTION_CHANGE,{features:D.getSelected().map(function(Vt){return Vt.toGeoJSON()}),points:D.getSelectedCoordinates().map(function(Vt){return{type:st.FEATURE,properties:{},geometry:{type:st.POINT,coordinates:Vt.coordinates}}})}),D._emitSelectionChange=!1),D._deletedFeaturesToEmit.length){var ft=D._deletedFeaturesToEmit.map(function(Vt){return Vt.toGeoJSON()});D._deletedFeaturesToEmit=[],D.ctx.map.fire(Oi.DELETE,{features:ft})}function Ze(){D.isDirty=!1,D.clearChangedIds()}Ze(),D.ctx.map.fire(Oi.RENDER,{})}function Sn(D){var N,J=this;this._features={},this._featureIds=new qn,this._selectedFeatureIds=new qn,this._selectedCoordinates=[],this._changedFeatureIds=new qn,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=D,this.sources={hot:[],cold:[]},this.render=function(){N||(N=requestAnimationFrame(function(){N=null,Os.call(J)}))},this.isDirty=!1}function fa(D,N){var J=D._selectedCoordinates.filter(function(re){return D._selectedFeatureIds.has(re.feature_id)});D._selectedCoordinates.length===J.length||N.silent||(D._emitSelectionChange=!0),D._selectedCoordinates=J}Sn.prototype.createRenderBatch=function(){var D=this,N=this.render,J=0;return this.render=function(){J++},function(){D.render=N,J>0&&D.render()}},Sn.prototype.setDirty=function(){return this.isDirty=!0,this},Sn.prototype.featureChanged=function(D){return this._changedFeatureIds.add(D),this},Sn.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Sn.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Sn.prototype.getAllIds=function(){return this._featureIds.values()},Sn.prototype.add=function(D){return this.featureChanged(D.id),this._features[D.id]=D,this._featureIds.add(D.id),this},Sn.prototype.delete=function(D,N){var J=this;return N===void 0&&(N={}),uo(D).forEach(function(re){J._featureIds.has(re)&&(J._featureIds.delete(re),J._selectedFeatureIds.delete(re),N.silent||J._deletedFeaturesToEmit.indexOf(J._features[re])===-1&&J._deletedFeaturesToEmit.push(J._features[re]),delete J._features[re],J.isDirty=!0)}),fa(this,N),this},Sn.prototype.get=function(D){return this._features[D]},Sn.prototype.getAll=function(){var D=this;return Object.keys(this._features).map(function(N){return D._features[N]})},Sn.prototype.select=function(D,N){var J=this;return N===void 0&&(N={}),uo(D).forEach(function(re){J._selectedFeatureIds.has(re)||(J._selectedFeatureIds.add(re),J._changedFeatureIds.add(re),N.silent||(J._emitSelectionChange=!0))}),this},Sn.prototype.deselect=function(D,N){var J=this;return N===void 0&&(N={}),uo(D).forEach(function(re){J._selectedFeatureIds.has(re)&&(J._selectedFeatureIds.delete(re),J._changedFeatureIds.add(re),N.silent||(J._emitSelectionChange=!0))}),fa(this,N),this},Sn.prototype.clearSelected=function(D){return D===void 0&&(D={}),this.deselect(this._selectedFeatureIds.values(),{silent:D.silent}),this},Sn.prototype.setSelected=function(D,N){var J=this;return N===void 0&&(N={}),D=uo(D),this.deselect(this._selectedFeatureIds.values().filter(function(re){return D.indexOf(re)===-1}),{silent:N.silent}),this.select(D.filter(function(re){return!J._selectedFeatureIds.has(re)}),{silent:N.silent}),this},Sn.prototype.setSelectedCoordinates=function(D){return this._selectedCoordinates=D,this._emitSelectionChange=!0,this},Sn.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Sn.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Sn.prototype.getSelected=function(){var D=this;return this._selectedFeatureIds.values().map(function(N){return D.get(N)})},Sn.prototype.getSelectedCoordinates=function(){var D=this;return this._selectedCoordinates.map(function(N){return{coordinates:D.get(N.feature_id).getCoordinate(N.coord_path)}})},Sn.prototype.isSelected=function(D){return this._selectedFeatureIds.has(D)},Sn.prototype.setFeatureProperty=function(D,N,J){this.get(D).setProperty(N,J),this.featureChanged(D)},Sn.prototype.storeMapConfig=function(){var D=this;Wo.forEach(function(N){D.ctx.map[N]&&(D._mapInitialConfig[N]=D.ctx.map[N].isEnabled())})},Sn.prototype.restoreMapConfig=function(){var D=this;Object.keys(this._mapInitialConfig).forEach(function(N){D._mapInitialConfig[N]?D.ctx.map[N].enable():D.ctx.map[N].disable()})},Sn.prototype.getInitialConfigValue=function(D){return this._mapInitialConfig[D]===void 0||this._mapInitialConfig[D]};var Fs=function(){for(var D=arguments,N={},J=0;J<arguments.length;J++){var re=D[J];for(var pe in re)Cr.call(re,pe)&&(N[pe]=re[pe])}return N},Cr=Object.prototype.hasOwnProperty,No=l(Fs),Tl=["mode","feature","mouse"];function Ko(D){var N=null,J=null,re={onRemove:function(){return D.map.off("load",re.connect),clearInterval(J),re.removeLayers(),D.store.restoreMapConfig(),D.ui.removeButtons(),D.events.removeEventListeners(),D.ui.clearMapClasses(),D.boxZoomInitial&&D.map.boxZoom.enable(),D.map=null,D.container=null,D.store=null,N&&N.parentNode&&N.parentNode.removeChild(N),N=null,this},connect:function(){D.map.off("load",re.connect),clearInterval(J),re.addLayers(),D.store.storeMapConfig(),D.events.addEventListeners()},onAdd:function(pe){var ge=pe.fire;return pe.fire=function(Ee,ft){var Ze=arguments;return ge.length===1&&arguments.length!==1&&(Ze=[No({},{type:Ee},ft)]),ge.apply(pe,Ze)},D.map=pe,D.events=function(Ee){var ft=Object.keys(Ee.options.modes).reduce(function(ke,Kt){return ke[Kt]=er(Ee.options.modes[Kt]),ke},{}),Ze={},Vt={},zt={},Mt=null,oi=null;zt.drag=function(ke,Kt){Kt({point:ke.point,time:new Date().getTime()})?(Ee.ui.queueMapClasses({mouse:Je.DRAG}),oi.drag(ke)):ke.originalEvent.stopPropagation()},zt.mousedrag=function(ke){zt.drag(ke,function(Kt){return!us(Ze,Kt)})},zt.touchdrag=function(ke){zt.drag(ke,function(Kt){return!Ia(Vt,Kt)})},zt.mousemove=function(ke){if((ke.originalEvent.buttons!==void 0?ke.originalEvent.buttons:ke.originalEvent.which)===1)return zt.mousedrag(ke);var Kt=Yr(ke,Ee);ke.featureTarget=Kt,oi.mousemove(ke)},zt.mousedown=function(ke){Ze={time:new Date().getTime(),point:ke.point};var Kt=Yr(ke,Ee);ke.featureTarget=Kt,oi.mousedown(ke)},zt.mouseup=function(ke){var Kt=Yr(ke,Ee);ke.featureTarget=Kt,us(Ze,{point:ke.point,time:new Date().getTime()})?oi.click(ke):oi.mouseup(ke)},zt.mouseout=function(ke){oi.mouseout(ke)},zt.touchstart=function(ke){if(Ee.options.touchEnabled){Vt={time:new Date().getTime(),point:ke.point};var Kt=yt.touch(ke,null,Ee)[0];ke.featureTarget=Kt,oi.touchstart(ke)}},zt.touchmove=function(ke){if(Ee.options.touchEnabled)return oi.touchmove(ke),zt.touchdrag(ke)},zt.touchend=function(ke){if(ke.originalEvent.preventDefault(),Ee.options.touchEnabled){var Kt=yt.touch(ke,null,Ee)[0];ke.featureTarget=Kt,Ia(Vt,{time:new Date().getTime(),point:ke.point})?oi.tap(ke):oi.touchend(ke)}};var ji=function(ke){return!(ke===8||ke===46||ke>=48&&ke<=57)};function ot(ke,Kt,Gt){Gt===void 0&&(Gt={}),oi.stop();var Er=ft[ke];if(Er===void 0)throw new Error(ke+" is not valid");Mt=ke;var _n=Er(Ee,Kt);oi=g(_n,Ee),Gt.silent||Ee.map.fire(Oi.MODE_CHANGE,{mode:ke}),Ee.store.setDirty(),Ee.store.render()}zt.keydown=function(ke){(ke.srcElement||ke.target).classList.contains("mapboxgl-canvas")&&(ke.keyCode!==8&&ke.keyCode!==46||!Ee.options.controls.trash?ji(ke.keyCode)?oi.keydown(ke):ke.keyCode===49&&Ee.options.controls.point?ot(Xt.DRAW_POINT):ke.keyCode===50&&Ee.options.controls.line_string?ot(Xt.DRAW_LINE_STRING):ke.keyCode===51&&Ee.options.controls.polygon&&ot(Xt.DRAW_POLYGON):(ke.preventDefault(),oi.trash()))},zt.keyup=function(ke){ji(ke.keyCode)&&oi.keyup(ke)},zt.zoomend=function(){Ee.store.changeZoom()},zt.data=function(ke){if(ke.dataType==="style"){var Kt=Ee.setup,Gt=Ee.map,Er=Ee.options,_n=Ee.store;Er.styles.some(function(qt){return Gt.getLayer(qt.id)})||(Kt.addLayers(),_n.setDirty(),_n.render())}};var tr={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){Mt=Ee.options.defaultMode,oi=g(ft[Mt](Ee),Ee)},changeMode:ot,actionable:function(ke){var Kt=!1;Object.keys(ke).forEach(function(Gt){if(tr[Gt]===void 0)throw new Error("Invalid action type");tr[Gt]!==ke[Gt]&&(Kt=!0),tr[Gt]=ke[Gt]}),Kt&&Ee.map.fire(Oi.ACTIONABLE,{actions:tr})},currentModeName:function(){return Mt},currentModeRender:function(ke,Kt){return oi.render(ke,Kt)},fire:function(ke,Kt){zt[ke]&&zt[ke](Kt)},addEventListeners:function(){Ee.map.on("mousemove",zt.mousemove),Ee.map.on("mousedown",zt.mousedown),Ee.map.on("mouseup",zt.mouseup),Ee.map.on("data",zt.data),Ee.map.on("touchmove",zt.touchmove),Ee.map.on("touchstart",zt.touchstart),Ee.map.on("touchend",zt.touchend),Ee.container.addEventListener("mouseout",zt.mouseout),Ee.options.keybindings&&(Ee.container.addEventListener("keydown",zt.keydown),Ee.container.addEventListener("keyup",zt.keyup))},removeEventListeners:function(){Ee.map.off("mousemove",zt.mousemove),Ee.map.off("mousedown",zt.mousedown),Ee.map.off("mouseup",zt.mouseup),Ee.map.off("data",zt.data),Ee.map.off("touchmove",zt.touchmove),Ee.map.off("touchstart",zt.touchstart),Ee.map.off("touchend",zt.touchend),Ee.container.removeEventListener("mouseout",zt.mouseout),Ee.options.keybindings&&(Ee.container.removeEventListener("keydown",zt.keydown),Ee.container.removeEventListener("keyup",zt.keyup))},trash:function(ke){oi.trash(ke)},combineFeatures:function(){oi.combineFeatures()},uncombineFeatures:function(){oi.uncombineFeatures()},getMode:function(){return Mt}}}(D),D.ui=function(Ee){var ft={},Ze=null,Vt={mode:null,feature:null,mouse:null},zt={mode:null,feature:null,mouse:null};function Mt(ke){zt=No(zt,ke)}function oi(){var ke,Kt;if(Ee.container){var Gt=[],Er=[];Tl.forEach(function(_n){zt[_n]!==Vt[_n]&&(Gt.push(_n+"-"+Vt[_n]),zt[_n]!==null&&Er.push(_n+"-"+zt[_n]))}),Gt.length>0&&(ke=Ee.container.classList).remove.apply(ke,Gt),Er.length>0&&(Kt=Ee.container.classList).add.apply(Kt,Er),Vt=No(Vt,zt)}}function ji(ke,Kt){Kt===void 0&&(Kt={});var Gt=document.createElement("button");return Gt.className=ue.CONTROL_BUTTON+" "+Kt.className,Gt.setAttribute("title",Kt.title),Kt.container.appendChild(Gt),Gt.addEventListener("click",function(Er){if(Er.preventDefault(),Er.stopPropagation(),Er.target===Ze)return ot(),void Kt.onDeactivate();tr(ke),Kt.onActivate()},!0),Gt}function ot(){Ze&&(Ze.classList.remove(ue.ACTIVE_BUTTON),Ze=null)}function tr(ke){ot();var Kt=ft[ke];Kt&&Kt&&ke!=="trash"&&(Kt.classList.add(ue.ACTIVE_BUTTON),Ze=Kt)}return{setActiveButton:tr,queueMapClasses:Mt,updateMapClasses:oi,clearMapClasses:function(){Mt({mode:null,feature:null,mouse:null}),oi()},addButtons:function(){var ke=Ee.options.controls,Kt=document.createElement("div");return Kt.className=ue.CONTROL_GROUP+" "+ue.CONTROL_BASE,ke&&(ke[It.LINE]&&(ft[It.LINE]=ji(It.LINE,{container:Kt,className:ue.CONTROL_BUTTON_LINE,title:"LineString tool "+(Ee.options.keybindings?"(l)":""),onActivate:function(){return Ee.events.changeMode(Xt.DRAW_LINE_STRING)},onDeactivate:function(){return Ee.events.trash()}})),ke[It.POLYGON]&&(ft[It.POLYGON]=ji(It.POLYGON,{container:Kt,className:ue.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Ee.options.keybindings?"(p)":""),onActivate:function(){return Ee.events.changeMode(Xt.DRAW_POLYGON)},onDeactivate:function(){return Ee.events.trash()}})),ke[It.POINT]&&(ft[It.POINT]=ji(It.POINT,{container:Kt,className:ue.CONTROL_BUTTON_POINT,title:"Marker tool "+(Ee.options.keybindings?"(m)":""),onActivate:function(){return Ee.events.changeMode(Xt.DRAW_POINT)},onDeactivate:function(){return Ee.events.trash()}})),ke.trash&&(ft.trash=ji("trash",{container:Kt,className:ue.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Ee.events.trash()}})),ke.combine_features&&(ft.combine_features=ji("combineFeatures",{container:Kt,className:ue.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Ee.events.combineFeatures()}})),ke.uncombine_features&&(ft.uncombine_features=ji("uncombineFeatures",{container:Kt,className:ue.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Ee.events.uncombineFeatures()}}))),Kt},removeButtons:function(){Object.keys(ft).forEach(function(ke){var Kt=ft[ke];Kt.parentNode&&Kt.parentNode.removeChild(Kt),delete ft[ke]})}}}(D),D.container=pe.getContainer(),D.store=new Sn(D),N=D.ui.addButtons(),D.options.boxSelect&&(D.boxZoomInitial=pe.boxZoom.isEnabled(),pe.boxZoom.disable(),pe.dragPan.disable(),pe.dragPan.enable()),pe.loaded()?re.connect():(pe.on("load",re.connect),J=setInterval(function(){pe.loaded()&&re.connect()},16)),D.events.start(),N},addLayers:function(){D.map.addSource(ye.COLD,{data:{type:st.FEATURE_COLLECTION,features:[]},type:"geojson"}),D.map.addSource(ye.HOT,{data:{type:st.FEATURE_COLLECTION,features:[]},type:"geojson"}),D.options.styles.forEach(function(pe){D.map.addLayer(pe)}),D.store.setDirty(!0),D.store.render()},removeLayers:function(){D.options.styles.forEach(function(pe){D.map.getLayer(pe.id)&&D.map.removeLayer(pe.id)}),D.map.getSource(ye.COLD)&&D.map.removeSource(ye.COLD),D.map.getSource(ye.HOT)&&D.map.removeSource(ye.HOT)}};return D.setup=re,re}var Sa=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function ga(D){return function(N){var J=N.featureTarget;return!!J&&!!J.properties&&J.properties.meta===D}}function Ue(D){return!!D.originalEvent&&!!D.originalEvent.shiftKey&&D.originalEvent.button===0}function Y(D){return!!D.featureTarget&&!!D.featureTarget.properties&&D.featureTarget.properties.active===xn.ACTIVE&&D.featureTarget.properties.meta===Ti.FEATURE}function ae(D){return!!D.featureTarget&&!!D.featureTarget.properties&&D.featureTarget.properties.active===xn.INACTIVE&&D.featureTarget.properties.meta===Ti.FEATURE}function fe(D){return D.featureTarget===void 0}function Be(D){return!!D.featureTarget&&!!D.featureTarget.properties&&D.featureTarget.properties.meta===Ti.FEATURE}function Ge(D){var N=D.featureTarget;return!!N&&!!N.properties&&N.properties.meta===Ti.VERTEX}function et(D){return!!D.originalEvent&&D.originalEvent.shiftKey===!0}function St(D){return D.keyCode===27}function Ve(D){return D.keyCode===13}var Pt=Object.freeze({__proto__:null,isOfMetaType:ga,isShiftMousedown:Ue,isActiveFeature:Y,isInactiveFeature:ae,noTarget:fe,isFeature:Be,isVertex:Ge,isShiftDown:et,isEscapeKey:St,isEnterKey:Ve,isTrue:function(){return!0}}),Tt=Dt;function Dt(D,N){this.x=D,this.y=N}Dt.prototype={clone:function(){return new Dt(this.x,this.y)},add:function(D){return this.clone()._add(D)},sub:function(D){return this.clone()._sub(D)},multByPoint:function(D){return this.clone()._multByPoint(D)},divByPoint:function(D){return this.clone()._divByPoint(D)},mult:function(D){return this.clone()._mult(D)},div:function(D){return this.clone()._div(D)},rotate:function(D){return this.clone()._rotate(D)},rotateAround:function(D,N){return this.clone()._rotateAround(D,N)},matMult:function(D){return this.clone()._matMult(D)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(D){return this.x===D.x&&this.y===D.y},dist:function(D){return Math.sqrt(this.distSqr(D))},distSqr:function(D){var N=D.x-this.x,J=D.y-this.y;return N*N+J*J},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(D){return Math.atan2(this.y-D.y,this.x-D.x)},angleWith:function(D){return this.angleWithSep(D.x,D.y)},angleWithSep:function(D,N){return Math.atan2(this.x*N-this.y*D,this.x*D+this.y*N)},_matMult:function(D){var N=D[0]*this.x+D[1]*this.y,J=D[2]*this.x+D[3]*this.y;return this.x=N,this.y=J,this},_add:function(D){return this.x+=D.x,this.y+=D.y,this},_sub:function(D){return this.x-=D.x,this.y-=D.y,this},_mult:function(D){return this.x*=D,this.y*=D,this},_div:function(D){return this.x/=D,this.y/=D,this},_multByPoint:function(D){return this.x*=D.x,this.y*=D.y,this},_divByPoint:function(D){return this.x/=D.x,this.y/=D.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var D=this.y;return this.y=this.x,this.x=-D,this},_rotate:function(D){var N=Math.cos(D),J=Math.sin(D),re=N*this.x-J*this.y,pe=J*this.x+N*this.y;return this.x=re,this.y=pe,this},_rotateAround:function(D,N){var J=Math.cos(D),re=Math.sin(D),pe=N.x+J*(this.x-N.x)-re*(this.y-N.y),ge=N.y+re*(this.x-N.x)+J*(this.y-N.y);return this.x=pe,this.y=ge,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Dt.convert=function(D){return D instanceof Dt?D:Array.isArray(D)?new Dt(D[0],D[1]):D};var Ei=l(Tt);function mn(D,N){var J=N.getBoundingClientRect();return new Ei(D.clientX-J.left-(N.clientLeft||0),D.clientY-J.top-(N.clientTop||0))}function En(D,N,J,re){return{type:st.FEATURE,properties:{meta:Ti.VERTEX,parent:D,coord_path:J,active:re?xn.ACTIVE:xn.INACTIVE},geometry:{type:st.POINT,coordinates:N}}}function gn(D,N,J){var re=N.geometry.coordinates,pe=J.geometry.coordinates;if(re[1]>85||re[1]<ur||pe[1]>85||pe[1]<ur)return null;var ge={lng:(re[0]+pe[0])/2,lat:(re[1]+pe[1])/2};return{type:st.FEATURE,properties:{meta:Ti.MIDPOINT,parent:D,lng:ge.lng,lat:ge.lat,coord_path:J.properties.coord_path},geometry:{type:st.POINT,coordinates:[ge.lng,ge.lat]}}}function $i(D,N,J){N===void 0&&(N={}),J===void 0&&(J=null);var re,pe=D.geometry,ge=pe.type,Ee=pe.coordinates,ft=D.properties&&D.properties.id,Ze=[];function Vt(Mt,oi){var ji="",ot=null;Mt.forEach(function(tr,ke){var Kt=oi!=null?oi+"."+ke:String(ke),Gt=En(ft,tr,Kt,zt(Kt));if(N.midpoints&&ot){var Er=gn(ft,ot,Gt);Er&&Ze.push(Er)}ot=Gt;var _n=JSON.stringify(tr);ji!==_n&&Ze.push(Gt),ke===0&&(ji=_n)})}function zt(Mt){return!!N.selectedPaths&&N.selectedPaths.indexOf(Mt)!==-1}return ge===st.POINT?Ze.push(En(ft,Ee,J,zt(J))):ge===st.POLYGON?Ee.forEach(function(Mt,oi){Vt(Mt,J!==null?J+"."+oi:String(oi))}):ge===st.LINE_STRING?Vt(Ee,J):ge.indexOf(st.MULTI_PREFIX)===0&&(re=ge.replace(st.MULTI_PREFIX,""),Ee.forEach(function(Mt,oi){var ji={type:st.FEATURE,properties:D.properties,geometry:{type:re,coordinates:Mt}};Ze=Ze.concat($i(ji,N,oi))})),Ze}var Ii={enable:function(D){setTimeout(function(){D.map&&D.map.doubleClickZoom&&D._ctx&&D._ctx.store&&D._ctx.store.getInitialConfigValue&&D._ctx.store.getInitialConfigValue("doubleClickZoom")&&D.map.doubleClickZoom.enable()},0)},disable:function(D){setTimeout(function(){D.map&&D.map.doubleClickZoom&&D.map.doubleClickZoom.disable()},0)}},on={exports:{}},Mn=function(D){if(!D||!D.type)return null;var N=zr[D.type];if(!N)return null;if(N==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:D}]};if(N==="feature")return{type:"FeatureCollection",features:[D]};if(N==="featurecollection")return D},zr={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Ln=l(Mn),To=Object.freeze({__proto__:null,default:function D(N){switch(N&&N.type||null){case"FeatureCollection":return N.features=N.features.reduce(function(J,re){return J.concat(D(re))},[]),N;case"Feature":return N.geometry?D(N.geometry).map(function(J){var re={type:"Feature",properties:JSON.parse(JSON.stringify(N.properties)),geometry:J};return N.id!==void 0&&(re.id=N.id),re}):[N];case"MultiPoint":return N.coordinates.map(function(J){return{type:"Point",coordinates:J}});case"MultiPolygon":return N.coordinates.map(function(J){return{type:"Polygon",coordinates:J}});case"MultiLineString":return N.coordinates.map(function(J){return{type:"LineString",coordinates:J}});case"GeometryCollection":return N.geometries.map(D).reduce(function(J,re){return J.concat(re)},[]);case"Point":case"Polygon":case"LineString":return[N]}}}),ho=Mn,to=w(To),kr=function(D){return function N(J){return Array.isArray(J)&&J.length&&typeof J[0]=="number"?[J]:J.reduce(function(re,pe){return Array.isArray(pe)&&Array.isArray(pe[0])?re.concat(N(pe)):(re.push(pe),re)},[])}(D)};to instanceof Function||(to=to.default);var gr={exports:{}},Ne=gr.exports=function(D){return new Le(D)};function Le(D){this.value=D}function tt(D,N,J){var re=[],pe=[],ge=!0;return function Ee(ft){var Ze=J?lt(ft):ft,Vt={},zt=!0,Mt={node:Ze,node_:ft,path:[].concat(re),parent:pe[pe.length-1],parents:pe,key:re.slice(-1)[0],isRoot:re.length===0,level:re.length,circular:null,update:function(ot,tr){Mt.isRoot||(Mt.parent.node[Mt.key]=ot),Mt.node=ot,tr&&(zt=!1)},delete:function(ot){delete Mt.parent.node[Mt.key],ot&&(zt=!1)},remove:function(ot){gt(Mt.parent.node)?Mt.parent.node.splice(Mt.key,1):delete Mt.parent.node[Mt.key],ot&&(zt=!1)},keys:null,before:function(ot){Vt.before=ot},after:function(ot){Vt.after=ot},pre:function(ot){Vt.pre=ot},post:function(ot){Vt.post=ot},stop:function(){ge=!1},block:function(){zt=!1}};if(!ge)return Mt;function oi(){if(typeof Mt.node=="object"&&Mt.node!==null){Mt.keys&&Mt.node_===Mt.node||(Mt.keys=it(Mt.node)),Mt.isLeaf=Mt.keys.length==0;for(var ot=0;ot<pe.length;ot++)if(pe[ot].node_===ft){Mt.circular=pe[ot];break}}else Mt.isLeaf=!0,Mt.keys=null;Mt.notLeaf=!Mt.isLeaf,Mt.notRoot=!Mt.isRoot}oi();var ji=N.call(Mt,Mt.node);return ji!==void 0&&Mt.update&&Mt.update(ji),Vt.before&&Vt.before.call(Mt,Mt.node),zt&&(typeof Mt.node!="object"||Mt.node===null||Mt.circular||(pe.push(Mt),oi(),rt(Mt.keys,function(ot,tr){re.push(ot),Vt.pre&&Vt.pre.call(Mt,Mt.node[ot],ot);var ke=Ee(Mt.node[ot]);J&&xt.call(Mt.node,ot)&&(Mt.node[ot]=ke.node),ke.isLast=tr==Mt.keys.length-1,ke.isFirst=tr==0,Vt.post&&Vt.post.call(Mt,ke),re.pop()}),pe.pop()),Vt.after&&Vt.after.call(Mt,Mt.node)),Mt}(D).node}function lt(D){if(typeof D=="object"&&D!==null){var N;if(gt(D))N=[];else if(ht(D)==="[object Date]")N=new Date(D.getTime?D.getTime():D);else if(function(pe){return ht(pe)==="[object RegExp]"}(D))N=new RegExp(D);else if(function(pe){return ht(pe)==="[object Error]"}(D))N={message:D.message};else if(function(pe){return ht(pe)==="[object Boolean]"}(D))N=new Boolean(D);else if(function(pe){return ht(pe)==="[object Number]"}(D))N=new Number(D);else if(function(pe){return ht(pe)==="[object String]"}(D))N=new String(D);else if(Object.create&&Object.getPrototypeOf)N=Object.create(Object.getPrototypeOf(D));else if(D.constructor===Object)N={};else{var J=D.constructor&&D.constructor.prototype||D.__proto__||{},re=function(){};re.prototype=J,N=new re}return rt(it(D),function(pe){N[pe]=D[pe]}),N}return D}Le.prototype.get=function(D){for(var N=this.value,J=0;J<D.length;J++){var re=D[J];if(!N||!xt.call(N,re)){N=void 0;break}N=N[re]}return N},Le.prototype.has=function(D){for(var N=this.value,J=0;J<D.length;J++){var re=D[J];if(!N||!xt.call(N,re))return!1;N=N[re]}return!0},Le.prototype.set=function(D,N){for(var J=this.value,re=0;re<D.length-1;re++){var pe=D[re];xt.call(J,pe)||(J[pe]={}),J=J[pe]}return J[D[re]]=N,N},Le.prototype.map=function(D){return tt(this.value,D,!0)},Le.prototype.forEach=function(D){return this.value=tt(this.value,D,!1),this.value},Le.prototype.reduce=function(D,N){var J=arguments.length===1,re=J?this.value:N;return this.forEach(function(pe){this.isRoot&&J||(re=D.call(this,re,pe))}),re},Le.prototype.paths=function(){var D=[];return this.forEach(function(N){D.push(this.path)}),D},Le.prototype.nodes=function(){var D=[];return this.forEach(function(N){D.push(this.node)}),D},Le.prototype.clone=function(){var D=[],N=[];return function J(re){for(var pe=0;pe<D.length;pe++)if(D[pe]===re)return N[pe];if(typeof re=="object"&&re!==null){var ge=lt(re);return D.push(re),N.push(ge),rt(it(re),function(Ee){ge[Ee]=J(re[Ee])}),D.pop(),N.pop(),ge}return re}(this.value)};var it=Object.keys||function(D){var N=[];for(var J in D)N.push(J);return N};function ht(D){return Object.prototype.toString.call(D)}var gt=Array.isArray||function(D){return Object.prototype.toString.call(D)==="[object Array]"},rt=function(D,N){if(D.forEach)return D.forEach(N);for(var J=0;J<D.length;J++)N(D[J],J,D)};rt(it(Le.prototype),function(D){Ne[D]=function(N){var J=[].slice.call(arguments,1),re=new Le(N);return re[D].apply(re,J)}});var xt=Object.hasOwnProperty||function(D,N){return N in D},pt=gr.exports,ti=ni;function ni(D){if(!(this instanceof ni))return new ni(D);this._bbox=D||[1/0,1/0,-1/0,-1/0],this._valid=!!D}ni.prototype.include=function(D){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],D[0]),this._bbox[1]=Math.min(this._bbox[1],D[1]),this._bbox[2]=Math.max(this._bbox[2],D[0]),this._bbox[3]=Math.max(this._bbox[3],D[1]),this},ni.prototype.equals=function(D){var N;return N=D instanceof ni?D.bbox():D,this._bbox[0]==N[0]&&this._bbox[1]==N[1]&&this._bbox[2]==N[2]&&this._bbox[3]==N[3]},ni.prototype.center=function(D){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},ni.prototype.union=function(D){var N;return this._valid=!0,N=D instanceof ni?D.bbox():D,this._bbox[0]=Math.min(this._bbox[0],N[0]),this._bbox[1]=Math.min(this._bbox[1],N[1]),this._bbox[2]=Math.max(this._bbox[2],N[2]),this._bbox[3]=Math.max(this._bbox[3],N[3]),this},ni.prototype.bbox=function(){return this._valid?this._bbox:null},ni.prototype.contains=function(D){if(!D)return this._fastContains();if(!this._valid)return null;var N=D[0],J=D[1];return this._bbox[0]<=N&&this._bbox[1]<=J&&this._bbox[2]>=N&&this._bbox[3]>=J},ni.prototype.intersect=function(D){return this._valid?(N=D instanceof ni?D.bbox():D,!(this._bbox[0]>N[2]||this._bbox[2]<N[0]||this._bbox[3]<N[1]||this._bbox[1]>N[3])):null;var N},ni.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var D="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",D)},ni.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Bt=function(D){if(!D)return[];var N=to(ho(D)),J=[];return N.features.forEach(function(re){re.geometry&&(J=J.concat(kr(re.geometry.coordinates)))}),J},In=pt,Gn=ti,Wn={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Rr=Object.keys(Wn);function Nr(D){for(var N=Gn(),J=Bt(D),re=0;re<J.length;re++)N.include(J[re]);return N}on.exports=function(D){return Nr(D).bbox()},on.exports.polygon=function(D){return Nr(D).polygon()},on.exports.bboxify=function(D){return In(D).map(function(N){N&&Rr.some(function(J){return!!N[J]&&Wn[J].indexOf(N.type)!==-1})&&(N.bbox=Nr(N).bbox(),this.update(N))})};var Zi=l(on.exports),po=-90;function Bo(D,N){var J=po,re=90,pe=po,ge=90,Ee=270,ft=-270;D.forEach(function(Vt){var zt=Zi(Vt),Mt=zt[1],oi=zt[3],ji=zt[0],ot=zt[2];Mt>J&&(J=Mt),oi<re&&(re=oi),oi>pe&&(pe=oi),Mt<ge&&(ge=Mt),ji<Ee&&(Ee=ji),ot>ft&&(ft=ot)});var Ze=N;return J+Ze.lat>85&&(Ze.lat=85-J),pe+Ze.lat>90&&(Ze.lat=90-pe),re+Ze.lat<-85&&(Ze.lat=-85-re),ge+Ze.lat<po&&(Ze.lat=po-ge),Ee+Ze.lng<=-270&&(Ze.lng+=360*Math.ceil(Math.abs(Ze.lng)/360)),ft+Ze.lng>=270&&(Ze.lng-=360*Math.ceil(Math.abs(Ze.lng)/360)),Ze}function Br(D,N){var J=Bo(D.map(function(re){return re.toGeoJSON()}),N);D.forEach(function(re){var pe,ge=re.getCoordinates(),Ee=function(Ze){var Vt={lng:Ze[0]+J.lng,lat:Ze[1]+J.lat};return[Vt.lng,Vt.lat]},ft=function(Ze){return Ze.map(function(Vt){return Ee(Vt)})};re.type===st.POINT?pe=Ee(ge):re.type===st.LINE_STRING||re.type===st.MULTI_POINT?pe=ge.map(Ee):re.type===st.POLYGON||re.type===st.MULTI_LINE_STRING?pe=ge.map(ft):re.type===st.MULTI_POLYGON&&(pe=ge.map(function(Ze){return Ze.map(function(Vt){return ft(Vt)})})),re.incomingCoords(pe)})}var Tr={onSetup:function(D){var N=this,J={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:D.featureIds||[]};return this.setSelected(J.initiallySelectedFeatureIds.filter(function(re){return N.getFeature(re)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),J},fireUpdate:function(){this.map.fire(Oi.UPDATE,{action:vi.MOVE,features:this.getSelected().map(function(D){return D.toGeoJSON()})})},fireActionable:function(){var D=this,N=this.getSelected(),J=N.filter(function(ft){return D.isInstanceOf("MultiFeature",ft)}),re=!1;if(N.length>1){re=!0;var pe=N[0].type.replace("Multi","");N.forEach(function(ft){ft.type.replace("Multi","")!==pe&&(re=!1)})}var ge=J.length>0,Ee=N.length>0;this.setActionableState({combineFeatures:re,uncombineFeatures:ge,trash:Ee})},getUniqueIds:function(D){return D.length?D.map(function(N){return N.properties.id}).filter(function(N){return N!==void 0}).reduce(function(N,J){return N.add(J),N},new qn).values():[]},stopExtendedInteractions:function(D){D.boxSelectElement&&(D.boxSelectElement.parentNode&&D.boxSelectElement.parentNode.removeChild(D.boxSelectElement),D.boxSelectElement=null),this.map.dragPan.enable(),D.boxSelecting=!1,D.canBoxSelect=!1,D.dragMoving=!1,D.canDragMove=!1},onStop:function(){Ii.enable(this)},onMouseMove:function(D,N){return Be(N)&&D.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(D),!0},onMouseOut:function(D){return!D.dragMoving||this.fireUpdate()}};Tr.onTap=Tr.onClick=function(D,N){return fe(N)?this.clickAnywhere(D,N):ga(Ti.VERTEX)(N)?this.clickOnVertex(D,N):Be(N)?this.clickOnFeature(D,N):void 0},Tr.clickAnywhere=function(D){var N=this,J=this.getSelectedIds();J.length&&(this.clearSelectedFeatures(),J.forEach(function(re){return N.doRender(re)})),Ii.enable(this),this.stopExtendedInteractions(D)},Tr.clickOnVertex=function(D,N){this.changeMode(Xt.DIRECT_SELECT,{featureId:N.featureTarget.properties.parent,coordPath:N.featureTarget.properties.coord_path,startPos:N.lngLat}),this.updateUIClasses({mouse:Je.MOVE})},Tr.startOnActiveFeature=function(D,N){this.stopExtendedInteractions(D),this.map.dragPan.disable(),this.doRender(N.featureTarget.properties.id),D.canDragMove=!0,D.dragMoveLocation=N.lngLat},Tr.clickOnFeature=function(D,N){var J=this;Ii.disable(this),this.stopExtendedInteractions(D);var re=et(N),pe=this.getSelectedIds(),ge=N.featureTarget.properties.id,Ee=this.isSelected(ge);if(!re&&Ee&&this.getFeature(ge).type!==st.POINT)return this.changeMode(Xt.DIRECT_SELECT,{featureId:ge});Ee&&re?(this.deselect(ge),this.updateUIClasses({mouse:Je.POINTER}),pe.length===1&&Ii.enable(this)):!Ee&&re?(this.select(ge),this.updateUIClasses({mouse:Je.MOVE})):Ee||re||(pe.forEach(function(ft){return J.doRender(ft)}),this.setSelected(ge),this.updateUIClasses({mouse:Je.MOVE})),this.doRender(ge)},Tr.onMouseDown=function(D,N){return Y(N)?this.startOnActiveFeature(D,N):this.drawConfig.boxSelect&&Ue(N)?this.startBoxSelect(D,N):void 0},Tr.startBoxSelect=function(D,N){this.stopExtendedInteractions(D),this.map.dragPan.disable(),D.boxSelectStartLocation=mn(N.originalEvent,this.map.getContainer()),D.canBoxSelect=!0},Tr.onTouchStart=function(D,N){if(Y(N))return this.startOnActiveFeature(D,N)},Tr.onDrag=function(D,N){return D.canDragMove?this.dragMove(D,N):this.drawConfig.boxSelect&&D.canBoxSelect?this.whileBoxSelect(D,N):void 0},Tr.whileBoxSelect=function(D,N){D.boxSelecting=!0,this.updateUIClasses({mouse:Je.ADD}),D.boxSelectElement||(D.boxSelectElement=document.createElement("div"),D.boxSelectElement.classList.add(ue.BOX_SELECT),this.map.getContainer().appendChild(D.boxSelectElement));var J=mn(N.originalEvent,this.map.getContainer()),re=Math.min(D.boxSelectStartLocation.x,J.x),pe=Math.max(D.boxSelectStartLocation.x,J.x),ge=Math.min(D.boxSelectStartLocation.y,J.y),Ee=Math.max(D.boxSelectStartLocation.y,J.y),ft="translate("+re+"px, "+ge+"px)";D.boxSelectElement.style.transform=ft,D.boxSelectElement.style.WebkitTransform=ft,D.boxSelectElement.style.width=pe-re+"px",D.boxSelectElement.style.height=Ee-ge+"px"},Tr.dragMove=function(D,N){D.dragMoving=!0,N.originalEvent.stopPropagation();var J={lng:N.lngLat.lng-D.dragMoveLocation.lng,lat:N.lngLat.lat-D.dragMoveLocation.lat};Br(this.getSelected(),J),D.dragMoveLocation=N.lngLat},Tr.onTouchEnd=Tr.onMouseUp=function(D,N){var J=this;if(D.dragMoving)this.fireUpdate();else if(D.boxSelecting){var re=[D.boxSelectStartLocation,mn(N.originalEvent,this.map.getContainer())],pe=this.featuresAt(null,re,"click"),ge=this.getUniqueIds(pe).filter(function(Ee){return!J.isSelected(Ee)});ge.length&&(this.select(ge),ge.forEach(function(Ee){return J.doRender(Ee)}),this.updateUIClasses({mouse:Je.MOVE}))}this.stopExtendedInteractions(D)},Tr.toDisplayFeatures=function(D,N,J){N.properties.active=this.isSelected(N.properties.id)?xn.ACTIVE:xn.INACTIVE,J(N),this.fireActionable(),N.properties.active===xn.ACTIVE&&N.geometry.type!==st.POINT&&$i(N).forEach(J)},Tr.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Tr.onCombineFeatures=function(){var D=this.getSelected();if(!(D.length===0||D.length<2)){for(var N=[],J=[],re=D[0].type.replace("Multi",""),pe=0;pe<D.length;pe++){var ge=D[pe];if(ge.type.replace("Multi","")!==re)return;ge.type.includes("Multi")?ge.getCoordinates().forEach(function(ft){N.push(ft)}):N.push(ge.getCoordinates()),J.push(ge.toGeoJSON())}if(J.length>1){var Ee=this.newFeature({type:st.FEATURE,properties:J[0].properties,geometry:{type:"Multi"+re,coordinates:N}});this.addFeature(Ee),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Ee.id]),this.map.fire(Oi.COMBINE_FEATURES,{createdFeatures:[Ee.toGeoJSON()],deletedFeatures:J})}this.fireActionable()}},Tr.onUncombineFeatures=function(){var D=this,N=this.getSelected();if(N.length!==0){for(var J=[],re=[],pe=function(Ee){var ft=N[Ee];D.isInstanceOf("MultiFeature",ft)&&(ft.getFeatures().forEach(function(Ze){D.addFeature(Ze),Ze.properties=ft.properties,J.push(Ze.toGeoJSON()),D.select([Ze.id])}),D.deleteFeature(ft.id,{silent:!0}),re.push(ft.toGeoJSON()))},ge=0;ge<N.length;ge++)pe(ge);J.length>1&&this.map.fire(Oi.UNCOMBINE_FEATURES,{createdFeatures:J,deletedFeatures:re}),this.fireActionable()}};var Ga=ga(Ti.VERTEX),Ls=ga(Ti.MIDPOINT),Ma={fireUpdate:function(){this.map.fire(Oi.UPDATE,{action:vi.CHANGE_COORDINATES,features:this.getSelected().map(function(D){return D.toGeoJSON()})})},fireActionable:function(D){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:D.selectedCoordPaths.length>0})},startDragging:function(D,N){this.map.dragPan.disable(),D.canDragMove=!0,D.dragMoveLocation=N.lngLat},stopDragging:function(D){this.map.dragPan.enable(),D.dragMoving=!1,D.canDragMove=!1,D.dragMoveLocation=null},onVertex:function(D,N){this.startDragging(D,N);var J=N.featureTarget.properties,re=D.selectedCoordPaths.indexOf(J.coord_path);et(N)||re!==-1?et(N)&&re===-1&&D.selectedCoordPaths.push(J.coord_path):D.selectedCoordPaths=[J.coord_path];var pe=this.pathsToCoordinates(D.featureId,D.selectedCoordPaths);this.setSelectedCoordinates(pe)},onMidpoint:function(D,N){this.startDragging(D,N);var J=N.featureTarget.properties;D.feature.addCoordinate(J.coord_path,J.lng,J.lat),this.fireUpdate(),D.selectedCoordPaths=[J.coord_path]},pathsToCoordinates:function(D,N){return N.map(function(J){return{feature_id:D,coord_path:J}})},onFeature:function(D,N){D.selectedCoordPaths.length===0?this.startDragging(D,N):this.stopDragging(D)},dragFeature:function(D,N,J){Br(this.getSelected(),J),D.dragMoveLocation=N.lngLat},dragVertex:function(D,N,J){for(var re=D.selectedCoordPaths.map(function(ft){return D.feature.getCoordinate(ft)}),pe=Bo(re.map(function(ft){return{type:st.FEATURE,properties:{},geometry:{type:st.POINT,coordinates:ft}}}),J),ge=0;ge<re.length;ge++){var Ee=re[ge];D.feature.updateCoordinate(D.selectedCoordPaths[ge],Ee[0]+pe.lng,Ee[1]+pe.lat)}},clickNoTarget:function(){this.changeMode(Xt.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(Xt.SIMPLE_SELECT)},clickActiveFeature:function(D){D.selectedCoordPaths=[],this.clearSelectedCoordinates(),D.feature.changed()},onSetup:function(D){var N=D.featureId,J=this.getFeature(N);if(!J)throw new Error("You must provide a featureId to enter direct_select mode");if(J.type===st.POINT)throw new TypeError("direct_select mode doesn't handle point features");var re={featureId:N,feature:J,dragMoveLocation:D.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:D.coordPath?[D.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(N,re.selectedCoordPaths)),this.setSelected(N),Ii.disable(this),this.setActionableState({trash:!0}),re},onStop:function(){Ii.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(D,N,J){D.featureId===N.properties.id?(N.properties.active=xn.ACTIVE,J(N),$i(N,{map:this.map,midpoints:!0,selectedPaths:D.selectedCoordPaths}).forEach(J)):(N.properties.active=xn.INACTIVE,J(N)),this.fireActionable(D)},onTrash:function(D){D.selectedCoordPaths.sort(function(N,J){return J.localeCompare(N,"en",{numeric:!0})}).forEach(function(N){return D.feature.removeCoordinate(N)}),this.fireUpdate(),D.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(D),D.feature.isValid()===!1&&(this.deleteFeature([D.featureId]),this.changeMode(Xt.SIMPLE_SELECT,{}))},onMouseMove:function(D,N){var J=Y(N),re=Ga(N),pe=Ls(N),ge=D.selectedCoordPaths.length===0;return J&&ge||re&&!ge?this.updateUIClasses({mouse:Je.MOVE}):this.updateUIClasses({mouse:Je.NONE}),(re||J||pe)&&D.dragMoving&&this.fireUpdate(),this.stopDragging(D),!0},onMouseOut:function(D){return D.dragMoving&&this.fireUpdate(),!0}};Ma.onTouchStart=Ma.onMouseDown=function(D,N){return Ga(N)?this.onVertex(D,N):Y(N)?this.onFeature(D,N):Ls(N)?this.onMidpoint(D,N):void 0},Ma.onDrag=function(D,N){if(D.canDragMove===!0){D.dragMoving=!0,N.originalEvent.stopPropagation();var J={lng:N.lngLat.lng-D.dragMoveLocation.lng,lat:N.lngLat.lat-D.dragMoveLocation.lat};D.selectedCoordPaths.length>0?this.dragVertex(D,N,J):this.dragFeature(D,N,J),D.dragMoveLocation=N.lngLat}},Ma.onClick=function(D,N){return fe(N)?this.clickNoTarget(D,N):Y(N)?this.clickActiveFeature(D,N):ae(N)?this.clickInactive(D,N):void this.stopDragging(D)},Ma.onTap=function(D,N){return fe(N)?this.clickNoTarget(D,N):Y(N)?this.clickActiveFeature(D,N):ae(N)?this.clickInactive(D,N):void 0},Ma.onTouchEnd=Ma.onMouseUp=function(D){D.dragMoving&&this.fireUpdate(),this.stopDragging(D)};var mo={};function El(D,N){return!!D.lngLat&&D.lngLat.lng===N[0]&&D.lngLat.lat===N[1]}mo.onSetup=function(){var D=this.newFeature({type:st.FEATURE,properties:{},geometry:{type:st.POINT,coordinates:[]}});return this.addFeature(D),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Je.ADD}),this.activateUIButton(It.POINT),this.setActionableState({trash:!0}),{point:D}},mo.stopDrawingAndRemove=function(D){this.deleteFeature([D.point.id],{silent:!0}),this.changeMode(Xt.SIMPLE_SELECT)},mo.onTap=mo.onClick=function(D,N){this.updateUIClasses({mouse:Je.MOVE}),D.point.updateCoordinate("",N.lngLat.lng,N.lngLat.lat),this.map.fire(Oi.CREATE,{features:[D.point.toGeoJSON()]}),this.changeMode(Xt.SIMPLE_SELECT,{featureIds:[D.point.id]})},mo.onStop=function(D){this.activateUIButton(),D.point.getCoordinate().length||this.deleteFeature([D.point.id],{silent:!0})},mo.toDisplayFeatures=function(D,N,J){var re=N.properties.id===D.point.id;if(N.properties.active=re?xn.ACTIVE:xn.INACTIVE,!re)return J(N)},mo.onTrash=mo.stopDrawingAndRemove,mo.onKeyUp=function(D,N){if(St(N)||Ve(N))return this.stopDrawingAndRemove(D,N)};var Qo={onSetup:function(){var D=this.newFeature({type:st.FEATURE,properties:{},geometry:{type:st.POLYGON,coordinates:[[]]}});return this.addFeature(D),this.clearSelectedFeatures(),Ii.disable(this),this.updateUIClasses({mouse:Je.ADD}),this.activateUIButton(It.POLYGON),this.setActionableState({trash:!0}),{polygon:D,currentVertexPosition:0}},clickAnywhere:function(D,N){if(D.currentVertexPosition>0&&El(N,D.polygon.coordinates[0][D.currentVertexPosition-1]))return this.changeMode(Xt.SIMPLE_SELECT,{featureIds:[D.polygon.id]});this.updateUIClasses({mouse:Je.ADD}),D.polygon.updateCoordinate("0."+D.currentVertexPosition,N.lngLat.lng,N.lngLat.lat),D.currentVertexPosition++,D.polygon.updateCoordinate("0."+D.currentVertexPosition,N.lngLat.lng,N.lngLat.lat)},clickOnVertex:function(D){return this.changeMode(Xt.SIMPLE_SELECT,{featureIds:[D.polygon.id]})},onMouseMove:function(D,N){D.polygon.updateCoordinate("0."+D.currentVertexPosition,N.lngLat.lng,N.lngLat.lat),Ge(N)&&this.updateUIClasses({mouse:Je.POINTER})}};Qo.onTap=Qo.onClick=function(D,N){return Ge(N)?this.clickOnVertex(D,N):this.clickAnywhere(D,N)},Qo.onKeyUp=function(D,N){St(N)?(this.deleteFeature([D.polygon.id],{silent:!0}),this.changeMode(Xt.SIMPLE_SELECT)):Ve(N)&&this.changeMode(Xt.SIMPLE_SELECT,{featureIds:[D.polygon.id]})},Qo.onStop=function(D){this.updateUIClasses({mouse:Je.NONE}),Ii.enable(this),this.activateUIButton(),this.getFeature(D.polygon.id)!==void 0&&(D.polygon.removeCoordinate("0."+D.currentVertexPosition),D.polygon.isValid()?this.map.fire(Oi.CREATE,{features:[D.polygon.toGeoJSON()]}):(this.deleteFeature([D.polygon.id],{silent:!0}),this.changeMode(Xt.SIMPLE_SELECT,{},{silent:!0})))},Qo.toDisplayFeatures=function(D,N,J){var re=N.properties.id===D.polygon.id;if(N.properties.active=re?xn.ACTIVE:xn.INACTIVE,!re)return J(N);if(N.geometry.coordinates.length!==0){var pe=N.geometry.coordinates[0].length;if(!(pe<3)){if(N.properties.meta=Ti.FEATURE,J(En(D.polygon.id,N.geometry.coordinates[0][0],"0.0",!1)),pe>3){var ge=N.geometry.coordinates[0].length-3;J(En(D.polygon.id,N.geometry.coordinates[0][ge],"0."+ge,!1))}if(pe<=4){var Ee=[[N.geometry.coordinates[0][0][0],N.geometry.coordinates[0][0][1]],[N.geometry.coordinates[0][1][0],N.geometry.coordinates[0][1][1]]];if(J({type:st.FEATURE,properties:N.properties,geometry:{coordinates:Ee,type:st.LINE_STRING}}),pe===3)return}return J(N)}}},Qo.onTrash=function(D){this.deleteFeature([D.polygon.id],{silent:!0}),this.changeMode(Xt.SIMPLE_SELECT)};var hs={onSetup:function(D){var N,J,re=(D=D||{}).featureId,pe="forward";if(re){if(!(N=this.getFeature(re)))throw new Error("Could not find a feature with the provided featureId");var ge=D.from;if(ge&&ge.type==="Feature"&&ge.geometry&&ge.geometry.type==="Point"&&(ge=ge.geometry),ge&&ge.type==="Point"&&ge.coordinates&&ge.coordinates.length===2&&(ge=ge.coordinates),!ge||!Array.isArray(ge))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Ee=N.coordinates.length-1;if(N.coordinates[Ee][0]===ge[0]&&N.coordinates[Ee][1]===ge[1])J=Ee+1,N.addCoordinate.apply(N,[J].concat(N.coordinates[Ee]));else{if(N.coordinates[0][0]!==ge[0]||N.coordinates[0][1]!==ge[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");pe="backwards",J=0,N.addCoordinate.apply(N,[J].concat(N.coordinates[0]))}}else N=this.newFeature({type:st.FEATURE,properties:{},geometry:{type:st.LINE_STRING,coordinates:[]}}),J=0,this.addFeature(N);return this.clearSelectedFeatures(),Ii.disable(this),this.updateUIClasses({mouse:Je.ADD}),this.activateUIButton(It.LINE),this.setActionableState({trash:!0}),{line:N,currentVertexPosition:J,direction:pe}},clickAnywhere:function(D,N){if(D.currentVertexPosition>0&&El(N,D.line.coordinates[D.currentVertexPosition-1])||D.direction==="backwards"&&El(N,D.line.coordinates[D.currentVertexPosition+1]))return this.changeMode(Xt.SIMPLE_SELECT,{featureIds:[D.line.id]});this.updateUIClasses({mouse:Je.ADD}),D.line.updateCoordinate(D.currentVertexPosition,N.lngLat.lng,N.lngLat.lat),D.direction==="forward"?(D.currentVertexPosition++,D.line.updateCoordinate(D.currentVertexPosition,N.lngLat.lng,N.lngLat.lat)):D.line.addCoordinate(0,N.lngLat.lng,N.lngLat.lat)},clickOnVertex:function(D){return this.changeMode(Xt.SIMPLE_SELECT,{featureIds:[D.line.id]})},onMouseMove:function(D,N){D.line.updateCoordinate(D.currentVertexPosition,N.lngLat.lng,N.lngLat.lat),Ge(N)&&this.updateUIClasses({mouse:Je.POINTER})}};hs.onTap=hs.onClick=function(D,N){if(Ge(N))return this.clickOnVertex(D,N);this.clickAnywhere(D,N)},hs.onKeyUp=function(D,N){Ve(N)?this.changeMode(Xt.SIMPLE_SELECT,{featureIds:[D.line.id]}):St(N)&&(this.deleteFeature([D.line.id],{silent:!0}),this.changeMode(Xt.SIMPLE_SELECT))},hs.onStop=function(D){Ii.enable(this),this.activateUIButton(),this.getFeature(D.line.id)!==void 0&&(D.line.removeCoordinate(""+D.currentVertexPosition),D.line.isValid()?this.map.fire(Oi.CREATE,{features:[D.line.toGeoJSON()]}):(this.deleteFeature([D.line.id],{silent:!0}),this.changeMode(Xt.SIMPLE_SELECT,{},{silent:!0})))},hs.onTrash=function(D){this.deleteFeature([D.line.id],{silent:!0}),this.changeMode(Xt.SIMPLE_SELECT)},hs.toDisplayFeatures=function(D,N,J){var re=N.properties.id===D.line.id;if(N.properties.active=re?xn.ACTIVE:xn.INACTIVE,!re)return J(N);N.geometry.coordinates.length<2||(N.properties.meta=Ti.FEATURE,J(En(D.line.id,N.geometry.coordinates[D.direction==="forward"?N.geometry.coordinates.length-2:1],""+(D.direction==="forward"?N.geometry.coordinates.length-2:1),!1)),J(N))};var ac={simple_select:Tr,direct_select:Ma,draw_point:mo,draw_polygon:Qo,draw_line_string:hs},Ad={defaultMode:Xt.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Sa,modes:ac,controls:{},userProperties:!1},Vc={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Dd={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Eo(D,N){return D.map(function(J){return J.source?J:No(J,{id:J.id+"."+N,source:N==="hot"?ye.HOT:ye.COLD})})}var hr={exports:{}};(function(D,N){var J="__lodash_hash_undefined__",re=9007199254740991,pe="[object Arguments]",ge="[object Array]",Ee="[object Boolean]",ft="[object Date]",Ze="[object Error]",Vt="[object Function]",zt="[object Map]",Mt="[object Number]",oi="[object Object]",ji="[object Promise]",ot="[object RegExp]",tr="[object Set]",ke="[object String]",Kt="[object Symbol]",Gt="[object WeakMap]",Er="[object ArrayBuffer]",_n="[object DataView]",qt=/^\[object .+?Constructor\]$/,Ku=/^(?:0|[1-9]\d*)$/,zn={};zn["[object Float32Array]"]=zn["[object Float64Array]"]=zn["[object Int8Array]"]=zn["[object Int16Array]"]=zn["[object Int32Array]"]=zn["[object Uint8Array]"]=zn["[object Uint8ClampedArray]"]=zn["[object Uint16Array]"]=zn["[object Uint32Array]"]=!0,zn[pe]=zn[ge]=zn[Er]=zn[Ee]=zn[_n]=zn[ft]=zn[Ze]=zn[Vt]=zn[zt]=zn[Mt]=zn[oi]=zn[ot]=zn[tr]=zn[ke]=zn[Gt]=!1;var Ir=typeof global=="object"&&global&&global.Object===Object&&global,Jo=typeof self=="object"&&self&&self.Object===Object&&self,fo=Ir||Jo||Function("return this")(),Aa=N&&!N.nodeType&&N,Sr=Aa&&D&&!D.nodeType&&D,Uc=Sr&&Sr.exports===Aa,sc=Uc&&Ir.process,Da=function(){try{return sc&&sc.binding&&sc.binding("util")}catch{}}(),zs=Da&&Da.isTypedArray;function Ns(Me,We){for(var Lt=-1,si=Me==null?0:Me.length;++Lt<si;)if(We(Me[Lt],Lt,Me))return!0;return!1}function Il(Me){var We=-1,Lt=Array(Me.size);return Me.forEach(function(si,Hn){Lt[++We]=[Hn,si]}),Lt}function _a(Me){var We=-1,Lt=Array(Me.size);return Me.forEach(function(si){Lt[++We]=si}),Lt}var lc,ka,Sl,Qu=Array.prototype,Bs=Function.prototype,cc=Object.prototype,Di=fo["__core-js_shared__"],Ml=Bs.toString,ea=cc.hasOwnProperty,Ju=(lc=/[^.]+$/.exec(Di&&Di.keys&&Di.keys.IE_PROTO||""))?"Symbol(src)_1."+lc:"",eh=cc.toString,ps=RegExp("^"+Ml.call(ea).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ha=Uc?fo.Buffer:void 0,Vs=fo.Symbol,js=fo.Uint8Array,Gc=cc.propertyIsEnumerable,$a=Qu.splice,Do=Vs?Vs.toStringTag:void 0,Al=Object.getOwnPropertySymbols,Pd=Ha?Ha.isBuffer:void 0,Od=(ka=Object.keys,Sl=Object,function(Me){return ka(Sl(Me))}),ko=qs(fo,"DataView"),Dl=qs(fo,"Map"),dc=qs(fo,"Promise"),uc=qs(fo,"Set"),hc=qs(fo,"WeakMap"),Us=qs(Object,"create"),Fd=Ws(ko),kl=Ws(Dl),Hc=Ws(dc),pc=Ws(uc),ms=Ws(hc),$c=Vs?Vs.prototype:void 0,Ro=$c?$c.valueOf:void 0;function mt(Me){var We=-1,Lt=Me==null?0:Me.length;for(this.clear();++We<Lt;){var si=Me[We];this.set(si[0],si[1])}}function ta(Me){var We=-1,Lt=Me==null?0:Me.length;for(this.clear();++We<Lt;){var si=Me[We];this.set(si[0],si[1])}}function qa(Me){var We=-1,Lt=Me==null?0:Me.length;for(this.clear();++We<Lt;){var si=Me[We];this.set(si[0],si[1])}}function fs(Me){var We=-1,Lt=Me==null?0:Me.length;for(this.__data__=new qa;++We<Lt;)this.add(Me[We])}function Ra(Me){var We=this.__data__=new ta(Me);this.size=We.size}function gs(Me,We){var Lt=bs(Me),si=!Lt&&rh(Me),Hn=!Lt&&!si&&zd(Me),an=!Lt&&!si&&!Hn&&gc(Me),Kn=Lt||si||Hn||an,_r=Kn?function(ir,br){for(var ba=-1,go=Array(ir);++ba<ir;)go[ba]=br(ba);return go}(Me.length,String):[],Io=_r.length;for(var wn in Me)!We&&!ea.call(Me,wn)||Kn&&(wn=="length"||Hn&&(wn=="offset"||wn=="parent")||an&&(wn=="buffer"||wn=="byteLength"||wn=="byteOffset")||Mp(wn,Io))||_r.push(wn);return _r}function Po(Me,We){for(var Lt=Me.length;Lt--;)if(nh(Me[Lt][0],We))return Lt;return-1}function Gs(Me){return Me==null?Me===void 0?"[object Undefined]":"[object Null]":Do&&Do in Object(Me)?function(We){var Lt=ea.call(We,Do),si=We[Do];try{We[Do]=void 0;var Hn=!0}catch{}var an=eh.call(We);return Hn&&(Lt?We[Do]=si:delete We[Do]),an}(Me):function(We){return eh.call(We)}(Me)}function _s(Me){return Zs(Me)&&Gs(Me)==pe}function mc(Me,We,Lt,si,Hn){return Me===We||(Me==null||We==null||!Zs(Me)&&!Zs(We)?Me!=Me&&We!=We:function(an,Kn,_r,Io,wn,ir){var br=bs(an),ba=bs(Kn),go=br?ge:Pa(an),ya=ba?ge:Pa(Kn),ia=(go=go==pe?oi:go)==oi,Ys=(ya=ya==pe?oi:ya)==oi,Oa=go==ya;if(Oa&&zd(an)){if(!zd(Kn))return!1;br=!0,ia=!1}if(Oa&&!ia)return ir||(ir=new Ra),br||gc(an)?th(an,Kn,_r,Io,wn,ir):function($n,Vn,Zc,Xr,Ol,So,na){switch(Zc){case _n:if($n.byteLength!=Vn.byteLength||$n.byteOffset!=Vn.byteOffset)return!1;$n=$n.buffer,Vn=Vn.buffer;case Er:return!($n.byteLength!=Vn.byteLength||!So(new js($n),new js(Vn)));case Ee:case ft:case Mt:return nh(+$n,+Vn);case Ze:return $n.name==Vn.name&&$n.message==Vn.message;case ot:case ke:return $n==Vn+"";case zt:var va=Il;case tr:var Xs=1&Xr;if(va||(va=_a),$n.size!=Vn.size&&!Xs)return!1;var Fl=na.get($n);if(Fl)return Fl==Vn;Xr|=2,na.set($n,Vn);var Ks=th(va($n),va(Vn),Xr,Ol,So,na);return na.delete($n),Ks;case Kt:if(Ro)return Ro.call($n)==Ro.call(Vn)}return!1}(an,Kn,go,_r,Io,wn,ir);if(!(1&_r)){var Rl=ia&&ea.call(an,"__wrapped__"),Wa=Ys&&ea.call(Kn,"__wrapped__");if(Rl||Wa){var oh=Rl?an.value():an,Pl=Wa?Kn.value():Kn;return ir||(ir=new Ra),wn(oh,Pl,_r,Io,ir)}}return Oa?(ir||(ir=new Ra),function($n,Vn,Zc,Xr,Ol,So){var na=1&Zc,va=$s($n),Xs=va.length,Fl=$s(Vn).length;if(Xs!=Fl&&!na)return!1;for(var Ks=Xs;Ks--;){var ra=va[Ks];if(!(na?ra in Vn:ea.call(Vn,ra)))return!1}var Qs=So.get($n);if(Qs&&So.get(Vn))return Qs==Vn;var Ll=!0;So.set($n,Vn),So.set(Vn,$n);for(var Js=na;++Ks<Xs;){var Za=$n[ra=va[Ks]],_o=Vn[ra];if(Xr)var el=na?Xr(_o,Za,ra,Vn,$n,So):Xr(Za,_o,ra,$n,Vn,So);if(!(el===void 0?Za===_o||Ol(Za,_o,Zc,Xr,So):el)){Ll=!1;break}Js||(Js=ra=="constructor")}if(Ll&&!Js){var zl=$n.constructor,tl=Vn.constructor;zl==tl||!("constructor"in $n)||!("constructor"in Vn)||typeof zl=="function"&&zl instanceof zl&&typeof tl=="function"&&tl instanceof tl||(Ll=!1)}return So.delete($n),So.delete(Vn),Ll}(an,Kn,_r,Io,wn,ir)):!1}(Me,We,Lt,si,mc,Hn))}function Hs(Me){return!(!Nd(Me)||function(We){return!!Ju&&Ju in We}(Me))&&(fc(Me)?ps:qt).test(Ws(Me))}function Ld(Me){if(Lt=(We=Me)&&We.constructor,si=typeof Lt=="function"&&Lt.prototype||cc,We!==si)return Od(Me);var We,Lt,si,Hn=[];for(var an in Object(Me))ea.call(Me,an)&&an!="constructor"&&Hn.push(an);return Hn}function th(Me,We,Lt,si,Hn,an){var Kn=1&Lt,_r=Me.length,Io=We.length;if(_r!=Io&&!(Kn&&Io>_r))return!1;var wn=an.get(Me);if(wn&&an.get(We))return wn==We;var ir=-1,br=!0,ba=2&Lt?new fs:void 0;for(an.set(Me,We),an.set(We,Me);++ir<_r;){var go=Me[ir],ya=We[ir];if(si)var ia=Kn?si(ya,go,ir,We,Me,an):si(go,ya,ir,Me,We,an);if(ia!==void 0){if(ia)continue;br=!1;break}if(ba){if(!Ns(We,function(Ys,Oa){if(Rl=Oa,!ba.has(Rl)&&(go===Ys||Hn(go,Ys,Lt,si,an)))return ba.push(Oa);var Rl})){br=!1;break}}else if(go!==ya&&!Hn(go,ya,Lt,si,an)){br=!1;break}}return an.delete(Me),an.delete(We),br}function $s(Me){return function(We,Lt,si){var Hn=Lt(We);return bs(We)?Hn:function(an,Kn){for(var _r=-1,Io=Kn.length,wn=an.length;++_r<Io;)an[wn+_r]=Kn[_r];return an}(Hn,si(We))}(Me,Bd,ih)}function qc(Me,We){var Lt,si,Hn=Me.__data__;return((si=typeof(Lt=We))=="string"||si=="number"||si=="symbol"||si=="boolean"?Lt!=="__proto__":Lt===null)?Hn[typeof We=="string"?"string":"hash"]:Hn.map}function qs(Me,We){var Lt=function(si,Hn){return si?.[Hn]}(Me,We);return Hs(Lt)?Lt:void 0}mt.prototype.clear=function(){this.__data__=Us?Us(null):{},this.size=0},mt.prototype.delete=function(Me){var We=this.has(Me)&&delete this.__data__[Me];return this.size-=We?1:0,We},mt.prototype.get=function(Me){var We=this.__data__;if(Us){var Lt=We[Me];return Lt===J?void 0:Lt}return ea.call(We,Me)?We[Me]:void 0},mt.prototype.has=function(Me){var We=this.__data__;return Us?We[Me]!==void 0:ea.call(We,Me)},mt.prototype.set=function(Me,We){var Lt=this.__data__;return this.size+=this.has(Me)?0:1,Lt[Me]=Us&&We===void 0?J:We,this},ta.prototype.clear=function(){this.__data__=[],this.size=0},ta.prototype.delete=function(Me){var We=this.__data__,Lt=Po(We,Me);return!(Lt<0)&&(Lt==We.length-1?We.pop():$a.call(We,Lt,1),--this.size,!0)},ta.prototype.get=function(Me){var We=this.__data__,Lt=Po(We,Me);return Lt<0?void 0:We[Lt][1]},ta.prototype.has=function(Me){return Po(this.__data__,Me)>-1},ta.prototype.set=function(Me,We){var Lt=this.__data__,si=Po(Lt,Me);return si<0?(++this.size,Lt.push([Me,We])):Lt[si][1]=We,this},qa.prototype.clear=function(){this.size=0,this.__data__={hash:new mt,map:new(Dl||ta),string:new mt}},qa.prototype.delete=function(Me){var We=qc(this,Me).delete(Me);return this.size-=We?1:0,We},qa.prototype.get=function(Me){return qc(this,Me).get(Me)},qa.prototype.has=function(Me){return qc(this,Me).has(Me)},qa.prototype.set=function(Me,We){var Lt=qc(this,Me),si=Lt.size;return Lt.set(Me,We),this.size+=Lt.size==si?0:1,this},fs.prototype.add=fs.prototype.push=function(Me){return this.__data__.set(Me,J),this},fs.prototype.has=function(Me){return this.__data__.has(Me)},Ra.prototype.clear=function(){this.__data__=new ta,this.size=0},Ra.prototype.delete=function(Me){var We=this.__data__,Lt=We.delete(Me);return this.size=We.size,Lt},Ra.prototype.get=function(Me){return this.__data__.get(Me)},Ra.prototype.has=function(Me){return this.__data__.has(Me)},Ra.prototype.set=function(Me,We){var Lt=this.__data__;if(Lt instanceof ta){var si=Lt.__data__;if(!Dl||si.length<199)return si.push([Me,We]),this.size=++Lt.size,this;Lt=this.__data__=new qa(si)}return Lt.set(Me,We),this.size=Lt.size,this};var ih=Al?function(Me){return Me==null?[]:(Me=Object(Me),function(We,Lt){for(var si=-1,Hn=We==null?0:We.length,an=0,Kn=[];++si<Hn;){var _r=We[si];Lt(_r,si,We)&&(Kn[an++]=_r)}return Kn}(Al(Me),function(We){return Gc.call(Me,We)}))}:function(){return[]},Pa=Gs;function Mp(Me,We){return!!(We=We??re)&&(typeof Me=="number"||Ku.test(Me))&&Me>-1&&Me%1==0&&Me<We}function Ws(Me){if(Me!=null){try{return Ml.call(Me)}catch{}try{return Me+""}catch{}}return""}function nh(Me,We){return Me===We||Me!=Me&&We!=We}(ko&&Pa(new ko(new ArrayBuffer(1)))!=_n||Dl&&Pa(new Dl)!=zt||dc&&Pa(dc.resolve())!=ji||uc&&Pa(new uc)!=tr||hc&&Pa(new hc)!=Gt)&&(Pa=function(Me){var We=Gs(Me),Lt=We==oi?Me.constructor:void 0,si=Lt?Ws(Lt):"";if(si)switch(si){case Fd:return _n;case kl:return zt;case Hc:return ji;case pc:return tr;case ms:return Gt}return We});var rh=_s(function(){return arguments}())?_s:function(Me){return Zs(Me)&&ea.call(Me,"callee")&&!Gc.call(Me,"callee")},bs=Array.isArray,zd=Pd||function(){return!1};function fc(Me){if(!Nd(Me))return!1;var We=Gs(Me);return We==Vt||We=="[object GeneratorFunction]"||We=="[object AsyncFunction]"||We=="[object Proxy]"}function Wc(Me){return typeof Me=="number"&&Me>-1&&Me%1==0&&Me<=re}function Nd(Me){var We=typeof Me;return Me!=null&&(We=="object"||We=="function")}function Zs(Me){return Me!=null&&typeof Me=="object"}var gc=zs?function(Me){return function(We){return Me(We)}}(zs):function(Me){return Zs(Me)&&Wc(Me.length)&&!!zn[Gs(Me)]};function Bd(Me){return(We=Me)!=null&&Wc(We.length)&&!fc(We)?gs(Me):Ld(Me);var We}D.exports=function(Me,We){return mc(Me,We)}})(hr,hr.exports);var Ai=l(hr.exports);function kd(D,N){return D.length===N.length&&JSON.stringify(D.map(function(J){return J}).sort())===JSON.stringify(N.map(function(J){return J}).sort())}var jc={Polygon:co,LineString:zo,Point:ma,MultiPolygon:Bn,MultiLineString:Bn,MultiPoint:Bn},Rd=Object.freeze({__proto__:null,CommonSelectors:Pt,constrainFeatureMovement:Bo,createMidPoint:gn,createSupplementaryPoints:$i,createVertex:En,doubleClickZoom:Ii,euclideanDistance:gi,featuresAt:yt,getFeatureAtAndSetCursors:Yr,isClick:us,isEventAtCoordinates:El,isTap:Ia,mapEventToBoundingBox:Fi,ModeHandler:g,moveFeatures:Br,sortFeatures:Cl,stringSetsAreEqual:kd,StringSet:qn,theme:Sa,toDenseArray:uo}),Sp=function(D,N){var J={options:D=function(pe){pe===void 0&&(pe={});var ge=No(pe);return pe.controls||(ge.controls={}),pe.displayControlsDefault===!1?ge.controls=No(Dd,pe.controls):ge.controls=No(Vc,pe.controls),(ge=No(Ad,ge)).styles=Eo(ge.styles,"cold").concat(Eo(ge.styles,"hot")),ge}(D)};N=function(pe,ge){return ge.modes=Xt,ge.getFeatureIdsAt=function(Ee){return yt.click({point:Ee},null,pe).map(function(ft){return ft.properties.id})},ge.getSelectedIds=function(){return pe.store.getSelectedIds()},ge.getSelected=function(){return{type:st.FEATURE_COLLECTION,features:pe.store.getSelectedIds().map(function(Ee){return pe.store.get(Ee)}).map(function(Ee){return Ee.toGeoJSON()})}},ge.getSelectedPoints=function(){return{type:st.FEATURE_COLLECTION,features:pe.store.getSelectedCoordinates().map(function(Ee){return{type:st.FEATURE,properties:{},geometry:{type:st.POINT,coordinates:Ee.coordinates}}})}},ge.set=function(Ee){if(Ee.type===void 0||Ee.type!==st.FEATURE_COLLECTION||!Array.isArray(Ee.features))throw new Error("Invalid FeatureCollection");var ft=pe.store.createRenderBatch(),Ze=pe.store.getAllIds().slice(),Vt=ge.add(Ee),zt=new qn(Vt);return(Ze=Ze.filter(function(Mt){return!zt.has(Mt)})).length&&ge.delete(Ze),ft(),Vt},ge.add=function(Ee){var ft=JSON.parse(JSON.stringify(Ln(Ee))).features.map(function(Ze){if(Ze.id=Ze.id||Ua(),Ze.geometry===null)throw new Error("Invalid geometry: null");if(pe.store.get(Ze.id)===void 0||pe.store.get(Ze.id).type!==Ze.geometry.type){var Vt=jc[Ze.geometry.type];if(Vt===void 0)throw new Error("Invalid geometry type: "+Ze.geometry.type+".");var zt=new Vt(pe,Ze);pe.store.add(zt)}else{var Mt=pe.store.get(Ze.id);Mt.properties=Ze.properties,Ai(Mt.properties,Ze.properties)||pe.store.featureChanged(Mt.id),Ai(Mt.getCoordinates(),Ze.geometry.coordinates)||Mt.incomingCoords(Ze.geometry.coordinates)}return Ze.id});return pe.store.render(),ft},ge.get=function(Ee){var ft=pe.store.get(Ee);if(ft)return ft.toGeoJSON()},ge.getAll=function(){return{type:st.FEATURE_COLLECTION,features:pe.store.getAll().map(function(Ee){return Ee.toGeoJSON()})}},ge.delete=function(Ee){return pe.store.delete(Ee,{silent:!0}),ge.getMode()!==Xt.DIRECT_SELECT||pe.store.getSelectedIds().length?pe.store.render():pe.events.changeMode(Xt.SIMPLE_SELECT,void 0,{silent:!0}),ge},ge.deleteAll=function(){return pe.store.delete(pe.store.getAllIds(),{silent:!0}),ge.getMode()===Xt.DIRECT_SELECT?pe.events.changeMode(Xt.SIMPLE_SELECT,void 0,{silent:!0}):pe.store.render(),ge},ge.changeMode=function(Ee,ft){return ft===void 0&&(ft={}),Ee===Xt.SIMPLE_SELECT&&ge.getMode()===Xt.SIMPLE_SELECT?(kd(ft.featureIds||[],pe.store.getSelectedIds())||(pe.store.setSelected(ft.featureIds,{silent:!0}),pe.store.render()),ge):(Ee===Xt.DIRECT_SELECT&&ge.getMode()===Xt.DIRECT_SELECT&&ft.featureId===pe.store.getSelectedIds()[0]||pe.events.changeMode(Ee,ft,{silent:!0}),ge)},ge.getMode=function(){return pe.events.getMode()},ge.trash=function(){return pe.events.trash({silent:!0}),ge},ge.combineFeatures=function(){return pe.events.combineFeatures({silent:!0}),ge},ge.uncombineFeatures=function(){return pe.events.uncombineFeatures({silent:!0}),ge},ge.setFeatureProperty=function(Ee,ft,Ze){return pe.store.setFeatureProperty(Ee,ft,Ze),ge},ge}(J,N),J.api=N;var re=Ko(J);return N.onAdd=re.onAdd,N.onRemove=re.onRemove,N.types=It,N.options=D,N};function Vo(D){Sp(D,this)}return Vo.modes=ac,Vo.constants=Lo,Vo.lib=Rd,Vo})});var sf=class{},Y_=class{},Ou=class g{constructor(l){this.normalizedNames=new Map,this.lazyUpdate=null,l?typeof l=="string"?this.lazyInit=()=>{this.headers=new Map,l.split(`
`).forEach(w=>{let c=w.indexOf(":");if(c>0){let m=w.slice(0,c),r=m.toLowerCase(),M=w.slice(c+1).trim();this.maybeSetNormalizedName(m,r),this.headers.has(r)?this.headers.get(r).push(M):this.headers.set(r,[M])}})}:typeof Headers<"u"&&l instanceof Headers?(this.headers=new Map,l.forEach((w,c)=>{this.setHeaderEntries(c,w)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(l).forEach(([w,c])=>{this.setHeaderEntries(w,c)})}:this.headers=new Map}has(l){return this.init(),this.headers.has(l.toLowerCase())}get(l){this.init();let w=this.headers.get(l.toLowerCase());return w&&w.length>0?w[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(l){return this.init(),this.headers.get(l.toLowerCase())||null}append(l,w){return this.clone({name:l,value:w,op:"a"})}set(l,w){return this.clone({name:l,value:w,op:"s"})}delete(l,w){return this.clone({name:l,value:w,op:"d"})}maybeSetNormalizedName(l,w){this.normalizedNames.has(w)||this.normalizedNames.set(w,l)}init(){this.lazyInit&&(this.lazyInit instanceof g?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(l=>this.applyUpdate(l)),this.lazyUpdate=null))}copyFrom(l){l.init(),Array.from(l.headers.keys()).forEach(w=>{this.headers.set(w,l.headers.get(w)),this.normalizedNames.set(w,l.normalizedNames.get(w))})}clone(l){let w=new g;return w.lazyInit=this.lazyInit&&this.lazyInit instanceof g?this.lazyInit:this,w.lazyUpdate=(this.lazyUpdate||[]).concat([l]),w}applyUpdate(l){let w=l.name.toLowerCase();switch(l.op){case"a":case"s":let c=l.value;if(typeof c=="string"&&(c=[c]),c.length===0)return;this.maybeSetNormalizedName(l.name,w);let m=(l.op==="a"?this.headers.get(w):void 0)||[];m.push(...c),this.headers.set(w,m);break;case"d":let r=l.value;if(!r)this.headers.delete(w),this.normalizedNames.delete(w);else{let M=this.headers.get(w);if(!M)return;M=M.filter(z=>r.indexOf(z)===-1),M.length===0?(this.headers.delete(w),this.normalizedNames.delete(w)):this.headers.set(w,M)}break}}setHeaderEntries(l,w){let c=(Array.isArray(w)?w:[w]).map(r=>r.toString()),m=l.toLowerCase();this.headers.set(m,c),this.maybeSetNormalizedName(l,m)}forEach(l){this.init(),Array.from(this.normalizedNames.keys()).forEach(w=>l(this.normalizedNames.get(w),this.headers.get(w)))}};var tv=class{encodeKey(l){return YE(l)}encodeValue(l){return YE(l)}decodeKey(l){return decodeURIComponent(l)}decodeValue(l){return decodeURIComponent(l)}};function K2(g,l){let w=new Map;return g.length>0&&g.replace(/^\?/,"").split("&").forEach(m=>{let r=m.indexOf("="),[M,z]=r==-1?[l.decodeKey(m),""]:[l.decodeKey(m.slice(0,r)),l.decodeValue(m.slice(r+1))],ie=w.get(M)||[];ie.push(z),w.set(M,ie)}),w}var Q2=/%(\d[a-f0-9])/gi,J2={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function YE(g){return encodeURIComponent(g).replace(Q2,(l,w)=>J2[w]??l)}function Z_(g){return`${g}`}var tc=class g{constructor(l={}){if(this.updates=null,this.cloneFrom=null,this.encoder=l.encoder||new tv,l.fromString){if(l.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=K2(l.fromString,this.encoder)}else l.fromObject?(this.map=new Map,Object.keys(l.fromObject).forEach(w=>{let c=l.fromObject[w],m=Array.isArray(c)?c.map(Z_):[Z_(c)];this.map.set(w,m)})):this.map=null}has(l){return this.init(),this.map.has(l)}get(l){this.init();let w=this.map.get(l);return w?w[0]:null}getAll(l){return this.init(),this.map.get(l)||null}keys(){return this.init(),Array.from(this.map.keys())}append(l,w){return this.clone({param:l,value:w,op:"a"})}appendAll(l){let w=[];return Object.keys(l).forEach(c=>{let m=l[c];Array.isArray(m)?m.forEach(r=>{w.push({param:c,value:r,op:"a"})}):w.push({param:c,value:m,op:"a"})}),this.clone(w)}set(l,w){return this.clone({param:l,value:w,op:"s"})}delete(l,w){return this.clone({param:l,value:w,op:"d"})}toString(){return this.init(),this.keys().map(l=>{let w=this.encoder.encodeKey(l);return this.map.get(l).map(c=>w+"="+this.encoder.encodeValue(c)).join("&")}).filter(l=>l!=="").join("&")}clone(l){let w=new g({encoder:this.encoder});return w.cloneFrom=this.cloneFrom||this,w.updates=(this.updates||[]).concat(l),w}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(l=>this.map.set(l,this.cloneFrom.map.get(l))),this.updates.forEach(l=>{switch(l.op){case"a":case"s":let w=(l.op==="a"?this.map.get(l.param):void 0)||[];w.push(Z_(l.value)),this.map.set(l.param,w);break;case"d":if(l.value!==void 0){let c=this.map.get(l.param)||[],m=c.indexOf(Z_(l.value));m!==-1&&c.splice(m,1),c.length>0?this.map.set(l.param,c):this.map.delete(l.param)}else{this.map.delete(l.param);break}}}),this.cloneFrom=this.updates=null)}};var iv=class{constructor(){this.map=new Map}set(l,w){return this.map.set(l,w),this}get(l){return this.map.has(l)||this.map.set(l,l.defaultValue()),this.map.get(l)}delete(l){return this.map.delete(l),this}has(l){return this.map.has(l)}keys(){return this.map.keys()}};function eR(g){switch(g){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function XE(g){return typeof ArrayBuffer<"u"&&g instanceof ArrayBuffer}function KE(g){return typeof Blob<"u"&&g instanceof Blob}function QE(g){return typeof FormData<"u"&&g instanceof FormData}function tR(g){return typeof URLSearchParams<"u"&&g instanceof URLSearchParams}var af=class g{constructor(l,w,c,m){this.url=w,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=l.toUpperCase();let r;if(eR(this.method)||m?(this.body=c!==void 0?c:null,r=m):r=c,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),this.transferCache=r.transferCache),this.headers??=new Ou,this.context??=new iv,!this.params)this.params=new tc,this.urlWithParams=w;else{let M=this.params.toString();if(M.length===0)this.urlWithParams=w;else{let z=w.indexOf("?"),ie=z===-1?"?":z<w.length-1?"&":"";this.urlWithParams=w+ie+M}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||XE(this.body)||KE(this.body)||QE(this.body)||tR(this.body)?this.body:this.body instanceof tc?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||QE(this.body)?null:KE(this.body)?this.body.type||null:XE(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof tc?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(l={}){let w=l.method||this.method,c=l.url||this.url,m=l.responseType||this.responseType,r=l.transferCache??this.transferCache,M=l.body!==void 0?l.body:this.body,z=l.withCredentials??this.withCredentials,ie=l.reportProgress??this.reportProgress,ue=l.headers||this.headers,ye=l.params||this.params,Je=l.context??this.context;return l.setHeaders!==void 0&&(ue=Object.keys(l.setHeaders).reduce((It,st)=>It.set(st,l.setHeaders[st]),ue)),l.setParams&&(ye=Object.keys(l.setParams).reduce((It,st)=>It.set(st,l.setParams[st]),ye)),new g(w,c,M,{params:ye,headers:ue,context:Je,reportProgress:ie,responseType:m,withCredentials:z,transferCache:r})}},ep=function(g){return g[g.Sent=0]="Sent",g[g.UploadProgress=1]="UploadProgress",g[g.ResponseHeader=2]="ResponseHeader",g[g.DownloadProgress=3]="DownloadProgress",g[g.Response=4]="Response",g[g.User=5]="User",g}(ep||{}),lf=class{constructor(l,w=Q_.Ok,c="OK"){this.headers=l.headers||new Ou,this.status=l.status!==void 0?l.status:w,this.statusText=l.statusText||c,this.url=l.url||null,this.ok=this.status>=200&&this.status<300}},nv=class g extends lf{constructor(l={}){super(l),this.type=ep.ResponseHeader}clone(l={}){return new g({headers:l.headers||this.headers,status:l.status!==void 0?l.status:this.status,statusText:l.statusText||this.statusText,url:l.url||this.url||void 0})}},X_=class g extends lf{constructor(l={}){super(l),this.type=ep.Response,this.body=l.body!==void 0?l.body:null}clone(l={}){return new g({body:l.body!==void 0?l.body:this.body,headers:l.headers||this.headers,status:l.status!==void 0?l.status:this.status,statusText:l.statusText||this.statusText,url:l.url||this.url||void 0})}},K_=class extends lf{constructor(l){super(l,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${l.url||"(unknown url)"}`:this.message=`Http failure response for ${l.url||"(unknown url)"}: ${l.status} ${l.statusText}`,this.error=l.error||null}},Q_=function(g){return g[g.Continue=100]="Continue",g[g.SwitchingProtocols=101]="SwitchingProtocols",g[g.Processing=102]="Processing",g[g.EarlyHints=103]="EarlyHints",g[g.Ok=200]="Ok",g[g.Created=201]="Created",g[g.Accepted=202]="Accepted",g[g.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",g[g.NoContent=204]="NoContent",g[g.ResetContent=205]="ResetContent",g[g.PartialContent=206]="PartialContent",g[g.MultiStatus=207]="MultiStatus",g[g.AlreadyReported=208]="AlreadyReported",g[g.ImUsed=226]="ImUsed",g[g.MultipleChoices=300]="MultipleChoices",g[g.MovedPermanently=301]="MovedPermanently",g[g.Found=302]="Found",g[g.SeeOther=303]="SeeOther",g[g.NotModified=304]="NotModified",g[g.UseProxy=305]="UseProxy",g[g.Unused=306]="Unused",g[g.TemporaryRedirect=307]="TemporaryRedirect",g[g.PermanentRedirect=308]="PermanentRedirect",g[g.BadRequest=400]="BadRequest",g[g.Unauthorized=401]="Unauthorized",g[g.PaymentRequired=402]="PaymentRequired",g[g.Forbidden=403]="Forbidden",g[g.NotFound=404]="NotFound",g[g.MethodNotAllowed=405]="MethodNotAllowed",g[g.NotAcceptable=406]="NotAcceptable",g[g.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",g[g.RequestTimeout=408]="RequestTimeout",g[g.Conflict=409]="Conflict",g[g.Gone=410]="Gone",g[g.LengthRequired=411]="LengthRequired",g[g.PreconditionFailed=412]="PreconditionFailed",g[g.PayloadTooLarge=413]="PayloadTooLarge",g[g.UriTooLong=414]="UriTooLong",g[g.UnsupportedMediaType=415]="UnsupportedMediaType",g[g.RangeNotSatisfiable=416]="RangeNotSatisfiable",g[g.ExpectationFailed=417]="ExpectationFailed",g[g.ImATeapot=418]="ImATeapot",g[g.MisdirectedRequest=421]="MisdirectedRequest",g[g.UnprocessableEntity=422]="UnprocessableEntity",g[g.Locked=423]="Locked",g[g.FailedDependency=424]="FailedDependency",g[g.TooEarly=425]="TooEarly",g[g.UpgradeRequired=426]="UpgradeRequired",g[g.PreconditionRequired=428]="PreconditionRequired",g[g.TooManyRequests=429]="TooManyRequests",g[g.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",g[g.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",g[g.InternalServerError=500]="InternalServerError",g[g.NotImplemented=501]="NotImplemented",g[g.BadGateway=502]="BadGateway",g[g.ServiceUnavailable=503]="ServiceUnavailable",g[g.GatewayTimeout=504]="GatewayTimeout",g[g.HttpVersionNotSupported=505]="HttpVersionNotSupported",g[g.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",g[g.InsufficientStorage=507]="InsufficientStorage",g[g.LoopDetected=508]="LoopDetected",g[g.NotExtended=510]="NotExtended",g[g.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",g}(Q_||{});function ev(g,l){return{body:l,headers:g.headers,context:g.context,observe:g.observe,params:g.params,reportProgress:g.reportProgress,responseType:g.responseType,withCredentials:g.withCredentials,transferCache:g.transferCache}}var cf=(()=>{let l=class l{constructor(c){this.handler=c}request(c,m,r={}){let M;if(c instanceof af)M=c;else{let ue;r.headers instanceof Ou?ue=r.headers:ue=new Ou(r.headers);let ye;r.params&&(r.params instanceof tc?ye=r.params:ye=new tc({fromObject:r.params})),M=new af(c,m,r.body!==void 0?r.body:null,{headers:ue,context:r.context,params:ye,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache})}let z=ui(M).pipe(Tu(ue=>this.handler.handle(ue)));if(c instanceof af||r.observe==="events")return z;let ie=z.pipe(eo(ue=>ue instanceof X_));switch(r.observe||"body"){case"body":switch(M.responseType){case"arraybuffer":return ie.pipe(ln(ue=>{if(ue.body!==null&&!(ue.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return ue.body}));case"blob":return ie.pipe(ln(ue=>{if(ue.body!==null&&!(ue.body instanceof Blob))throw new Error("Response is not a Blob.");return ue.body}));case"text":return ie.pipe(ln(ue=>{if(ue.body!==null&&typeof ue.body!="string")throw new Error("Response is not a string.");return ue.body}));case"json":default:return ie.pipe(ln(ue=>ue.body))}case"response":return ie;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(c,m={}){return this.request("DELETE",c,m)}get(c,m={}){return this.request("GET",c,m)}head(c,m={}){return this.request("HEAD",c,m)}jsonp(c,m){return this.request("JSONP",c,{params:new tc().append(m,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(c,m={}){return this.request("OPTIONS",c,m)}patch(c,m,r={}){return this.request("PATCH",c,ev(r,m))}post(c,m,r={}){return this.request("POST",c,ev(r,m))}put(c,m,r={}){return this.request("PUT",c,ev(r,m))}};l.\u0275fac=function(m){return new(m||l)(bt(sf))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac});let g=l;return g})();function iR(g,l){return l(g)}function nR(g,l,w){return(c,m)=>kc(w,()=>l(c,r=>g(r,m)))}var iI=new hi(""),rR=new hi(""),oR=new hi("");var JE=(()=>{let l=class l extends sf{constructor(c,m){super(),this.backend=c,this.injector=m,this.chain=null,this.pendingTasks=$t(j_);let r=$t(oR,{optional:!0});this.backend=r??c}handle(c){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(iI),...this.injector.get(rR,[])]));this.chain=r.reduceRight((M,z)=>nR(M,z,this.injector),iR)}let m=this.pendingTasks.add();return this.chain(c,r=>this.backend.handle(r)).pipe(_d(()=>this.pendingTasks.remove(m)))}};l.\u0275fac=function(m){return new(m||l)(bt(Y_),bt(qh))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac});let g=l;return g})();var aR=/^\)\]\}',?\n/;function sR(g){return"responseURL"in g&&g.responseURL?g.responseURL:/^X-Request-URL:/m.test(g.getAllResponseHeaders())?g.getResponseHeader("X-Request-URL"):null}var eI=(()=>{let l=class l{constructor(c){this.xhrFactory=c}handle(c){if(c.method==="JSONP")throw new fr(-2800,!1);let m=this.xhrFactory;return(m.\u0275loadImpl?ha(m.\u0275loadImpl()):ui(null)).pipe(Ta(()=>new rs(M=>{let z=m.build();if(z.open(c.method,c.urlWithParams),c.withCredentials&&(z.withCredentials=!0),c.headers.forEach((vi,Ti)=>z.setRequestHeader(vi,Ti.join(","))),c.headers.has("Accept")||z.setRequestHeader("Accept","application/json, text/plain, */*"),!c.headers.has("Content-Type")){let vi=c.detectContentTypeHeader();vi!==null&&z.setRequestHeader("Content-Type",vi)}if(c.responseType){let vi=c.responseType.toLowerCase();z.responseType=vi!=="json"?vi:"text"}let ie=c.serializeBody(),ue=null,ye=()=>{if(ue!==null)return ue;let vi=z.statusText||"OK",Ti=new Ou(z.getAllResponseHeaders()),xn=sR(z)||c.url;return ue=new nv({headers:Ti,status:z.status,statusText:vi,url:xn}),ue},Je=()=>{let{headers:vi,status:Ti,statusText:xn,url:Wo}=ye(),ur=null;Ti!==Q_.NoContent&&(ur=typeof z.response>"u"?z.responseText:z.response),Ti===0&&(Ti=ur?Q_.Ok:0);let Lo=Ti>=200&&Ti<300;if(c.responseType==="json"&&typeof ur=="string"){let dt=ur;ur=ur.replace(aR,"");try{ur=ur!==""?JSON.parse(ur):null}catch(ja){ur=dt,Lo&&(Lo=!1,ur={error:ja,text:ur})}}Lo?(M.next(new X_({body:ur,headers:vi,status:Ti,statusText:xn,url:Wo||void 0})),M.complete()):M.error(new K_({error:ur,headers:vi,status:Ti,statusText:xn,url:Wo||void 0}))},It=vi=>{let{url:Ti}=ye(),xn=new K_({error:vi,status:z.status||0,statusText:z.statusText||"Unknown Error",url:Ti||void 0});M.error(xn)},st=!1,Xt=vi=>{st||(M.next(ye()),st=!0);let Ti={type:ep.DownloadProgress,loaded:vi.loaded};vi.lengthComputable&&(Ti.total=vi.total),c.responseType==="text"&&z.responseText&&(Ti.partialText=z.responseText),M.next(Ti)},Oi=vi=>{let Ti={type:ep.UploadProgress,loaded:vi.loaded};vi.lengthComputable&&(Ti.total=vi.total),M.next(Ti)};return z.addEventListener("load",Je),z.addEventListener("error",It),z.addEventListener("timeout",It),z.addEventListener("abort",It),c.reportProgress&&(z.addEventListener("progress",Xt),ie!==null&&z.upload&&z.upload.addEventListener("progress",Oi)),z.send(ie),M.next({type:ep.Sent}),()=>{z.removeEventListener("error",It),z.removeEventListener("abort",It),z.removeEventListener("load",Je),z.removeEventListener("timeout",It),c.reportProgress&&(z.removeEventListener("progress",Xt),ie!==null&&z.upload&&z.upload.removeEventListener("progress",Oi)),z.readyState!==z.DONE&&z.abort()}})))}};l.\u0275fac=function(m){return new(m||l)(bt(W_))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac});let g=l;return g})(),nI=new hi(""),lR="XSRF-TOKEN",cR=new hi("",{providedIn:"root",factory:()=>lR}),dR="X-XSRF-TOKEN",uR=new hi("",{providedIn:"root",factory:()=>dR}),J_=class{},hR=(()=>{let l=class l{constructor(c,m,r){this.doc=c,this.platform=m,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let c=this.doc.cookie||"";return c!==this.lastCookieString&&(this.parseCount++,this.lastToken=H_(c,this.cookieName),this.lastCookieString=c),this.lastToken}};l.\u0275fac=function(m){return new(m||l)(bt(rn),bt(Rc),bt(cR))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac});let g=l;return g})();function pR(g,l){let w=g.url.toLowerCase();if(!$t(nI)||g.method==="GET"||g.method==="HEAD"||w.startsWith("http://")||w.startsWith("https://"))return l(g);let c=$t(J_).getToken(),m=$t(uR);return c!=null&&!g.headers.has(m)&&(g=g.clone({headers:g.headers.set(m,c)})),l(g)}function rI(...g){let l=[cf,eI,JE,{provide:sf,useExisting:JE},{provide:Y_,useExisting:eI},{provide:iI,useValue:pR,multi:!0},{provide:nI,useValue:!0},{provide:J_,useClass:hR}];for(let w of g)l.push(...w.\u0275providers);return Eu(l)}var av=class extends GE{constructor(){super(...arguments),this.supportsDOMEvents=!0}},sv=class g extends av{static makeCurrent(){UE(new g)}onAndCancel(l,w,c){return l.addEventListener(w,c),()=>{l.removeEventListener(w,c)}}dispatchEvent(l,w){l.dispatchEvent(w)}remove(l){l.parentNode&&l.parentNode.removeChild(l)}createElement(l,w){return w=w||this.getDefaultDocument(),w.createElement(l)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(l){return l.nodeType===Node.ELEMENT_NODE}isShadowRoot(l){return l instanceof DocumentFragment}getGlobalEventTarget(l,w){return w==="window"?window:w==="document"?l:w==="body"?l.body:null}getBaseHref(l){let w=fR();return w==null?null:gR(w)}resetBaseElement(){df=null}getUserAgent(){return window.navigator.userAgent}getCookie(l){return H_(document.cookie,l)}},df=null;function fR(){return df=df||document.querySelector("base"),df?df.getAttribute("href"):null}function gR(g){return new URL(g,document.baseURI).pathname}var _R=(()=>{let l=class l{build(){return new XMLHttpRequest}};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:l.\u0275fac});let g=l;return g})(),lv=new hi(""),lI=(()=>{let l=class l{constructor(c,m){this._zone=m,this._eventNameToPlugin=new Map,c.forEach(r=>{r.manager=this}),this._plugins=c.slice().reverse()}addEventListener(c,m,r){return this._findPluginFor(m).addEventListener(c,m,r)}getZone(){return this._zone}_findPluginFor(c){let m=this._eventNameToPlugin.get(c);if(m)return m;if(m=this._plugins.find(M=>M.supports(c)),!m)throw new fr(5101,!1);return this._eventNameToPlugin.set(c,m),m}};l.\u0275fac=function(m){return new(m||l)(bt(lv),bt(yi))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac});let g=l;return g})(),eb=class{constructor(l){this._doc=l}},rv="ng-app-id",cI=(()=>{let l=class l{constructor(c,m,r,M={}){this.doc=c,this.appId=m,this.nonce=r,this.platformId=M,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=q_(M),this.resetHostNodes()}addStyles(c){for(let m of c)this.changeUsageCount(m,1)===1&&this.onStyleAdded(m)}removeStyles(c){for(let m of c)this.changeUsageCount(m,-1)<=0&&this.onStyleRemoved(m)}ngOnDestroy(){let c=this.styleNodesInDOM;c&&(c.forEach(m=>m.remove()),c.clear());for(let m of this.getAllStyles())this.onStyleRemoved(m);this.resetHostNodes()}addHost(c){this.hostNodes.add(c);for(let m of this.getAllStyles())this.addStyleToHost(c,m)}removeHost(c){this.hostNodes.delete(c)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(c){for(let m of this.hostNodes)this.addStyleToHost(m,c)}onStyleRemoved(c){let m=this.styleRef;m.get(c)?.elements?.forEach(r=>r.remove()),m.delete(c)}collectServerRenderedStyles(){let c=this.doc.head?.querySelectorAll(`style[${rv}="${this.appId}"]`);if(c?.length){let m=new Map;return c.forEach(r=>{r.textContent!=null&&m.set(r.textContent,r)}),m}return null}changeUsageCount(c,m){let r=this.styleRef;if(r.has(c)){let M=r.get(c);return M.usage+=m,M.usage}return r.set(c,{usage:m,elements:[]}),m}getStyleElement(c,m){let r=this.styleNodesInDOM,M=r?.get(m);if(M?.parentNode===c)return r.delete(m),M.removeAttribute(rv),M;{let z=this.doc.createElement("style");return this.nonce&&z.setAttribute("nonce",this.nonce),z.textContent=m,this.platformIsServer&&z.setAttribute(rv,this.appId),c.appendChild(z),z}}addStyleToHost(c,m){let r=this.getStyleElement(c,m),M=this.styleRef,z=M.get(m)?.elements;z?z.push(r):M.set(m,{elements:[r],usage:1})}resetHostNodes(){let c=this.hostNodes;c.clear(),c.add(this.doc.head)}};l.\u0275fac=function(m){return new(m||l)(bt(rn),bt(B_),bt(ef,8),bt(Rc))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac});let g=l;return g})(),ov={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},uv=/%COMP%/g,dI="%COMP%",bR=`_nghost-${dI}`,yR=`_ngcontent-${dI}`,vR=!0,xR=new hi("",{providedIn:"root",factory:()=>vR});function wR(g){return yR.replace(uv,g)}function CR(g){return bR.replace(uv,g)}function uI(g,l){return l.map(w=>w.replace(uv,g))}var tb=(()=>{let l=class l{constructor(c,m,r,M,z,ie,ue,ye=null){this.eventManager=c,this.sharedStylesHost=m,this.appId=r,this.removeStylesOnCompDestroy=M,this.doc=z,this.platformId=ie,this.ngZone=ue,this.nonce=ye,this.rendererByCompId=new Map,this.platformIsServer=q_(ie),this.defaultRenderer=new uf(c,z,ue,this.platformIsServer)}createRenderer(c,m){if(!c||!m)return this.defaultRenderer;this.platformIsServer&&m.encapsulation===Jm.ShadowDom&&(m=Ar(Ht({},m),{encapsulation:Jm.Emulated}));let r=this.getOrCreateRenderer(c,m);return r instanceof ib?r.applyToHost(c):r instanceof hf&&r.applyStyles(),r}getOrCreateRenderer(c,m){let r=this.rendererByCompId,M=r.get(m.id);if(!M){let z=this.doc,ie=this.ngZone,ue=this.eventManager,ye=this.sharedStylesHost,Je=this.removeStylesOnCompDestroy,It=this.platformIsServer;switch(m.encapsulation){case Jm.Emulated:M=new ib(ue,ye,m,this.appId,Je,z,ie,It);break;case Jm.ShadowDom:return new cv(ue,ye,c,m,z,ie,this.nonce,It);default:M=new hf(ue,ye,m,Je,z,ie,It);break}r.set(m.id,M)}return M}ngOnDestroy(){this.rendererByCompId.clear()}};l.\u0275fac=function(m){return new(m||l)(bt(lI),bt(cI),bt(B_),bt(xR),bt(rn),bt(Rc),bt(yi),bt(ef))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac});let g=l;return g})(),uf=class{constructor(l,w,c,m){this.eventManager=l,this.doc=w,this.ngZone=c,this.platformIsServer=m,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(l,w){return w?this.doc.createElementNS(ov[w]||w,l):this.doc.createElement(l)}createComment(l){return this.doc.createComment(l)}createText(l){return this.doc.createTextNode(l)}appendChild(l,w){(aI(l)?l.content:l).appendChild(w)}insertBefore(l,w,c){l&&(aI(l)?l.content:l).insertBefore(w,c)}removeChild(l,w){l&&l.removeChild(w)}selectRootElement(l,w){let c=typeof l=="string"?this.doc.querySelector(l):l;if(!c)throw new fr(-5104,!1);return w||(c.textContent=""),c}parentNode(l){return l.parentNode}nextSibling(l){return l.nextSibling}setAttribute(l,w,c,m){if(m){w=m+":"+w;let r=ov[m];r?l.setAttributeNS(r,w,c):l.setAttribute(w,c)}else l.setAttribute(w,c)}removeAttribute(l,w,c){if(c){let m=ov[c];m?l.removeAttributeNS(m,w):l.removeAttribute(`${c}:${w}`)}else l.removeAttribute(w)}addClass(l,w){l.classList.add(w)}removeClass(l,w){l.classList.remove(w)}setStyle(l,w,c,m){m&(tf.DashCase|tf.Important)?l.style.setProperty(w,c,m&tf.Important?"important":""):l.style[w]=c}removeStyle(l,w,c){c&tf.DashCase?l.style.removeProperty(w):l.style[w]=""}setProperty(l,w,c){l!=null&&(l[w]=c)}setValue(l,w){l.nodeValue=w}listen(l,w,c){if(typeof l=="string"&&(l=Qh().getGlobalEventTarget(this.doc,l),!l))throw new Error(`Unsupported event target ${l} for event ${w}`);return this.eventManager.addEventListener(l,w,this.decoratePreventDefault(c))}decoratePreventDefault(l){return w=>{if(w==="__ngUnwrap__")return l;(this.platformIsServer?this.ngZone.runGuarded(()=>l(w)):l(w))===!1&&w.preventDefault()}}};function aI(g){return g.tagName==="TEMPLATE"&&g.content!==void 0}var cv=class extends uf{constructor(l,w,c,m,r,M,z,ie){super(l,r,M,ie),this.sharedStylesHost=w,this.hostEl=c,this.shadowRoot=c.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let ue=uI(m.id,m.styles);for(let ye of ue){let Je=document.createElement("style");z&&Je.setAttribute("nonce",z),Je.textContent=ye,this.shadowRoot.appendChild(Je)}}nodeOrShadowRoot(l){return l===this.hostEl?this.shadowRoot:l}appendChild(l,w){return super.appendChild(this.nodeOrShadowRoot(l),w)}insertBefore(l,w,c){return super.insertBefore(this.nodeOrShadowRoot(l),w,c)}removeChild(l,w){return super.removeChild(this.nodeOrShadowRoot(l),w)}parentNode(l){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(l)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},hf=class extends uf{constructor(l,w,c,m,r,M,z,ie){super(l,r,M,z),this.sharedStylesHost=w,this.removeStylesOnCompDestroy=m,this.styles=ie?uI(ie,c.styles):c.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},ib=class extends hf{constructor(l,w,c,m,r,M,z,ie){let ue=m+"-"+c.id;super(l,w,c,r,M,z,ie,ue),this.contentAttr=wR(ue),this.hostAttr=CR(ue)}applyToHost(l){this.applyStyles(),this.setAttribute(l,this.hostAttr,"")}createElement(l,w){let c=super.createElement(l,w);return super.setAttribute(c,this.contentAttr,""),c}},TR=(()=>{let l=class l extends eb{constructor(c){super(c)}supports(c){return!0}addEventListener(c,m,r){return c.addEventListener(m,r,!1),()=>this.removeEventListener(c,m,r)}removeEventListener(c,m,r){return c.removeEventListener(m,r)}};l.\u0275fac=function(m){return new(m||l)(bt(rn))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac});let g=l;return g})(),sI=["alt","control","meta","shift"],ER={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},IR={alt:g=>g.altKey,control:g=>g.ctrlKey,meta:g=>g.metaKey,shift:g=>g.shiftKey},SR=(()=>{let l=class l extends eb{constructor(c){super(c)}supports(c){return l.parseEventName(c)!=null}addEventListener(c,m,r){let M=l.parseEventName(m),z=l.eventCallback(M.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Qh().onAndCancel(c,M.domEventName,z))}static parseEventName(c){let m=c.toLowerCase().split("."),r=m.shift();if(m.length===0||!(r==="keydown"||r==="keyup"))return null;let M=l._normalizeKey(m.pop()),z="",ie=m.indexOf("code");if(ie>-1&&(m.splice(ie,1),z="code."),sI.forEach(ye=>{let Je=m.indexOf(ye);Je>-1&&(m.splice(Je,1),z+=ye+".")}),z+=M,m.length!=0||M.length===0)return null;let ue={};return ue.domEventName=r,ue.fullKey=z,ue}static matchEventFullKeyCode(c,m){let r=ER[c.key]||c.key,M="";return m.indexOf("code.")>-1&&(r=c.code,M="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),sI.forEach(z=>{if(z!==r){let ie=IR[z];ie(c)&&(M+=z+".")}}),M+=r,M===m)}static eventCallback(c,m,r){return M=>{l.matchEventFullKeyCode(M,c)&&r.runGuarded(()=>m(M))}}static _normalizeKey(c){return c==="esc"?"escape":c}};l.\u0275fac=function(m){return new(m||l)(bt(rn))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac});let g=l;return g})();function hI(g,l){return VE(Ht({rootComponent:g},MR(l)))}function MR(g){return{appProviders:[...PR,...g?.providers??[]],platformProviders:RR}}function AR(){sv.makeCurrent()}function DR(){return new Iu}function kR(){return CE(document),document}var RR=[{provide:Rc,useValue:WE},{provide:TE,useValue:AR,multi:!0},{provide:rn,useFactory:kR,deps:[]}];var PR=[{provide:wE,useValue:"root"},{provide:Iu,useFactory:DR,deps:[]},{provide:lv,useClass:TR,multi:!0,deps:[rn,yi,Rc]},{provide:lv,useClass:SR,multi:!0,deps:[rn]},tb,cI,lI,{provide:V_,useExisting:tb},{provide:W_,useClass:_R,deps:[]},[]];var pI=(()=>{let l=class l{constructor(c){this._doc=c}getTitle(){return this._doc.title}setTitle(c){this._doc.title=c||""}};l.\u0275fac=function(m){return new(m||l)(bt(rn))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();var hv=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:function(m){let r=null;return m?r=new(m||l):r=bt(OR),r},providedIn:"root"});let g=l;return g})(),OR=(()=>{let l=class l extends hv{constructor(c){super(),this._doc=c}sanitize(c,m){if(m==null)return null;switch(c){case as.NONE:return m;case as.HTML:return Yh(m,"HTML")?Zh(m):kE(this._doc,String(m)).toString();case as.STYLE:return Yh(m,"Style")?Zh(m):m;case as.SCRIPT:if(Yh(m,"Script"))return Zh(m);throw new fr(5200,!1);case as.URL:return Yh(m,"URL")?Zh(m):DE(String(m));case as.RESOURCE_URL:if(Yh(m,"ResourceURL"))return Zh(m);throw new fr(5201,!1);default:throw new fr(5202,!1)}}bypassSecurityTrustHtml(c){return EE(c)}bypassSecurityTrustStyle(c){return IE(c)}bypassSecurityTrustScript(c){return SE(c)}bypassSecurityTrustUrl(c){return ME(c)}bypassSecurityTrustResourceUrl(c){return AE(c)}};l.\u0275fac=function(m){return new(m||l)(bt(rn))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();var vn="primary",Sf=Symbol("RouteTitle"),_v=class{constructor(l){this.params=l||{}}has(l){return Object.prototype.hasOwnProperty.call(this.params,l)}get(l){if(this.has(l)){let w=this.params[l];return Array.isArray(w)?w[0]:w}return null}getAll(l){if(this.has(l)){let w=this.params[l];return Array.isArray(w)?w:[w]}return[]}get keys(){return Object.keys(this.params)}};function op(g){return new _v(g)}function FR(g,l,w){let c=w.path.split("/");if(c.length>g.length||w.pathMatch==="full"&&(l.hasChildren()||c.length<g.length))return null;let m={};for(let r=0;r<c.length;r++){let M=c[r],z=g[r];if(M.startsWith(":"))m[M.substring(1)]=z;else if(M!==z.path)return null}return{consumed:g.slice(0,c.length),posParams:m}}function LR(g,l){if(g.length!==l.length)return!1;for(let w=0;w<g.length;++w)if(!ic(g[w],l[w]))return!1;return!0}function ic(g,l){let w=g?bv(g):void 0,c=l?bv(l):void 0;if(!w||!c||w.length!=c.length)return!1;let m;for(let r=0;r<w.length;r++)if(m=w[r],!vI(g[m],l[m]))return!1;return!0}function bv(g){return[...Object.keys(g),...Object.getOwnPropertySymbols(g)]}function vI(g,l){if(Array.isArray(g)&&Array.isArray(l)){if(g.length!==l.length)return!1;let w=[...g].sort(),c=[...l].sort();return w.every((m,r)=>c[r]===m)}else return g===l}function xI(g){return g.length>0?g[g.length-1]:null}function wd(g){return z0(g)?g:G_(g)?ha(Promise.resolve(g)):ui(g)}var zR={exact:CI,subset:TI},wI={exact:NR,subset:BR,ignored:()=>!0};function fI(g,l,w){return zR[w.paths](g.root,l.root,w.matrixParams)&&wI[w.queryParams](g.queryParams,l.queryParams)&&!(w.fragment==="exact"&&g.fragment!==l.fragment)}function NR(g,l){return ic(g,l)}function CI(g,l,w){if(!Lu(g.segments,l.segments)||!ob(g.segments,l.segments,w)||g.numberOfChildren!==l.numberOfChildren)return!1;for(let c in l.children)if(!g.children[c]||!CI(g.children[c],l.children[c],w))return!1;return!0}function BR(g,l){return Object.keys(l).length<=Object.keys(g).length&&Object.keys(l).every(w=>vI(g[w],l[w]))}function TI(g,l,w){return EI(g,l,l.segments,w)}function EI(g,l,w,c){if(g.segments.length>w.length){let m=g.segments.slice(0,w.length);return!(!Lu(m,w)||l.hasChildren()||!ob(m,w,c))}else if(g.segments.length===w.length){if(!Lu(g.segments,w)||!ob(g.segments,w,c))return!1;for(let m in l.children)if(!g.children[m]||!TI(g.children[m],l.children[m],c))return!1;return!0}else{let m=w.slice(0,g.segments.length),r=w.slice(g.segments.length);return!Lu(g.segments,m)||!ob(g.segments,m,c)||!g.children[vn]?!1:EI(g.children[vn],l,r,c)}}function ob(g,l,w){return l.every((c,m)=>wI[w](g[m].parameters,c.parameters))}var vd=class{constructor(l=new dr([],{}),w={},c=null){this.root=l,this.queryParams=w,this.fragment=c}get queryParamMap(){return this._queryParamMap??=op(this.queryParams),this._queryParamMap}toString(){return UR.serialize(this)}},dr=class{constructor(l,w){this.segments=l,this.children=w,this.parent=null,Object.values(w).forEach(c=>c.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return ab(this)}},Fu=class{constructor(l,w){this.path=l,this.parameters=w}get parameterMap(){return this._parameterMap??=op(this.parameters),this._parameterMap}toString(){return SI(this)}};function VR(g,l){return Lu(g,l)&&g.every((w,c)=>ic(w.parameters,l[c].parameters))}function Lu(g,l){return g.length!==l.length?!1:g.every((w,c)=>w.path===l[c].path)}function jR(g,l){let w=[];return Object.entries(g.children).forEach(([c,m])=>{c===vn&&(w=w.concat(l(m,c)))}),Object.entries(g.children).forEach(([c,m])=>{c!==vn&&(w=w.concat(l(m,c)))}),w}var Hv=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:()=>new lb,providedIn:"root"});let g=l;return g})(),lb=class{parse(l){let w=new vv(l);return new vd(w.parseRootSegment(),w.parseQueryParams(),w.parseFragment())}serialize(l){let w=`/${pf(l.root,!0)}`,c=$R(l.queryParams),m=typeof l.fragment=="string"?`#${GR(l.fragment)}`:"";return`${w}${c}${m}`}},UR=new lb;function ab(g){return g.segments.map(l=>SI(l)).join("/")}function pf(g,l){if(!g.hasChildren())return ab(g);if(l){let w=g.children[vn]?pf(g.children[vn],!1):"",c=[];return Object.entries(g.children).forEach(([m,r])=>{m!==vn&&c.push(`${m}:${pf(r,!1)}`)}),c.length>0?`${w}(${c.join("//")})`:w}else{let w=jR(g,(c,m)=>m===vn?[pf(g.children[vn],!1)]:[`${m}:${pf(c,!1)}`]);return Object.keys(g.children).length===1&&g.children[vn]!=null?`${ab(g)}/${w[0]}`:`${ab(g)}/(${w.join("//")})`}}function II(g){return encodeURIComponent(g).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function nb(g){return II(g).replace(/%3B/gi,";")}function GR(g){return encodeURI(g)}function yv(g){return II(g).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function sb(g){return decodeURIComponent(g)}function gI(g){return sb(g.replace(/\+/g,"%20"))}function SI(g){return`${yv(g.path)}${HR(g.parameters)}`}function HR(g){return Object.entries(g).map(([l,w])=>`;${yv(l)}=${yv(w)}`).join("")}function $R(g){let l=Object.entries(g).map(([w,c])=>Array.isArray(c)?c.map(m=>`${nb(w)}=${nb(m)}`).join("&"):`${nb(w)}=${nb(c)}`).filter(w=>w);return l.length?`?${l.join("&")}`:""}var qR=/^[^\/()?;#]+/;function pv(g){let l=g.match(qR);return l?l[0]:""}var WR=/^[^\/()?;=#]+/;function ZR(g){let l=g.match(WR);return l?l[0]:""}var YR=/^[^=?&#]+/;function XR(g){let l=g.match(YR);return l?l[0]:""}var KR=/^[^&#]+/;function QR(g){let l=g.match(KR);return l?l[0]:""}var vv=class{constructor(l){this.url=l,this.remaining=l}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new dr([],{}):new dr([],this.parseChildren())}parseQueryParams(){let l={};if(this.consumeOptional("?"))do this.parseQueryParam(l);while(this.consumeOptional("&"));return l}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let l=[];for(this.peekStartsWith("(")||l.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),l.push(this.parseSegment());let w={};this.peekStartsWith("/(")&&(this.capture("/"),w=this.parseParens(!0));let c={};return this.peekStartsWith("(")&&(c=this.parseParens(!1)),(l.length>0||Object.keys(w).length>0)&&(c[vn]=new dr(l,w)),c}parseSegment(){let l=pv(this.remaining);if(l===""&&this.peekStartsWith(";"))throw new fr(4009,!1);return this.capture(l),new Fu(sb(l),this.parseMatrixParams())}parseMatrixParams(){let l={};for(;this.consumeOptional(";");)this.parseParam(l);return l}parseParam(l){let w=ZR(this.remaining);if(!w)return;this.capture(w);let c="";if(this.consumeOptional("=")){let m=pv(this.remaining);m&&(c=m,this.capture(c))}l[sb(w)]=sb(c)}parseQueryParam(l){let w=XR(this.remaining);if(!w)return;this.capture(w);let c="";if(this.consumeOptional("=")){let M=QR(this.remaining);M&&(c=M,this.capture(c))}let m=gI(w),r=gI(c);if(l.hasOwnProperty(m)){let M=l[m];Array.isArray(M)||(M=[M],l[m]=M),M.push(r)}else l[m]=r}parseParens(l){let w={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let c=pv(this.remaining),m=this.remaining[c.length];if(m!=="/"&&m!==")"&&m!==";")throw new fr(4010,!1);let r;c.indexOf(":")>-1?(r=c.slice(0,c.indexOf(":")),this.capture(r),this.capture(":")):l&&(r=vn);let M=this.parseChildren();w[r]=Object.keys(M).length===1?M[vn]:new dr([],M),this.consumeOptional("//")}return w}peekStartsWith(l){return this.remaining.startsWith(l)}consumeOptional(l){return this.peekStartsWith(l)?(this.remaining=this.remaining.substring(l.length),!0):!1}capture(l){if(!this.consumeOptional(l))throw new fr(4011,!1)}};function MI(g){return g.segments.length>0?new dr([],{[vn]:g}):g}function AI(g){let l={};for(let[c,m]of Object.entries(g.children)){let r=AI(m);if(c===vn&&r.segments.length===0&&r.hasChildren())for(let[M,z]of Object.entries(r.children))l[M]=z;else(r.segments.length>0||r.hasChildren())&&(l[c]=r)}let w=new dr(g.segments,l);return JR(w)}function JR(g){if(g.numberOfChildren===1&&g.children[vn]){let l=g.children[vn];return new dr(g.segments.concat(l.segments),l.children)}return g}function ap(g){return g instanceof vd}function eP(g,l,w=null,c=null){let m=DI(g);return kI(m,l,w,c)}function DI(g){let l;function w(r){let M={};for(let ie of r.children){let ue=w(ie);M[ie.outlet]=ue}let z=new dr(r.url,M);return r===g&&(l=z),z}let c=w(g.root),m=MI(c);return l??m}function kI(g,l,w,c){let m=g;for(;m.parent;)m=m.parent;if(l.length===0)return mv(m,m,m,w,c);let r=tP(l);if(r.toRoot())return mv(m,m,new dr([],{}),w,c);let M=iP(r,m,g),z=M.processChildren?gf(M.segmentGroup,M.index,r.commands):PI(M.segmentGroup,M.index,r.commands);return mv(m,M.segmentGroup,z,w,c)}function cb(g){return typeof g=="object"&&g!=null&&!g.outlets&&!g.segmentPath}function yf(g){return typeof g=="object"&&g!=null&&g.outlets}function mv(g,l,w,c,m){let r={};c&&Object.entries(c).forEach(([ie,ue])=>{r[ie]=Array.isArray(ue)?ue.map(ye=>`${ye}`):`${ue}`});let M;g===l?M=w:M=RI(g,l,w);let z=MI(AI(M));return new vd(z,r,m)}function RI(g,l,w){let c={};return Object.entries(g.children).forEach(([m,r])=>{r===l?c[m]=w:c[m]=RI(r,l,w)}),new dr(g.segments,c)}var db=class{constructor(l,w,c){if(this.isAbsolute=l,this.numberOfDoubleDots=w,this.commands=c,l&&c.length>0&&cb(c[0]))throw new fr(4003,!1);let m=c.find(yf);if(m&&m!==xI(c))throw new fr(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function tP(g){if(typeof g[0]=="string"&&g.length===1&&g[0]==="/")return new db(!0,0,g);let l=0,w=!1,c=g.reduce((m,r,M)=>{if(typeof r=="object"&&r!=null){if(r.outlets){let z={};return Object.entries(r.outlets).forEach(([ie,ue])=>{z[ie]=typeof ue=="string"?ue.split("/"):ue}),[...m,{outlets:z}]}if(r.segmentPath)return[...m,r.segmentPath]}return typeof r!="string"?[...m,r]:M===0?(r.split("/").forEach((z,ie)=>{ie==0&&z==="."||(ie==0&&z===""?w=!0:z===".."?l++:z!=""&&m.push(z))}),m):[...m,r]},[]);return new db(w,l,c)}var np=class{constructor(l,w,c){this.segmentGroup=l,this.processChildren=w,this.index=c}};function iP(g,l,w){if(g.isAbsolute)return new np(l,!0,0);if(!w)return new np(l,!1,NaN);if(w.parent===null)return new np(w,!0,0);let c=cb(g.commands[0])?0:1,m=w.segments.length-1+c;return nP(w,m,g.numberOfDoubleDots)}function nP(g,l,w){let c=g,m=l,r=w;for(;r>m;){if(r-=m,c=c.parent,!c)throw new fr(4005,!1);m=c.segments.length}return new np(c,!1,m-r)}function rP(g){return yf(g[0])?g[0].outlets:{[vn]:g}}function PI(g,l,w){if(g??=new dr([],{}),g.segments.length===0&&g.hasChildren())return gf(g,l,w);let c=oP(g,l,w),m=w.slice(c.commandIndex);if(c.match&&c.pathIndex<g.segments.length){let r=new dr(g.segments.slice(0,c.pathIndex),{});return r.children[vn]=new dr(g.segments.slice(c.pathIndex),g.children),gf(r,0,m)}else return c.match&&m.length===0?new dr(g.segments,{}):c.match&&!g.hasChildren()?xv(g,l,w):c.match?gf(g,0,m):xv(g,l,w)}function gf(g,l,w){if(w.length===0)return new dr(g.segments,{});{let c=rP(w),m={};if(Object.keys(c).some(r=>r!==vn)&&g.children[vn]&&g.numberOfChildren===1&&g.children[vn].segments.length===0){let r=gf(g.children[vn],l,w);return new dr(g.segments,r.children)}return Object.entries(c).forEach(([r,M])=>{typeof M=="string"&&(M=[M]),M!==null&&(m[r]=PI(g.children[r],l,M))}),Object.entries(g.children).forEach(([r,M])=>{c[r]===void 0&&(m[r]=M)}),new dr(g.segments,m)}}function oP(g,l,w){let c=0,m=l,r={match:!1,pathIndex:0,commandIndex:0};for(;m<g.segments.length;){if(c>=w.length)return r;let M=g.segments[m],z=w[c];if(yf(z))break;let ie=`${z}`,ue=c<w.length-1?w[c+1]:null;if(m>0&&ie===void 0)break;if(ie&&ue&&typeof ue=="object"&&ue.outlets===void 0){if(!bI(ie,ue,M))return r;c+=2}else{if(!bI(ie,{},M))return r;c++}m++}return{match:!0,pathIndex:m,commandIndex:c}}function xv(g,l,w){let c=g.segments.slice(0,l),m=0;for(;m<w.length;){let r=w[m];if(yf(r)){let ie=aP(r.outlets);return new dr(c,ie)}if(m===0&&cb(w[0])){let ie=g.segments[l];c.push(new Fu(ie.path,_I(w[0]))),m++;continue}let M=yf(r)?r.outlets[vn]:`${r}`,z=m<w.length-1?w[m+1]:null;M&&z&&cb(z)?(c.push(new Fu(M,_I(z))),m+=2):(c.push(new Fu(M,{})),m++)}return new dr(c,{})}function aP(g){let l={};return Object.entries(g).forEach(([w,c])=>{typeof c=="string"&&(c=[c]),c!==null&&(l[w]=xv(new dr([],{}),0,c))}),l}function _I(g){let l={};return Object.entries(g).forEach(([w,c])=>l[w]=`${c}`),l}function bI(g,l,w){return g==w.path&&ic(l,w.parameters)}var _f="imperative",$o=function(g){return g[g.NavigationStart=0]="NavigationStart",g[g.NavigationEnd=1]="NavigationEnd",g[g.NavigationCancel=2]="NavigationCancel",g[g.NavigationError=3]="NavigationError",g[g.RoutesRecognized=4]="RoutesRecognized",g[g.ResolveStart=5]="ResolveStart",g[g.ResolveEnd=6]="ResolveEnd",g[g.GuardsCheckStart=7]="GuardsCheckStart",g[g.GuardsCheckEnd=8]="GuardsCheckEnd",g[g.RouteConfigLoadStart=9]="RouteConfigLoadStart",g[g.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",g[g.ChildActivationStart=11]="ChildActivationStart",g[g.ChildActivationEnd=12]="ChildActivationEnd",g[g.ActivationStart=13]="ActivationStart",g[g.ActivationEnd=14]="ActivationEnd",g[g.Scroll=15]="Scroll",g[g.NavigationSkipped=16]="NavigationSkipped",g}($o||{}),As=class{constructor(l,w){this.id=l,this.url=w}},vf=class extends As{constructor(l,w,c="imperative",m=null){super(l,w),this.type=$o.NavigationStart,this.navigationTrigger=c,this.restoredState=m}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Fc=class extends As{constructor(l,w,c){super(l,w),this.urlAfterRedirects=c,this.type=$o.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},cs=function(g){return g[g.Redirect=0]="Redirect",g[g.SupersededByNewNavigation=1]="SupersededByNewNavigation",g[g.NoDataFromResolver=2]="NoDataFromResolver",g[g.GuardRejected=3]="GuardRejected",g}(cs||{}),wv=function(g){return g[g.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",g[g.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",g}(wv||{}),xd=class extends As{constructor(l,w,c,m){super(l,w),this.reason=c,this.code=m,this.type=$o.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},zu=class extends As{constructor(l,w,c,m){super(l,w),this.reason=c,this.code=m,this.type=$o.NavigationSkipped}},xf=class extends As{constructor(l,w,c,m){super(l,w),this.error=c,this.target=m,this.type=$o.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},ub=class extends As{constructor(l,w,c,m){super(l,w),this.urlAfterRedirects=c,this.state=m,this.type=$o.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Cv=class extends As{constructor(l,w,c,m){super(l,w),this.urlAfterRedirects=c,this.state=m,this.type=$o.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Tv=class extends As{constructor(l,w,c,m,r){super(l,w),this.urlAfterRedirects=c,this.state=m,this.shouldActivate=r,this.type=$o.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Ev=class extends As{constructor(l,w,c,m){super(l,w),this.urlAfterRedirects=c,this.state=m,this.type=$o.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Iv=class extends As{constructor(l,w,c,m){super(l,w),this.urlAfterRedirects=c,this.state=m,this.type=$o.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Sv=class{constructor(l){this.route=l,this.type=$o.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Mv=class{constructor(l){this.route=l,this.type=$o.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Av=class{constructor(l){this.snapshot=l,this.type=$o.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Dv=class{constructor(l){this.snapshot=l,this.type=$o.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},kv=class{constructor(l){this.snapshot=l,this.type=$o.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Rv=class{constructor(l){this.snapshot=l,this.type=$o.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var wf=class{},Cf=class{constructor(l){this.url=l}};var Pv=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new bb,this.attachRef=null}},bb=(()=>{let l=class l{constructor(){this.contexts=new Map}onChildOutletCreated(c,m){let r=this.getOrCreateContext(c);r.outlet=m,this.contexts.set(c,r)}onChildOutletDestroyed(c){let m=this.getContext(c);m&&(m.outlet=null,m.attachRef=null)}onOutletDeactivated(){let c=this.contexts;return this.contexts=new Map,c}onOutletReAttached(c){this.contexts=c}getOrCreateContext(c){let m=this.getContext(c);return m||(m=new Pv,this.contexts.set(c,m)),m}getContext(c){return this.contexts.get(c)||null}};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),hb=class{constructor(l){this._root=l}get root(){return this._root.value}parent(l){let w=this.pathFromRoot(l);return w.length>1?w[w.length-2]:null}children(l){let w=Ov(l,this._root);return w?w.children.map(c=>c.value):[]}firstChild(l){let w=Ov(l,this._root);return w&&w.children.length>0?w.children[0].value:null}siblings(l){let w=Fv(l,this._root);return w.length<2?[]:w[w.length-2].children.map(m=>m.value).filter(m=>m!==l)}pathFromRoot(l){return Fv(l,this._root).map(w=>w.value)}};function Ov(g,l){if(g===l.value)return l;for(let w of l.children){let c=Ov(g,w);if(c)return c}return null}function Fv(g,l){if(g===l.value)return[l];for(let w of l.children){let c=Fv(g,w);if(c.length)return c.unshift(l),c}return[]}var ls=class{constructor(l,w){this.value=l,this.children=w}toString(){return`TreeNode(${this.value})`}};function ip(g){let l={};return g&&g.children.forEach(w=>l[w.value.outlet]=w),l}var pb=class extends hb{constructor(l,w){super(l),this.snapshot=w,qv(this,l)}toString(){return this.snapshot.toString()}};function OI(g){let l=sP(g),w=new ua([new Fu("",{})]),c=new ua({}),m=new ua({}),r=new ua({}),M=new ua(""),z=new Nu(w,c,r,M,m,vn,g,l.root);return z.snapshot=l.root,new pb(new ls(z,[]),l)}function sP(g){let l={},w={},c={},m="",r=new Tf([],l,c,m,w,vn,g,null,{});return new mb("",new ls(r,[]))}var Nu=class{constructor(l,w,c,m,r,M,z,ie){this.urlSubject=l,this.paramsSubject=w,this.queryParamsSubject=c,this.fragmentSubject=m,this.dataSubject=r,this.outlet=M,this.component=z,this._futureSnapshot=ie,this.title=this.dataSubject?.pipe(ln(ue=>ue[Sf]))??ui(void 0),this.url=l,this.params=w,this.queryParams=c,this.fragment=m,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(ln(l=>op(l))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(ln(l=>op(l))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function $v(g,l,w="emptyOnly"){let c,{routeConfig:m}=g;return l!==null&&(w==="always"||m?.path===""||!l.component&&!l.routeConfig?.loadComponent)?c={params:Ht(Ht({},l.params),g.params),data:Ht(Ht({},l.data),g.data),resolve:Ht(Ht(Ht(Ht({},g.data),l.data),m?.data),g._resolvedData)}:c={params:Ht({},g.params),data:Ht({},g.data),resolve:Ht(Ht({},g.data),g._resolvedData??{})},m&&LI(m)&&(c.resolve[Sf]=m.title),c}var Tf=class{get title(){return this.data?.[Sf]}constructor(l,w,c,m,r,M,z,ie,ue){this.url=l,this.params=w,this.queryParams=c,this.fragment=m,this.data=r,this.outlet=M,this.component=z,this.routeConfig=ie,this._resolve=ue}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=op(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=op(this.queryParams),this._queryParamMap}toString(){let l=this.url.map(c=>c.toString()).join("/"),w=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${l}', path:'${w}')`}},mb=class extends hb{constructor(l,w){super(w),this.url=l,qv(this,w)}toString(){return FI(this._root)}};function qv(g,l){l.value._routerState=g,l.children.forEach(w=>qv(g,w))}function FI(g){let l=g.children.length>0?` { ${g.children.map(FI).join(", ")} } `:"";return`${g.value}${l}`}function fv(g){if(g.snapshot){let l=g.snapshot,w=g._futureSnapshot;g.snapshot=w,ic(l.queryParams,w.queryParams)||g.queryParamsSubject.next(w.queryParams),l.fragment!==w.fragment&&g.fragmentSubject.next(w.fragment),ic(l.params,w.params)||g.paramsSubject.next(w.params),LR(l.url,w.url)||g.urlSubject.next(w.url),ic(l.data,w.data)||g.dataSubject.next(w.data)}else g.snapshot=g._futureSnapshot,g.dataSubject.next(g._futureSnapshot.data)}function Lv(g,l){let w=ic(g.params,l.params)&&VR(g.url,l.url),c=!g.parent!=!l.parent;return w&&!c&&(!g.parent||Lv(g.parent,l.parent))}function LI(g){return typeof g.title=="string"||g.title===null}var Wv=(()=>{let l=class l{constructor(){this.activated=null,this._activatedRoute=null,this.name=vn,this.activateEvents=new fi,this.deactivateEvents=new fi,this.attachEvents=new fi,this.detachEvents=new fi,this.parentContexts=$t(bb),this.location=$t(Pc),this.changeDetector=$t(Pr),this.environmentInjector=$t(qh),this.inputBinder=$t(Zv,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(c){if(c.name){let{firstChange:m,previousValue:r}=c.name;if(m)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(c){return this.parentContexts.getContext(c)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let c=this.parentContexts.getContext(this.name);c?.route&&(c.attachRef?this.attach(c.attachRef,c.route):this.activateWith(c.route,c.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new fr(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new fr(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new fr(4012,!1);this.location.detach();let c=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(c.instance),c}attach(c,m){this.activated=c,this._activatedRoute=m,this.location.insert(c.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(c.instance)}deactivate(){if(this.activated){let c=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(c)}}activateWith(c,m){if(this.isActivated)throw new fr(4013,!1);this._activatedRoute=c;let r=this.location,z=c.snapshot.component,ie=this.parentContexts.getOrCreateContext(this.name).children,ue=new zv(c,ie,r.injector);this.activated=r.createComponent(z,{index:r.length,injector:ue,environmentInjector:m??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};l.\u0275fac=function(m){return new(m||l)},l.\u0275dir=Qi({type:l,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[jr]});let g=l;return g})(),zv=class g{__ngOutletInjector(l){return new g(this.route,this.childContexts,l)}constructor(l,w,c){this.route=l,this.childContexts=w,this.parent=c}get(l,w){return l===Nu?this.route:l===bb?this.childContexts:this.parent.get(l,w)}},Zv=new hi("");function lP(g,l,w){let c=Ef(g,l._root,w?w._root:void 0);return new pb(c,l)}function Ef(g,l,w){if(w&&g.shouldReuseRoute(l.value,w.value.snapshot)){let c=w.value;c._futureSnapshot=l.value;let m=cP(g,l,w);return new ls(c,m)}else{if(g.shouldAttach(l.value)){let r=g.retrieve(l.value);if(r!==null){let M=r.route;return M.value._futureSnapshot=l.value,M.children=l.children.map(z=>Ef(g,z)),M}}let c=dP(l.value),m=l.children.map(r=>Ef(g,r));return new ls(c,m)}}function cP(g,l,w){return l.children.map(c=>{for(let m of w.children)if(g.shouldReuseRoute(c.value,m.value.snapshot))return Ef(g,c,m);return Ef(g,c)})}function dP(g){return new Nu(new ua(g.url),new ua(g.params),new ua(g.queryParams),new ua(g.fragment),new ua(g.data),g.outlet,g.component,g)}var zI="ngNavigationCancelingError";function NI(g,l){let{redirectTo:w,navigationBehaviorOptions:c}=ap(l)?{redirectTo:l,navigationBehaviorOptions:void 0}:l,m=BI(!1,cs.Redirect);return m.url=w,m.navigationBehaviorOptions=c,m}function BI(g,l){let w=new Error(`NavigationCancelingError: ${g||""}`);return w[zI]=!0,w.cancellationCode=l,w}function uP(g){return VI(g)&&ap(g.url)}function VI(g){return!!g&&g[zI]}var hP=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275cmp=kn({type:l,selectors:[["ng-component"]],standalone:!0,features:[Pn],decls:1,vars:0,template:function(m,r){m&1&&nn(0,"router-outlet")},dependencies:[Wv],encapsulation:2});let g=l;return g})();function pP(g,l){return g.providers&&!g._injector&&(g._injector=FE(g.providers,l,`Route: ${g.path}`)),g._injector??l}function Yv(g){let l=g.children&&g.children.map(Yv),w=l?Ar(Ht({},g),{children:l}):Ht({},g);return!w.component&&!w.loadComponent&&(l||w.loadChildren)&&w.outlet&&w.outlet!==vn&&(w.component=hP),w}function nc(g){return g.outlet||vn}function mP(g,l){let w=g.filter(c=>nc(c)===l);return w.push(...g.filter(c=>nc(c)!==l)),w}function Mf(g){if(!g)return null;if(g.routeConfig?._injector)return g.routeConfig._injector;for(let l=g.parent;l;l=l.parent){let w=l.routeConfig;if(w?._loadedInjector)return w._loadedInjector;if(w?._injector)return w._injector}return null}var fP=(g,l,w,c)=>ln(m=>(new Nv(l,m.targetRouterState,m.currentRouterState,w,c).activate(g),m)),Nv=class{constructor(l,w,c,m,r){this.routeReuseStrategy=l,this.futureState=w,this.currState=c,this.forwardEvent=m,this.inputBindingEnabled=r}activate(l){let w=this.futureState._root,c=this.currState?this.currState._root:null;this.deactivateChildRoutes(w,c,l),fv(this.futureState.root),this.activateChildRoutes(w,c,l)}deactivateChildRoutes(l,w,c){let m=ip(w);l.children.forEach(r=>{let M=r.value.outlet;this.deactivateRoutes(r,m[M],c),delete m[M]}),Object.values(m).forEach(r=>{this.deactivateRouteAndItsChildren(r,c)})}deactivateRoutes(l,w,c){let m=l.value,r=w?w.value:null;if(m===r)if(m.component){let M=c.getContext(m.outlet);M&&this.deactivateChildRoutes(l,w,M.children)}else this.deactivateChildRoutes(l,w,c);else r&&this.deactivateRouteAndItsChildren(w,c)}deactivateRouteAndItsChildren(l,w){l.value.component&&this.routeReuseStrategy.shouldDetach(l.value.snapshot)?this.detachAndStoreRouteSubtree(l,w):this.deactivateRouteAndOutlet(l,w)}detachAndStoreRouteSubtree(l,w){let c=w.getContext(l.value.outlet),m=c&&l.value.component?c.children:w,r=ip(l);for(let M of Object.values(r))this.deactivateRouteAndItsChildren(M,m);if(c&&c.outlet){let M=c.outlet.detach(),z=c.children.onOutletDeactivated();this.routeReuseStrategy.store(l.value.snapshot,{componentRef:M,route:l,contexts:z})}}deactivateRouteAndOutlet(l,w){let c=w.getContext(l.value.outlet),m=c&&l.value.component?c.children:w,r=ip(l);for(let M of Object.values(r))this.deactivateRouteAndItsChildren(M,m);c&&(c.outlet&&(c.outlet.deactivate(),c.children.onOutletDeactivated()),c.attachRef=null,c.route=null)}activateChildRoutes(l,w,c){let m=ip(w);l.children.forEach(r=>{this.activateRoutes(r,m[r.value.outlet],c),this.forwardEvent(new Rv(r.value.snapshot))}),l.children.length&&this.forwardEvent(new Dv(l.value.snapshot))}activateRoutes(l,w,c){let m=l.value,r=w?w.value:null;if(fv(m),m===r)if(m.component){let M=c.getOrCreateContext(m.outlet);this.activateChildRoutes(l,w,M.children)}else this.activateChildRoutes(l,w,c);else if(m.component){let M=c.getOrCreateContext(m.outlet);if(this.routeReuseStrategy.shouldAttach(m.snapshot)){let z=this.routeReuseStrategy.retrieve(m.snapshot);this.routeReuseStrategy.store(m.snapshot,null),M.children.onOutletReAttached(z.contexts),M.attachRef=z.componentRef,M.route=z.route.value,M.outlet&&M.outlet.attach(z.componentRef,z.route.value),fv(z.route.value),this.activateChildRoutes(l,null,M.children)}else{let z=Mf(m.snapshot);M.attachRef=null,M.route=m,M.injector=z,M.outlet&&M.outlet.activateWith(m,M.injector),this.activateChildRoutes(l,null,M.children)}}else this.activateChildRoutes(l,null,c)}},fb=class{constructor(l){this.path=l,this.route=this.path[this.path.length-1]}},rp=class{constructor(l,w){this.component=l,this.route=w}};function gP(g,l,w){let c=g._root,m=l?l._root:null;return mf(c,m,w,[c.value])}function _P(g){let l=g.routeConfig?g.routeConfig.canActivateChild:null;return!l||l.length===0?null:{node:g,guards:l}}function lp(g,l){let w=Symbol(),c=l.get(g,w);return c===w?typeof g=="function"&&!xE(g)?g:l.get(g):c}function mf(g,l,w,c,m={canDeactivateChecks:[],canActivateChecks:[]}){let r=ip(l);return g.children.forEach(M=>{bP(M,r[M.value.outlet],w,c.concat([M.value]),m),delete r[M.value.outlet]}),Object.entries(r).forEach(([M,z])=>bf(z,w.getContext(M),m)),m}function bP(g,l,w,c,m={canDeactivateChecks:[],canActivateChecks:[]}){let r=g.value,M=l?l.value:null,z=w?w.getContext(g.value.outlet):null;if(M&&r.routeConfig===M.routeConfig){let ie=yP(M,r,r.routeConfig.runGuardsAndResolvers);ie?m.canActivateChecks.push(new fb(c)):(r.data=M.data,r._resolvedData=M._resolvedData),r.component?mf(g,l,z?z.children:null,c,m):mf(g,l,w,c,m),ie&&z&&z.outlet&&z.outlet.isActivated&&m.canDeactivateChecks.push(new rp(z.outlet.component,M))}else M&&bf(l,z,m),m.canActivateChecks.push(new fb(c)),r.component?mf(g,null,z?z.children:null,c,m):mf(g,null,w,c,m);return m}function yP(g,l,w){if(typeof w=="function")return w(g,l);switch(w){case"pathParamsChange":return!Lu(g.url,l.url);case"pathParamsOrQueryParamsChange":return!Lu(g.url,l.url)||!ic(g.queryParams,l.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Lv(g,l)||!ic(g.queryParams,l.queryParams);case"paramsChange":default:return!Lv(g,l)}}function bf(g,l,w){let c=ip(g),m=g.value;Object.entries(c).forEach(([r,M])=>{m.component?l?bf(M,l.children.getContext(r),w):bf(M,null,w):bf(M,l,w)}),m.component?l&&l.outlet&&l.outlet.isActivated?w.canDeactivateChecks.push(new rp(l.outlet.component,m)):w.canDeactivateChecks.push(new rp(null,m)):w.canDeactivateChecks.push(new rp(null,m))}function Af(g){return typeof g=="function"}function vP(g){return typeof g=="boolean"}function xP(g){return g&&Af(g.canLoad)}function wP(g){return g&&Af(g.canActivate)}function CP(g){return g&&Af(g.canActivateChild)}function TP(g){return g&&Af(g.canDeactivate)}function EP(g){return g&&Af(g.canMatch)}function jI(g){return g instanceof fE||g?.name==="EmptyError"}var rb=Symbol("INITIAL_VALUE");function sp(){return Ta(g=>Km(g.map(l=>l.pipe(vo(1),Es(rb)))).pipe(ln(l=>{for(let w of l)if(w!==!0){if(w===rb)return rb;if(w===!1||w instanceof vd)return w}return!0}),eo(l=>l!==rb),vo(1)))}function IP(g,l){return Ts(w=>{let{targetSnapshot:c,currentSnapshot:m,guards:{canActivateChecks:r,canDeactivateChecks:M}}=w;return M.length===0&&r.length===0?ui(Ar(Ht({},w),{guardsResult:!0})):SP(M,c,m,g).pipe(Ts(z=>z&&vP(z)?MP(c,r,g,l):ui(z)),ln(z=>Ar(Ht({},w),{guardsResult:z})))})}function SP(g,l,w,c){return ha(g).pipe(Ts(m=>PP(m.component,m.route,w,l,c)),bd(m=>m!==!0,!0))}function MP(g,l,w,c){return ha(l).pipe(Tu(m=>P_(DP(m.route.parent,c),AP(m.route,c),RP(g,m.path,w),kP(g,m.route,w))),bd(m=>m!==!0,!0))}function AP(g,l){return g!==null&&l&&l(new kv(g)),ui(!0)}function DP(g,l){return g!==null&&l&&l(new Av(g)),ui(!0)}function kP(g,l,w){let c=l.routeConfig?l.routeConfig.canActivate:null;if(!c||c.length===0)return ui(!0);let m=c.map(r=>B0(()=>{let M=Mf(l)??w,z=lp(r,M),ie=wP(z)?z.canActivate(l,g):kc(M,()=>z(l,g));return wd(ie).pipe(bd())}));return ui(m).pipe(sp())}function RP(g,l,w){let c=l[l.length-1],r=l.slice(0,l.length-1).reverse().map(M=>_P(M)).filter(M=>M!==null).map(M=>B0(()=>{let z=M.guards.map(ie=>{let ue=Mf(M.node)??w,ye=lp(ie,ue),Je=CP(ye)?ye.canActivateChild(c,g):kc(ue,()=>ye(c,g));return wd(Je).pipe(bd())});return ui(z).pipe(sp())}));return ui(r).pipe(sp())}function PP(g,l,w,c,m){let r=l&&l.routeConfig?l.routeConfig.canDeactivate:null;if(!r||r.length===0)return ui(!0);let M=r.map(z=>{let ie=Mf(l)??m,ue=lp(z,ie),ye=TP(ue)?ue.canDeactivate(g,l,w,c):kc(ie,()=>ue(g,l,w,c));return wd(ye).pipe(bd())});return ui(M).pipe(sp())}function OP(g,l,w,c){let m=l.canLoad;if(m===void 0||m.length===0)return ui(!0);let r=m.map(M=>{let z=lp(M,g),ie=xP(z)?z.canLoad(l,w):kc(g,()=>z(l,w));return wd(ie)});return ui(r).pipe(sp(),UI(c))}function UI(g){return mE(Zr(l=>{if(ap(l))throw NI(g,l)}),ln(l=>l===!0))}function FP(g,l,w,c){let m=l.canMatch;if(!m||m.length===0)return ui(!0);let r=m.map(M=>{let z=lp(M,g),ie=EP(z)?z.canMatch(l,w):kc(g,()=>z(l,w));return wd(ie)});return ui(r).pipe(sp(),UI(c))}var If=class{constructor(l){this.segmentGroup=l||null}},gb=class extends Error{constructor(l){super(),this.urlTree=l}};function tp(g){return wu(new If(g))}function LP(g){return wu(new fr(4e3,!1))}function zP(g){return wu(BI(!1,cs.GuardRejected))}var Bv=class{constructor(l,w){this.urlSerializer=l,this.urlTree=w}lineralizeSegments(l,w){let c=[],m=w.root;for(;;){if(c=c.concat(m.segments),m.numberOfChildren===0)return ui(c);if(m.numberOfChildren>1||!m.children[vn])return LP(l.redirectTo);m=m.children[vn]}}applyRedirectCommands(l,w,c){let m=this.applyRedirectCreateUrlTree(w,this.urlSerializer.parse(w),l,c);if(w.startsWith("/"))throw new gb(m);return m}applyRedirectCreateUrlTree(l,w,c,m){let r=this.createSegmentGroup(l,w.root,c,m);return new vd(r,this.createQueryParams(w.queryParams,this.urlTree.queryParams),w.fragment)}createQueryParams(l,w){let c={};return Object.entries(l).forEach(([m,r])=>{if(typeof r=="string"&&r.startsWith(":")){let z=r.substring(1);c[m]=w[z]}else c[m]=r}),c}createSegmentGroup(l,w,c,m){let r=this.createSegments(l,w.segments,c,m),M={};return Object.entries(w.children).forEach(([z,ie])=>{M[z]=this.createSegmentGroup(l,ie,c,m)}),new dr(r,M)}createSegments(l,w,c,m){return w.map(r=>r.path.startsWith(":")?this.findPosParam(l,r,m):this.findOrReturn(r,c))}findPosParam(l,w,c){let m=c[w.path.substring(1)];if(!m)throw new fr(4001,!1);return m}findOrReturn(l,w){let c=0;for(let m of w){if(m.path===l.path)return w.splice(c),m;c++}return l}},Vv={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function NP(g,l,w,c,m){let r=Xv(g,l,w);return r.matched?(c=pP(l,c),FP(c,l,w,m).pipe(ln(M=>M===!0?r:Ht({},Vv)))):ui(r)}function Xv(g,l,w){if(l.path==="**")return BP(w);if(l.path==="")return l.pathMatch==="full"&&(g.hasChildren()||w.length>0)?Ht({},Vv):{matched:!0,consumedSegments:[],remainingSegments:w,parameters:{},positionalParamSegments:{}};let m=(l.matcher||FR)(w,g,l);if(!m)return Ht({},Vv);let r={};Object.entries(m.posParams??{}).forEach(([z,ie])=>{r[z]=ie.path});let M=m.consumed.length>0?Ht(Ht({},r),m.consumed[m.consumed.length-1].parameters):r;return{matched:!0,consumedSegments:m.consumed,remainingSegments:w.slice(m.consumed.length),parameters:M,positionalParamSegments:m.posParams??{}}}function BP(g){return{matched:!0,parameters:g.length>0?xI(g).parameters:{},consumedSegments:g,remainingSegments:[],positionalParamSegments:{}}}function yI(g,l,w,c){return w.length>0&&UP(g,w,c)?{segmentGroup:new dr(l,jP(c,new dr(w,g.children))),slicedSegments:[]}:w.length===0&&GP(g,w,c)?{segmentGroup:new dr(g.segments,VP(g,w,c,g.children)),slicedSegments:w}:{segmentGroup:new dr(g.segments,g.children),slicedSegments:w}}function VP(g,l,w,c){let m={};for(let r of w)if(yb(g,l,r)&&!c[nc(r)]){let M=new dr([],{});m[nc(r)]=M}return Ht(Ht({},c),m)}function jP(g,l){let w={};w[vn]=l;for(let c of g)if(c.path===""&&nc(c)!==vn){let m=new dr([],{});w[nc(c)]=m}return w}function UP(g,l,w){return w.some(c=>yb(g,l,c)&&nc(c)!==vn)}function GP(g,l,w){return w.some(c=>yb(g,l,c))}function yb(g,l,w){return(g.hasChildren()||l.length>0)&&w.pathMatch==="full"?!1:w.path===""}function HP(g,l,w,c){return nc(g)!==c&&(c===vn||!yb(l,w,g))?!1:Xv(l,g,w).matched}function $P(g,l,w){return l.length===0&&!g.children[w]}var jv=class{};function qP(g,l,w,c,m,r,M="emptyOnly"){return new Uv(g,l,w,c,m,M,r).recognize()}var WP=31,Uv=class{constructor(l,w,c,m,r,M,z){this.injector=l,this.configLoader=w,this.rootComponentType=c,this.config=m,this.urlTree=r,this.paramsInheritanceStrategy=M,this.urlSerializer=z,this.applyRedirects=new Bv(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(l){return new fr(4002,`'${l.segmentGroup}'`)}recognize(){let l=yI(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(l).pipe(ln(w=>{let c=new Tf([],Object.freeze({}),Object.freeze(Ht({},this.urlTree.queryParams)),this.urlTree.fragment,{},vn,this.rootComponentType,null,{}),m=new ls(c,w),r=new mb("",m),M=eP(c,[],this.urlTree.queryParams,this.urlTree.fragment);return M.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(M),this.inheritParamsAndData(r._root,null),{state:r,tree:M}}))}match(l){return this.processSegmentGroup(this.injector,this.config,l,vn).pipe(gd(c=>{if(c instanceof gb)return this.urlTree=c.urlTree,this.match(c.urlTree.root);throw c instanceof If?this.noMatchError(c):c}))}inheritParamsAndData(l,w){let c=l.value,m=$v(c,w,this.paramsInheritanceStrategy);c.params=Object.freeze(m.params),c.data=Object.freeze(m.data),l.children.forEach(r=>this.inheritParamsAndData(r,c))}processSegmentGroup(l,w,c,m){return c.segments.length===0&&c.hasChildren()?this.processChildren(l,w,c):this.processSegment(l,w,c,c.segments,m,!0).pipe(ln(r=>r instanceof ls?[r]:[]))}processChildren(l,w,c){let m=[];for(let r of Object.keys(c.children))r==="primary"?m.unshift(r):m.push(r);return ha(m).pipe(Tu(r=>{let M=c.children[r],z=mP(w,r);return this.processSegmentGroup(l,z,M,r)}),yE((r,M)=>(r.push(...M),r)),j0(null),bE(),Ts(r=>{if(r===null)return tp(c);let M=GI(r);return ZP(M),ui(M)}))}processSegment(l,w,c,m,r,M){return ha(w).pipe(Tu(z=>this.processSegmentAgainstRoute(z._injector??l,w,z,c,m,r,M).pipe(gd(ie=>{if(ie instanceof If)return ui(null);throw ie}))),bd(z=>!!z),gd(z=>{if(jI(z))return $P(c,m,r)?ui(new jv):tp(c);throw z}))}processSegmentAgainstRoute(l,w,c,m,r,M,z){return HP(c,m,r,M)?c.redirectTo===void 0?this.matchSegmentAgainstRoute(l,m,c,r,M):this.allowRedirects&&z?this.expandSegmentAgainstRouteUsingRedirect(l,m,w,c,r,M):tp(m):tp(m)}expandSegmentAgainstRouteUsingRedirect(l,w,c,m,r,M){let{matched:z,consumedSegments:ie,positionalParamSegments:ue,remainingSegments:ye}=Xv(w,m,r);if(!z)return tp(w);m.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>WP&&(this.allowRedirects=!1));let Je=this.applyRedirects.applyRedirectCommands(ie,m.redirectTo,ue);return this.applyRedirects.lineralizeSegments(m,Je).pipe(Ts(It=>this.processSegment(l,c,w,It.concat(ye),M,!1)))}matchSegmentAgainstRoute(l,w,c,m,r){let M=NP(w,c,m,l,this.urlSerializer);return c.path==="**"&&(w.children={}),M.pipe(Ta(z=>z.matched?(l=c._injector??l,this.getChildConfig(l,c,m).pipe(Ta(({routes:ie})=>{let ue=c._loadedInjector??l,{consumedSegments:ye,remainingSegments:Je,parameters:It}=z,st=new Tf(ye,It,Object.freeze(Ht({},this.urlTree.queryParams)),this.urlTree.fragment,XP(c),nc(c),c.component??c._loadedComponent??null,c,KP(c)),{segmentGroup:Xt,slicedSegments:Oi}=yI(w,ye,Je,ie);if(Oi.length===0&&Xt.hasChildren())return this.processChildren(ue,ie,Xt).pipe(ln(Ti=>Ti===null?null:new ls(st,Ti)));if(ie.length===0&&Oi.length===0)return ui(new ls(st,[]));let vi=nc(c)===r;return this.processSegment(ue,ie,Xt,Oi,vi?vn:r,!0).pipe(ln(Ti=>new ls(st,Ti instanceof ls?[Ti]:[])))}))):tp(w)))}getChildConfig(l,w,c){return w.children?ui({routes:w.children,injector:l}):w.loadChildren?w._loadedRoutes!==void 0?ui({routes:w._loadedRoutes,injector:w._loadedInjector}):OP(l,w,c,this.urlSerializer).pipe(Ts(m=>m?this.configLoader.loadChildren(l,w).pipe(Zr(r=>{w._loadedRoutes=r.routes,w._loadedInjector=r.injector})):zP(w))):ui({routes:[],injector:l})}};function ZP(g){g.sort((l,w)=>l.value.outlet===vn?-1:w.value.outlet===vn?1:l.value.outlet.localeCompare(w.value.outlet))}function YP(g){let l=g.value.routeConfig;return l&&l.path===""}function GI(g){let l=[],w=new Set;for(let c of g){if(!YP(c)){l.push(c);continue}let m=l.find(r=>c.value.routeConfig===r.value.routeConfig);m!==void 0?(m.children.push(...c.children),w.add(m)):l.push(c)}for(let c of w){let m=GI(c.children);l.push(new ls(c.value,m))}return l.filter(c=>!w.has(c))}function XP(g){return g.data||{}}function KP(g){return g.resolve||{}}function QP(g,l,w,c,m,r){return Ts(M=>qP(g,l,w,c,M.extractedUrl,m,r).pipe(ln(({state:z,tree:ie})=>Ar(Ht({},M),{targetSnapshot:z,urlAfterRedirects:ie}))))}function JP(g,l){return Ts(w=>{let{targetSnapshot:c,guards:{canActivateChecks:m}}=w;if(!m.length)return ui(w);let r=new Set(m.map(ie=>ie.route)),M=new Set;for(let ie of r)if(!M.has(ie))for(let ue of HI(ie))M.add(ue);let z=0;return ha(M).pipe(Tu(ie=>r.has(ie)?eO(ie,c,g,l):(ie.data=$v(ie,ie.parent,g).resolve,ui(void 0))),Zr(()=>z++),U0(1),Ts(ie=>z===M.size?ui(w):Cs))})}function HI(g){let l=g.children.map(w=>HI(w)).flat();return[g,...l]}function eO(g,l,w,c){let m=g.routeConfig,r=g._resolve;return m?.title!==void 0&&!LI(m)&&(r[Sf]=m.title),tO(r,g,l,c).pipe(ln(M=>(g._resolvedData=M,g.data=$v(g,g.parent,w).resolve,null)))}function tO(g,l,w,c){let m=bv(g);if(m.length===0)return ui({});let r={};return ha(m).pipe(Ts(M=>iO(g[M],l,w,c).pipe(bd(),Zr(z=>{r[M]=z}))),U0(1),_E(r),gd(M=>jI(M)?Cs:wu(M)))}function iO(g,l,w,c){let m=Mf(l)??c,r=lp(g,m),M=r.resolve?r.resolve(l,w):kc(m,()=>r(l,w));return wd(M)}function gv(g){return Ta(l=>{let w=g(l);return w?ha(w).pipe(ln(()=>l)):ui(l)})}var $I=(()=>{let l=class l{buildTitle(c){let m,r=c.root;for(;r!==void 0;)m=this.getResolvedTitleForRoute(r)??m,r=r.children.find(M=>M.outlet===vn);return m}getResolvedTitleForRoute(c){return c.data[Sf]}};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:()=>$t(nO),providedIn:"root"});let g=l;return g})(),nO=(()=>{let l=class l extends $I{constructor(c){super(),this.title=c}updateTitle(c){let m=this.buildTitle(c);m!==void 0&&this.title.setTitle(m)}};l.\u0275fac=function(m){return new(m||l)(bt(pI))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),Kv=new hi("",{providedIn:"root",factory:()=>({})}),Qv=new hi(""),rO=(()=>{let l=class l{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=$t(X0)}loadComponent(c){if(this.componentLoaders.get(c))return this.componentLoaders.get(c);if(c._loadedComponent)return ui(c._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(c);let m=wd(c.loadComponent()).pipe(ln(qI),Zr(M=>{this.onLoadEndListener&&this.onLoadEndListener(c),c._loadedComponent=M}),_d(()=>{this.componentLoaders.delete(c)})),r=new L0(m,()=>new Gi).pipe(F0());return this.componentLoaders.set(c,r),r}loadChildren(c,m){if(this.childrenLoaders.get(m))return this.childrenLoaders.get(m);if(m._loadedRoutes)return ui({routes:m._loadedRoutes,injector:m._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(m);let M=oO(m,this.compiler,c,this.onLoadEndListener).pipe(_d(()=>{this.childrenLoaders.delete(m)})),z=new L0(M,()=>new Gi).pipe(F0());return this.childrenLoaders.set(m,z),z}};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();function oO(g,l,w,c){return wd(g.loadChildren()).pipe(ln(qI),Ts(m=>m instanceof OE||Array.isArray(m)?ui(m):ha(l.compileModuleAsync(m))),ln(m=>{c&&c(g);let r,M,z=!1;return Array.isArray(m)?(M=m,z=!0):(r=m.create(w).injector,M=r.get(Qv,[],{optional:!0,self:!0}).flat()),{routes:M.map(Yv),injector:r}}))}function aO(g){return g&&typeof g=="object"&&"default"in g}function qI(g){return aO(g)?g.default:g}var Jv=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:()=>$t(sO),providedIn:"root"});let g=l;return g})(),sO=(()=>{let l=class l{shouldProcessUrl(c){return!0}extract(c){return c}merge(c,m){return c}};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),lO=new hi("");var cO=(()=>{let l=class l{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new Gi,this.transitionAbortSubject=new Gi,this.configLoader=$t(rO),this.environmentInjector=$t(qh),this.urlSerializer=$t(Hv),this.rootContexts=$t(bb),this.location=$t(Jh),this.inputBindingEnabled=$t(Zv,{optional:!0})!==null,this.titleStrategy=$t($I),this.options=$t(Kv,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=$t(Jv),this.createViewTransition=$t(lO,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>ui(void 0),this.rootComponentType=null;let c=r=>this.events.next(new Sv(r)),m=r=>this.events.next(new Mv(r));this.configLoader.onLoadEndListener=m,this.configLoader.onLoadStartListener=c}complete(){this.transitions?.complete()}handleNavigationRequest(c){let m=++this.navigationId;this.transitions?.next(Ar(Ht(Ht({},this.transitions.value),c),{id:m}))}setupNavigations(c,m,r){return this.transitions=new ua({id:0,currentUrlTree:m,currentRawUrl:m,extractedUrl:this.urlHandlingStrategy.extract(m),urlAfterRedirects:this.urlHandlingStrategy.extract(m),rawUrl:m,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:_f,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(eo(M=>M.id!==0),ln(M=>Ar(Ht({},M),{extractedUrl:this.urlHandlingStrategy.extract(M.rawUrl)})),Ta(M=>{let z=!1,ie=!1;return ui(M).pipe(Ta(ue=>{if(this.navigationId>M.id)return this.cancelNavigationTransition(M,"",cs.SupersededByNewNavigation),Cs;this.currentTransition=M,this.currentNavigation={id:ue.id,initialUrl:ue.rawUrl,extractedUrl:ue.extractedUrl,trigger:ue.source,extras:ue.extras,previousNavigation:this.lastSuccessfulNavigation?Ar(Ht({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let ye=!c.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),Je=ue.extras.onSameUrlNavigation??c.onSameUrlNavigation;if(!ye&&Je!=="reload"){let It="";return this.events.next(new zu(ue.id,this.urlSerializer.serialize(ue.rawUrl),It,wv.IgnoredSameUrlNavigation)),ue.resolve(null),Cs}if(this.urlHandlingStrategy.shouldProcessUrl(ue.rawUrl))return ui(ue).pipe(Ta(It=>{let st=this.transitions?.getValue();return this.events.next(new vf(It.id,this.urlSerializer.serialize(It.extractedUrl),It.source,It.restoredState)),st!==this.transitions?.getValue()?Cs:Promise.resolve(It)}),QP(this.environmentInjector,this.configLoader,this.rootComponentType,c.config,this.urlSerializer,this.paramsInheritanceStrategy),Zr(It=>{M.targetSnapshot=It.targetSnapshot,M.urlAfterRedirects=It.urlAfterRedirects,this.currentNavigation=Ar(Ht({},this.currentNavigation),{finalUrl:It.urlAfterRedirects});let st=new ub(It.id,this.urlSerializer.serialize(It.extractedUrl),this.urlSerializer.serialize(It.urlAfterRedirects),It.targetSnapshot);this.events.next(st)}));if(ye&&this.urlHandlingStrategy.shouldProcessUrl(ue.currentRawUrl)){let{id:It,extractedUrl:st,source:Xt,restoredState:Oi,extras:vi}=ue,Ti=new vf(It,this.urlSerializer.serialize(st),Xt,Oi);this.events.next(Ti);let xn=OI(this.rootComponentType).snapshot;return this.currentTransition=M=Ar(Ht({},ue),{targetSnapshot:xn,urlAfterRedirects:st,extras:Ar(Ht({},vi),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=st,ui(M)}else{let It="";return this.events.next(new zu(ue.id,this.urlSerializer.serialize(ue.extractedUrl),It,wv.IgnoredByUrlHandlingStrategy)),ue.resolve(null),Cs}}),Zr(ue=>{let ye=new Cv(ue.id,this.urlSerializer.serialize(ue.extractedUrl),this.urlSerializer.serialize(ue.urlAfterRedirects),ue.targetSnapshot);this.events.next(ye)}),ln(ue=>(this.currentTransition=M=Ar(Ht({},ue),{guards:gP(ue.targetSnapshot,ue.currentSnapshot,this.rootContexts)}),M)),IP(this.environmentInjector,ue=>this.events.next(ue)),Zr(ue=>{if(M.guardsResult=ue.guardsResult,ap(ue.guardsResult))throw NI(this.urlSerializer,ue.guardsResult);let ye=new Tv(ue.id,this.urlSerializer.serialize(ue.extractedUrl),this.urlSerializer.serialize(ue.urlAfterRedirects),ue.targetSnapshot,!!ue.guardsResult);this.events.next(ye)}),eo(ue=>ue.guardsResult?!0:(this.cancelNavigationTransition(ue,"",cs.GuardRejected),!1)),gv(ue=>{if(ue.guards.canActivateChecks.length)return ui(ue).pipe(Zr(ye=>{let Je=new Ev(ye.id,this.urlSerializer.serialize(ye.extractedUrl),this.urlSerializer.serialize(ye.urlAfterRedirects),ye.targetSnapshot);this.events.next(Je)}),Ta(ye=>{let Je=!1;return ui(ye).pipe(JP(this.paramsInheritanceStrategy,this.environmentInjector),Zr({next:()=>Je=!0,complete:()=>{Je||this.cancelNavigationTransition(ye,"",cs.NoDataFromResolver)}}))}),Zr(ye=>{let Je=new Iv(ye.id,this.urlSerializer.serialize(ye.extractedUrl),this.urlSerializer.serialize(ye.urlAfterRedirects),ye.targetSnapshot);this.events.next(Je)}))}),gv(ue=>{let ye=Je=>{let It=[];Je.routeConfig?.loadComponent&&!Je.routeConfig._loadedComponent&&It.push(this.configLoader.loadComponent(Je.routeConfig).pipe(Zr(st=>{Je.component=st}),ln(()=>{})));for(let st of Je.children)It.push(...ye(st));return It};return Km(ye(ue.targetSnapshot.root)).pipe(j0(null),vo(1))}),gv(()=>this.afterPreactivation()),Ta(()=>{let{currentSnapshot:ue,targetSnapshot:ye}=M,Je=this.createViewTransition?.(this.environmentInjector,ue.root,ye.root);return Je?ha(Je).pipe(ln(()=>M)):ui(M)}),ln(ue=>{let ye=lP(c.routeReuseStrategy,ue.targetSnapshot,ue.currentRouterState);return this.currentTransition=M=Ar(Ht({},ue),{targetRouterState:ye}),this.currentNavigation.targetRouterState=ye,M}),Zr(()=>{this.events.next(new wf)}),fP(this.rootContexts,c.routeReuseStrategy,ue=>this.events.next(ue),this.inputBindingEnabled),vo(1),Zr({next:ue=>{z=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Fc(ue.id,this.urlSerializer.serialize(ue.extractedUrl),this.urlSerializer.serialize(ue.urlAfterRedirects))),this.titleStrategy?.updateTitle(ue.targetRouterState.snapshot),ue.resolve(!0)},complete:()=>{z=!0}}),Wr(this.transitionAbortSubject.pipe(Zr(ue=>{throw ue}))),_d(()=>{!z&&!ie&&this.cancelNavigationTransition(M,"",cs.SupersededByNewNavigation),this.currentTransition?.id===M.id&&(this.currentNavigation=null,this.currentTransition=null)}),gd(ue=>{if(ie=!0,VI(ue))this.events.next(new xd(M.id,this.urlSerializer.serialize(M.extractedUrl),ue.message,ue.cancellationCode)),uP(ue)?this.events.next(new Cf(ue.url)):M.resolve(!1);else{this.events.next(new xf(M.id,this.urlSerializer.serialize(M.extractedUrl),ue,M.targetSnapshot??void 0));try{M.resolve(c.errorHandler(ue))}catch(ye){this.options.resolveNavigationPromiseOnError?M.resolve(!1):M.reject(ye)}}return Cs}))}))}cancelNavigationTransition(c,m,r){let M=new xd(c.id,this.urlSerializer.serialize(c.extractedUrl),m,r);this.events.next(M),c.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();function dO(g){return g!==_f}var uO=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:()=>$t(hO),providedIn:"root"});let g=l;return g})(),Gv=class{shouldDetach(l){return!1}store(l,w){}shouldAttach(l){return!1}retrieve(l){return null}shouldReuseRoute(l,w){return l.routeConfig===w.routeConfig}},hO=(()=>{let l=class l extends Gv{};l.\u0275fac=(()=>{let c;return function(r){return(c||(c=Ql(l)))(r||l)}})(),l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),WI=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:()=>$t(pO),providedIn:"root"});let g=l;return g})(),pO=(()=>{let l=class l extends WI{constructor(){super(...arguments),this.location=$t(Jh),this.urlSerializer=$t(Hv),this.options=$t(Kv,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=$t(Jv),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new vd,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=OI(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(c){return this.location.subscribe(m=>{m.type==="popstate"&&c(m.url,m.state)})}handleRouterEvent(c,m){if(c instanceof vf)this.stateMemento=this.createStateMemento();else if(c instanceof zu)this.rawUrlTree=m.initialUrl;else if(c instanceof ub){if(this.urlUpdateStrategy==="eager"&&!m.extras.skipLocationChange){let r=this.urlHandlingStrategy.merge(m.finalUrl,m.initialUrl);this.setBrowserUrl(r,m)}}else c instanceof wf?(this.currentUrlTree=m.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(m.finalUrl,m.initialUrl),this.routerState=m.targetRouterState,this.urlUpdateStrategy==="deferred"&&(m.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,m))):c instanceof xd&&(c.code===cs.GuardRejected||c.code===cs.NoDataFromResolver)?this.restoreHistory(m):c instanceof xf?this.restoreHistory(m,!0):c instanceof Fc&&(this.lastSuccessfulId=c.id,this.currentPageId=this.browserPageId)}setBrowserUrl(c,m){let r=this.urlSerializer.serialize(c);if(this.location.isCurrentPathEqualTo(r)||m.extras.replaceUrl){let M=this.browserPageId,z=Ht(Ht({},m.extras.state),this.generateNgRouterState(m.id,M));this.location.replaceState(r,"",z)}else{let M=Ht(Ht({},m.extras.state),this.generateNgRouterState(m.id,this.browserPageId+1));this.location.go(r,"",M)}}restoreHistory(c,m=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,M=this.currentPageId-r;M!==0?this.location.historyGo(M):this.currentUrlTree===c.finalUrl&&M===0&&(this.resetState(c),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(m&&this.resetState(c),this.resetUrlToCurrentUrlTree())}resetState(c){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,c.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(c,m){return this.canceledNavigationResolution==="computed"?{navigationId:c,\u0275routerPageId:m}:{navigationId:c}}};l.\u0275fac=(()=>{let c;return function(r){return(c||(c=Ql(l)))(r||l)}})(),l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),ff=function(g){return g[g.COMPLETE=0]="COMPLETE",g[g.FAILED=1]="FAILED",g[g.REDIRECTING=2]="REDIRECTING",g}(ff||{});function mO(g,l){g.events.pipe(eo(w=>w instanceof Fc||w instanceof xd||w instanceof xf||w instanceof zu),ln(w=>w instanceof Fc||w instanceof zu?ff.COMPLETE:(w instanceof xd?w.code===cs.Redirect||w.code===cs.SupersededByNewNavigation:!1)?ff.REDIRECTING:ff.FAILED),eo(w=>w!==ff.REDIRECTING),vo(1)).subscribe(()=>{l()})}function fO(g){throw g}var gO={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},_O={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},cp=(()=>{let l=class l{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=$t(U_),this.stateManager=$t(WI),this.options=$t(Kv,{optional:!0})||{},this.pendingTasks=$t(j_),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=$t(cO),this.urlSerializer=$t(Hv),this.location=$t(Jh),this.urlHandlingStrategy=$t(Jv),this._events=new Gi,this.errorHandler=this.options.errorHandler||fO,this.navigated=!1,this.routeReuseStrategy=$t(uO),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=$t(Qv,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!$t(Zv,{optional:!0}),this.eventsSubscription=new qr,this.isNgZoneEnabled=$t(yi)instanceof yi&&yi.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:c=>{this.console.warn(c)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let c=this.navigationTransitions.events.subscribe(m=>{try{let r=this.navigationTransitions.currentTransition,M=this.navigationTransitions.currentNavigation;if(r!==null&&M!==null){if(this.stateManager.handleRouterEvent(m,M),m instanceof xd&&m.code!==cs.Redirect&&m.code!==cs.SupersededByNewNavigation)this.navigated=!0;else if(m instanceof Fc)this.navigated=!0;else if(m instanceof Cf){let z=this.urlHandlingStrategy.merge(m.url,r.currentRawUrl),ie={info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||dO(r.source)};this.scheduleNavigation(z,_f,null,ie,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}yO(m)&&this._events.next(m)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(c)}resetRootComponentType(c){this.routerState.root.component=c,this.navigationTransitions.rootComponentType=c}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),_f,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((c,m)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(c,"popstate",m)},0)})}navigateToSyncWithBrowser(c,m,r){let M={replaceUrl:!0},z=r?.navigationId?r:null;if(r){let ue=Ht({},r);delete ue.navigationId,delete ue.\u0275routerPageId,Object.keys(ue).length!==0&&(M.state=ue)}let ie=this.parseUrl(c);this.scheduleNavigation(ie,m,z,M)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(c){this.config=c.map(Yv),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(c,m={}){let{relativeTo:r,queryParams:M,fragment:z,queryParamsHandling:ie,preserveFragment:ue}=m,ye=ue?this.currentUrlTree.fragment:z,Je=null;switch(ie){case"merge":Je=Ht(Ht({},this.currentUrlTree.queryParams),M);break;case"preserve":Je=this.currentUrlTree.queryParams;break;default:Je=M||null}Je!==null&&(Je=this.removeEmptyProps(Je));let It;try{let st=r?r.snapshot:this.routerState.snapshot.root;It=DI(st)}catch{(typeof c[0]!="string"||!c[0].startsWith("/"))&&(c=[]),It=this.currentUrlTree.root}return kI(It,c,Je,ye??null)}navigateByUrl(c,m={skipLocationChange:!1}){let r=ap(c)?c:this.parseUrl(c),M=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(M,_f,null,m)}navigate(c,m={skipLocationChange:!1}){return bO(c),this.navigateByUrl(this.createUrlTree(c,m),m)}serializeUrl(c){return this.urlSerializer.serialize(c)}parseUrl(c){try{return this.urlSerializer.parse(c)}catch{return this.urlSerializer.parse("/")}}isActive(c,m){let r;if(m===!0?r=Ht({},gO):m===!1?r=Ht({},_O):r=m,ap(c))return fI(this.currentUrlTree,c,r);let M=this.parseUrl(c);return fI(this.currentUrlTree,M,r)}removeEmptyProps(c){return Object.entries(c).reduce((m,[r,M])=>(M!=null&&(m[r]=M),m),{})}scheduleNavigation(c,m,r,M,z){if(this.disposed)return Promise.resolve(!1);let ie,ue,ye;z?(ie=z.resolve,ue=z.reject,ye=z.promise):ye=new Promise((It,st)=>{ie=It,ue=st});let Je=this.pendingTasks.add();return mO(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(Je))}),this.navigationTransitions.handleNavigationRequest({source:m,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:c,extras:M,resolve:ie,reject:ue,promise:ye,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),ye.catch(It=>Promise.reject(It))}};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();function bO(g){for(let l=0;l<g.length;l++)if(g[l]==null)throw new fr(4008,!1)}function yO(g){return!(g instanceof wf)&&!(g instanceof Cf)}var _b=(()=>{let l=class l{constructor(c,m,r,M,z,ie){this.router=c,this.route=m,this.tabIndexAttribute=r,this.renderer=M,this.el=z,this.locationStrategy=ie,this.href=null,this.commands=null,this.onChanges=new Gi,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let ue=z.nativeElement.tagName?.toLowerCase();this.isAnchorElement=ue==="a"||ue==="area",this.isAnchorElement?this.subscription=c.events.subscribe(ye=>{ye instanceof Fc&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(c){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",c)}ngOnChanges(c){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(c){c!=null?(this.commands=Array.isArray(c)?c:[c],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(c,m,r,M,z){let ie=this.urlTree;if(ie===null||this.isAnchorElement&&(c!==0||m||r||M||z||typeof this.target=="string"&&this.target!="_self"))return!0;let ue={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(ie,ue),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let c=this.urlTree;this.href=c!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(c)):null;let m=this.href===null?null:RE(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",m)}applyAttributeValue(c,m){let r=this.renderer,M=this.el.nativeElement;m!==null?r.setAttribute(M,c,m):r.removeAttribute(M,c)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};l.\u0275fac=function(m){return new(m||l)(Oe(cp),Oe(Nu),Is("tabindex"),Oe(Xh),Oe(zi),Oe(K0))},l.\u0275dir=Qi({type:l,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(m,r){m&1&&Vi("click",function(z){return r.onClick(z.button,z.ctrlKey,z.shiftKey,z.altKey,z.metaKey)}),m&2&&Fn("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[Jt.HasDecoratorInputTransform,"preserveFragment","preserveFragment",pn],skipLocationChange:[Jt.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",pn],replaceUrl:[Jt.HasDecoratorInputTransform,"replaceUrl","replaceUrl",pn],routerLink:"routerLink"},standalone:!0,features:[xr,jr]});let g=l;return g})(),ZI=(()=>{let l=class l{get isActive(){return this._isActive}constructor(c,m,r,M,z){this.router=c,this.element=m,this.renderer=r,this.cdr=M,this.link=z,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new fi,this.routerEventsSubscription=c.events.subscribe(ie=>{ie instanceof Fc&&this.update()})}ngAfterContentInit(){ui(this.links.changes,ui(null)).pipe(N0()).subscribe(c=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let c=[...this.links.toArray(),this.link].filter(m=>!!m).map(m=>m.onChanges);this.linkInputChangesSubscription=ha(c).pipe(N0()).subscribe(m=>{this._isActive!==this.isLinkActive(this.router)(m)&&this.update()})}set routerLinkActive(c){let m=Array.isArray(c)?c:c.split(" ");this.classes=m.filter(r=>!!r)}ngOnChanges(c){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let c=this.hasActiveLinks();this.classes.forEach(m=>{c?this.renderer.addClass(this.element.nativeElement,m):this.renderer.removeClass(this.element.nativeElement,m)}),c&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this._isActive!==c&&(this._isActive=c,this.cdr.markForCheck(),this.isActiveChange.emit(c))})}isLinkActive(c){let m=vO(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return r=>{let M=r.urlTree;return M?c.isActive(M,m):!1}}hasActiveLinks(){let c=this.isLinkActive(this.router);return this.link&&c(this.link)||this.links.some(c)}};l.\u0275fac=function(m){return new(m||l)(Oe(cp),Oe(zi),Oe(Xh),Oe(Pr),Oe(_b,8))},l.\u0275dir=Qi({type:l,selectors:[["","routerLinkActive",""]],contentQueries:function(m,r,M){if(m&1&&Ea(M,_b,5),m&2){let z;bn(z=yn())&&(r.links=z)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[jr]});let g=l;return g})();function vO(g){return!!g.paths}var xO=new hi("");function YI(g,...l){return Eu([{provide:Qv,multi:!0,useValue:g},[],{provide:Nu,useFactory:wO,deps:[cp]},{provide:Y0,multi:!0,useFactory:CO},l.map(w=>w.\u0275providers)])}function wO(g){return g.routerState.root}function CO(){let g=$t(yd);return l=>{let w=g.get(Kh);if(l!==w.components[0])return;let c=g.get(cp),m=g.get(TO);g.get(EO)===1&&c.initialNavigation(),g.get(IO,null,H0.Optional)?.setUpPreloading(),g.get(xO,null,H0.Optional)?.init(),c.resetRootComponentType(w.componentTypes[0]),m.closed||(m.next(),m.complete(),m.unsubscribe())}}var TO=new hi("",{factory:()=>new Gi}),EO=new hi("",{providedIn:"root",factory:()=>1});var IO=new hi("");var fx=pE(KI()),ES=pE(QI());var Cd={production:!1,apiUrl:"",mapbox:{accessToken:"pk.eyJ1IjoibWFyb29uZWRpb25lIiwiYSI6ImNqdmp0MzB1azBpcDAzem1naHZwMjNndGIifQ.65nvvRg9QeFUV2c6b9W4Vw"},yandex:{rasp:{api:{key:"9ae678fa-547f-46fd-8419-5d54d5f57cdd",url:"https://api.rasp.yandex.net/v3.0/search/?"},suggests:{url:"https://suggests.rasp.yandex.net/all_suggests?format=old&part="}}},proxy:{url:"https://corsproxy.io/?"}};var aS=(()=>{let l=class l{constructor(c,m){this._renderer=c,this._elementRef=m,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(c,m){this._renderer.setProperty(this._elementRef.nativeElement,c,m)}registerOnTouched(c){this.onTouched=c}registerOnChange(c){this.onChange=c}setDisabledState(c){this.setProperty("disabled",c)}};l.\u0275fac=function(m){return new(m||l)(Oe(Xh),Oe(zi))},l.\u0275dir=Qi({type:l});let g=l;return g})(),sS=(()=>{let l=class l extends aS{};l.\u0275fac=(()=>{let c;return function(r){return(c||(c=Ql(l)))(r||l)}})(),l.\u0275dir=Qi({type:l,features:[so]});let g=l;return g})(),Vu=new hi("");var MO={provide:Vu,useExisting:os(()=>hp),multi:!0};function AO(){let g=Qh()?Qh().getUserAgent():"";return/android (\d+)/.test(g.toLowerCase())}var DO=new hi(""),hp=(()=>{let l=class l extends aS{constructor(c,m,r){super(c,m),this._compositionMode=r,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!AO())}writeValue(c){let m=c??"";this.setProperty("value",m)}_handleInput(c){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(c)}_compositionStart(){this._composing=!0}_compositionEnd(c){this._composing=!1,this._compositionMode&&this.onChange(c)}};l.\u0275fac=function(m){return new(m||l)(Oe(Xh),Oe(zi),Oe(DO,8))},l.\u0275dir=Qi({type:l,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(m,r){m&1&&Vi("input",function(z){return r._handleInput(z.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(z){return r._compositionEnd(z.target.value)})},features:[Fr([MO]),so]});let g=l;return g})();function Td(g){return g==null||(typeof g=="string"||Array.isArray(g))&&g.length===0}function lS(g){return g!=null&&typeof g.length=="number"}var ju=new hi(""),ax=new hi(""),kO=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,up=class{static min(l){return RO(l)}static max(l){return PO(l)}static required(l){return OO(l)}static requiredTrue(l){return FO(l)}static email(l){return LO(l)}static minLength(l){return zO(l)}static maxLength(l){return NO(l)}static pattern(l){return BO(l)}static nullValidator(l){return cS(l)}static compose(l){return fS(l)}static composeAsync(l){return gS(l)}};function RO(g){return l=>{if(Td(l.value)||Td(g))return null;let w=parseFloat(l.value);return!isNaN(w)&&w<g?{min:{min:g,actual:l.value}}:null}}function PO(g){return l=>{if(Td(l.value)||Td(g))return null;let w=parseFloat(l.value);return!isNaN(w)&&w>g?{max:{max:g,actual:l.value}}:null}}function OO(g){return Td(g.value)?{required:!0}:null}function FO(g){return g.value===!0?null:{required:!0}}function LO(g){return Td(g.value)||kO.test(g.value)?null:{email:!0}}function zO(g){return l=>Td(l.value)||!lS(l.value)?null:l.value.length<g?{minlength:{requiredLength:g,actualLength:l.value.length}}:null}function NO(g){return l=>lS(l.value)&&l.value.length>g?{maxlength:{requiredLength:g,actualLength:l.value.length}}:null}function BO(g){if(!g)return cS;let l,w;return typeof g=="string"?(w="",g.charAt(0)!=="^"&&(w+="^"),w+=g,g.charAt(g.length-1)!=="$"&&(w+="$"),l=new RegExp(w)):(w=g.toString(),l=g),c=>{if(Td(c.value))return null;let m=c.value;return l.test(m)?null:{pattern:{requiredPattern:w,actualValue:m}}}}function cS(g){return null}function dS(g){return g!=null}function uS(g){return G_(g)?ha(g):g}function hS(g){let l={};return g.forEach(w=>{l=w!=null?Ht(Ht({},l),w):l}),Object.keys(l).length===0?null:l}function pS(g,l){return l.map(w=>w(g))}function VO(g){return!g.validate}function mS(g){return g.map(l=>VO(l)?l:w=>l.validate(w))}function fS(g){if(!g)return null;let l=g.filter(dS);return l.length==0?null:function(w){return hS(pS(w,l))}}function sx(g){return g!=null?fS(mS(g)):null}function gS(g){if(!g)return null;let l=g.filter(dS);return l.length==0?null:function(w){let c=pS(w,l).map(uS);return O_(c).pipe(ln(hS))}}function lx(g){return g!=null?gS(mS(g)):null}function JI(g,l){return g===null?[l]:Array.isArray(g)?[...g,l]:[g,l]}function _S(g){return g._rawValidators}function bS(g){return g._rawAsyncValidators}function rx(g){return g?Array.isArray(g)?g:[g]:[]}function xb(g,l){return Array.isArray(g)?g.includes(l):g===l}function eS(g,l){let w=rx(l);return rx(g).forEach(m=>{xb(w,m)||w.push(m)}),w}function tS(g,l){return rx(l).filter(w=>!xb(g,w))}var wb=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(l){this._rawValidators=l||[],this._composedValidatorFn=sx(this._rawValidators)}_setAsyncValidators(l){this._rawAsyncValidators=l||[],this._composedAsyncValidatorFn=lx(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(l){this._onDestroyCallbacks.push(l)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(l=>l()),this._onDestroyCallbacks=[]}reset(l=void 0){this.control&&this.control.reset(l)}hasError(l,w){return this.control?this.control.hasError(l,w):!1}getError(l,w){return this.control?this.control.getError(l,w):null}},Bu=class extends wb{get formDirective(){return null}get path(){return null}},Ed=class extends wb{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},ox=class{constructor(l){this._cd=l}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},jO={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},jB=Ar(Ht({},jO),{"[class.ng-submitted]":"isSubmitted"}),Mb=(()=>{let l=class l extends ox{constructor(c){super(c)}};l.\u0275fac=function(m){return new(m||l)(Oe(Ed,2))},l.\u0275dir=Qi({type:l,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(m,r){m&2&&Tn("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[so]});let g=l;return g})();var Df="VALID",vb="INVALID",dp="PENDING",kf="DISABLED";function yS(g){return(Ab(g)?g.validators:g)||null}function UO(g){return Array.isArray(g)?sx(g):g||null}function vS(g,l){return(Ab(l)?l.asyncValidators:g)||null}function GO(g){return Array.isArray(g)?lx(g):g||null}function Ab(g){return g!=null&&!Array.isArray(g)&&typeof g=="object"}function HO(g,l,w){let c=g.controls;if(!(l?Object.keys(c):c).length)throw new fr(1e3,"");if(!c[w])throw new fr(1001,"")}function $O(g,l,w){g._forEachChild((c,m)=>{if(w[m]===void 0)throw new fr(1002,"")})}var Cb=class{constructor(l,w){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(l),this._assignAsyncValidators(w)}get validator(){return this._composedValidatorFn}set validator(l){this._rawValidators=this._composedValidatorFn=l}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(l){this._rawAsyncValidators=this._composedAsyncValidatorFn=l}get parent(){return this._parent}get valid(){return this.status===Df}get invalid(){return this.status===vb}get pending(){return this.status==dp}get disabled(){return this.status===kf}get enabled(){return this.status!==kf}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(l){this._assignValidators(l)}setAsyncValidators(l){this._assignAsyncValidators(l)}addValidators(l){this.setValidators(eS(l,this._rawValidators))}addAsyncValidators(l){this.setAsyncValidators(eS(l,this._rawAsyncValidators))}removeValidators(l){this.setValidators(tS(l,this._rawValidators))}removeAsyncValidators(l){this.setAsyncValidators(tS(l,this._rawAsyncValidators))}hasValidator(l){return xb(this._rawValidators,l)}hasAsyncValidator(l){return xb(this._rawAsyncValidators,l)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(l={}){this.touched=!0,this._parent&&!l.onlySelf&&this._parent.markAsTouched(l)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(l=>l.markAllAsTouched())}markAsUntouched(l={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(w=>{w.markAsUntouched({onlySelf:!0})}),this._parent&&!l.onlySelf&&this._parent._updateTouched(l)}markAsDirty(l={}){this.pristine=!1,this._parent&&!l.onlySelf&&this._parent.markAsDirty(l)}markAsPristine(l={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(w=>{w.markAsPristine({onlySelf:!0})}),this._parent&&!l.onlySelf&&this._parent._updatePristine(l)}markAsPending(l={}){this.status=dp,l.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!l.onlySelf&&this._parent.markAsPending(l)}disable(l={}){let w=this._parentMarkedDirty(l.onlySelf);this.status=kf,this.errors=null,this._forEachChild(c=>{c.disable(Ar(Ht({},l),{onlySelf:!0}))}),this._updateValue(),l.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Ar(Ht({},l),{skipPristineCheck:w})),this._onDisabledChange.forEach(c=>c(!0))}enable(l={}){let w=this._parentMarkedDirty(l.onlySelf);this.status=Df,this._forEachChild(c=>{c.enable(Ar(Ht({},l),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:l.emitEvent}),this._updateAncestors(Ar(Ht({},l),{skipPristineCheck:w})),this._onDisabledChange.forEach(c=>c(!1))}_updateAncestors(l){this._parent&&!l.onlySelf&&(this._parent.updateValueAndValidity(l),l.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(l){this._parent=l}getRawValue(){return this.value}updateValueAndValidity(l={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Df||this.status===dp)&&this._runAsyncValidator(l.emitEvent)),l.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!l.onlySelf&&this._parent.updateValueAndValidity(l)}_updateTreeValidity(l={emitEvent:!0}){this._forEachChild(w=>w._updateTreeValidity(l)),this.updateValueAndValidity({onlySelf:!0,emitEvent:l.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?kf:Df}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(l){if(this.asyncValidator){this.status=dp,this._hasOwnPendingAsyncValidator=!0;let w=uS(this.asyncValidator(this));this._asyncValidationSubscription=w.subscribe(c=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(c,{emitEvent:l})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(l,w={}){this.errors=l,this._updateControlsErrors(w.emitEvent!==!1)}get(l){let w=l;return w==null||(Array.isArray(w)||(w=w.split(".")),w.length===0)?null:w.reduce((c,m)=>c&&c._find(m),this)}getError(l,w){let c=w?this.get(w):this;return c&&c.errors?c.errors[l]:null}hasError(l,w){return!!this.getError(l,w)}get root(){let l=this;for(;l._parent;)l=l._parent;return l}_updateControlsErrors(l){this.status=this._calculateStatus(),l&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(l)}_initObservables(){this.valueChanges=new fi,this.statusChanges=new fi}_calculateStatus(){return this._allControlsDisabled()?kf:this.errors?vb:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(dp)?dp:this._anyControlsHaveStatus(vb)?vb:Df}_anyControlsHaveStatus(l){return this._anyControls(w=>w.status===l)}_anyControlsDirty(){return this._anyControls(l=>l.dirty)}_anyControlsTouched(){return this._anyControls(l=>l.touched)}_updatePristine(l={}){this.pristine=!this._anyControlsDirty(),this._parent&&!l.onlySelf&&this._parent._updatePristine(l)}_updateTouched(l={}){this.touched=this._anyControlsTouched(),this._parent&&!l.onlySelf&&this._parent._updateTouched(l)}_registerOnCollectionChange(l){this._onCollectionChange=l}_setUpdateStrategy(l){Ab(l)&&l.updateOn!=null&&(this._updateOn=l.updateOn)}_parentMarkedDirty(l){let w=this._parent&&this._parent.dirty;return!l&&!!w&&!this._parent._anyControlsDirty()}_find(l){return null}_assignValidators(l){this._rawValidators=Array.isArray(l)?l.slice():l,this._composedValidatorFn=UO(this._rawValidators)}_assignAsyncValidators(l){this._rawAsyncValidators=Array.isArray(l)?l.slice():l,this._composedAsyncValidatorFn=GO(this._rawAsyncValidators)}},Tb=class extends Cb{constructor(l,w,c){super(yS(w),vS(c,w)),this.controls=l,this._initObservables(),this._setUpdateStrategy(w),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(l,w){return this.controls[l]?this.controls[l]:(this.controls[l]=w,w.setParent(this),w._registerOnCollectionChange(this._onCollectionChange),w)}addControl(l,w,c={}){this.registerControl(l,w),this.updateValueAndValidity({emitEvent:c.emitEvent}),this._onCollectionChange()}removeControl(l,w={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),delete this.controls[l],this.updateValueAndValidity({emitEvent:w.emitEvent}),this._onCollectionChange()}setControl(l,w,c={}){this.controls[l]&&this.controls[l]._registerOnCollectionChange(()=>{}),delete this.controls[l],w&&this.registerControl(l,w),this.updateValueAndValidity({emitEvent:c.emitEvent}),this._onCollectionChange()}contains(l){return this.controls.hasOwnProperty(l)&&this.controls[l].enabled}setValue(l,w={}){$O(this,!0,l),Object.keys(l).forEach(c=>{HO(this,!0,c),this.controls[c].setValue(l[c],{onlySelf:!0,emitEvent:w.emitEvent})}),this.updateValueAndValidity(w)}patchValue(l,w={}){l!=null&&(Object.keys(l).forEach(c=>{let m=this.controls[c];m&&m.patchValue(l[c],{onlySelf:!0,emitEvent:w.emitEvent})}),this.updateValueAndValidity(w))}reset(l={},w={}){this._forEachChild((c,m)=>{c.reset(l?l[m]:null,{onlySelf:!0,emitEvent:w.emitEvent})}),this._updatePristine(w),this._updateTouched(w),this.updateValueAndValidity(w)}getRawValue(){return this._reduceChildren({},(l,w,c)=>(l[c]=w.getRawValue(),l))}_syncPendingControls(){let l=this._reduceChildren(!1,(w,c)=>c._syncPendingControls()?!0:w);return l&&this.updateValueAndValidity({onlySelf:!0}),l}_forEachChild(l){Object.keys(this.controls).forEach(w=>{let c=this.controls[w];c&&l(c,w)})}_setUpControls(){this._forEachChild(l=>{l.setParent(this),l._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(l){for(let[w,c]of Object.entries(this.controls))if(this.contains(w)&&l(c))return!0;return!1}_reduceValue(){let l={};return this._reduceChildren(l,(w,c,m)=>((c.enabled||this.disabled)&&(w[m]=c.value),w))}_reduceChildren(l,w){let c=l;return this._forEachChild((m,r)=>{c=w(c,m,r)}),c}_allControlsDisabled(){for(let l of Object.keys(this.controls))if(this.controls[l].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(l){return this.controls.hasOwnProperty(l)?this.controls[l]:null}};var Db=new hi("CallSetDisabledState",{providedIn:"root",factory:()=>cx}),cx="always";function qO(g,l){return[...l.path,g]}function Eb(g,l,w=cx){dx(g,l),l.valueAccessor.writeValue(g.value),(g.disabled||w==="always")&&l.valueAccessor.setDisabledState?.(g.disabled),ZO(g,l),XO(g,l),YO(g,l),WO(g,l)}function iS(g,l,w=!0){let c=()=>{};l.valueAccessor&&(l.valueAccessor.registerOnChange(c),l.valueAccessor.registerOnTouched(c)),Sb(g,l),g&&(l._invokeOnDestroyCallbacks(),g._registerOnCollectionChange(()=>{}))}function Ib(g,l){g.forEach(w=>{w.registerOnValidatorChange&&w.registerOnValidatorChange(l)})}function WO(g,l){if(l.valueAccessor.setDisabledState){let w=c=>{l.valueAccessor.setDisabledState(c)};g.registerOnDisabledChange(w),l._registerOnDestroy(()=>{g._unregisterOnDisabledChange(w)})}}function dx(g,l){let w=_S(g);l.validator!==null?g.setValidators(JI(w,l.validator)):typeof w=="function"&&g.setValidators([w]);let c=bS(g);l.asyncValidator!==null?g.setAsyncValidators(JI(c,l.asyncValidator)):typeof c=="function"&&g.setAsyncValidators([c]);let m=()=>g.updateValueAndValidity();Ib(l._rawValidators,m),Ib(l._rawAsyncValidators,m)}function Sb(g,l){let w=!1;if(g!==null){if(l.validator!==null){let m=_S(g);if(Array.isArray(m)&&m.length>0){let r=m.filter(M=>M!==l.validator);r.length!==m.length&&(w=!0,g.setValidators(r))}}if(l.asyncValidator!==null){let m=bS(g);if(Array.isArray(m)&&m.length>0){let r=m.filter(M=>M!==l.asyncValidator);r.length!==m.length&&(w=!0,g.setAsyncValidators(r))}}}let c=()=>{};return Ib(l._rawValidators,c),Ib(l._rawAsyncValidators,c),w}function ZO(g,l){l.valueAccessor.registerOnChange(w=>{g._pendingValue=w,g._pendingChange=!0,g._pendingDirty=!0,g.updateOn==="change"&&xS(g,l)})}function YO(g,l){l.valueAccessor.registerOnTouched(()=>{g._pendingTouched=!0,g.updateOn==="blur"&&g._pendingChange&&xS(g,l),g.updateOn!=="submit"&&g.markAsTouched()})}function xS(g,l){g._pendingDirty&&g.markAsDirty(),g.setValue(g._pendingValue,{emitModelToViewChange:!1}),l.viewToModelUpdate(g._pendingValue),g._pendingChange=!1}function XO(g,l){let w=(c,m)=>{l.valueAccessor.writeValue(c),m&&l.viewToModelUpdate(c)};g.registerOnChange(w),l._registerOnDestroy(()=>{g._unregisterOnChange(w)})}function wS(g,l){g==null,dx(g,l)}function KO(g,l){return Sb(g,l)}function QO(g,l){if(!g.hasOwnProperty("model"))return!1;let w=g.model;return w.isFirstChange()?!0:!Object.is(l,w.currentValue)}function JO(g){return Object.getPrototypeOf(g.constructor)===sS}function CS(g,l){g._syncPendingControls(),l.forEach(w=>{let c=w.control;c.updateOn==="submit"&&c._pendingChange&&(w.viewToModelUpdate(c._pendingValue),c._pendingChange=!1)})}function eF(g,l){if(!l)return null;Array.isArray(l);let w,c,m;return l.forEach(r=>{r.constructor===hp?w=r:JO(r)?c=r:m=r}),m||c||w||null}function tF(g,l){let w=g.indexOf(l);w>-1&&g.splice(w,1)}var iF={provide:Bu,useExisting:os(()=>ux)},Rf=Promise.resolve(),ux=(()=>{let l=class l extends Bu{constructor(c,m,r){super(),this.callSetDisabledState=r,this.submitted=!1,this._directives=new Set,this.ngSubmit=new fi,this.form=new Tb({},sx(c),lx(m))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(c){Rf.then(()=>{let m=this._findContainer(c.path);c.control=m.registerControl(c.name,c.control),Eb(c.control,c,this.callSetDisabledState),c.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(c)})}getControl(c){return this.form.get(c.path)}removeControl(c){Rf.then(()=>{let m=this._findContainer(c.path);m&&m.removeControl(c.name),this._directives.delete(c)})}addFormGroup(c){Rf.then(()=>{let m=this._findContainer(c.path),r=new Tb({});wS(r,c),m.registerControl(c.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(c){Rf.then(()=>{let m=this._findContainer(c.path);m&&m.removeControl(c.name)})}getFormGroup(c){return this.form.get(c.path)}updateModel(c,m){Rf.then(()=>{this.form.get(c.path).setValue(m)})}setValue(c){this.control.setValue(c)}onSubmit(c){return this.submitted=!0,CS(this.form,this._directives),this.ngSubmit.emit(c),c?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(c=void 0){this.form.reset(c),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(c){return c.pop(),c.length?this.form.get(c):this.form}};l.\u0275fac=function(m){return new(m||l)(Oe(ju,10),Oe(ax,10),Oe(Db,8))},l.\u0275dir=Qi({type:l,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(m,r){m&1&&Vi("submit",function(z){return r.onSubmit(z)})("reset",function(){return r.onReset()})},inputs:{options:[Jt.None,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Fr([iF]),so]});let g=l;return g})();function nS(g,l){let w=g.indexOf(l);w>-1&&g.splice(w,1)}function rS(g){return typeof g=="object"&&g!==null&&Object.keys(g).length===2&&"value"in g&&"disabled"in g}var TS=class extends Cb{constructor(l=null,w,c){super(yS(w),vS(c,w)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(l),this._setUpdateStrategy(w),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Ab(w)&&(w.nonNullable||w.initialValueIsDefault)&&(rS(l)?this.defaultValue=l.value:this.defaultValue=l)}setValue(l,w={}){this.value=this._pendingValue=l,this._onChange.length&&w.emitModelToViewChange!==!1&&this._onChange.forEach(c=>c(this.value,w.emitViewToModelChange!==!1)),this.updateValueAndValidity(w)}patchValue(l,w={}){this.setValue(l,w)}reset(l=this.defaultValue,w={}){this._applyFormState(l),this.markAsPristine(w),this.markAsUntouched(w),this.setValue(this.value,w),this._pendingChange=!1}_updateValue(){}_anyControls(l){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(l){this._onChange.push(l)}_unregisterOnChange(l){nS(this._onChange,l)}registerOnDisabledChange(l){this._onDisabledChange.push(l)}_unregisterOnDisabledChange(l){nS(this._onDisabledChange,l)}_forEachChild(l){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(l){rS(l)?(this.value=this._pendingValue=l.value,l.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=l}};var nF=g=>g instanceof TS;var rF={provide:Ed,useExisting:os(()=>Pf)},oS=Promise.resolve(),Pf=(()=>{let l=class l extends Ed{constructor(c,m,r,M,z,ie){super(),this._changeDetectorRef=z,this.callSetDisabledState=ie,this.control=new TS,this._registered=!1,this.name="",this.update=new fi,this._parent=c,this._setValidators(m),this._setAsyncValidators(r),this.valueAccessor=eF(this,M)}ngOnChanges(c){if(this._checkForErrors(),!this._registered||"name"in c){if(this._registered&&(this._checkName(),this.formDirective)){let m=c.name.previousValue;this.formDirective.removeControl({name:m,path:this._getPath(m)})}this._setUpControl()}"isDisabled"in c&&this._updateDisabled(c),QO(c,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(c){this.viewModel=c,this.update.emit(c)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){Eb(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(c){oS.then(()=>{this.control.setValue(c,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(c){let m=c.isDisabled.currentValue,r=m!==0&&pn(m);oS.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(c){return this._parent?qO(c,this._parent):[c]}};l.\u0275fac=function(m){return new(m||l)(Oe(Bu,9),Oe(ju,10),Oe(ax,10),Oe(Vu,10),Oe(Pr,8),Oe(Db,8))},l.\u0275dir=Qi({type:l,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[Jt.None,"disabled","isDisabled"],model:[Jt.None,"ngModel","model"],options:[Jt.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Fr([rF]),so,jr]});let g=l;return g})();var oF={provide:Vu,useExisting:os(()=>hx),multi:!0},hx=(()=>{let l=class l extends sS{writeValue(c){let m=c??"";this.setProperty("value",m)}registerOnChange(c){this.onChange=m=>{c(m==""?null:parseFloat(m))}}};l.\u0275fac=(()=>{let c;return function(r){return(c||(c=Ql(l)))(r||l)}})(),l.\u0275dir=Qi({type:l,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(m,r){m&1&&Vi("input",function(z){return r.onChange(z.target.value)})("blur",function(){return r.onTouched()})},features:[Fr([oF]),so]});let g=l;return g})();var aF={provide:Bu,useExisting:os(()=>px)},px=(()=>{let l=class l extends Bu{constructor(c,m,r){super(),this.callSetDisabledState=r,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new fi,this._setValidators(c),this._setAsyncValidators(m)}ngOnChanges(c){this._checkFormPresent(),c.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Sb(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(c){let m=this.form.get(c.path);return Eb(m,c,this.callSetDisabledState),m.updateValueAndValidity({emitEvent:!1}),this.directives.push(c),m}getControl(c){return this.form.get(c.path)}removeControl(c){iS(c.control||null,c,!1),tF(this.directives,c)}addFormGroup(c){this._setUpFormContainer(c)}removeFormGroup(c){this._cleanUpFormContainer(c)}getFormGroup(c){return this.form.get(c.path)}addFormArray(c){this._setUpFormContainer(c)}removeFormArray(c){this._cleanUpFormContainer(c)}getFormArray(c){return this.form.get(c.path)}updateModel(c,m){this.form.get(c.path).setValue(m)}onSubmit(c){return this.submitted=!0,CS(this.form,this.directives),this.ngSubmit.emit(c),c?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(c=void 0){this.form.reset(c),this.submitted=!1}_updateDomValue(){this.directives.forEach(c=>{let m=c.control,r=this.form.get(c.path);m!==r&&(iS(m||null,c),nF(r)&&(Eb(r,c,this.callSetDisabledState),c.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(c){let m=this.form.get(c.path);wS(m,c),m.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(c){if(this.form){let m=this.form.get(c.path);m&&KO(m,c)&&m.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){dx(this.form,this),this._oldForm&&Sb(this._oldForm,this)}_checkFormPresent(){this.form}};l.\u0275fac=function(m){return new(m||l)(Oe(ju,10),Oe(ax,10),Oe(Db,8))},l.\u0275dir=Qi({type:l,selectors:[["","formGroup",""]],hostBindings:function(m,r){m&1&&Vi("submit",function(z){return r.onSubmit(z)})("reset",function(){return r.onReset()})},inputs:{form:[Jt.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Fr([aF]),so,jr]});let g=l;return g})();var sF=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({});let g=l;return g})();var kb=(()=>{let l=class l{static withConfig(c){return{ngModule:l,providers:[{provide:Db,useValue:c.callSetDisabledState??cx}]}}};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({imports:[sF]});let g=l;return g})();var IS=(()=>{let l=class l{constructor(){this.polygon={hidden:!1,height:0},this.style="mapbox://styles/mapbox/streets-v11",this.zoom=8,this.lat=55.75,this.lng=37.62,fx.default.accessToken=Cd.mapbox.accessToken}ngOnInit(){this.initializeMap()}initializeMap(){this.map=new fx.default.Map({container:"map",style:this.style,center:[this.lng,this.lat],zoom:15.99,pitch:40,bearing:20,antialias:!0,attributionControl:!1}),this.map.on("load",()=>{this.addDrawControl()})}addDrawControl(){this.draw=new ES.default({displayControlsDefault:!0}),this.map.addControl(this.draw,"top-left"),this.map.on("draw.delete",c=>{console.log("delete");let m=c.features[0].id;this.map.removeLayer(m)}),this.map.on("draw.update",c=>{console.log("update");let m=c.features[0].id,r=this.draw.getAll().features,M=r.find(ie=>ie.id===m);if(console.log(M),M===void 0)throw new Error("undefined param received");let z=this.map.getSource(m);z.type==="geojson"&&z.setData({type:"FeatureCollection",features:r}),this.map.setPaintProperty(m,"fill-extrusion-height",this.polygon.height)}),this.map.on("draw.create",c=>{console.log("create");let m=c.features[0].id;this.map.addSource(m,{type:"geojson",data:{features:this.draw.getAll().features,type:"FeatureCollection"}}),this.map.addLayer({id:m,type:"fill-extrusion",source:m,paint:{"fill-extrusion-color":"orange","fill-extrusion-height":this.polygon.height,"fill-extrusion-base":0,"fill-extrusion-opacity":1}})})}};l.\u0275fac=function(m){return new(m||l)},l.\u0275cmp=kn({type:l,selectors:[["app-polygon-editor"]],standalone:!0,features:[Pn],decls:3,vars:2,consts:[["type","number","placeholder","height",1,"input-polygon-height",3,"ngModelChange","hidden","ngModel"],["id","map",1,"match-parent","map"]],template:function(m,r){m&1&&(vt(0,"section")(1,"input",0),bl("ngModelChange",function(z){return _l(r.polygon.height,z)||(r.polygon.height=z),z}),wt(),nn(2,"div",1),wt()),m&2&&(Ft(),Ni("hidden",r.polygon.hidden),gl("ngModel",r.polygon.height))},dependencies:[kb,hp,hx,Mb,Pf],styles:["section[_ngcontent-%COMP%]   div.match-parent[_ngcontent-%COMP%]{width:100%;height:calc(100vh - 48px)}section[_ngcontent-%COMP%]   input.input-polygon-height[_ngcontent-%COMP%]{position:absolute;z-index:1;width:100px;margin-top:200px;margin-left:10px}"]});let g=l;return g})();var lF=new hi("cdk-dir-doc",{providedIn:"root",factory:cF});function cF(){return $t(rn)}var dF=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function uF(g){let l=g?.toLowerCase()||"";return l==="auto"&&typeof navigator<"u"&&navigator?.language?dF.test(navigator.language)?"rtl":"ltr":l==="rtl"?"rtl":"ltr"}var Ds=(()=>{let l=class l{constructor(c){if(this.value="ltr",this.change=new fi,c){let m=c.body?c.body.dir:null,r=c.documentElement?c.documentElement.dir:null;this.value=uF(m||r||"ltr")}}ngOnDestroy(){this.change.complete()}};l.\u0275fac=function(m){return new(m||l)(bt(lF,8))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();var Id=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({});let g=l;return g})();var _x;try{_x=typeof Intl<"u"&&Intl.v8BreakIterator}catch{_x=!1}var Nn=(()=>{let l=class l{constructor(c){this._platformId=c,this.isBrowser=this._platformId?ZE(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||_x)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};l.\u0275fac=function(m){return new(m||l)(bt(Rc))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();var pp,SS=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function bx(){if(pp)return pp;if(typeof document!="object"||!document)return pp=new Set(SS),pp;let g=document.createElement("input");return pp=new Set(SS.filter(l=>(g.setAttribute("type",l),g.type===l))),pp}var Of;function hF(){if(Of==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Of=!0}))}finally{Of=Of||!1}return Of}function Ba(g){return hF()?g:!!g.capture}var Uu;function MS(){if(Uu==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return Uu=!1,Uu;if("scrollBehavior"in document.documentElement.style)Uu=!0;else{let g=Element.prototype.scrollTo;g?Uu=!/\{\s*\[native code\]\s*\}/.test(g.toString()):Uu=!1}}return Uu}var gx;function pF(){if(gx==null){let g=typeof document<"u"?document.head:null;gx=!!(g&&(g.createShadowRoot||g.attachShadow))}return gx}function AS(g){if(pF()){let l=g.getRootNode?g.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&l instanceof ShadowRoot)return l}return null}function Pb(){let g=typeof document<"u"&&document?document.activeElement:null;for(;g&&g.shadowRoot;){let l=g.shadowRoot.activeElement;if(l===g)break;g=l}return g}function vl(g){return g.composedPath?g.composedPath()[0]:g.target}function Ff(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}var yx=class{constructor(l){this._box=l,this._destroyed=new Gi,this._resizeSubject=new Gi,this._elementObservables=new Map,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(w=>this._resizeSubject.next(w)))}observe(l){return this._elementObservables.has(l)||this._elementObservables.set(l,new rs(w=>{let c=this._resizeSubject.subscribe(w);return this._resizeObserver?.observe(l,{box:this._box}),()=>{this._resizeObserver?.unobserve(l),c.unsubscribe(),this._elementObservables.delete(l)}}).pipe(eo(w=>w.some(c=>c.target===l)),G0({bufferSize:1,refCount:!0}),Wr(this._destroyed))),this._elementObservables.get(l)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}},DS=(()=>{let l=class l{constructor(){this._observers=new Map,this._ngZone=$t(yi),typeof ResizeObserver<"u"}ngOnDestroy(){for(let[,c]of this._observers)c.destroy();this._observers.clear(),typeof ResizeObserver<"u"}observe(c,m){let r=m?.box||"content-box";return this._observers.has(r)||this._observers.set(r,new yx(r)),this._observers.get(r).observe(c)}};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();function Gu(g){return g!=null&&`${g}`!="false"}function Lf(g,l=0){return mF(g)?Number(g):l}function mF(g){return!isNaN(parseFloat(g))&&!isNaN(Number(g))}function mp(g){return Array.isArray(g)?g:[g]}function lo(g){return g==null?"":typeof g=="string"?g:`${g}px`}function Va(g){return g instanceof zi?g.nativeElement:g}function kS(g,l=/\s+/){let w=[];if(g!=null){let c=Array.isArray(g)?g:`${g}`.split(l);for(let m of c){let r=`${m}`.trim();r&&w.push(r)}}return w}function fF(g){if(g.type==="characterData"&&g.target instanceof Comment)return!0;if(g.type==="childList"){for(let l=0;l<g.addedNodes.length;l++)if(!(g.addedNodes[l]instanceof Comment))return!1;for(let l=0;l<g.removedNodes.length;l++)if(!(g.removedNodes[l]instanceof Comment))return!1;return!0}return!1}var RS=(()=>{let l=class l{create(c){return typeof MutationObserver>"u"?null:new MutationObserver(c)}};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),gF=(()=>{let l=class l{constructor(c){this._mutationObserverFactory=c,this._observedElements=new Map}ngOnDestroy(){this._observedElements.forEach((c,m)=>this._cleanupObserver(m))}observe(c){let m=Va(c);return new rs(r=>{let z=this._observeElement(m).pipe(ln(ie=>ie.filter(ue=>!fF(ue))),eo(ie=>!!ie.length)).subscribe(r);return()=>{z.unsubscribe(),this._unobserveElement(m)}})}_observeElement(c){if(this._observedElements.has(c))this._observedElements.get(c).count++;else{let m=new Gi,r=this._mutationObserverFactory.create(M=>m.next(M));r&&r.observe(c,{characterData:!0,childList:!0,subtree:!0}),this._observedElements.set(c,{observer:r,stream:m,count:1})}return this._observedElements.get(c).stream}_unobserveElement(c){this._observedElements.has(c)&&(this._observedElements.get(c).count--,this._observedElements.get(c).count||this._cleanupObserver(c))}_cleanupObserver(c){if(this._observedElements.has(c)){let{observer:m,stream:r}=this._observedElements.get(c);m&&m.disconnect(),r.complete(),this._observedElements.delete(c)}}};l.\u0275fac=function(m){return new(m||l)(bt(RS))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),PS=(()=>{let l=class l{get disabled(){return this._disabled}set disabled(c){this._disabled=c,this._disabled?this._unsubscribe():this._subscribe()}get debounce(){return this._debounce}set debounce(c){this._debounce=Lf(c),this._subscribe()}constructor(c,m,r){this._contentObserver=c,this._elementRef=m,this._ngZone=r,this.event=new fi,this._disabled=!1,this._currentSubscription=null}ngAfterContentInit(){!this._currentSubscription&&!this.disabled&&this._subscribe()}ngOnDestroy(){this._unsubscribe()}_subscribe(){this._unsubscribe();let c=this._contentObserver.observe(this._elementRef);this._ngZone.runOutsideAngular(()=>{this._currentSubscription=(this.debounce?c.pipe(Hh(this.debounce)):c).subscribe(this.event)})}_unsubscribe(){this._currentSubscription?.unsubscribe()}};l.\u0275fac=function(m){return new(m||l)(Oe(gF),Oe(zi),Oe(yi))},l.\u0275dir=Qi({type:l,selectors:[["","cdkObserveContent",""]],inputs:{disabled:[Jt.HasDecoratorInputTransform,"cdkObserveContentDisabled","disabled",pn],debounce:"debounce"},outputs:{event:"cdkObserveContent"},exportAs:["cdkObserveContent"],standalone:!0,features:[xr]});let g=l;return g})(),Ob=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({providers:[RS]});let g=l;return g})();function xl(g,...l){return l.length?l.some(w=>g[w]):g.altKey||g.shiftKey||g.ctrlKey||g.metaKey}var OS=new Set,Hu,_F=(()=>{let l=class l{constructor(c,m){this._platform=c,this._nonce=m,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):yF}matchMedia(c){return(this._platform.WEBKIT||this._platform.BLINK)&&bF(c,this._nonce),this._matchMedia(c)}};l.\u0275fac=function(m){return new(m||l)(bt(Nn),bt(ef,8))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();function bF(g,l){if(!OS.has(g))try{Hu||(Hu=document.createElement("style"),l&&Hu.setAttribute("nonce",l),Hu.setAttribute("type","text/css"),document.head.appendChild(Hu)),Hu.sheet&&(Hu.sheet.insertRule(`@media ${g} {body{ }}`,0),OS.add(g))}catch(w){console.error(w)}}function yF(g){return{matches:g==="all"||g==="",media:g,addListener:()=>{},removeListener:()=>{}}}var LS=(()=>{let l=class l{constructor(c,m){this._mediaMatcher=c,this._zone=m,this._queries=new Map,this._destroySubject=new Gi}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(c){return FS(mp(c)).some(r=>this._registerQuery(r).mql.matches)}observe(c){let r=FS(mp(c)).map(z=>this._registerQuery(z).observable),M=Km(r);return M=P_(M.pipe(vo(1)),M.pipe($h(1),Hh(0))),M.pipe(ln(z=>{let ie={matches:!1,breakpoints:{}};return z.forEach(({matches:ue,query:ye})=>{ie.matches=ie.matches||ue,ie.breakpoints[ye]=ue}),ie}))}_registerQuery(c){if(this._queries.has(c))return this._queries.get(c);let m=this._mediaMatcher.matchMedia(c),M={observable:new rs(z=>{let ie=ue=>this._zone.run(()=>z.next(ue));return m.addListener(ie),()=>{m.removeListener(ie)}}).pipe(Es(m),ln(({matches:z})=>({query:c,matches:z})),Wr(this._destroySubject)),mql:m};return this._queries.set(c,M),M}};l.\u0275fac=function(m){return new(m||l)(bt(_F),bt(yi))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();function FS(g){return g.map(l=>l.split(",")).reduce((l,w)=>l.concat(w)).map(l=>l.trim())}var xx=class{constructor(l,w){this._items=l,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new Gi,this._typeaheadSubscription=qr.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._pageUpAndDown={enabled:!1,delta:10},this._skipPredicateFn=c=>c.disabled,this._pressedLetters=[],this.tabOut=new Gi,this.change=new Gi,l instanceof N_?this._itemChangesSubscription=l.changes.subscribe(c=>this._itemsChanged(c.toArray())):q0(l)&&(this._effectRef=jE(()=>this._itemsChanged(l()),{injector:w}))}skipPredicate(l){return this._skipPredicateFn=l,this}withWrap(l=!0){return this._wrap=l,this}withVerticalOrientation(l=!0){return this._vertical=l,this}withHorizontalOrientation(l){return this._horizontal=l,this}withAllowedModifierKeys(l){return this._allowedModifierKeys=l,this}withTypeAhead(l=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe(Zr(w=>this._pressedLetters.push(w)),Hh(l),eo(()=>this._pressedLetters.length>0),ln(()=>this._pressedLetters.join(""))).subscribe(w=>{let c=this._getItemsArray();for(let m=1;m<c.length+1;m++){let r=(this._activeItemIndex+m)%c.length,M=c[r];if(!this._skipPredicateFn(M)&&M.getLabel().toUpperCase().trim().indexOf(w)===0){this.setActiveItem(r);break}}this._pressedLetters=[]}),this}cancelTypeahead(){return this._pressedLetters=[],this}withHomeAndEnd(l=!0){return this._homeAndEnd=l,this}withPageUpDown(l=!0,w=10){return this._pageUpAndDown={enabled:l,delta:w},this}setActiveItem(l){let w=this._activeItem;this.updateActiveItem(l),this._activeItem!==w&&this.change.next(this._activeItemIndex)}onKeydown(l){let w=l.keyCode,m=["altKey","ctrlKey","metaKey","shiftKey"].every(r=>!l[r]||this._allowedModifierKeys.indexOf(r)>-1);switch(w){case 9:this.tabOut.next();return;case 40:if(this._vertical&&m){this.setNextItemActive();break}else return;case 38:if(this._vertical&&m){this.setPreviousItemActive();break}else return;case 39:if(this._horizontal&&m){this._horizontal==="rtl"?this.setPreviousItemActive():this.setNextItemActive();break}else return;case 37:if(this._horizontal&&m){this._horizontal==="rtl"?this.setNextItemActive():this.setPreviousItemActive();break}else return;case 36:if(this._homeAndEnd&&m){this.setFirstItemActive();break}else return;case 35:if(this._homeAndEnd&&m){this.setLastItemActive();break}else return;case 33:if(this._pageUpAndDown.enabled&&m){let r=this._activeItemIndex-this._pageUpAndDown.delta;this._setActiveItemByIndex(r>0?r:0,1);break}else return;case 34:if(this._pageUpAndDown.enabled&&m){let r=this._activeItemIndex+this._pageUpAndDown.delta,M=this._getItemsArray().length;this._setActiveItemByIndex(r<M?r:M-1,-1);break}else return;default:(m||xl(l,"shiftKey"))&&(l.key&&l.key.length===1?this._letterKeyStream.next(l.key.toLocaleUpperCase()):(w>=65&&w<=90||w>=48&&w<=57)&&this._letterKeyStream.next(String.fromCharCode(w)));return}this._pressedLetters=[],l.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._getItemsArray().length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(l){let w=this._getItemsArray(),c=typeof l=="number"?l:w.indexOf(l),m=w[c];this._activeItem=m??null,this._activeItemIndex=c}destroy(){this._typeaheadSubscription.unsubscribe(),this._itemChangesSubscription?.unsubscribe(),this._effectRef?.destroy(),this._letterKeyStream.complete(),this.tabOut.complete(),this.change.complete(),this._pressedLetters=[]}_setActiveItemByDelta(l){this._wrap?this._setActiveInWrapMode(l):this._setActiveInDefaultMode(l)}_setActiveInWrapMode(l){let w=this._getItemsArray();for(let c=1;c<=w.length;c++){let m=(this._activeItemIndex+l*c+w.length)%w.length,r=w[m];if(!this._skipPredicateFn(r)){this.setActiveItem(m);return}}}_setActiveInDefaultMode(l){this._setActiveItemByIndex(this._activeItemIndex+l,l)}_setActiveItemByIndex(l,w){let c=this._getItemsArray();if(c[l]){for(;this._skipPredicateFn(c[l]);)if(l+=w,!c[l])return;this.setActiveItem(l)}}_getItemsArray(){return q0(this._items)?this._items():this._items instanceof N_?this._items.toArray():this._items}_itemsChanged(l){if(this._activeItem){let w=l.indexOf(this._activeItem);w>-1&&w!==this._activeItemIndex&&(this._activeItemIndex=w)}}};var zb=class extends xx{constructor(){super(...arguments),this._origin="program"}setFocusOrigin(l){return this._origin=l,this}setActiveItem(l){super.setActiveItem(l),this.activeItem&&this.activeItem.focus(this._origin)}};var DF=(()=>{let l=class l{constructor(c){this._platform=c}isDisabled(c){return c.hasAttribute("disabled")}isVisible(c){return RF(c)&&getComputedStyle(c).visibility==="visible"}isTabbable(c){if(!this._platform.isBrowser)return!1;let m=kF(VF(c));if(m&&(zS(m)===-1||!this.isVisible(m)))return!1;let r=c.nodeName.toLowerCase(),M=zS(c);return c.hasAttribute("contenteditable")?M!==-1:r==="iframe"||r==="object"||this._platform.WEBKIT&&this._platform.IOS&&!NF(c)?!1:r==="audio"?c.hasAttribute("controls")?M!==-1:!1:r==="video"?M===-1?!1:M!==null?!0:this._platform.FIREFOX||c.hasAttribute("controls"):c.tabIndex>=0}isFocusable(c,m){return BF(c)&&!this.isDisabled(c)&&(m?.ignoreVisibility||this.isVisible(c))}};l.\u0275fac=function(m){return new(m||l)(bt(Nn))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();function kF(g){try{return g.frameElement}catch{return null}}function RF(g){return!!(g.offsetWidth||g.offsetHeight||typeof g.getClientRects=="function"&&g.getClientRects().length)}function PF(g){let l=g.nodeName.toLowerCase();return l==="input"||l==="select"||l==="button"||l==="textarea"}function OF(g){return LF(g)&&g.type=="hidden"}function FF(g){return zF(g)&&g.hasAttribute("href")}function LF(g){return g.nodeName.toLowerCase()=="input"}function zF(g){return g.nodeName.toLowerCase()=="a"}function VS(g){if(!g.hasAttribute("tabindex")||g.tabIndex===void 0)return!1;let l=g.getAttribute("tabindex");return!!(l&&!isNaN(parseInt(l,10)))}function zS(g){if(!VS(g))return null;let l=parseInt(g.getAttribute("tabindex")||"",10);return isNaN(l)?-1:l}function NF(g){let l=g.nodeName.toLowerCase(),w=l==="input"&&g.type;return w==="text"||w==="password"||l==="select"||l==="textarea"}function BF(g){return OF(g)?!1:PF(g)||FF(g)||g.hasAttribute("contenteditable")||VS(g)}function VF(g){return g.ownerDocument&&g.ownerDocument.defaultView||window}var wx=class{get enabled(){return this._enabled}set enabled(l){this._enabled=l,this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(l,this._startAnchor),this._toggleAnchorTabIndex(l,this._endAnchor))}constructor(l,w,c,m,r=!1){this._element=l,this._checker=w,this._ngZone=c,this._document=m,this._hasAttached=!1,this.startAnchorListener=()=>this.focusLastTabbableElement(),this.endAnchorListener=()=>this.focusFirstTabbableElement(),this._enabled=!0,r||this.attachAnchors()}destroy(){let l=this._startAnchor,w=this._endAnchor;l&&(l.removeEventListener("focus",this.startAnchorListener),l.remove()),w&&(w.removeEventListener("focus",this.endAnchorListener),w.remove()),this._startAnchor=this._endAnchor=null,this._hasAttached=!1}attachAnchors(){return this._hasAttached?!0:(this._ngZone.runOutsideAngular(()=>{this._startAnchor||(this._startAnchor=this._createAnchor(),this._startAnchor.addEventListener("focus",this.startAnchorListener)),this._endAnchor||(this._endAnchor=this._createAnchor(),this._endAnchor.addEventListener("focus",this.endAnchorListener))}),this._element.parentNode&&(this._element.parentNode.insertBefore(this._startAnchor,this._element),this._element.parentNode.insertBefore(this._endAnchor,this._element.nextSibling),this._hasAttached=!0),this._hasAttached)}focusInitialElementWhenReady(l){return new Promise(w=>{this._executeOnStable(()=>w(this.focusInitialElement(l)))})}focusFirstTabbableElementWhenReady(l){return new Promise(w=>{this._executeOnStable(()=>w(this.focusFirstTabbableElement(l)))})}focusLastTabbableElementWhenReady(l){return new Promise(w=>{this._executeOnStable(()=>w(this.focusLastTabbableElement(l)))})}_getRegionBoundary(l){let w=this._element.querySelectorAll(`[cdk-focus-region-${l}], [cdkFocusRegion${l}], [cdk-focus-${l}]`);return l=="start"?w.length?w[0]:this._getFirstTabbableElement(this._element):w.length?w[w.length-1]:this._getLastTabbableElement(this._element)}focusInitialElement(l){let w=this._element.querySelector("[cdk-focus-initial], [cdkFocusInitial]");if(w){if(!this._checker.isFocusable(w)){let c=this._getFirstTabbableElement(w);return c?.focus(l),!!c}return w.focus(l),!0}return this.focusFirstTabbableElement(l)}focusFirstTabbableElement(l){let w=this._getRegionBoundary("start");return w&&w.focus(l),!!w}focusLastTabbableElement(l){let w=this._getRegionBoundary("end");return w&&w.focus(l),!!w}hasAttached(){return this._hasAttached}_getFirstTabbableElement(l){if(this._checker.isFocusable(l)&&this._checker.isTabbable(l))return l;let w=l.children;for(let c=0;c<w.length;c++){let m=w[c].nodeType===this._document.ELEMENT_NODE?this._getFirstTabbableElement(w[c]):null;if(m)return m}return null}_getLastTabbableElement(l){if(this._checker.isFocusable(l)&&this._checker.isTabbable(l))return l;let w=l.children;for(let c=w.length-1;c>=0;c--){let m=w[c].nodeType===this._document.ELEMENT_NODE?this._getLastTabbableElement(w[c]):null;if(m)return m}return null}_createAnchor(){let l=this._document.createElement("div");return this._toggleAnchorTabIndex(this._enabled,l),l.classList.add("cdk-visually-hidden"),l.classList.add("cdk-focus-trap-anchor"),l.setAttribute("aria-hidden","true"),l}_toggleAnchorTabIndex(l,w){l?w.setAttribute("tabindex","0"):w.removeAttribute("tabindex")}toggleAnchors(l){this._startAnchor&&this._endAnchor&&(this._toggleAnchorTabIndex(l,this._startAnchor),this._toggleAnchorTabIndex(l,this._endAnchor))}_executeOnStable(l){this._ngZone.isStable?l():this._ngZone.onStable.pipe(vo(1)).subscribe(l)}},jF=(()=>{let l=class l{constructor(c,m,r){this._checker=c,this._ngZone=m,this._document=r}create(c,m=!1){return new wx(c,this._checker,this._ngZone,this._document,m)}};l.\u0275fac=function(m){return new(m||l)(bt(DF),bt(yi),bt(rn))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),jS=(()=>{let l=class l{get enabled(){return this.focusTrap?.enabled||!1}set enabled(c){this.focusTrap&&(this.focusTrap.enabled=c)}constructor(c,m,r){this._elementRef=c,this._focusTrapFactory=m,this._previouslyFocusedElement=null,$t(Nn).isBrowser&&(this.focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement,!0))}ngOnDestroy(){this.focusTrap?.destroy(),this._previouslyFocusedElement&&(this._previouslyFocusedElement.focus(),this._previouslyFocusedElement=null)}ngAfterContentInit(){this.focusTrap?.attachAnchors(),this.autoCapture&&this._captureFocus()}ngDoCheck(){this.focusTrap&&!this.focusTrap.hasAttached()&&this.focusTrap.attachAnchors()}ngOnChanges(c){let m=c.autoCapture;m&&!m.firstChange&&this.autoCapture&&this.focusTrap?.hasAttached()&&this._captureFocus()}_captureFocus(){this._previouslyFocusedElement=Pb(),this.focusTrap?.focusInitialElementWhenReady()}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(jF),Oe(rn))},l.\u0275dir=Qi({type:l,selectors:[["","cdkTrapFocus",""]],inputs:{enabled:[Jt.HasDecoratorInputTransform,"cdkTrapFocus","enabled",pn],autoCapture:[Jt.HasDecoratorInputTransform,"cdkTrapFocusAutoCapture","autoCapture",pn]},exportAs:["cdkTrapFocus"],standalone:!0,features:[xr,jr]});let g=l;return g})();function Cx(g){return g.buttons===0||g.detail===0}function Tx(g){let l=g.touches&&g.touches[0]||g.changedTouches&&g.changedTouches[0];return!!l&&l.identifier===-1&&(l.radiusX==null||l.radiusX===1)&&(l.radiusY==null||l.radiusY===1)}var UF=new hi("cdk-input-modality-detector-options"),GF={ignoreKeys:[18,17,224,91,16]},US=650,fp=Ba({passive:!0,capture:!0}),HF=(()=>{let l=class l{get mostRecentModality(){return this._modality.value}constructor(c,m,r,M){this._platform=c,this._mostRecentTarget=null,this._modality=new ua(null),this._lastTouchMs=0,this._onKeydown=z=>{this._options?.ignoreKeys?.some(ie=>ie===z.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=vl(z))},this._onMousedown=z=>{Date.now()-this._lastTouchMs<US||(this._modality.next(Cx(z)?"keyboard":"mouse"),this._mostRecentTarget=vl(z))},this._onTouchstart=z=>{if(Tx(z)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=vl(z)},this._options=Ht(Ht({},GF),M),this.modalityDetected=this._modality.pipe($h(1)),this.modalityChanged=this.modalityDetected.pipe(F_()),c.isBrowser&&m.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,fp),r.addEventListener("mousedown",this._onMousedown,fp),r.addEventListener("touchstart",this._onTouchstart,fp)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,fp),document.removeEventListener("mousedown",this._onMousedown,fp),document.removeEventListener("touchstart",this._onTouchstart,fp))}};l.\u0275fac=function(m){return new(m||l)(bt(Nn),bt(yi),bt(rn),bt(UF,8))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();var Lb=function(g){return g[g.IMMEDIATE=0]="IMMEDIATE",g[g.EVENTUAL=1]="EVENTUAL",g}(Lb||{}),$F=new hi("cdk-focus-monitor-default-options"),Fb=Ba({passive:!0,capture:!0}),Bf=(()=>{let l=class l{constructor(c,m,r,M,z){this._ngZone=c,this._platform=m,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Gi,this._rootNodeFocusAndBlurListener=ie=>{let ue=vl(ie);for(let ye=ue;ye;ye=ye.parentElement)ie.type==="focus"?this._onFocus(ie,ye):this._onBlur(ie,ye)},this._document=M,this._detectionMode=z?.detectionMode||Lb.IMMEDIATE}monitor(c,m=!1){let r=Va(c);if(!this._platform.isBrowser||r.nodeType!==1)return ui();let M=AS(r)||this._getDocument(),z=this._elementInfo.get(r);if(z)return m&&(z.checkChildren=!0),z.subject;let ie={checkChildren:m,subject:new Gi,rootNode:M};return this._elementInfo.set(r,ie),this._registerGlobalListeners(ie),ie.subject}stopMonitoring(c){let m=Va(c),r=this._elementInfo.get(m);r&&(r.subject.complete(),this._setClasses(m),this._elementInfo.delete(m),this._removeGlobalListeners(r))}focusVia(c,m,r){let M=Va(c),z=this._getDocument().activeElement;M===z?this._getClosestElementsInfo(M).forEach(([ie,ue])=>this._originChanged(ie,m,ue)):(this._setOrigin(m),typeof M.focus=="function"&&M.focus(r))}ngOnDestroy(){this._elementInfo.forEach((c,m)=>this.stopMonitoring(m))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(c){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(c)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:c&&this._isLastInteractionFromInputLabel(c)?"mouse":"program"}_shouldBeAttributedToTouch(c){return this._detectionMode===Lb.EVENTUAL||!!c?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(c,m){c.classList.toggle("cdk-focused",!!m),c.classList.toggle("cdk-touch-focused",m==="touch"),c.classList.toggle("cdk-keyboard-focused",m==="keyboard"),c.classList.toggle("cdk-mouse-focused",m==="mouse"),c.classList.toggle("cdk-program-focused",m==="program")}_setOrigin(c,m=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=c,this._originFromTouchInteraction=c==="touch"&&m,this._detectionMode===Lb.IMMEDIATE){clearTimeout(this._originTimeoutId);let r=this._originFromTouchInteraction?US:1;this._originTimeoutId=setTimeout(()=>this._origin=null,r)}})}_onFocus(c,m){let r=this._elementInfo.get(m),M=vl(c);!r||!r.checkChildren&&m!==M||this._originChanged(m,this._getFocusOrigin(M),r)}_onBlur(c,m){let r=this._elementInfo.get(m);!r||r.checkChildren&&c.relatedTarget instanceof Node&&m.contains(c.relatedTarget)||(this._setClasses(m),this._emitOrigin(r,null))}_emitOrigin(c,m){c.subject.observers.length&&this._ngZone.run(()=>c.subject.next(m))}_registerGlobalListeners(c){if(!this._platform.isBrowser)return;let m=c.rootNode,r=this._rootNodeFocusListenerCount.get(m)||0;r||this._ngZone.runOutsideAngular(()=>{m.addEventListener("focus",this._rootNodeFocusAndBlurListener,Fb),m.addEventListener("blur",this._rootNodeFocusAndBlurListener,Fb)}),this._rootNodeFocusListenerCount.set(m,r+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(Wr(this._stopInputModalityDetector)).subscribe(M=>{this._setOrigin(M,!0)}))}_removeGlobalListeners(c){let m=c.rootNode;if(this._rootNodeFocusListenerCount.has(m)){let r=this._rootNodeFocusListenerCount.get(m);r>1?this._rootNodeFocusListenerCount.set(m,r-1):(m.removeEventListener("focus",this._rootNodeFocusAndBlurListener,Fb),m.removeEventListener("blur",this._rootNodeFocusAndBlurListener,Fb),this._rootNodeFocusListenerCount.delete(m))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(c,m,r){this._setClasses(c,m),this._emitOrigin(r,m),this._lastFocusOrigin=m}_getClosestElementsInfo(c){let m=[];return this._elementInfo.forEach((r,M)=>{(M===c||r.checkChildren&&M.contains(c))&&m.push([M,r])}),m}_isLastInteractionFromInputLabel(c){let{_mostRecentTarget:m,mostRecentModality:r}=this._inputModalityDetector;if(r!=="mouse"||!m||m===c||c.nodeName!=="INPUT"&&c.nodeName!=="TEXTAREA"||c.disabled)return!1;let M=c.labels;if(M){for(let z=0;z<M.length;z++)if(M[z].contains(m))return!0}return!1}};l.\u0275fac=function(m){return new(m||l)(bt(yi),bt(Nn),bt(HF),bt(rn,8),bt($F,8))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),Ex=(()=>{let l=class l{constructor(c,m){this._elementRef=c,this._focusMonitor=m,this._focusOrigin=null,this.cdkFocusChange=new fi}get focusOrigin(){return this._focusOrigin}ngAfterViewInit(){let c=this._elementRef.nativeElement;this._monitorSubscription=this._focusMonitor.monitor(c,c.nodeType===1&&c.hasAttribute("cdkMonitorSubtreeFocus")).subscribe(m=>{this._focusOrigin=m,this.cdkFocusChange.emit(m)})}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._monitorSubscription&&this._monitorSubscription.unsubscribe()}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(Bf))},l.\u0275dir=Qi({type:l,selectors:[["","cdkMonitorElementFocus",""],["","cdkMonitorSubtreeFocus",""]],outputs:{cdkFocusChange:"cdkFocusChange"},exportAs:["cdkMonitorFocus"],standalone:!0});let g=l;return g})(),$u=function(g){return g[g.NONE=0]="NONE",g[g.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",g[g.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",g}($u||{}),NS="cdk-high-contrast-black-on-white",BS="cdk-high-contrast-white-on-black",vx="cdk-high-contrast-active",Ix=(()=>{let l=class l{constructor(c,m){this._platform=c,this._document=m,this._breakpointSubscription=$t(LS).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return $u.NONE;let c=this._document.createElement("div");c.style.backgroundColor="rgb(1,2,3)",c.style.position="absolute",this._document.body.appendChild(c);let m=this._document.defaultView||window,r=m&&m.getComputedStyle?m.getComputedStyle(c):null,M=(r&&r.backgroundColor||"").replace(/ /g,"");switch(c.remove(),M){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return $u.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return $u.BLACK_ON_WHITE}return $u.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let c=this._document.body.classList;c.remove(vx,NS,BS),this._hasCheckedHighContrastMode=!0;let m=this.getHighContrastMode();m===$u.BLACK_ON_WHITE?c.add(vx,NS):m===$u.WHITE_ON_BLACK&&c.add(vx,BS)}}};l.\u0275fac=function(m){return new(m||l)(bt(Nn),bt(rn))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),GS=(()=>{let l=class l{constructor(c){c._applyBodyHighContrastModeCssClasses()}};l.\u0275fac=function(m){return new(m||l)(bt(Ix))},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({imports:[Ob]});let g=l;return g})();var qF=["mat-internal-form-field",""],WF=["*"];function ZF(){return!0}var YF=new hi("mat-sanity-checks",{providedIn:"root",factory:ZF}),Dr=(()=>{let l=class l{constructor(c,m,r){this._sanityChecks=m,this._document=r,this._hasDoneGlobalChecks=!1,c._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(c){return Ff()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[c]}};l.\u0275fac=function(m){return new(m||l)(bt(Ix),bt(YF,8),bt(rn))},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({imports:[Id,Id]});let g=l;return g})();var vp=class{constructor(l,w,c,m,r){this._defaultMatcher=l,this.ngControl=w,this._parentFormGroup=c,this._parentForm=m,this._stateChanges=r,this.errorState=!1}updateErrorState(){let l=this.errorState,w=this._parentFormGroup||this._parentForm,c=this.matcher||this._defaultMatcher,m=this.ngControl?this.ngControl.control:null,r=c?.isErrorState(m,w)??!1;r!==l&&(this.errorState=r,this._stateChanges.next())}};var $S=new hi("MAT_DATE_LOCALE",{providedIn:"root",factory:XF});function XF(){return $t(BE)}var qo=class{constructor(){this._localeChanges=new Gi,this.localeChanges=this._localeChanges}getValidDateOrNull(l){return this.isDateInstance(l)&&this.isValid(l)?l:null}deserialize(l){return l==null||this.isDateInstance(l)&&this.isValid(l)?l:this.invalid()}setLocale(l){this.locale=l,this._localeChanges.next()}compareDate(l,w){return this.getYear(l)-this.getYear(w)||this.getMonth(l)-this.getMonth(w)||this.getDate(l)-this.getDate(w)}sameDate(l,w){if(l&&w){let c=this.isValid(l),m=this.isValid(w);return c&&m?!this.compareDate(l,w):c==m}return l==w}clampDate(l,w,c){return w&&this.compareDate(l,w)<0?w:c&&this.compareDate(l,c)>0?c:l}},Sd=new hi("mat-date-formats"),KF=/^\d{4}-\d{2}-\d{2}(?:T\d{2}:\d{2}:\d{2}(?:\.\d+)?(?:Z|(?:(?:\+|-)\d{2}:\d{2}))?)?$/;function Sx(g,l){let w=Array(g);for(let c=0;c<g;c++)w[c]=l(c);return w}var QF=(()=>{let l=class l extends qo{constructor(c){super(),this.useUtcForDisplay=!1,this._matDateLocale=$t($S,{optional:!0}),c!==void 0&&(this._matDateLocale=c),super.setLocale(this._matDateLocale)}getYear(c){return c.getFullYear()}getMonth(c){return c.getMonth()}getDate(c){return c.getDate()}getDayOfWeek(c){return c.getDay()}getMonthNames(c){let m=new Intl.DateTimeFormat(this.locale,{month:c,timeZone:"utc"});return Sx(12,r=>this._format(m,new Date(2017,r,1)))}getDateNames(){let c=new Intl.DateTimeFormat(this.locale,{day:"numeric",timeZone:"utc"});return Sx(31,m=>this._format(c,new Date(2017,0,m+1)))}getDayOfWeekNames(c){let m=new Intl.DateTimeFormat(this.locale,{weekday:c,timeZone:"utc"});return Sx(7,r=>this._format(m,new Date(2017,0,r+1)))}getYearName(c){let m=new Intl.DateTimeFormat(this.locale,{year:"numeric",timeZone:"utc"});return this._format(m,c)}getFirstDayOfWeek(){return 0}getNumDaysInMonth(c){return this.getDate(this._createDateWithOverflow(this.getYear(c),this.getMonth(c)+1,0))}clone(c){return new Date(c.getTime())}createDate(c,m,r){let M=this._createDateWithOverflow(c,m,r);return M.getMonth()!=m,M}today(){return new Date}parse(c,m){return typeof c=="number"?new Date(c):c?new Date(Date.parse(c)):null}format(c,m){if(!this.isValid(c))throw Error("NativeDateAdapter: Cannot format invalid date.");let r=new Intl.DateTimeFormat(this.locale,Ar(Ht({},m),{timeZone:"utc"}));return this._format(r,c)}addCalendarYears(c,m){return this.addCalendarMonths(c,m*12)}addCalendarMonths(c,m){let r=this._createDateWithOverflow(this.getYear(c),this.getMonth(c)+m,this.getDate(c));return this.getMonth(r)!=((this.getMonth(c)+m)%12+12)%12&&(r=this._createDateWithOverflow(this.getYear(r),this.getMonth(r),0)),r}addCalendarDays(c,m){return this._createDateWithOverflow(this.getYear(c),this.getMonth(c),this.getDate(c)+m)}toIso8601(c){return[c.getUTCFullYear(),this._2digit(c.getUTCMonth()+1),this._2digit(c.getUTCDate())].join("-")}deserialize(c){if(typeof c=="string"){if(!c)return null;if(KF.test(c)){let m=new Date(c);if(this.isValid(m))return m}}return super.deserialize(c)}isDateInstance(c){return c instanceof Date}isValid(c){return!isNaN(c.getTime())}invalid(){return new Date(NaN)}_createDateWithOverflow(c,m,r){let M=new Date;return M.setFullYear(c,m,r),M.setHours(0,0,0,0),M}_2digit(c){return("00"+c).slice(-2)}_format(c,m){let r=new Date;return r.setUTCFullYear(m.getFullYear(),m.getMonth(),m.getDate()),r.setUTCHours(m.getHours(),m.getMinutes(),m.getSeconds(),m.getMilliseconds()),c.format(r)}};l.\u0275fac=function(m){return new(m||l)(bt($S,8))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac});let g=l;return g})(),JF={parse:{dateInput:null},display:{dateInput:{year:"numeric",month:"numeric",day:"numeric"},monthYearLabel:{year:"numeric",month:"short"},dateA11yLabel:{year:"numeric",month:"long",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"long"}}};function eM(g=JF){return[{provide:qo,useClass:QF},{provide:Sd,useValue:g}]}var Px=(()=>{let l=class l{isErrorState(c,m){return!!(c&&c.invalid&&(c.touched||m&&m.submitted))}};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();var ks=function(g){return g[g.FADING_IN=0]="FADING_IN",g[g.VISIBLE=1]="VISIBLE",g[g.FADING_OUT=2]="FADING_OUT",g[g.HIDDEN=3]="HIDDEN",g}(ks||{}),Dx=class{constructor(l,w,c,m=!1){this._renderer=l,this.element=w,this.config=c,this._animationForciblyDisabledThroughCss=m,this.state=ks.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},qS=Ba({passive:!0,capture:!0}),kx=class{constructor(){this._events=new Map,this._delegateEventHandler=l=>{let w=vl(l);w&&this._events.get(l.type)?.forEach((c,m)=>{(m===w||m.contains(w))&&c.forEach(r=>r.handleEvent(l))})}}addHandler(l,w,c,m){let r=this._events.get(w);if(r){let M=r.get(c);M?M.add(m):r.set(c,new Set([m]))}else this._events.set(w,new Map([[c,new Set([m])]])),l.runOutsideAngular(()=>{document.addEventListener(w,this._delegateEventHandler,qS)})}removeHandler(l,w,c){let m=this._events.get(l);if(!m)return;let r=m.get(w);r&&(r.delete(c),r.size===0&&m.delete(w),m.size===0&&(this._events.delete(l),document.removeEventListener(l,this._delegateEventHandler,qS)))}},WS={enterDuration:225,exitDuration:150},eL=800,ZS=Ba({passive:!0,capture:!0}),YS=["mousedown","touchstart"],XS=["mouseup","mouseleave","touchend","touchcancel"],Vf=class Vf{constructor(l,w,c,m){this._target=l,this._ngZone=w,this._platform=m,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,m.isBrowser&&(this._containerElement=Va(c))}fadeInRipple(l,w,c={}){let m=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),r=Ht(Ht({},WS),c.animation);c.centered&&(l=m.left+m.width/2,w=m.top+m.height/2);let M=c.radius||tL(l,w,m),z=l-m.left,ie=w-m.top,ue=r.enterDuration,ye=document.createElement("div");ye.classList.add("mat-ripple-element"),ye.style.left=`${z-M}px`,ye.style.top=`${ie-M}px`,ye.style.height=`${M*2}px`,ye.style.width=`${M*2}px`,c.color!=null&&(ye.style.backgroundColor=c.color),ye.style.transitionDuration=`${ue}ms`,this._containerElement.appendChild(ye);let Je=window.getComputedStyle(ye),It=Je.transitionProperty,st=Je.transitionDuration,Xt=It==="none"||st==="0s"||st==="0s, 0s"||m.width===0&&m.height===0,Oi=new Dx(this,ye,c,Xt);ye.style.transform="scale3d(1, 1, 1)",Oi.state=ks.FADING_IN,c.persistent||(this._mostRecentTransientRipple=Oi);let vi=null;return!Xt&&(ue||r.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let Ti=()=>this._finishRippleTransition(Oi),xn=()=>this._destroyRipple(Oi);ye.addEventListener("transitionend",Ti),ye.addEventListener("transitioncancel",xn),vi={onTransitionEnd:Ti,onTransitionCancel:xn}}),this._activeRipples.set(Oi,vi),(Xt||!ue)&&this._finishRippleTransition(Oi),Oi}fadeOutRipple(l){if(l.state===ks.FADING_OUT||l.state===ks.HIDDEN)return;let w=l.element,c=Ht(Ht({},WS),l.config.animation);w.style.transitionDuration=`${c.exitDuration}ms`,w.style.opacity="0",l.state=ks.FADING_OUT,(l._animationForciblyDisabledThroughCss||!c.exitDuration)&&this._finishRippleTransition(l)}fadeOutAll(){this._getActiveRipples().forEach(l=>l.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(l=>{l.config.persistent||l.fadeOut()})}setupTriggerEvents(l){let w=Va(l);!this._platform.isBrowser||!w||w===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=w,YS.forEach(c=>{Vf._eventManager.addHandler(this._ngZone,c,w,this)}))}handleEvent(l){l.type==="mousedown"?this._onMousedown(l):l.type==="touchstart"?this._onTouchStart(l):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{XS.forEach(w=>{this._triggerElement.addEventListener(w,this,ZS)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(l){l.state===ks.FADING_IN?this._startFadeOutTransition(l):l.state===ks.FADING_OUT&&this._destroyRipple(l)}_startFadeOutTransition(l){let w=l===this._mostRecentTransientRipple,{persistent:c}=l.config;l.state=ks.VISIBLE,!c&&(!w||!this._isPointerDown)&&l.fadeOut()}_destroyRipple(l){let w=this._activeRipples.get(l)??null;this._activeRipples.delete(l),this._activeRipples.size||(this._containerRect=null),l===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),l.state=ks.HIDDEN,w!==null&&(l.element.removeEventListener("transitionend",w.onTransitionEnd),l.element.removeEventListener("transitioncancel",w.onTransitionCancel)),l.element.remove()}_onMousedown(l){let w=Cx(l),c=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+eL;!this._target.rippleDisabled&&!w&&!c&&(this._isPointerDown=!0,this.fadeInRipple(l.clientX,l.clientY,this._target.rippleConfig))}_onTouchStart(l){if(!this._target.rippleDisabled&&!Tx(l)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let w=l.changedTouches;if(w)for(let c=0;c<w.length;c++)this.fadeInRipple(w[c].clientX,w[c].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(l=>{let w=l.state===ks.VISIBLE||l.config.terminateOnPointerUp&&l.state===ks.FADING_IN;!l.config.persistent&&w&&l.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let l=this._triggerElement;l&&(YS.forEach(w=>Vf._eventManager.removeHandler(w,l,this)),this._pointerUpEventsRegistered&&XS.forEach(w=>l.removeEventListener(w,this,ZS)))}};Vf._eventManager=new kx;var Rx=Vf;function tL(g,l,w){let c=Math.max(Math.abs(g-w.left),Math.abs(g-w.right)),m=Math.max(Math.abs(l-w.top),Math.abs(l-w.bottom));return Math.sqrt(c*c+m*m)}var Bb=new hi("mat-ripple-global-options"),Zu=(()=>{let l=class l{get disabled(){return this._disabled}set disabled(c){c&&this.fadeOutAllNonPersistent(),this._disabled=c,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(c){this._trigger=c,this._setupTriggerEventsIfEnabled()}constructor(c,m,r,M,z){this._elementRef=c,this._animationMode=z,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=M||{},this._rippleRenderer=new Rx(this,m,c,r)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Ht(Ht(Ht({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(c,m=0,r){return typeof c=="number"?this._rippleRenderer.fadeInRipple(c,m,Ht(Ht({},this.rippleConfig),r)):this._rippleRenderer.fadeInRipple(0,0,Ht(Ht({},this.rippleConfig),c))}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(yi),Oe(Nn),Oe(Bb,8),Oe(xo,8))},l.\u0275dir=Qi({type:l,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(m,r){m&2&&Tn("mat-ripple-unbounded",r.unbounded)},inputs:{color:[Jt.None,"matRippleColor","color"],unbounded:[Jt.None,"matRippleUnbounded","unbounded"],centered:[Jt.None,"matRippleCentered","centered"],radius:[Jt.None,"matRippleRadius","radius"],animation:[Jt.None,"matRippleAnimation","animation"],disabled:[Jt.None,"matRippleDisabled","disabled"],trigger:[Jt.None,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0});let g=l;return g})(),jf=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({imports:[Dr,Dr]});let g=l;return g})();var iL=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({imports:[Dr]});let g=l;return g})();var Uf=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({imports:[jf,Dr,iL]});let g=l;return g})(),KS={capture:!0},QS=["focus","click","mouseenter","touchstart"],Mx="mat-ripple-loader-uninitialized",Ax="mat-ripple-loader-class-name",JS="mat-ripple-loader-centered",Nb="mat-ripple-loader-disabled",tM=(()=>{let l=class l{constructor(){this._document=$t(rn,{optional:!0}),this._animationMode=$t(xo,{optional:!0}),this._globalRippleOptions=$t(Bb,{optional:!0}),this._platform=$t(Nn),this._ngZone=$t(yi),this._hosts=new Map,this._onInteraction=c=>{if(!(c.target instanceof HTMLElement))return;let r=c.target.closest(`[${Mx}]`);r&&this._createRipple(r)},this._ngZone.runOutsideAngular(()=>{for(let c of QS)this._document?.addEventListener(c,this._onInteraction,KS)})}ngOnDestroy(){let c=this._hosts.keys();for(let m of c)this.destroyRipple(m);for(let m of QS)this._document?.removeEventListener(m,this._onInteraction,KS)}configureRipple(c,m){c.setAttribute(Mx,""),(m.className||!c.hasAttribute(Ax))&&c.setAttribute(Ax,m.className||""),m.centered&&c.setAttribute(JS,""),m.disabled&&c.setAttribute(Nb,"")}getRipple(c){return this._hosts.get(c)||this._createRipple(c)}setDisabled(c,m){let r=this._hosts.get(c);if(r){r.disabled=m;return}m?c.setAttribute(Nb,""):c.removeAttribute(Nb)}_createRipple(c){if(!this._document)return;let m=this._hosts.get(c);if(m)return m;c.querySelector(".mat-ripple")?.remove();let r=this._document.createElement("span");r.classList.add("mat-ripple",c.getAttribute(Ax)),c.append(r);let M=new Zu(new zi(r),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return M._isInitialized=!0,M.trigger=c,M.centered=c.hasAttribute(JS),M.disabled=c.hasAttribute(Nb),this.attachRipple(c,M),M}attachRipple(c,m){c.removeAttribute(Mx),this._hosts.set(c,m)}destroyRipple(c){let m=this._hosts.get(c);m&&(m.ngOnDestroy(),this._hosts.delete(c))}};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),iM=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275cmp=kn({type:l,selectors:[["div","mat-internal-form-field",""]],hostAttrs:[1,"mdc-form-field","mat-internal-form-field"],hostVars:2,hostBindings:function(m,r){m&2&&Tn("mdc-form-field--align-end",r.labelPosition==="before")},inputs:{labelPosition:"labelPosition"},standalone:!0,features:[Pn],attrs:qF,ngContentSelectors:WF,decls:1,vars:0,template:function(m,r){m&1&&(wo(),lr(0))},styles:[".mdc-form-field{display:inline-flex;align-items:center;vertical-align:middle}.mdc-form-field[hidden]{display:none}.mdc-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{margin-left:auto;margin-right:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{padding-left:0;padding-right:4px}.mdc-form-field--nowrap>label{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{margin-left:0;margin-right:auto}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{padding-left:4px;padding-right:0}.mdc-form-field--space-between{justify-content:space-between}.mdc-form-field--space-between>label{margin:0}[dir=rtl] .mdc-form-field--space-between>label,.mdc-form-field--space-between>label[dir=rtl]{margin:0}.mdc-form-field{font-family:var(--mdc-form-field-label-text-font);line-height:var(--mdc-form-field-label-text-line-height);font-size:var(--mdc-form-field-label-text-size);font-weight:var(--mdc-form-field-label-text-weight);letter-spacing:var(--mdc-form-field-label-text-tracking);color:var(--mdc-form-field-label-text-color)}.mat-internal-form-field{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}"],encapsulation:2,changeDetection:0});let g=l;return g})();var nL=["notch"],rL=["matFormFieldNotchedOutline",""],oL=["*"],aL=["textField"],sL=["iconPrefixContainer"],lL=["textPrefixContainer"],cL=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],dL=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"];function uL(g,l){g&1&&nn(0,"span",17)}function hL(g,l){if(g&1&&(vt(0,"label",16),lr(1,1),Xn(2,uL,1,0,"span",17),wt()),g&2){let w=Rn(2);Ni("floating",w._shouldLabelFloat())("monitorResize",w._hasOutline())("id",w._labelId),Fn("for",w._control.disableAutomaticLabeling?null:w._control.id),Ft(2),Ur(2,!w.hideRequiredMarker&&w._control.required?2:-1)}}function pL(g,l){if(g&1&&Xn(0,hL,3,5,"label",16),g&2){let w=Rn();Ur(0,w._hasFloatingLabel()?0:-1)}}function mL(g,l){g&1&&nn(0,"div",5)}function fL(g,l){}function gL(g,l){if(g&1&&Xn(0,fL,0,0,"ng-template",11),g&2){Rn(2);let w=Ss(1);Ni("ngTemplateOutlet",w)}}function _L(g,l){if(g&1&&(vt(0,"div",7),Xn(1,gL,1,1,null,11),wt()),g&2){let w=Rn();Ni("matFormFieldNotchedOutlineOpen",w._shouldLabelFloat()),Ft(),Ur(1,w._forceDisplayInfixLabel()?-1:1)}}function bL(g,l){g&1&&(vt(0,"div",8,2),lr(2,2),wt())}function yL(g,l){g&1&&(vt(0,"div",9,3),lr(2,3),wt())}function vL(g,l){}function xL(g,l){if(g&1&&Xn(0,vL,0,0,"ng-template",11),g&2){Rn();let w=Ss(1);Ni("ngTemplateOutlet",w)}}function wL(g,l){g&1&&(vt(0,"div",12),lr(1,4),wt())}function CL(g,l){g&1&&(vt(0,"div",13),lr(1,5),wt())}function TL(g,l){g&1&&nn(0,"div",14)}function EL(g,l){if(g&1&&(vt(0,"div",18),lr(1,6),wt()),g&2){let w=Rn();Ni("@transitionMessages",w._subscriptAnimationState)}}function IL(g,l){if(g&1&&(vt(0,"mat-hint",20),hn(1),wt()),g&2){let w=Rn(2);Ni("id",w._hintLabelId),Ft(),Co(w.hintLabel)}}function SL(g,l){if(g&1&&(vt(0,"div",19),Xn(1,IL,2,2,"mat-hint",20),lr(2,7),nn(3,"div",21),lr(4,8),wt()),g&2){let w=Rn();Ni("@transitionMessages",w._subscriptAnimationState),Ft(),Ur(1,w.hintLabel?1:-1)}}var jb=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275dir=Qi({type:l,selectors:[["mat-label"]],standalone:!0});let g=l;return g})();var ML=new hi("MatError");var AL=0,rM=(()=>{let l=class l{constructor(){this.align="start",this.id=`mat-mdc-hint-${AL++}`}};l.\u0275fac=function(m){return new(m||l)},l.\u0275dir=Qi({type:l,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(m,r){m&2&&(Oc("id",r.id),Fn("align",null),Tn("mat-mdc-form-field-hint-end",r.align==="end"))},inputs:{align:"align",id:"id"},standalone:!0});let g=l;return g})(),DL=new hi("MatPrefix");var hM=new hi("MatSuffix"),pM=(()=>{let l=class l{constructor(){this._isText=!1}set _isTextSelector(c){this._isText=!0}};l.\u0275fac=function(m){return new(m||l)},l.\u0275dir=Qi({type:l,selectors:[["","matSuffix",""],["","matIconSuffix",""],["","matTextSuffix",""]],inputs:{_isTextSelector:[Jt.None,"matTextSuffix","_isTextSelector"]},standalone:!0,features:[Fr([{provide:hM,useExisting:l}])]});let g=l;return g})(),mM=new hi("FloatingLabelParent"),oM=(()=>{let l=class l{get floating(){return this._floating}set floating(c){this._floating=c,this.monitorResize&&this._handleResize()}get monitorResize(){return this._monitorResize}set monitorResize(c){this._monitorResize=c,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}constructor(c){this._elementRef=c,this._floating=!1,this._monitorResize=!1,this._resizeObserver=$t(DS),this._ngZone=$t(yi),this._parent=$t(mM),this._resizeSubscription=new qr}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return kL(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}};l.\u0275fac=function(m){return new(m||l)(Oe(zi))},l.\u0275dir=Qi({type:l,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(m,r){m&2&&Tn("mdc-floating-label--float-above",r.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"},standalone:!0});let g=l;return g})();function kL(g){let l=g;if(l.offsetParent!==null)return l.scrollWidth;let w=l.cloneNode(!0);w.style.setProperty("position","absolute"),w.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(w);let c=w.scrollWidth;return w.remove(),c}var aM="mdc-line-ripple--active",Vb="mdc-line-ripple--deactivating",sM=(()=>{let l=class l{constructor(c,m){this._elementRef=c,this._handleTransitionEnd=r=>{let M=this._elementRef.nativeElement.classList,z=M.contains(Vb);r.propertyName==="opacity"&&z&&M.remove(aM,Vb)},m.runOutsideAngular(()=>{c.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){let c=this._elementRef.nativeElement.classList;c.remove(Vb),c.add(aM)}deactivate(){this._elementRef.nativeElement.classList.add(Vb)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(yi))},l.\u0275dir=Qi({type:l,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"],standalone:!0});let g=l;return g})(),lM=(()=>{let l=class l{constructor(c,m){this._elementRef=c,this._ngZone=m,this.open=!1}ngAfterViewInit(){let c=this._elementRef.nativeElement.querySelector(".mdc-floating-label");c?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),typeof requestAnimationFrame=="function"&&(c.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>c.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(c){!this.open||!c?this._notch.nativeElement.style.width="":this._notch.nativeElement.style.width=`calc(${c}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(yi))},l.\u0275cmp=kn({type:l,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(m,r){if(m&1&&cr(nL,5),m&2){let M;bn(M=yn())&&(r._notch=M.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(m,r){m&2&&Tn("mdc-notched-outline--notched",r.open)},inputs:{open:[Jt.None,"matFormFieldNotchedOutlineOpen","open"]},standalone:!0,features:[Pn],attrs:rL,ngContentSelectors:oL,decls:5,vars:0,consts:[["notch",""],[1,"mdc-notched-outline__leading"],[1,"mdc-notched-outline__notch"],[1,"mdc-notched-outline__trailing"]],template:function(m,r){m&1&&(wo(),nn(0,"div",1),vt(1,"div",2,0),lr(3),wt(),nn(4,"div",3))},encapsulation:2,changeDetection:0});let g=l;return g})(),RL={transitionMessages:rf("transitionMessages",[of("enter",yl({opacity:1,transform:"translateY(0%)"})),Pu("void => enter",[yl({opacity:0,transform:"translateY(-5px)"}),Ru("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])},Gf=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275dir=Qi({type:l});let g=l;return g})();var xp=new hi("MatFormField"),PL=new hi("MAT_FORM_FIELD_DEFAULT_OPTIONS"),cM=0,dM="fill",OL="auto",uM="fixed",FL="translateY(-50%)",fM=(()=>{let l=class l{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(c){this._hideRequiredMarker=Gu(c)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||OL}set floatLabel(c){c!==this._floatLabel&&(this._floatLabel=c,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(c){let m=this._appearance,r=c||this._defaults?.appearance||dM;this._appearance=r,this._appearance==="outline"&&this._appearance!==m&&(this._needsOutlineLabelOffsetUpdateOnStable=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||uM}set subscriptSizing(c){this._subscriptSizing=c||this._defaults?.subscriptSizing||uM}get hintLabel(){return this._hintLabel}set hintLabel(c){this._hintLabel=c,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(c){this._explicitFormFieldControl=c}constructor(c,m,r,M,z,ie,ue,ye){this._elementRef=c,this._changeDetectorRef=m,this._ngZone=r,this._dir=M,this._platform=z,this._defaults=ie,this._animationMode=ue,this._hideRequiredMarker=!1,this.color="primary",this._appearance=dM,this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId=`mat-mdc-form-field-label-${cM++}`,this._hintLabelId=`mat-mdc-hint-${cM++}`,this._subscriptAnimationState="",this._destroyed=new Gi,this._isFocused=null,this._needsOutlineLabelOffsetUpdateOnStable=!1,ie&&(ie.appearance&&(this.appearance=ie.appearance),this._hideRequiredMarker=!!ie?.hideRequiredMarker,ie.color&&(this.color=ie.color))}ngAfterViewInit(){this._updateFocusState(),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(){let c=this._control;c.controlType&&this._elementRef.nativeElement.classList.add(`mat-mdc-form-field-type-${c.controlType}`),c.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),c.ngControl&&c.ngControl.valueChanges&&c.ngControl.valueChanges.pipe(Wr(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck())}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(c=>!c._isText),this._hasTextPrefix=!!this._prefixChildren.find(c=>c._isText),this._hasIconSuffix=!!this._suffixChildren.find(c=>!c._isText),this._hasTextSuffix=!!this._suffixChildren.find(c=>c._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),fl(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){this._control}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||this._isFocused===null)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(Wr(this._destroyed)).subscribe(()=>{this._needsOutlineLabelOffsetUpdateOnStable&&(this._needsOutlineLabelOffsetUpdateOnStable=!1,this._updateOutlineLabelOffset())})}),this._dir.change.pipe(Wr(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdateOnStable=!0)}_shouldAlwaysFloat(){return this.floatLabel==="always"}_hasOutline(){return this.appearance==="outline"}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_hasFloatingLabel(){return!!this._labelChildNonStatic||!!this._labelChildStatic}_shouldLabelFloat(){return this._control.shouldLabelFloat||this._shouldAlwaysFloat()}_shouldForward(c){let m=this._control?this._control.ngControl:null;return m&&m[c]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){!this._hasOutline()||!this._floatingLabel||!this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(0):this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth())}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){this._hintChildren}_syncDescribedByIds(){if(this._control){let c=[];if(this._control.userAriaDescribedBy&&typeof this._control.userAriaDescribedBy=="string"&&c.push(...this._control.userAriaDescribedBy.split(" ")),this._getDisplayedMessages()==="hint"){let m=this._hintChildren?this._hintChildren.find(M=>M.align==="start"):null,r=this._hintChildren?this._hintChildren.find(M=>M.align==="end"):null;m?c.push(m.id):this._hintLabel&&c.push(this._hintLabelId),r&&c.push(r.id)}else this._errorChildren&&c.push(...this._errorChildren.map(m=>m.id));this._control.setDescribedByIds(c)}}_updateOutlineLabelOffset(){if(!this._platform.isBrowser||!this._hasOutline()||!this._floatingLabel)return;let c=this._floatingLabel.element;if(!(this._iconPrefixContainer||this._textPrefixContainer)){c.style.transform="";return}if(!this._isAttachedToDom()){this._needsOutlineLabelOffsetUpdateOnStable=!0;return}let m=this._iconPrefixContainer?.nativeElement,r=this._textPrefixContainer?.nativeElement,M=m?.getBoundingClientRect().width??0,z=r?.getBoundingClientRect().width??0,ie=this._dir.value==="rtl"?"-1":"1",ue=`${M+z}px`,Je=`calc(${ie} * (${ue} + var(--mat-mdc-form-field-label-offset-x, 0px)))`;c.style.transform=`var(
        --mat-mdc-form-field-label-transform,
        ${FL} translateX(${Je})
    )`}_isAttachedToDom(){let c=this._elementRef.nativeElement;if(c.getRootNode){let m=c.getRootNode();return m&&m!==c}return document.documentElement.contains(c)}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(Pr),Oe(yi),Oe(Ds),Oe(Nn),Oe(PL,8),Oe(xo,8),Oe(rn))},l.\u0275cmp=kn({type:l,selectors:[["mat-form-field"]],contentQueries:function(m,r,M){if(m&1&&(Ea(M,jb,5),Ea(M,jb,7),Ea(M,Gf,5),Ea(M,DL,5),Ea(M,hM,5),Ea(M,ML,5),Ea(M,rM,5)),m&2){let z;bn(z=yn())&&(r._labelChildNonStatic=z.first),bn(z=yn())&&(r._labelChildStatic=z.first),bn(z=yn())&&(r._formFieldControl=z.first),bn(z=yn())&&(r._prefixChildren=z),bn(z=yn())&&(r._suffixChildren=z),bn(z=yn())&&(r._errorChildren=z),bn(z=yn())&&(r._hintChildren=z)}},viewQuery:function(m,r){if(m&1&&(cr(aL,5),cr(sL,5),cr(lL,5),cr(oM,5),cr(lM,5),cr(sM,5)),m&2){let M;bn(M=yn())&&(r._textField=M.first),bn(M=yn())&&(r._iconPrefixContainer=M.first),bn(M=yn())&&(r._textPrefixContainer=M.first),bn(M=yn())&&(r._floatingLabel=M.first),bn(M=yn())&&(r._notchedOutline=M.first),bn(M=yn())&&(r._lineRipple=M.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(m,r){m&2&&Tn("mat-mdc-form-field-label-always-float",r._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",r._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",r._hasIconSuffix)("mat-form-field-invalid",r._control.errorState)("mat-form-field-disabled",r._control.disabled)("mat-form-field-autofilled",r._control.autofilled)("mat-form-field-no-animations",r._animationMode==="NoopAnimations")("mat-form-field-appearance-fill",r.appearance=="fill")("mat-form-field-appearance-outline",r.appearance=="outline")("mat-form-field-hide-placeholder",r._hasFloatingLabel()&&!r._shouldLabelFloat())("mat-focused",r._control.focused)("mat-primary",r.color!=="accent"&&r.color!=="warn")("mat-accent",r.color==="accent")("mat-warn",r.color==="warn")("ng-untouched",r._shouldForward("untouched"))("ng-touched",r._shouldForward("touched"))("ng-pristine",r._shouldForward("pristine"))("ng-dirty",r._shouldForward("dirty"))("ng-valid",r._shouldForward("valid"))("ng-invalid",r._shouldForward("invalid"))("ng-pending",r._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],standalone:!0,features:[Fr([{provide:xp,useExisting:l},{provide:mM,useExisting:l}]),Pn],ngContentSelectors:dL,decls:18,vars:21,consts:[["labelTemplate",""],["textField",""],["iconPrefixContainer",""],["textPrefixContainer",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],[1,"mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],[1,"mat-mdc-form-field-icon-prefix"],[1,"mat-mdc-form-field-text-prefix"],[1,"mat-mdc-form-field-infix"],[3,"ngTemplateOutlet"],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],[3,"id"],[1,"mat-mdc-form-field-hint-spacer"]],template:function(m,r){if(m&1){let M=Ho();wo(cL),Xn(0,pL,1,1,"ng-template",null,0,NE),vt(2,"div",4,1),Vi("click",function(ie){return Ji(M),en(r._control.onContainerClick(ie))}),Xn(4,mL,1,0,"div",5),vt(5,"div",6),Xn(6,_L,2,2,"div",7)(7,bL,3,0,"div",8)(8,yL,3,0,"div",9),vt(9,"div",10),Xn(10,xL,1,1,null,11),lr(11),wt(),Xn(12,wL,2,0,"div",12)(13,CL,2,0,"div",13),wt(),Xn(14,TL,1,0,"div",14),wt(),vt(15,"div",15),Xn(16,EL,2,1)(17,SL,5,2),wt()}if(m&2){let M;Ft(2),Tn("mdc-text-field--filled",!r._hasOutline())("mdc-text-field--outlined",r._hasOutline())("mdc-text-field--no-label",!r._hasFloatingLabel())("mdc-text-field--disabled",r._control.disabled)("mdc-text-field--invalid",r._control.errorState),Ft(2),Ur(4,!r._hasOutline()&&!r._control.disabled?4:-1),Ft(2),Ur(6,r._hasOutline()?6:-1),Ft(),Ur(7,r._hasIconPrefix?7:-1),Ft(),Ur(8,r._hasTextPrefix?8:-1),Ft(2),Ur(10,!r._hasOutline()||r._forceDisplayInfixLabel()?10:-1),Ft(2),Ur(12,r._hasTextSuffix?12:-1),Ft(),Ur(13,r._hasIconSuffix?13:-1),Ft(),Ur(14,r._hasOutline()?-1:14),Ft(),Tn("mat-mdc-form-field-subscript-dynamic-size",r.subscriptSizing==="dynamic"),Ft(),Ur(16,(M=r._getDisplayedMessages())==="error"?16:M==="hint"?17:-1)}},dependencies:[oM,lM,$E,sM,rM],styles:['.mdc-text-field{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:0;border-bottom-left-radius:0;display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-text-field__input{height:28px;width:100%;min-width:0;border:none;border-radius:0;background:none;appearance:none;padding:0}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}@media all{.mdc-text-field__input::placeholder{opacity:0}}@media all{.mdc-text-field__input:-ms-input-placeholder{opacity:0}}@media all{.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}}@media all{.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}}.mdc-text-field__affix{height:28px;opacity:0;white-space:nowrap}.mdc-text-field--label-floating .mdc-text-field__affix,.mdc-text-field--no-label .mdc-text-field__affix{opacity:1}@supports(-webkit-hyphens: none){.mdc-text-field--outlined .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field__affix--prefix,.mdc-text-field__affix--prefix[dir=rtl]{padding-left:2px;padding-right:0}.mdc-text-field--end-aligned .mdc-text-field__affix--prefix{padding-left:0;padding-right:12px}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--end-aligned .mdc-text-field__affix--prefix[dir=rtl]{padding-left:12px;padding-right:0}.mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field__affix--suffix,.mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:12px}.mdc-text-field--end-aligned .mdc-text-field__affix--suffix{padding-left:2px;padding-right:0}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--end-aligned .mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:2px}.mdc-text-field--filled{height:56px}.mdc-text-field--filled::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}.mdc-text-field--filled .mdc-floating-label{left:16px;right:initial}[dir=rtl] .mdc-text-field--filled .mdc-floating-label,.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:16px}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled.mdc-text-field--no-label::before{display:none}@supports(-webkit-hyphens: none){.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field--outlined{height:56px;overflow:visible}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--outlined .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-shape-small, 4px))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px,var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px,var(--mdc-shape-small, 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px,var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:initial}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:4px}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mdc-text-field--textarea{flex-direction:column;align-items:center;width:auto;height:auto;padding:0}.mdc-text-field--textarea .mdc-floating-label{top:19px}.mdc-text-field--textarea .mdc-floating-label:not(.mdc-floating-label--float-above){transform:none}.mdc-text-field--textarea .mdc-text-field__input{flex-grow:1;height:auto;min-height:1.5rem;overflow-x:hidden;overflow-y:auto;box-sizing:border-box;resize:none;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--filled::before{display:none}.mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-10.25px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--filled .mdc-text-field__input{margin-top:23px;margin-bottom:9px}.mdc-text-field--textarea.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-27.25px) scale(1)}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-24.75px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label{top:18px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field__input{margin-bottom:2px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter{align-self:flex-end;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::after{display:inline-block;width:0;height:16px;content:"";vertical-align:-16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::before{display:none}.mdc-text-field__resizer{align-self:stretch;display:inline-flex;flex-direction:column;flex-grow:1;max-height:100%;max-width:100%;min-height:56px;min-width:fit-content;min-width:-moz-available;min-width:-webkit-fill-available;overflow:hidden;resize:both}.mdc-text-field--filled .mdc-text-field__resizer{transform:translateY(-1px)}.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateY(1px)}.mdc-text-field--outlined .mdc-text-field__resizer{transform:translateX(-1px) translateY(-1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer,.mdc-text-field--outlined .mdc-text-field__resizer[dir=rtl]{transform:translateX(1px) translateY(-1px)}.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateX(1px) translateY(1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input[dir=rtl],.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter[dir=rtl]{transform:translateX(-1px) translateY(1px)}.mdc-text-field--with-leading-icon{padding-left:0;padding-right:16px}[dir=rtl] .mdc-text-field--with-leading-icon,.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:16px;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 48px);left:48px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:48px}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 64px/0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label{left:36px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:36px}.mdc-text-field--with-leading-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) translateX(-32px) scale(1)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-37.25px) translateX(32px) scale(1)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) translateX(-32px) scale(0.75)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl],.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-34.75px) translateX(32px) scale(0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--with-trailing-icon{padding-left:16px;padding-right:0}[dir=rtl] .mdc-text-field--with-trailing-icon,.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0;padding-right:16px}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 64px)}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 64px/0.75)}.mdc-text-field--with-trailing-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 96px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 96px/0.75)}.mdc-text-field-helper-line{display:flex;justify-content:space-between;box-sizing:border-box}.mdc-text-field+.mdc-text-field-helper-line{padding-right:16px;padding-left:16px}.mdc-form-field>.mdc-text-field+label{align-self:flex-start}.mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--focused .mdc-notched-outline__trailing{border-width:2px}.mdc-text-field--focused+.mdc-text-field-helper-line .mdc-text-field-helper-text:not(.mdc-text-field-helper-text--validation-msg){opacity:1}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-text-field--focused.mdc-text-field--outlined.mdc-text-field--textarea .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--invalid+.mdc-text-field-helper-line .mdc-text-field-helper-text--validation-msg{opacity:1}.mdc-text-field--disabled{pointer-events:none}@media screen and (forced-colors: active){.mdc-text-field--disabled .mdc-text-field__input{background-color:Window}.mdc-text-field--disabled .mdc-floating-label{z-index:1}}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.mdc-text-field--disabled.mdc-text-field--filled .mdc-text-field__ripple{display:none}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--end-aligned .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--end-aligned .mdc-text-field__input[dir=rtl]{text-align:left}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix{direction:ltr}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--leading,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--leading{order:1}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{order:2}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input{order:3}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{order:4}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--trailing,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--trailing{order:5}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--prefix{padding-right:12px}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--suffix{padding-left:2px}.mdc-floating-label{position:absolute;left:0;-webkit-transform-origin:left top;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label,.mdc-floating-label[dir=rtl]{right:0;left:auto;-webkit-transform-origin:right top;transform-origin:right top;text-align:right}.mdc-floating-label--float-above{cursor:auto}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0px;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after,.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)[dir=rtl]::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline,.mdc-notched-outline[dir=rtl]{text-align:right}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{box-sizing:border-box;height:100%;pointer-events:none}.mdc-notched-outline__trailing{flex-grow:1}.mdc-notched-outline__notch{flex:0 0 auto;width:auto}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch,.mdc-notched-outline--notched .mdc-notched-outline__notch[dir=rtl]{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{border-top:1px solid;border-bottom:1px solid}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;width:12px}[dir=rtl] .mdc-notched-outline__leading,.mdc-notched-outline__leading[dir=rtl]{border-left:none;border-right:1px solid}.mdc-notched-outline__trailing{border-left:none;border-right:1px solid}[dir=rtl] .mdc-notched-outline__trailing,.mdc-notched-outline__trailing[dir=rtl]{border-left:1px solid;border-right:none}.mdc-notched-outline__notch{max-width:calc(100% - 12px*2)}.mdc-line-ripple::before{border-bottom-width:1px}.mdc-line-ripple::after{border-bottom-width:2px}.mdc-text-field--filled{border-top-left-radius:var(--mdc-filled-text-field-container-shape);border-top-right-radius:var(--mdc-filled-text-field-container-shape);border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-caret-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-focus-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-hover-label-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-disabled-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-focus-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-hover-label-text-color)}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font);font-size:var(--mdc-filled-text-field-label-text-size);font-weight:var(--mdc-filled-text-field-label-text-weight);letter-spacing:var(--mdc-filled-text-field-label-text-tracking)}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color)}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color)}.mdc-text-field--filled .mdc-line-ripple::before{border-bottom-width:var(--mdc-filled-text-field-active-indicator-height)}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-caret-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-focus-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-hover-label-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-disabled-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-focus-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-hover-label-text-color)}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font);font-size:var(--mdc-outlined-text-field-label-text-size);font-weight:var(--mdc-outlined-text-field-label-text-weight);letter-spacing:var(--mdc-outlined-text-field-label-text-tracking)}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(.75*var(--mdc-outlined-text-field-label-text-size))}.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mdc-outlined-text-field-label-text-size)}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-outlined-text-field-container-shape))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-hover-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-focus-outline-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-disabled-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-hover-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-focus-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-outline-width)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-focus-outline-width)}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all;will-change:auto}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto;will-change:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-text-field-wrapper::before{content:none}.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:1px solid rgba(0,0,0,0)}[dir=rtl] .mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:none;border-right:1px solid rgba(0,0,0,0)}.mat-mdc-form-field-infix{min-height:var(--mat-form-field-container-height);padding-top:var(--mat-form-field-filled-with-label-container-padding-top);padding-bottom:var(--mat-form-field-filled-with-label-container-padding-bottom)}.mdc-text-field--outlined .mat-mdc-form-field-infix,.mdc-text-field--no-label .mat-mdc-form-field-infix{padding-top:var(--mat-form-field-container-vertical-padding);padding-bottom:var(--mat-form-field-container-vertical-padding)}.mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-floating-label{top:calc(var(--mat-form-field-container-height)/2)}.mdc-text-field--filled .mat-mdc-floating-label{display:var(--mat-form-field-filled-label-display, block)}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{--mat-mdc-form-field-label-transform: translateY(calc(calc(6.75px + var(--mat-form-field-container-height) / 2) * -1)) scale(var(--mat-mdc-form-field-floating-label-scale, 0.75));transform:var(--mat-mdc-form-field-label-transform)}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block;color:var(--mat-form-field-error-text-color)}.mat-mdc-form-field-subscript-wrapper,.mat-mdc-form-field-bottom-align::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-subscript-text-font);line-height:var(--mat-form-field-subscript-text-line-height);font-size:var(--mat-form-field-subscript-text-size);letter-spacing:var(--mat-form-field-subscript-text-tracking);font-weight:var(--mat-form-field-subscript-text-weight)}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none;background-color:var(--mat-form-field-state-layer-color)}.mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-hover-state-layer-opacity)}.mat-mdc-form-field.mat-focused .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-focus-state-layer-opacity)}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option{color:var(--mat-form-field-select-option-text-color)}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option:disabled{color:var(--mat-form-field-select-disabled-option-text-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none;color:var(--mat-form-field-enabled-select-arrow-color)}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select.mat-focused .mat-mdc-form-field-infix::after{color:var(--mat-form-field-focus-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select.mat-form-field-disabled .mat-mdc-form-field-infix::after{color:var(--mat-form-field-disabled-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font);line-height:var(--mat-form-field-container-text-line-height);font-size:var(--mat-form-field-container-text-size);letter-spacing:var(--mat-form-field-container-text-tracking);font-weight:var(--mat-form-field-container-text-weight)}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size)*var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%;z-index:0}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:0 12px;box-sizing:content-box}.mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-leading-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-disabled-leading-icon-color)}.mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-trailing-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-disabled-trailing-icon-color)}.mat-form-field-invalid .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-trailing-icon-color)}.mat-form-field-invalid:not(.mat-focused):not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-hover-trailing-icon-color)}.mat-form-field-invalid.mat-focused .mat-mdc-text-field-wrapper .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-focus-trailing-icon-color)}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__affix{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled.mdc-ripple-upgraded--background-focused .mdc-text-field__ripple::before,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea{transition:none}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-filled 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-filled{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon{0%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}[dir=rtl] .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined[dir=rtl] .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon-rtl{0%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-standard 250ms 1}@keyframes mdc-floating-label-shake-float-above-standard{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}'],encapsulation:2,data:{animation:[RL.transitionMessages]},changeDetection:0});let g=l;return g})(),Yu=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({imports:[Dr,ku,Ob,Dr]});let g=l;return g})();var zL=["*"],Ub;function NL(){if(Ub===void 0&&(Ub=null,typeof window<"u")){let g=window;g.trustedTypes!==void 0&&(Ub=g.trustedTypes.createPolicy("angular#components",{createHTML:l=>l}))}return Ub}function Hf(g){return NL()?.createHTML(g)||g}function gM(g){return Error(`Unable to find icon with the name "${g}"`)}function BL(){return Error("Could not find HttpClient provider for use with Angular Material icons. Please include the HttpClientModule from @angular/common/http in your app imports.")}function _M(g){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${g}".`)}function bM(g){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${g}".`)}var Lc=class{constructor(l,w,c){this.url=l,this.svgText=w,this.options=c}},VL=(()=>{let l=class l{constructor(c,m,r,M){this._httpClient=c,this._sanitizer=m,this._errorHandler=M,this._svgIconConfigs=new Map,this._iconSetConfigs=new Map,this._cachedIconsByUrl=new Map,this._inProgressUrlFetches=new Map,this._fontCssClassesByAlias=new Map,this._resolvers=[],this._defaultFontSetClass=["material-icons","mat-ligature-font"],this._document=r}addSvgIcon(c,m,r){return this.addSvgIconInNamespace("",c,m,r)}addSvgIconLiteral(c,m,r){return this.addSvgIconLiteralInNamespace("",c,m,r)}addSvgIconInNamespace(c,m,r,M){return this._addSvgIconConfig(c,m,new Lc(r,null,M))}addSvgIconResolver(c){return this._resolvers.push(c),this}addSvgIconLiteralInNamespace(c,m,r,M){let z=this._sanitizer.sanitize(as.HTML,r);if(!z)throw bM(r);let ie=Hf(z);return this._addSvgIconConfig(c,m,new Lc("",ie,M))}addSvgIconSet(c,m){return this.addSvgIconSetInNamespace("",c,m)}addSvgIconSetLiteral(c,m){return this.addSvgIconSetLiteralInNamespace("",c,m)}addSvgIconSetInNamespace(c,m,r){return this._addSvgIconSetConfig(c,new Lc(m,null,r))}addSvgIconSetLiteralInNamespace(c,m,r){let M=this._sanitizer.sanitize(as.HTML,m);if(!M)throw bM(m);let z=Hf(M);return this._addSvgIconSetConfig(c,new Lc("",z,r))}registerFontClassAlias(c,m=c){return this._fontCssClassesByAlias.set(c,m),this}classNameForFontAlias(c){return this._fontCssClassesByAlias.get(c)||c}setDefaultFontSetClass(...c){return this._defaultFontSetClass=c,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(c){let m=this._sanitizer.sanitize(as.RESOURCE_URL,c);if(!m)throw _M(c);let r=this._cachedIconsByUrl.get(m);return r?ui(Gb(r)):this._loadSvgIconFromConfig(new Lc(c,null)).pipe(Zr(M=>this._cachedIconsByUrl.set(m,M)),ln(M=>Gb(M)))}getNamedSvgIcon(c,m=""){let r=yM(m,c),M=this._svgIconConfigs.get(r);if(M)return this._getSvgFromConfig(M);if(M=this._getIconConfigFromResolvers(m,c),M)return this._svgIconConfigs.set(r,M),this._getSvgFromConfig(M);let z=this._iconSetConfigs.get(m);return z?this._getSvgFromIconSetConfigs(c,z):wu(gM(r))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(c){return c.svgText?ui(Gb(this._svgElementFromConfig(c))):this._loadSvgIconFromConfig(c).pipe(ln(m=>Gb(m)))}_getSvgFromIconSetConfigs(c,m){let r=this._extractIconWithNameFromAnySet(c,m);if(r)return ui(r);let M=m.filter(z=>!z.svgText).map(z=>this._loadSvgIconSetFromConfig(z).pipe(gd(ie=>{let ye=`Loading icon set URL: ${this._sanitizer.sanitize(as.RESOURCE_URL,z.url)} failed: ${ie.message}`;return this._errorHandler.handleError(new Error(ye)),ui(null)})));return O_(M).pipe(ln(()=>{let z=this._extractIconWithNameFromAnySet(c,m);if(!z)throw gM(c);return z}))}_extractIconWithNameFromAnySet(c,m){for(let r=m.length-1;r>=0;r--){let M=m[r];if(M.svgText&&M.svgText.toString().indexOf(c)>-1){let z=this._svgElementFromConfig(M),ie=this._extractSvgIconFromSet(z,c,M.options);if(ie)return ie}}return null}_loadSvgIconFromConfig(c){return this._fetchIcon(c).pipe(Zr(m=>c.svgText=m),ln(()=>this._svgElementFromConfig(c)))}_loadSvgIconSetFromConfig(c){return c.svgText?ui(null):this._fetchIcon(c).pipe(Zr(m=>c.svgText=m))}_extractSvgIconFromSet(c,m,r){let M=c.querySelector(`[id="${m}"]`);if(!M)return null;let z=M.cloneNode(!0);if(z.removeAttribute("id"),z.nodeName.toLowerCase()==="svg")return this._setSvgAttributes(z,r);if(z.nodeName.toLowerCase()==="symbol")return this._setSvgAttributes(this._toSvgElement(z),r);let ie=this._svgElementFromString(Hf("<svg></svg>"));return ie.appendChild(z),this._setSvgAttributes(ie,r)}_svgElementFromString(c){let m=this._document.createElement("DIV");m.innerHTML=c;let r=m.querySelector("svg");if(!r)throw Error("<svg> tag not found");return r}_toSvgElement(c){let m=this._svgElementFromString(Hf("<svg></svg>")),r=c.attributes;for(let M=0;M<r.length;M++){let{name:z,value:ie}=r[M];z!=="id"&&m.setAttribute(z,ie)}for(let M=0;M<c.childNodes.length;M++)c.childNodes[M].nodeType===this._document.ELEMENT_NODE&&m.appendChild(c.childNodes[M].cloneNode(!0));return m}_setSvgAttributes(c,m){return c.setAttribute("fit",""),c.setAttribute("height","100%"),c.setAttribute("width","100%"),c.setAttribute("preserveAspectRatio","xMidYMid meet"),c.setAttribute("focusable","false"),m&&m.viewBox&&c.setAttribute("viewBox",m.viewBox),c}_fetchIcon(c){let{url:m,options:r}=c,M=r?.withCredentials??!1;if(!this._httpClient)throw BL();if(m==null)throw Error(`Cannot fetch icon from URL "${m}".`);let z=this._sanitizer.sanitize(as.RESOURCE_URL,m);if(!z)throw _M(m);let ie=this._inProgressUrlFetches.get(z);if(ie)return ie;let ue=this._httpClient.get(z,{responseType:"text",withCredentials:M}).pipe(ln(ye=>Hf(ye)),_d(()=>this._inProgressUrlFetches.delete(z)),vE());return this._inProgressUrlFetches.set(z,ue),ue}_addSvgIconConfig(c,m,r){return this._svgIconConfigs.set(yM(c,m),r),this}_addSvgIconSetConfig(c,m){let r=this._iconSetConfigs.get(c);return r?r.push(m):this._iconSetConfigs.set(c,[m]),this}_svgElementFromConfig(c){if(!c.svgElement){let m=this._svgElementFromString(c.svgText);this._setSvgAttributes(m,c.options),c.svgElement=m}return c.svgElement}_getIconConfigFromResolvers(c,m){for(let r=0;r<this._resolvers.length;r++){let M=this._resolvers[r](m,c);if(M)return jL(M)?new Lc(M.url,null,M.options):new Lc(M,null)}}};l.\u0275fac=function(m){return new(m||l)(bt(cf,8),bt(hv),bt(rn,8),bt(Iu))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();function Gb(g){return g.cloneNode(!0)}function yM(g,l){return g+":"+l}function jL(g){return!!(g.url&&g.options)}var UL=new hi("MAT_ICON_DEFAULT_OPTIONS"),GL=new hi("mat-icon-location",{providedIn:"root",factory:HL});function HL(){let g=$t(rn),l=g?g.location:null;return{getPathname:()=>l?l.pathname+l.search:""}}var vM=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],$L=vM.map(g=>`[${g}]`).join(", "),qL=/^url\(['"]?#(.*?)['"]?\)$/,xM=(()=>{let l=class l{get color(){return this._color||this._defaultColor}set color(c){this._color=c}get svgIcon(){return this._svgIcon}set svgIcon(c){c!==this._svgIcon&&(c?this._updateSvgIcon(c):this._svgIcon&&this._clearSvgElement(),this._svgIcon=c)}get fontSet(){return this._fontSet}set fontSet(c){let m=this._cleanupFontValue(c);m!==this._fontSet&&(this._fontSet=m,this._updateFontIconClasses())}get fontIcon(){return this._fontIcon}set fontIcon(c){let m=this._cleanupFontValue(c);m!==this._fontIcon&&(this._fontIcon=m,this._updateFontIconClasses())}constructor(c,m,r,M,z,ie){this._elementRef=c,this._iconRegistry=m,this._location=M,this._errorHandler=z,this.inline=!1,this._previousFontSetClass=[],this._currentIconFetch=qr.EMPTY,ie&&(ie.color&&(this.color=this._defaultColor=ie.color),ie.fontSet&&(this.fontSet=ie.fontSet)),r||c.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(c){if(!c)return["",""];let m=c.split(":");switch(m.length){case 1:return["",m[0]];case 2:return m;default:throw Error(`Invalid icon name: "${c}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){let c=this._elementsWithExternalReferences;if(c&&c.size){let m=this._location.getPathname();m!==this._previousPath&&(this._previousPath=m,this._prependPathToReferences(m))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(c){this._clearSvgElement();let m=this._location.getPathname();this._previousPath=m,this._cacheChildrenWithExternalReferences(c),this._prependPathToReferences(m),this._elementRef.nativeElement.appendChild(c)}_clearSvgElement(){let c=this._elementRef.nativeElement,m=c.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();m--;){let r=c.childNodes[m];(r.nodeType!==1||r.nodeName.toLowerCase()==="svg")&&r.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;let c=this._elementRef.nativeElement,m=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(r=>r.length>0);this._previousFontSetClass.forEach(r=>c.classList.remove(r)),m.forEach(r=>c.classList.add(r)),this._previousFontSetClass=m,this.fontIcon!==this._previousFontIconClass&&!m.includes("mat-ligature-font")&&(this._previousFontIconClass&&c.classList.remove(this._previousFontIconClass),this.fontIcon&&c.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(c){return typeof c=="string"?c.trim().split(" ")[0]:c}_prependPathToReferences(c){let m=this._elementsWithExternalReferences;m&&m.forEach((r,M)=>{r.forEach(z=>{M.setAttribute(z.name,`url('${c}#${z.value}')`)})})}_cacheChildrenWithExternalReferences(c){let m=c.querySelectorAll($L),r=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let M=0;M<m.length;M++)vM.forEach(z=>{let ie=m[M],ue=ie.getAttribute(z),ye=ue?ue.match(qL):null;if(ye){let Je=r.get(ie);Je||(Je=[],r.set(ie,Je)),Je.push({name:z,value:ye[1]})}})}_updateSvgIcon(c){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),c){let[m,r]=this._splitIconName(c);m&&(this._svgNamespace=m),r&&(this._svgName=r),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(r,m).pipe(vo(1)).subscribe(M=>this._setSvgElement(M),M=>{let z=`Error retrieving icon ${m}:${r}! ${M.message}`;this._errorHandler.handleError(new Error(z))})}}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(VL),Is("aria-hidden"),Oe(GL),Oe(Iu),Oe(UL,8))},l.\u0275cmp=kn({type:l,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(m,r){m&2&&(Fn("data-mat-icon-type",r._usingFontIcon()?"font":"svg")("data-mat-icon-name",r._svgName||r.fontIcon)("data-mat-icon-namespace",r._svgNamespace||r.fontSet)("fontIcon",r._usingFontIcon()?r.fontIcon:null),ss(r.color?"mat-"+r.color:""),Tn("mat-icon-inline",r.inline)("mat-icon-no-color",r.color!=="primary"&&r.color!=="accent"&&r.color!=="warn"))},inputs:{color:"color",inline:[Jt.HasDecoratorInputTransform,"inline","inline",pn],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],standalone:!0,features:[xr,Pn],ngContentSelectors:zL,decls:1,vars:0,template:function(m,r){m&1&&(wo(),lr(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0});let g=l;return g})(),wM=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({imports:[Dr,Dr]});let g=l;return g})();var CM=Ba({passive:!0}),TM=(()=>{let l=class l{constructor(c,m){this._platform=c,this._ngZone=m,this._monitoredElements=new Map}monitor(c){if(!this._platform.isBrowser)return Cs;let m=Va(c),r=this._monitoredElements.get(m);if(r)return r.subject;let M=new Gi,z="cdk-text-field-autofilled",ie=ue=>{ue.animationName==="cdk-text-field-autofill-start"&&!m.classList.contains(z)?(m.classList.add(z),this._ngZone.run(()=>M.next({target:ue.target,isAutofilled:!0}))):ue.animationName==="cdk-text-field-autofill-end"&&m.classList.contains(z)&&(m.classList.remove(z),this._ngZone.run(()=>M.next({target:ue.target,isAutofilled:!1})))};return this._ngZone.runOutsideAngular(()=>{m.addEventListener("animationstart",ie,CM),m.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(m,{subject:M,unlisten:()=>{m.removeEventListener("animationstart",ie,CM)}}),M}stopMonitoring(c){let m=Va(c),r=this._monitoredElements.get(m);r&&(r.unlisten(),r.subject.complete(),m.classList.remove("cdk-text-field-autofill-monitored"),m.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(m))}ngOnDestroy(){this._monitoredElements.forEach((c,m)=>this.stopMonitoring(m))}};l.\u0275fac=function(m){return new(m||l)(bt(Nn),bt(yi))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();var EM=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({});let g=l;return g})();var Ox=new hi("MAT_INPUT_VALUE_ACCESSOR"),YL=["button","checkbox","file","hidden","image","radio","range","reset","submit"],XL=0,IM=(()=>{let l=class l{get disabled(){return this._disabled}set disabled(c){this._disabled=Gu(c),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(c){this._id=c||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(up.required)??!1}set required(c){this._required=Gu(c)}get type(){return this._type}set type(c){this._type=c||"text",this._validateType(),!this._isTextarea&&bx().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(c){this._errorStateTracker.matcher=c}get value(){return this._inputValueAccessor.value}set value(c){c!==this.value&&(this._inputValueAccessor.value=c,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(c){this._readonly=Gu(c)}get errorState(){return this._errorStateTracker.errorState}set errorState(c){this._errorStateTracker.errorState=c}constructor(c,m,r,M,z,ie,ue,ye,Je,It){this._elementRef=c,this._platform=m,this.ngControl=r,this._autofillMonitor=ye,this._formField=It,this._uid=`mat-input-${XL++}`,this.focused=!1,this.stateChanges=new Gi,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(Oi=>bx().has(Oi)),this._iOSKeyupListener=Oi=>{let vi=Oi.target;!vi.value&&vi.selectionStart===0&&vi.selectionEnd===0&&(vi.setSelectionRange(1,1),vi.setSelectionRange(0,0))};let st=this._elementRef.nativeElement,Xt=st.nodeName.toLowerCase();this._inputValueAccessor=ue||st,this._previousNativeValue=this.value,this.id=this.id,m.IOS&&Je.runOutsideAngular(()=>{c.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._errorStateTracker=new vp(ie,r,z,M,this.stateChanges),this._isServer=!this._platform.isBrowser,this._isNativeSelect=Xt==="select",this._isTextarea=Xt==="textarea",this._isInFormField=!!It,this._isNativeSelect&&(this.controlType=st.multiple?"mat-native-select-multiple":"mat-native-select")}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(c=>{this.autofilled=c.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngDoCheck(){this.ngControl&&(this.updateErrorState(),this.ngControl.disabled!==null&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(c){this._elementRef.nativeElement.focus(c)}updateErrorState(){this._errorStateTracker.updateErrorState()}_focusChanged(c){c!==this.focused&&(this.focused=c,this.stateChanges.next())}_onInput(){}_dirtyCheckNativeValue(){let c=this._elementRef.nativeElement.value;this._previousNativeValue!==c&&(this._previousNativeValue=c,this.stateChanges.next())}_dirtyCheckPlaceholder(){let c=this._getPlaceholder();if(c!==this._previousPlaceholder){let m=this._elementRef.nativeElement;this._previousPlaceholder=c,c?m.setAttribute("placeholder",c):m.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){YL.indexOf(this._type)>-1}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let c=this._elementRef.nativeElement.validity;return c&&c.badInput}get empty(){return!this._isNeverEmpty()&&!this._elementRef.nativeElement.value&&!this._isBadInput()&&!this.autofilled}get shouldLabelFloat(){if(this._isNativeSelect){let c=this._elementRef.nativeElement,m=c.options[0];return this.focused||c.multiple||!this.empty||!!(c.selectedIndex>-1&&m&&m.label)}else return this.focused||!this.empty}setDescribedByIds(c){c.length?this._elementRef.nativeElement.setAttribute("aria-describedby",c.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){let c=this._elementRef.nativeElement;return this._isNativeSelect&&(c.multiple||c.size>1)}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(Nn),Oe(Ed,10),Oe(ux,8),Oe(px,8),Oe(Px),Oe(Ox,10),Oe(TM),Oe(yi),Oe(xp,8))},l.\u0275dir=Qi({type:l,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:18,hostBindings:function(m,r){m&1&&Vi("focus",function(){return r._focusChanged(!0)})("blur",function(){return r._focusChanged(!1)})("input",function(){return r._onInput()}),m&2&&(Oc("id",r.id)("disabled",r.disabled)("required",r.required),Fn("name",r.name||null)("readonly",r.readonly&&!r._isNativeSelect||null)("aria-invalid",r.empty&&r.required?null:r.errorState)("aria-required",r.required)("id",r.id),Tn("mat-input-server",r._isServer)("mat-mdc-form-field-textarea-control",r._isInFormField&&r._isTextarea)("mat-mdc-form-field-input-control",r._isInFormField)("mdc-text-field__input",r._isInFormField)("mat-mdc-native-select-inline",r._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:[Jt.None,"aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],standalone:!0,features:[Fr([{provide:Gf,useExisting:l}]),jr]});let g=l;return g})(),SM=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({imports:[Dr,Yu,Yu,EM,Dr]});let g=l;return g})();var QL=["mat-button",""],JL=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],ez=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var tz=".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}";var iz=["mat-icon-button",""],nz=["*"];var rz=new hi("MAT_BUTTON_CONFIG");var oz=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],MM=(()=>{let l=class l{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(c){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,c)}get disableRipple(){return this._disableRipple}set disableRipple(c){this._disableRipple=c,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(c){this._disabled=c,this._updateRippleDisabled()}constructor(c,m,r,M){this._elementRef=c,this._platform=m,this._ngZone=r,this._animationMode=M,this._focusMonitor=$t(Bf),this._rippleLoader=$t(tM),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;let z=$t(rz,{optional:!0}),ie=c.nativeElement,ue=ie.classList;this.disabledInteractive=z?.disabledInteractive??!1,this._rippleLoader?.configureRipple(ie,{className:"mat-mdc-button-ripple"});for(let{attribute:ye,mdcClasses:Je}of oz)ie.hasAttribute(ye)&&ue.add(...Je)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(c="program",m){c?this._focusMonitor.focusVia(this._elementRef.nativeElement,c,m):this._elementRef.nativeElement.focus(m)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}};l.\u0275fac=function(m){Su()},l.\u0275dir=Qi({type:l,inputs:{color:"color",disableRipple:[Jt.HasDecoratorInputTransform,"disableRipple","disableRipple",pn],disabled:[Jt.HasDecoratorInputTransform,"disabled","disabled",pn],ariaDisabled:[Jt.HasDecoratorInputTransform,"aria-disabled","ariaDisabled",pn],disabledInteractive:[Jt.HasDecoratorInputTransform,"disabledInteractive","disabledInteractive",pn]},features:[xr]});let g=l;return g})();var $f=(()=>{let l=class l extends MM{constructor(c,m,r,M){super(c,m,r,M)}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(Nn),Oe(yi),Oe(xo,8))},l.\u0275cmp=kn({type:l,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(m,r){m&2&&(Fn("disabled",r._getDisabledAttribute())("aria-disabled",r._getAriaDisabled()),ss(r.color?"mat-"+r.color:""),Tn("mat-mdc-button-disabled",r.disabled)("mat-mdc-button-disabled-interactive",r.disabledInteractive)("_mat-animation-noopable",r._animationMode==="NoopAnimations")("mat-unthemed",!r.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[so,Pn],attrs:QL,ngContentSelectors:ez,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(m,r){m&1&&(wo(JL),nn(0,"span",0),lr(1),vt(2,"span",1),lr(3,1),wt(),lr(4,2),nn(5,"span",2)(6,"span",3)),m&2&&Tn("mdc-button__ripple",!r._isFab)("mdc-fab__ripple",r._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape);padding:0 var(--mat-text-button-horizontal-padding, 8px)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape);padding:0 var(--mat-filled-button-horizontal-padding, 16px)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width);padding:0 var(--mat-outlined-button-horizontal-padding, 15px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-outlined-button .mdc-button__label{z-index:1}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let g=l;return g})();var qf=(()=>{let l=class l extends MM{constructor(c,m,r,M){super(c,m,r,M),this._rippleLoader.configureRipple(this._elementRef.nativeElement,{centered:!0})}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(Nn),Oe(yi),Oe(xo,8))},l.\u0275cmp=kn({type:l,selectors:[["button","mat-icon-button",""]],hostVars:14,hostBindings:function(m,r){m&2&&(Fn("disabled",r._getDisabledAttribute())("aria-disabled",r._getAriaDisabled()),ss(r.color?"mat-"+r.color:""),Tn("mat-mdc-button-disabled",r.disabled)("mat-mdc-button-disabled-interactive",r.disabledInteractive)("_mat-animation-noopable",r._animationMode==="NoopAnimations")("mat-unthemed",!r.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[so,Pn],attrs:iz,ngContentSelectors:nz,decls:4,vars:0,consts:[[1,"mat-mdc-button-persistent-ripple","mdc-icon-button__ripple"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(m,r){m&1&&(wo(),nn(0,"span",0),lr(1),nn(2,"span",1)(3,"span",2))},styles:['.mdc-icon-button{display:inline-block;position:relative;box-sizing:border-box;border:none;outline:none;background-color:rgba(0,0,0,0);fill:currentColor;color:inherit;text-decoration:none;cursor:pointer;user-select:none;z-index:0;overflow:visible}.mdc-icon-button .mdc-icon-button__touch{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%)}@media screen and (forced-colors: active){.mdc-icon-button.mdc-ripple-upgraded--background-focused .mdc-icon-button__focus-ring,.mdc-icon-button:not(.mdc-ripple-upgraded):focus .mdc-icon-button__focus-ring{display:block}}.mdc-icon-button:disabled{cursor:default;pointer-events:none}.mdc-icon-button[hidden]{display:none}.mdc-icon-button--display-flex{align-items:center;display:inline-flex;justify-content:center}.mdc-icon-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:100%;width:100%;display:none}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring{border-color:CanvasText}}.mdc-icon-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-icon-button__focus-ring::after{border-color:CanvasText}}.mdc-icon-button__icon{display:inline-block}.mdc-icon-button__icon.mdc-icon-button__icon--on{display:none}.mdc-icon-button--on .mdc-icon-button__icon{display:none}.mdc-icon-button--on .mdc-icon-button__icon.mdc-icon-button__icon--on{display:inline-block}.mdc-icon-button__link{height:100%;left:0;outline:none;position:absolute;top:0;width:100%}.mat-mdc-icon-button{color:var(--mdc-icon-button-icon-color)}.mat-mdc-icon-button .mdc-button__icon{font-size:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button svg,.mat-mdc-icon-button img{width:var(--mdc-icon-button-icon-size);height:var(--mdc-icon-button-icon-size)}.mat-mdc-icon-button:disabled{color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button{border-radius:50%;flex-shrink:0;text-align:center;width:var(--mdc-icon-button-state-layer-size, 48px);height:var(--mdc-icon-button-state-layer-size, 48px);padding:calc(calc(var(--mdc-icon-button-state-layer-size, 48px) - var(--mdc-icon-button-icon-size, 24px)) / 2);font-size:var(--mdc-icon-button-icon-size);-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-icon-button svg{vertical-align:baseline}.mat-mdc-icon-button[disabled],.mat-mdc-icon-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-icon-button-disabled-icon-color)}.mat-mdc-icon-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-icon-button .mat-mdc-button-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple,.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-icon-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-icon-button .mdc-button__label{z-index:1}.mat-mdc-icon-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-icon-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-icon-button .mat-ripple-element{background-color:var(--mat-icon-button-ripple-color)}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-state-layer-color)}.mat-mdc-icon-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-icon-button-disabled-state-layer-color)}.mat-mdc-icon-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-hover-state-layer-opacity)}.mat-mdc-icon-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-icon-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-focus-state-layer-opacity)}.mat-mdc-icon-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-icon-button-pressed-state-layer-opacity)}.mat-mdc-icon-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-icon-button-touch-target-display)}.mat-mdc-icon-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-icon-button .mat-mdc-button-persistent-ripple{border-radius:50%}.mat-mdc-icon-button.mat-unthemed:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-primary:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-accent:not(.mdc-ripple-upgraded):focus::before,.mat-mdc-icon-button.mat-warn:not(.mdc-ripple-upgraded):focus::before{background:rgba(0,0,0,0);opacity:1}',tz],encapsulation:2,changeDetection:0});let g=l;return g})();var Hb=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({imports:[Dr,jf,Dr]});let g=l;return g})();var sz=20,AM=(()=>{let l=class l{constructor(c,m,r){this._ngZone=c,this._platform=m,this._scrolled=new Gi,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(c){this.scrollContainers.has(c)||this.scrollContainers.set(c,c.elementScrolled().subscribe(()=>this._scrolled.next(c)))}deregister(c){let m=this.scrollContainers.get(c);m&&(m.unsubscribe(),this.scrollContainers.delete(c))}scrolled(c=sz){return this._platform.isBrowser?new rs(m=>{this._globalSubscription||this._addGlobalListener();let r=c>0?this._scrolled.pipe(V0(c)).subscribe(m):this._scrolled.subscribe(m);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):ui()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((c,m)=>this.deregister(m)),this._scrolled.complete()}ancestorScrolled(c,m){let r=this.getAncestorScrollContainers(c);return this.scrolled(m).pipe(eo(M=>!M||r.indexOf(M)>-1))}getAncestorScrollContainers(c){let m=[];return this.scrollContainers.forEach((r,M)=>{this._scrollableContainsElement(M,c)&&m.push(M)}),m}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(c,m){let r=Va(m),M=c.getElementRef().nativeElement;do if(r==M)return!0;while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>{let c=this._getWindow();return Cu(c.document,"scroll").subscribe(()=>this._scrolled.next())})}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}};l.\u0275fac=function(m){return new(m||l)(bt(yi),bt(Nn),bt(rn,8))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();var lz=20,Cp=(()=>{let l=class l{constructor(c,m,r){this._platform=c,this._change=new Gi,this._changeListener=M=>{this._change.next(M)},this._document=r,m.runOutsideAngular(()=>{if(c.isBrowser){let M=this._getWindow();M.addEventListener("resize",this._changeListener),M.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let c=this._getWindow();c.removeEventListener("resize",this._changeListener),c.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let c={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),c}getViewportRect(){let c=this.getViewportScrollPosition(),{width:m,height:r}=this.getViewportSize();return{top:c.top,left:c.left,bottom:c.top+r,right:c.left+m,height:r,width:m}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let c=this._document,m=this._getWindow(),r=c.documentElement,M=r.getBoundingClientRect(),z=-M.top||c.body.scrollTop||m.scrollY||r.scrollTop||0,ie=-M.left||c.body.scrollLeft||m.scrollX||r.scrollLeft||0;return{top:z,left:ie}}change(c=lz){return c>0?this._change.pipe(V0(c)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let c=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:c.innerWidth,height:c.innerHeight}:{width:0,height:0}}};l.\u0275fac=function(m){return new(m||l)(bt(Nn),bt(yi),bt(rn,8))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();var wp=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({});let g=l;return g})(),Fx=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({imports:[Id,wp,Id,wp]});let g=l;return g})();var Zf=class{attach(l){return this._attachedHost=l,l.attach(this)}detach(){let l=this._attachedHost;l!=null&&(this._attachedHost=null,l.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(l){this._attachedHost=l}},Tp=class extends Zf{constructor(l,w,c,m,r){super(),this.component=l,this.viewContainerRef=w,this.injector=c,this.componentFactoryResolver=m,this.projectableNodes=r}},Yf=class extends Zf{constructor(l,w,c,m){super(),this.templateRef=l,this.viewContainerRef=w,this.context=c,this.injector=m}get origin(){return this.templateRef.elementRef}attach(l,w=this.context){return this.context=w,super.attach(l)}detach(){return this.context=void 0,super.detach()}},Lx=class extends Zf{constructor(l){super(),this.element=l instanceof zi?l.nativeElement:l}},$b=class{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(l){if(l instanceof Tp)return this._attachedPortal=l,this.attachComponentPortal(l);if(l instanceof Yf)return this._attachedPortal=l,this.attachTemplatePortal(l);if(this.attachDomPortal&&l instanceof Lx)return this._attachedPortal=l,this.attachDomPortal(l)}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(l){this._disposeFn=l}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}};var qb=class extends $b{constructor(l,w,c,m,r){super(),this.outletElement=l,this._componentFactoryResolver=w,this._appRef=c,this._defaultInjector=m,this.attachDomPortal=M=>{this._document;let z=M.element;z.parentNode;let ie=this._document.createComment("dom-portal");z.parentNode.insertBefore(ie,z),this.outletElement.appendChild(z),this._attachedPortal=M,super.setDisposeFn(()=>{ie.parentNode&&ie.parentNode.replaceChild(z,ie)})},this._document=r}attachComponentPortal(l){let c=(l.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(l.component),m;return l.viewContainerRef?(m=l.viewContainerRef.createComponent(c,l.viewContainerRef.length,l.injector||l.viewContainerRef.injector,l.projectableNodes||void 0),this.setDisposeFn(()=>m.destroy())):(m=c.create(l.injector||this._defaultInjector||yd.NULL),this._appRef.attachView(m.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(m.hostView),m.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(m)),this._attachedPortal=l,m}attachTemplatePortal(l){let w=l.viewContainerRef,c=w.createEmbeddedView(l.templateRef,l.context,{injector:l.injector});return c.rootNodes.forEach(m=>this.outletElement.appendChild(m)),c.detectChanges(),this.setDisposeFn(()=>{let m=w.indexOf(c);m!==-1&&w.remove(m)}),this._attachedPortal=l,c}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(l){return l.hostView.rootNodes[0]}};var zx=(()=>{let l=class l extends $b{constructor(c,m,r){super(),this._componentFactoryResolver=c,this._viewContainerRef=m,this._isInitialized=!1,this.attached=new fi,this.attachDomPortal=M=>{this._document;let z=M.element;z.parentNode;let ie=this._document.createComment("dom-portal");M.setAttachedHost(this),z.parentNode.insertBefore(ie,z),this._getRootNode().appendChild(z),this._attachedPortal=M,super.setDisposeFn(()=>{ie.parentNode&&ie.parentNode.replaceChild(z,ie)})},this._document=r}get portal(){return this._attachedPortal}set portal(c){this.hasAttached()&&!c&&!this._isInitialized||(this.hasAttached()&&super.detach(),c&&super.attach(c),this._attachedPortal=c||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(c){c.setAttachedHost(this);let m=c.viewContainerRef!=null?c.viewContainerRef:this._viewContainerRef,M=(c.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(c.component),z=m.createComponent(M,m.length,c.injector||m.injector,c.projectableNodes||void 0);return m!==this._viewContainerRef&&this._getRootNode().appendChild(z.hostView.rootNodes[0]),super.setDisposeFn(()=>z.destroy()),this._attachedPortal=c,this._attachedRef=z,this.attached.emit(z),z}attachTemplatePortal(c){c.setAttachedHost(this);let m=this._viewContainerRef.createEmbeddedView(c.templateRef,c.context,{injector:c.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=c,this._attachedRef=m,this.attached.emit(m),m}_getRootNode(){let c=this._viewContainerRef.element.nativeElement;return c.nodeType===c.ELEMENT_NODE?c:c.parentNode}};l.\u0275fac=function(m){return new(m||l)(Oe(nf),Oe(Pc),Oe(rn))},l.\u0275dir=Qi({type:l,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[Jt.None,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],standalone:!0,features:[so]});let g=l;return g})();var Wb=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({});let g=l;return g})();var kM=MS(),Nx=class{constructor(l,w){this._viewportRuler=l,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=w}attach(){}enable(){if(this._canBeEnabled()){let l=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=l.style.left||"",this._previousHTMLStyles.top=l.style.top||"",l.style.left=lo(-this._previousScrollPosition.left),l.style.top=lo(-this._previousScrollPosition.top),l.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let l=this._document.documentElement,w=this._document.body,c=l.style,m=w.style,r=c.scrollBehavior||"",M=m.scrollBehavior||"";this._isEnabled=!1,c.left=this._previousHTMLStyles.left,c.top=this._previousHTMLStyles.top,l.classList.remove("cdk-global-scrollblock"),kM&&(c.scrollBehavior=m.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),kM&&(c.scrollBehavior=r,m.scrollBehavior=M)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let w=this._document.body,c=this._viewportRuler.getViewportSize();return w.scrollHeight>c.height||w.scrollWidth>c.width}};var Bx=class{constructor(l,w,c,m){this._scrollDispatcher=l,this._ngZone=w,this._viewportRuler=c,this._config=m,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(l){this._overlayRef,this._overlayRef=l}enable(){if(this._scrollSubscription)return;let l=this._scrollDispatcher.scrolled(0).pipe(eo(w=>!w||!this._overlayRef.overlayElement.contains(w.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=l.subscribe(()=>{let w=this._viewportRuler.getViewportScrollPosition().top;Math.abs(w-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=l.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},Zb=class{enable(){}disable(){}attach(){}};function Vx(g,l){return l.some(w=>{let c=g.bottom<w.top,m=g.top>w.bottom,r=g.right<w.left,M=g.left>w.right;return c||m||r||M})}function RM(g,l){return l.some(w=>{let c=g.top<w.top,m=g.bottom>w.bottom,r=g.left<w.left,M=g.right>w.right;return c||m||r||M})}var jx=class{constructor(l,w,c,m){this._scrollDispatcher=l,this._viewportRuler=w,this._ngZone=c,this._config=m,this._scrollSubscription=null}attach(l){this._overlayRef,this._overlayRef=l}enable(){if(!this._scrollSubscription){let l=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(l).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let w=this._overlayRef.overlayElement.getBoundingClientRect(),{width:c,height:m}=this._viewportRuler.getViewportSize();Vx(w,[{width:c,height:m,bottom:m,right:c,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},cz=(()=>{let l=class l{constructor(c,m,r,M){this._scrollDispatcher=c,this._viewportRuler=m,this._ngZone=r,this.noop=()=>new Zb,this.close=z=>new Bx(this._scrollDispatcher,this._ngZone,this._viewportRuler,z),this.block=()=>new Nx(this._viewportRuler,this._document),this.reposition=z=>new jx(this._scrollDispatcher,this._viewportRuler,this._ngZone,z),this._document=M}};l.\u0275fac=function(m){return new(m||l)(bt(AM),bt(Cp),bt(yi),bt(rn))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),Xf=class{constructor(l){if(this.scrollStrategy=new Zb,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,l){let w=Object.keys(l);for(let c of w)l[c]!==void 0&&(this[c]=l[c])}}};var Ux=class{constructor(l,w){this.connectionPair=l,this.scrollableViewProperties=w}};var zM=(()=>{let l=class l{constructor(c){this._attachedOverlays=[],this._document=c}ngOnDestroy(){this.detach()}add(c){this.remove(c),this._attachedOverlays.push(c)}remove(c){let m=this._attachedOverlays.indexOf(c);m>-1&&this._attachedOverlays.splice(m,1),this._attachedOverlays.length===0&&this.detach()}};l.\u0275fac=function(m){return new(m||l)(bt(rn))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),dz=(()=>{let l=class l extends zM{constructor(c,m){super(c),this._ngZone=m,this._keydownListener=r=>{let M=this._attachedOverlays;for(let z=M.length-1;z>-1;z--)if(M[z]._keydownEvents.observers.length>0){let ie=M[z]._keydownEvents;this._ngZone?this._ngZone.run(()=>ie.next(r)):ie.next(r);break}}}add(c){super.add(c),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}};l.\u0275fac=function(m){return new(m||l)(bt(rn),bt(yi,8))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),uz=(()=>{let l=class l extends zM{constructor(c,m,r){super(c),this._platform=m,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=M=>{this._pointerDownEventTarget=vl(M)},this._clickListener=M=>{let z=vl(M),ie=M.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:z;this._pointerDownEventTarget=null;let ue=this._attachedOverlays.slice();for(let ye=ue.length-1;ye>-1;ye--){let Je=ue[ye];if(Je._outsidePointerEvents.observers.length<1||!Je.hasAttached())continue;if(Je.overlayElement.contains(z)||Je.overlayElement.contains(ie))break;let It=Je._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>It.next(M)):It.next(M)}}}add(c){if(super.add(c),!this._isAttached){let m=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(m)):this._addEventListeners(m),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=m.style.cursor,m.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){let c=this._document.body;c.removeEventListener("pointerdown",this._pointerDownListener,!0),c.removeEventListener("click",this._clickListener,!0),c.removeEventListener("auxclick",this._clickListener,!0),c.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(c.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(c){c.addEventListener("pointerdown",this._pointerDownListener,!0),c.addEventListener("click",this._clickListener,!0),c.addEventListener("auxclick",this._clickListener,!0),c.addEventListener("contextmenu",this._clickListener,!0)}};l.\u0275fac=function(m){return new(m||l)(bt(rn),bt(Nn),bt(yi,8))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),NM=(()=>{let l=class l{constructor(c,m){this._platform=m,this._document=c}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let c="cdk-overlay-container";if(this._platform.isBrowser||Ff()){let r=this._document.querySelectorAll(`.${c}[platform="server"], .${c}[platform="test"]`);for(let M=0;M<r.length;M++)r[M].remove()}let m=this._document.createElement("div");m.classList.add(c),Ff()?m.setAttribute("platform","test"):this._platform.isBrowser||m.setAttribute("platform","server"),this._document.body.appendChild(m),this._containerElement=m}};l.\u0275fac=function(m){return new(m||l)(bt(rn),bt(Nn))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),Gx=class{constructor(l,w,c,m,r,M,z,ie,ue,ye=!1){this._portalOutlet=l,this._host=w,this._pane=c,this._config=m,this._ngZone=r,this._keyboardDispatcher=M,this._document=z,this._location=ie,this._outsideClickDispatcher=ue,this._animationsDisabled=ye,this._backdropElement=null,this._backdropClick=new Gi,this._attachments=new Gi,this._detachments=new Gi,this._locationChanges=qr.EMPTY,this._backdropClickHandler=Je=>this._backdropClick.next(Je),this._backdropTransitionendHandler=Je=>{this._disposeBackdrop(Je.target)},this._keydownEvents=new Gi,this._outsidePointerEvents=new Gi,m.scrollStrategy&&(this._scrollStrategy=m.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=m.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(l){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let w=this._portalOutlet.attach(l);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(vo(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof w?.onDestroy=="function"&&w.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),w}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let l=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),l}dispose(){let l=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,l&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(l){l!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=l,this.hasAttached()&&(l.attach(this),this.updatePosition()))}updateSize(l){this._config=Ht(Ht({},this._config),l),this._updateElementSize()}setDirection(l){this._config=Ar(Ht({},this._config),{direction:l}),this._updateElementDirection()}addPanelClass(l){this._pane&&this._toggleClasses(this._pane,l,!0)}removePanelClass(l){this._pane&&this._toggleClasses(this._pane,l,!1)}getDirection(){let l=this._config.direction;return l?typeof l=="string"?l:l.value:"ltr"}updateScrollStrategy(l){l!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=l,this.hasAttached()&&(l.attach(this),l.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let l=this._pane.style;l.width=lo(this._config.width),l.height=lo(this._config.height),l.minWidth=lo(this._config.minWidth),l.minHeight=lo(this._config.minHeight),l.maxWidth=lo(this._config.maxWidth),l.maxHeight=lo(this._config.maxHeight)}_togglePointerEvents(l){this._pane.style.pointerEvents=l?"":"none"}_attachBackdrop(){let l="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(l)})}):this._backdropElement.classList.add(l)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let l=this._backdropElement;if(l){if(this._animationsDisabled){this._disposeBackdrop(l);return}l.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{l.addEventListener("transitionend",this._backdropTransitionendHandler)}),l.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(l)},500))}}_toggleClasses(l,w,c){let m=mp(w||[]).filter(r=>!!r);m.length&&(c?l.classList.add(...m):l.classList.remove(...m))}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{let l=this._ngZone.onStable.pipe(Wr(fl(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),l.unsubscribe())})})}_disposeScrollStrategy(){let l=this._scrollStrategy;l&&(l.disable(),l.detach&&l.detach())}_disposeBackdrop(l){l&&(l.removeEventListener("click",this._backdropClickHandler),l.removeEventListener("transitionend",this._backdropTransitionendHandler),l.remove(),this._backdropElement===l&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}},PM="cdk-overlay-connected-position-bounding-box",hz=/([A-Za-z%]+)$/,Kf=class{get positions(){return this._preferredPositions}constructor(l,w,c,m,r){this._viewportRuler=w,this._document=c,this._platform=m,this._overlayContainer=r,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Gi,this._resizeSubscription=qr.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(l)}attach(l){this._overlayRef&&this._overlayRef,this._validatePositions(),l.hostElement.classList.add(PM),this._overlayRef=l,this._boundingBox=l.hostElement,this._pane=l.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let l=this._originRect,w=this._overlayRect,c=this._viewportRect,m=this._containerRect,r=[],M;for(let z of this._preferredPositions){let ie=this._getOriginPoint(l,m,z),ue=this._getOverlayPoint(ie,w,z),ye=this._getOverlayFit(ue,w,c,z);if(ye.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(z,ie);return}if(this._canFitWithFlexibleDimensions(ye,ue,c)){r.push({position:z,origin:ie,overlayRect:w,boundingBoxRect:this._calculateBoundingBoxRect(ie,z)});continue}(!M||M.overlayFit.visibleArea<ye.visibleArea)&&(M={overlayFit:ye,overlayPoint:ue,originPoint:ie,position:z,overlayRect:w})}if(r.length){let z=null,ie=-1;for(let ue of r){let ye=ue.boundingBoxRect.width*ue.boundingBoxRect.height*(ue.position.weight||1);ye>ie&&(ie=ye,z=ue)}this._isPushed=!1,this._applyPosition(z.position,z.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(M.position,M.originPoint);return}this._applyPosition(M.position,M.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&Xu(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(PM),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let l=this._lastPosition;if(l){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let w=this._getOriginPoint(this._originRect,this._containerRect,l);this._applyPosition(l,w)}else this.apply()}withScrollableContainers(l){return this._scrollables=l,this}withPositions(l){return this._preferredPositions=l,l.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(l){return this._viewportMargin=l,this}withFlexibleDimensions(l=!0){return this._hasFlexibleDimensions=l,this}withGrowAfterOpen(l=!0){return this._growAfterOpen=l,this}withPush(l=!0){return this._canPush=l,this}withLockedPosition(l=!0){return this._positionLocked=l,this}setOrigin(l){return this._origin=l,this}withDefaultOffsetX(l){return this._offsetX=l,this}withDefaultOffsetY(l){return this._offsetY=l,this}withTransformOriginOn(l){return this._transformOriginSelector=l,this}_getOriginPoint(l,w,c){let m;if(c.originX=="center")m=l.left+l.width/2;else{let M=this._isRtl()?l.right:l.left,z=this._isRtl()?l.left:l.right;m=c.originX=="start"?M:z}w.left<0&&(m-=w.left);let r;return c.originY=="center"?r=l.top+l.height/2:r=c.originY=="top"?l.top:l.bottom,w.top<0&&(r-=w.top),{x:m,y:r}}_getOverlayPoint(l,w,c){let m;c.overlayX=="center"?m=-w.width/2:c.overlayX==="start"?m=this._isRtl()?-w.width:0:m=this._isRtl()?0:-w.width;let r;return c.overlayY=="center"?r=-w.height/2:r=c.overlayY=="top"?0:-w.height,{x:l.x+m,y:l.y+r}}_getOverlayFit(l,w,c,m){let r=FM(w),{x:M,y:z}=l,ie=this._getOffset(m,"x"),ue=this._getOffset(m,"y");ie&&(M+=ie),ue&&(z+=ue);let ye=0-M,Je=M+r.width-c.width,It=0-z,st=z+r.height-c.height,Xt=this._subtractOverflows(r.width,ye,Je),Oi=this._subtractOverflows(r.height,It,st),vi=Xt*Oi;return{visibleArea:vi,isCompletelyWithinViewport:r.width*r.height===vi,fitsInViewportVertically:Oi===r.height,fitsInViewportHorizontally:Xt==r.width}}_canFitWithFlexibleDimensions(l,w,c){if(this._hasFlexibleDimensions){let m=c.bottom-w.y,r=c.right-w.x,M=OM(this._overlayRef.getConfig().minHeight),z=OM(this._overlayRef.getConfig().minWidth),ie=l.fitsInViewportVertically||M!=null&&M<=m,ue=l.fitsInViewportHorizontally||z!=null&&z<=r;return ie&&ue}return!1}_pushOverlayOnScreen(l,w,c){if(this._previousPushAmount&&this._positionLocked)return{x:l.x+this._previousPushAmount.x,y:l.y+this._previousPushAmount.y};let m=FM(w),r=this._viewportRect,M=Math.max(l.x+m.width-r.width,0),z=Math.max(l.y+m.height-r.height,0),ie=Math.max(r.top-c.top-l.y,0),ue=Math.max(r.left-c.left-l.x,0),ye=0,Je=0;return m.width<=r.width?ye=ue||-M:ye=l.x<this._viewportMargin?r.left-c.left-l.x:0,m.height<=r.height?Je=ie||-z:Je=l.y<this._viewportMargin?r.top-c.top-l.y:0,this._previousPushAmount={x:ye,y:Je},{x:l.x+ye,y:l.y+Je}}_applyPosition(l,w){if(this._setTransformOrigin(l),this._setOverlayElementStyles(w,l),this._setBoundingBoxStyles(w,l),l.panelClass&&this._addPanelClasses(l.panelClass),this._positionChanges.observers.length){let c=this._getScrollVisibility();if(l!==this._lastPosition||!this._lastScrollVisibility||!pz(this._lastScrollVisibility,c)){let m=new Ux(l,c);this._positionChanges.next(m)}this._lastScrollVisibility=c}this._lastPosition=l,this._isInitialRender=!1}_setTransformOrigin(l){if(!this._transformOriginSelector)return;let w=this._boundingBox.querySelectorAll(this._transformOriginSelector),c,m=l.overlayY;l.overlayX==="center"?c="center":this._isRtl()?c=l.overlayX==="start"?"right":"left":c=l.overlayX==="start"?"left":"right";for(let r=0;r<w.length;r++)w[r].style.transformOrigin=`${c} ${m}`}_calculateBoundingBoxRect(l,w){let c=this._viewportRect,m=this._isRtl(),r,M,z;if(w.overlayY==="top")M=l.y,r=c.height-M+this._viewportMargin;else if(w.overlayY==="bottom")z=c.height-l.y+this._viewportMargin*2,r=c.height-z+this._viewportMargin;else{let st=Math.min(c.bottom-l.y+c.top,l.y),Xt=this._lastBoundingBoxSize.height;r=st*2,M=l.y-st,r>Xt&&!this._isInitialRender&&!this._growAfterOpen&&(M=l.y-Xt/2)}let ie=w.overlayX==="start"&&!m||w.overlayX==="end"&&m,ue=w.overlayX==="end"&&!m||w.overlayX==="start"&&m,ye,Je,It;if(ue)It=c.width-l.x+this._viewportMargin*2,ye=l.x-this._viewportMargin;else if(ie)Je=l.x,ye=c.right-l.x;else{let st=Math.min(c.right-l.x+c.left,l.x),Xt=this._lastBoundingBoxSize.width;ye=st*2,Je=l.x-st,ye>Xt&&!this._isInitialRender&&!this._growAfterOpen&&(Je=l.x-Xt/2)}return{top:M,left:Je,bottom:z,right:It,width:ye,height:r}}_setBoundingBoxStyles(l,w){let c=this._calculateBoundingBoxRect(l,w);!this._isInitialRender&&!this._growAfterOpen&&(c.height=Math.min(c.height,this._lastBoundingBoxSize.height),c.width=Math.min(c.width,this._lastBoundingBoxSize.width));let m={};if(this._hasExactPosition())m.top=m.left="0",m.bottom=m.right=m.maxHeight=m.maxWidth="",m.width=m.height="100%";else{let r=this._overlayRef.getConfig().maxHeight,M=this._overlayRef.getConfig().maxWidth;m.height=lo(c.height),m.top=lo(c.top),m.bottom=lo(c.bottom),m.width=lo(c.width),m.left=lo(c.left),m.right=lo(c.right),w.overlayX==="center"?m.alignItems="center":m.alignItems=w.overlayX==="end"?"flex-end":"flex-start",w.overlayY==="center"?m.justifyContent="center":m.justifyContent=w.overlayY==="bottom"?"flex-end":"flex-start",r&&(m.maxHeight=lo(r)),M&&(m.maxWidth=lo(M))}this._lastBoundingBoxSize=c,Xu(this._boundingBox.style,m)}_resetBoundingBoxStyles(){Xu(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){Xu(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(l,w){let c={},m=this._hasExactPosition(),r=this._hasFlexibleDimensions,M=this._overlayRef.getConfig();if(m){let ye=this._viewportRuler.getViewportScrollPosition();Xu(c,this._getExactOverlayY(w,l,ye)),Xu(c,this._getExactOverlayX(w,l,ye))}else c.position="static";let z="",ie=this._getOffset(w,"x"),ue=this._getOffset(w,"y");ie&&(z+=`translateX(${ie}px) `),ue&&(z+=`translateY(${ue}px)`),c.transform=z.trim(),M.maxHeight&&(m?c.maxHeight=lo(M.maxHeight):r&&(c.maxHeight="")),M.maxWidth&&(m?c.maxWidth=lo(M.maxWidth):r&&(c.maxWidth="")),Xu(this._pane.style,c)}_getExactOverlayY(l,w,c){let m={top:"",bottom:""},r=this._getOverlayPoint(w,this._overlayRect,l);if(this._isPushed&&(r=this._pushOverlayOnScreen(r,this._overlayRect,c)),l.overlayY==="bottom"){let M=this._document.documentElement.clientHeight;m.bottom=`${M-(r.y+this._overlayRect.height)}px`}else m.top=lo(r.y);return m}_getExactOverlayX(l,w,c){let m={left:"",right:""},r=this._getOverlayPoint(w,this._overlayRect,l);this._isPushed&&(r=this._pushOverlayOnScreen(r,this._overlayRect,c));let M;if(this._isRtl()?M=l.overlayX==="end"?"left":"right":M=l.overlayX==="end"?"right":"left",M==="right"){let z=this._document.documentElement.clientWidth;m.right=`${z-(r.x+this._overlayRect.width)}px`}else m.left=lo(r.x);return m}_getScrollVisibility(){let l=this._getOriginRect(),w=this._pane.getBoundingClientRect(),c=this._scrollables.map(m=>m.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:RM(l,c),isOriginOutsideView:Vx(l,c),isOverlayClipped:RM(w,c),isOverlayOutsideView:Vx(w,c)}}_subtractOverflows(l,...w){return w.reduce((c,m)=>c-Math.max(m,0),l)}_getNarrowedViewportRect(){let l=this._document.documentElement.clientWidth,w=this._document.documentElement.clientHeight,c=this._viewportRuler.getViewportScrollPosition();return{top:c.top+this._viewportMargin,left:c.left+this._viewportMargin,right:c.left+l-this._viewportMargin,bottom:c.top+w-this._viewportMargin,width:l-2*this._viewportMargin,height:w-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(l,w){return w==="x"?l.offsetX==null?this._offsetX:l.offsetX:l.offsetY==null?this._offsetY:l.offsetY}_validatePositions(){}_addPanelClasses(l){this._pane&&mp(l).forEach(w=>{w!==""&&this._appliedPanelClasses.indexOf(w)===-1&&(this._appliedPanelClasses.push(w),this._pane.classList.add(w))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(l=>{this._pane.classList.remove(l)}),this._appliedPanelClasses=[])}_getOriginRect(){let l=this._origin;if(l instanceof zi)return l.nativeElement.getBoundingClientRect();if(l instanceof Element)return l.getBoundingClientRect();let w=l.width||0,c=l.height||0;return{top:l.y,bottom:l.y+c,left:l.x,right:l.x+w,height:c,width:w}}};function Xu(g,l){for(let w in l)l.hasOwnProperty(w)&&(g[w]=l[w]);return g}function OM(g){if(typeof g!="number"&&g!=null){let[l,w]=g.split(hz);return!w||w==="px"?parseFloat(l):null}return g||null}function FM(g){return{top:Math.floor(g.top),right:Math.floor(g.right),bottom:Math.floor(g.bottom),left:Math.floor(g.left),width:Math.floor(g.width),height:Math.floor(g.height)}}function pz(g,l){return g===l?!0:g.isOriginClipped===l.isOriginClipped&&g.isOriginOutsideView===l.isOriginOutsideView&&g.isOverlayClipped===l.isOverlayClipped&&g.isOverlayOutsideView===l.isOverlayOutsideView}var LM="cdk-global-overlay-wrapper",Hx=class{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(l){let w=l.getConfig();this._overlayRef=l,this._width&&!w.width&&l.updateSize({width:this._width}),this._height&&!w.height&&l.updateSize({height:this._height}),l.hostElement.classList.add(LM),this._isDisposed=!1}top(l=""){return this._bottomOffset="",this._topOffset=l,this._alignItems="flex-start",this}left(l=""){return this._xOffset=l,this._xPosition="left",this}bottom(l=""){return this._topOffset="",this._bottomOffset=l,this._alignItems="flex-end",this}right(l=""){return this._xOffset=l,this._xPosition="right",this}start(l=""){return this._xOffset=l,this._xPosition="start",this}end(l=""){return this._xOffset=l,this._xPosition="end",this}width(l=""){return this._overlayRef?this._overlayRef.updateSize({width:l}):this._width=l,this}height(l=""){return this._overlayRef?this._overlayRef.updateSize({height:l}):this._height=l,this}centerHorizontally(l=""){return this.left(l),this._xPosition="center",this}centerVertically(l=""){return this.top(l),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let l=this._overlayRef.overlayElement.style,w=this._overlayRef.hostElement.style,c=this._overlayRef.getConfig(),{width:m,height:r,maxWidth:M,maxHeight:z}=c,ie=(m==="100%"||m==="100vw")&&(!M||M==="100%"||M==="100vw"),ue=(r==="100%"||r==="100vh")&&(!z||z==="100%"||z==="100vh"),ye=this._xPosition,Je=this._xOffset,It=this._overlayRef.getConfig().direction==="rtl",st="",Xt="",Oi="";ie?Oi="flex-start":ye==="center"?(Oi="center",It?Xt=Je:st=Je):It?ye==="left"||ye==="end"?(Oi="flex-end",st=Je):(ye==="right"||ye==="start")&&(Oi="flex-start",Xt=Je):ye==="left"||ye==="start"?(Oi="flex-start",st=Je):(ye==="right"||ye==="end")&&(Oi="flex-end",Xt=Je),l.position=this._cssPosition,l.marginLeft=ie?"0":st,l.marginTop=ue?"0":this._topOffset,l.marginBottom=this._bottomOffset,l.marginRight=ie?"0":Xt,w.justifyContent=Oi,w.alignItems=ue?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let l=this._overlayRef.overlayElement.style,w=this._overlayRef.hostElement,c=w.style;w.classList.remove(LM),c.justifyContent=c.alignItems=l.marginTop=l.marginBottom=l.marginLeft=l.marginRight=l.position="",this._overlayRef=null,this._isDisposed=!0}},mz=(()=>{let l=class l{constructor(c,m,r,M){this._viewportRuler=c,this._document=m,this._platform=r,this._overlayContainer=M}global(){return new Hx}flexibleConnectedTo(c){return new Kf(c,this._viewportRuler,this._document,this._platform,this._overlayContainer)}};l.\u0275fac=function(m){return new(m||l)(bt(Cp),bt(rn),bt(Nn),bt(NM))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),fz=0,wl=(()=>{let l=class l{constructor(c,m,r,M,z,ie,ue,ye,Je,It,st,Xt){this.scrollStrategies=c,this._overlayContainer=m,this._componentFactoryResolver=r,this._positionBuilder=M,this._keyboardDispatcher=z,this._injector=ie,this._ngZone=ue,this._document=ye,this._directionality=Je,this._location=It,this._outsideClickDispatcher=st,this._animationsModuleType=Xt}create(c){let m=this._createHostElement(),r=this._createPaneElement(m),M=this._createPortalOutlet(r),z=new Xf(c);return z.direction=z.direction||this._directionality.value,new Gx(M,m,r,z,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations")}position(){return this._positionBuilder}_createPaneElement(c){let m=this._document.createElement("div");return m.id=`cdk-overlay-${fz++}`,m.classList.add("cdk-overlay-pane"),c.appendChild(m),m}_createHostElement(){let c=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(c),c}_createPortalOutlet(c){return this._appRef||(this._appRef=this._injector.get(Kh)),new qb(c,this._componentFactoryResolver,this._appRef,this._injector,this._document)}};l.\u0275fac=function(m){return new(m||l)(bt(cz),bt(NM),bt(nf),bt(mz),bt(dz),bt(yd),bt(yi),bt(rn),bt(Ds),bt(Jh),bt(uz),bt(xo,8))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();var gz=new hi("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let g=$t(wl);return()=>g.scrollStrategies.reposition()}});function _z(g){return()=>g.scrollStrategies.reposition()}var bz={provide:gz,deps:[wl],useFactory:_z},Yb=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({providers:[wl,bz],imports:[Id,Wb,Fx,Fx]});let g=l;return g})();var vz=new hi("mat-select-scroll-strategy",{providedIn:"root",factory:()=>{let g=$t(wl);return()=>g.scrollStrategies.reposition()}});function xz(g){return()=>g.scrollStrategies.reposition()}var wz={provide:vz,deps:[wl],useFactory:xz};var BM=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({providers:[wz],imports:[ku,Yb,Uf,Dr,wp,Yu,Uf,Dr]});let g=l;return g})();var Cz=["mat-calendar-body",""];function Tz(g,l){if(g&1&&(vt(0,"tr",0)(1,"td",3),hn(2),wt()()),g&2){let w=Rn();Ft(),Jl("padding-top",w._cellPadding)("padding-bottom",w._cellPadding),Fn("colspan",w.numCols),Ft(),Ms(" ",w.label," ")}}function Ez(g,l){if(g&1&&(vt(0,"td",3),hn(1),wt()),g&2){let w=Rn(2);Jl("padding-top",w._cellPadding)("padding-bottom",w._cellPadding),Fn("colspan",w._firstRowOffset),Ft(),Ms(" ",w._firstRowOffset>=w.labelMinRequiredCells?w.label:""," ")}}function Iz(g,l){if(g&1){let w=Ho();vt(0,"td",6)(1,"button",7),Vi("click",function(m){let r=Ji(w).$implicit,M=Rn(2);return en(M._cellClicked(r,m))})("focus",function(m){let r=Ji(w).$implicit,M=Rn(2);return en(M._emitActiveDateChange(r,m))}),vt(2,"span",8),hn(3),wt(),nn(4,"span",9),wt()()}if(g&2){let w=l.$implicit,c=l.$index,m=Rn().$index,r=Rn();Jl("width",r._cellWidth)("padding-top",r._cellPadding)("padding-bottom",r._cellPadding),Fn("data-mat-row",m)("data-mat-col",c),Ft(),Tn("mat-calendar-body-disabled",!w.enabled)("mat-calendar-body-active",r._isActiveCell(m,c))("mat-calendar-body-range-start",r._isRangeStart(w.compareValue))("mat-calendar-body-range-end",r._isRangeEnd(w.compareValue))("mat-calendar-body-in-range",r._isInRange(w.compareValue))("mat-calendar-body-comparison-bridge-start",r._isComparisonBridgeStart(w.compareValue,m,c))("mat-calendar-body-comparison-bridge-end",r._isComparisonBridgeEnd(w.compareValue,m,c))("mat-calendar-body-comparison-start",r._isComparisonStart(w.compareValue))("mat-calendar-body-comparison-end",r._isComparisonEnd(w.compareValue))("mat-calendar-body-in-comparison-range",r._isInComparisonRange(w.compareValue))("mat-calendar-body-preview-start",r._isPreviewStart(w.compareValue))("mat-calendar-body-preview-end",r._isPreviewEnd(w.compareValue))("mat-calendar-body-in-preview",r._isInPreview(w.compareValue)),Ni("ngClass",w.cssClasses)("tabindex",r._isActiveCell(m,c)?0:-1),Fn("aria-label",w.ariaLabel)("aria-disabled",!w.enabled||null)("aria-pressed",r._isSelected(w.compareValue))("aria-current",r.todayValue===w.compareValue?"date":null)("aria-describedby",r._getDescribedby(w.compareValue)),Ft(),Tn("mat-calendar-body-selected",r._isSelected(w.compareValue))("mat-calendar-body-comparison-identical",r._isComparisonIdentical(w.compareValue))("mat-calendar-body-today",r.todayValue===w.compareValue),Ft(),Ms(" ",w.displayValue," ")}}function Sz(g,l){if(g&1&&(vt(0,"tr",1),Xn(1,Ez,2,6,"td",4),Au(2,Iz,5,48,"td",5,Mu),wt()),g&2){let w=l.$implicit,c=l.$index,m=Rn();Ft(),Ur(1,c===0&&m._firstRowOffset?1:-1),Ft(),Du(w)}}function Mz(g,l){if(g&1&&(vt(0,"th",2)(1,"span",6),hn(2),wt(),vt(3,"span",3),hn(4),wt()()),g&2){let w=l.$implicit;Ft(2),Co(w.long),Ft(2),Co(w.narrow)}}var Az=["*"];function Dz(g,l){}function kz(g,l){if(g&1){let w=Ho();vt(0,"mat-month-view",2),bl("activeDateChange",function(m){Ji(w);let r=Rn();return _l(r.activeDate,m)||(r.activeDate=m),en(m)}),Vi("_userSelection",function(m){Ji(w);let r=Rn();return en(r._dateSelected(m))})("dragStarted",function(m){Ji(w);let r=Rn();return en(r._dragStarted(m))})("dragEnded",function(m){Ji(w);let r=Rn();return en(r._dragEnded(m))}),wt()}if(g&2){let w=Rn();gl("activeDate",w.activeDate),Ni("selected",w.selected)("dateFilter",w.dateFilter)("maxDate",w.maxDate)("minDate",w.minDate)("dateClass",w.dateClass)("comparisonStart",w.comparisonStart)("comparisonEnd",w.comparisonEnd)("startDateAccessibleName",w.startDateAccessibleName)("endDateAccessibleName",w.endDateAccessibleName)("activeDrag",w._activeDrag)}}function Rz(g,l){if(g&1){let w=Ho();vt(0,"mat-year-view",3),bl("activeDateChange",function(m){Ji(w);let r=Rn();return _l(r.activeDate,m)||(r.activeDate=m),en(m)}),Vi("monthSelected",function(m){Ji(w);let r=Rn();return en(r._monthSelectedInYearView(m))})("selectedChange",function(m){Ji(w);let r=Rn();return en(r._goToDateInView(m,"month"))}),wt()}if(g&2){let w=Rn();gl("activeDate",w.activeDate),Ni("selected",w.selected)("dateFilter",w.dateFilter)("maxDate",w.maxDate)("minDate",w.minDate)("dateClass",w.dateClass)}}function Pz(g,l){if(g&1){let w=Ho();vt(0,"mat-multi-year-view",4),bl("activeDateChange",function(m){Ji(w);let r=Rn();return _l(r.activeDate,m)||(r.activeDate=m),en(m)}),Vi("yearSelected",function(m){Ji(w);let r=Rn();return en(r._yearSelectedInMultiYearView(m))})("selectedChange",function(m){Ji(w);let r=Rn();return en(r._goToDateInView(m,"year"))}),wt()}if(g&2){let w=Rn();gl("activeDate",w.activeDate),Ni("selected",w.selected)("dateFilter",w.dateFilter)("maxDate",w.maxDate)("minDate",w.minDate)("dateClass",w.dateClass)}}function Oz(g,l){}var Fz=["button"],Lz=[[["","matDatepickerToggleIcon",""]]],zz=["[matDatepickerToggleIcon]"];function Nz(g,l){g&1&&(Wh(),vt(0,"svg",2),nn(1,"path",3),wt())}var tg=(()=>{let l=class l{constructor(){this.changes=new Gi,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(c,m){return`${c} \u2013 ${m}`}formatYearRangeLabel(c,m){return`${c} to ${m}`}};l.\u0275fac=function(m){return new(m||l)},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})(),Jf=class{constructor(l,w,c,m,r={},M=l,z){this.value=l,this.displayValue=w,this.ariaLabel=c,this.enabled=m,this.cssClasses=r,this.compareValue=M,this.rawValue=z}},Bz=1,VM=Ba({passive:!1,capture:!0}),Md=Ba({passive:!0,capture:!0}),Xb=Ba({passive:!0}),Ip=(()=>{let l=class l{ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}constructor(c,m){this._elementRef=c,this._ngZone=m,this._platform=$t(Nn),this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new fi,this.previewChange=new fi,this.activeDateChange=new fi,this.dragStarted=new fi,this.dragEnded=new fi,this._didDragSinceMouseDown=!1,this._enterHandler=r=>{if(this._skipNextFocus&&r.type==="focus"){this._skipNextFocus=!1;return}if(r.target&&this.isRange){let M=this._getCellFromElement(r.target);M&&this._ngZone.run(()=>this.previewChange.emit({value:M.enabled?M:null,event:r}))}},this._touchmoveHandler=r=>{if(!this.isRange)return;let M=jM(r),z=M?this._getCellFromElement(M):null;M!==r.target&&(this._didDragSinceMouseDown=!0),qx(r.target)&&r.preventDefault(),this._ngZone.run(()=>this.previewChange.emit({value:z?.enabled?z:null,event:r}))},this._leaveHandler=r=>{this.previewEnd!==null&&this.isRange&&(r.type!=="blur"&&(this._didDragSinceMouseDown=!0),r.target&&this._getCellFromElement(r.target)&&!(r.relatedTarget&&this._getCellFromElement(r.relatedTarget))&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:r})))},this._mousedownHandler=r=>{if(!this.isRange)return;this._didDragSinceMouseDown=!1;let M=r.target&&this._getCellFromElement(r.target);!M||!this._isInRange(M.compareValue)||this._ngZone.run(()=>{this.dragStarted.emit({value:M.rawValue,event:r})})},this._mouseupHandler=r=>{if(!this.isRange)return;let M=qx(r.target);if(!M){this._ngZone.run(()=>{this.dragEnded.emit({value:null,event:r})});return}M.closest(".mat-calendar-body")===this._elementRef.nativeElement&&this._ngZone.run(()=>{let z=this._getCellFromElement(M);this.dragEnded.emit({value:z?.rawValue??null,event:r})})},this._touchendHandler=r=>{let M=jM(r);M&&this._mouseupHandler({target:M})},this._id=`mat-calendar-body-${Bz++}`,this._startDateLabelId=`${this._id}-start-date`,this._endDateLabelId=`${this._id}-end-date`,m.runOutsideAngular(()=>{let r=c.nativeElement;r.addEventListener("touchmove",this._touchmoveHandler,VM),r.addEventListener("mouseenter",this._enterHandler,Md),r.addEventListener("focus",this._enterHandler,Md),r.addEventListener("mouseleave",this._leaveHandler,Md),r.addEventListener("blur",this._leaveHandler,Md),r.addEventListener("mousedown",this._mousedownHandler,Xb),r.addEventListener("touchstart",this._mousedownHandler,Xb),this._platform.isBrowser&&(window.addEventListener("mouseup",this._mouseupHandler),window.addEventListener("touchend",this._touchendHandler))})}_cellClicked(c,m){this._didDragSinceMouseDown||c.enabled&&this.selectedValueChange.emit({value:c.value,event:m})}_emitActiveDateChange(c,m){c.enabled&&this.activeDateChange.emit({value:c.value,event:m})}_isSelected(c){return this.startValue===c||this.endValue===c}ngOnChanges(c){let m=c.numCols,{rows:r,numCols:M}=this;(c.rows||m)&&(this._firstRowOffset=r&&r.length&&r[0].length?M-r[0].length:0),(c.cellAspectRatio||m||!this._cellPadding)&&(this._cellPadding=`${50*this.cellAspectRatio/M}%`),(m||!this._cellWidth)&&(this._cellWidth=`${100/M}%`)}ngOnDestroy(){let c=this._elementRef.nativeElement;c.removeEventListener("touchmove",this._touchmoveHandler,VM),c.removeEventListener("mouseenter",this._enterHandler,Md),c.removeEventListener("focus",this._enterHandler,Md),c.removeEventListener("mouseleave",this._leaveHandler,Md),c.removeEventListener("blur",this._leaveHandler,Md),c.removeEventListener("mousedown",this._mousedownHandler,Xb),c.removeEventListener("touchstart",this._mousedownHandler,Xb),this._platform.isBrowser&&(window.removeEventListener("mouseup",this._mouseupHandler),window.removeEventListener("touchend",this._touchendHandler))}_isActiveCell(c,m){let r=c*this.numCols+m;return c&&(r-=this._firstRowOffset),r==this.activeCell}_focusActiveCell(c=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe(vo(1)).subscribe(()=>{setTimeout(()=>{let m=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");m&&(c||(this._skipNextFocus=!0),m.focus())})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(c){return Wx(c,this.startValue,this.endValue)}_isRangeEnd(c){return Zx(c,this.startValue,this.endValue)}_isInRange(c){return Yx(c,this.startValue,this.endValue,this.isRange)}_isComparisonStart(c){return Wx(c,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(c,m,r){if(!this._isComparisonStart(c)||this._isRangeStart(c)||!this._isInRange(c))return!1;let M=this.rows[m][r-1];if(!M){let z=this.rows[m-1];M=z&&z[z.length-1]}return M&&!this._isRangeEnd(M.compareValue)}_isComparisonBridgeEnd(c,m,r){if(!this._isComparisonEnd(c)||this._isRangeEnd(c)||!this._isInRange(c))return!1;let M=this.rows[m][r+1];if(!M){let z=this.rows[m+1];M=z&&z[0]}return M&&!this._isRangeStart(M.compareValue)}_isComparisonEnd(c){return Zx(c,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(c){return Yx(c,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(c){return this.comparisonStart===this.comparisonEnd&&c===this.comparisonStart}_isPreviewStart(c){return Wx(c,this.previewStart,this.previewEnd)}_isPreviewEnd(c){return Zx(c,this.previewStart,this.previewEnd)}_isInPreview(c){return Yx(c,this.previewStart,this.previewEnd,this.isRange)}_getDescribedby(c){return this.isRange?this.startValue===c&&this.endValue===c?`${this._startDateLabelId} ${this._endDateLabelId}`:this.startValue===c?this._startDateLabelId:this.endValue===c?this._endDateLabelId:null:null}_getCellFromElement(c){let m=qx(c);if(m){let r=m.getAttribute("data-mat-row"),M=m.getAttribute("data-mat-col");if(r&&M)return this.rows[parseInt(r)][parseInt(M)]}return null}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(yi))},l.\u0275cmp=kn({type:l,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange",dragStarted:"dragStarted",dragEnded:"dragEnded"},exportAs:["matCalendarBody"],standalone:!0,features:[jr,Pn],attrs:Cz,decls:7,vars:5,consts:[["aria-hidden","true"],["role","row"],[1,"mat-calendar-body-hidden-label",3,"id"],[1,"mat-calendar-body-label"],[1,"mat-calendar-body-label",3,"paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"click","focus","ngClass","tabindex"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"]],template:function(m,r){m&1&&(Xn(0,Tz,3,6,"tr",0),Au(1,Sz,4,1,"tr",1,Mu),vt(3,"label",2),hn(4),wt(),vt(5,"label",2),hn(6),wt()),m&2&&(Ur(0,r._firstRowOffset<r.labelMinRequiredCells?0:-1),Ft(),Du(r.rows),Ft(2),Ni("id",r._startDateLabelId),Ft(),Ms(" ",r.startDateAccessibleName,`
`),Ft(),Ni("id",r._endDateLabelId),Ft(),Ms(" ",r.endDateAccessibleName,`
`))},dependencies:[Q0],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-outline-color)}.mat-calendar-body-label{height:0;line-height:0;text-align:start;padding-left:4.7142857143%;padding-right:4.7142857143%;font-size:var(--mat-datepicker-calendar-body-label-text-size);font-weight:var(--mat-datepicker-calendar-body-label-text-weight);color:var(--mat-datepicker-calendar-body-label-text-color)}.mat-calendar-body-hidden-label{display:none}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;display:block;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview{color:var(--mat-datepicker-calendar-date-preview-state-outline-color)}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-disabled>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){color:var(--mat-datepicker-calendar-date-disabled-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-disabled-state-outline-color)}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px;color:var(--mat-datepicker-calendar-date-text-color);border-color:var(--mat-datepicker-calendar-date-outline-color)}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-focus-state-background-color)}@media(hover: hover){.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-hover-state-background-color)}}.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-state-background-color);color:var(--mat-datepicker-calendar-date-selected-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-disabled-state-background-color)}.mat-calendar-body-selected.mat-calendar-body-today{box-shadow:inset 0 0 0 1px var(--mat-datepicker-calendar-date-today-selected-state-outline-color)}.mat-calendar-body-in-range::before{background:var(--mat-datepicker-calendar-date-in-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-bridge-start::before,[dir=rtl] .mat-calendar-body-comparison-bridge-end::before{background:linear-gradient(to right, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-comparison-bridge-end::before,[dir=rtl] .mat-calendar-body-comparison-bridge-start::before{background:linear-gradient(to left, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-in-range>.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range.mat-calendar-body-in-range::after{background:var(--mat-datepicker-calendar-date-in-overlap-range-state-background-color)}.mat-calendar-body-comparison-identical.mat-calendar-body-selected,.mat-calendar-body-in-comparison-range>.mat-calendar-body-selected{background:var(--mat-datepicker-calendar-date-in-overlap-range-selected-state-background-color)}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}'],encapsulation:2,changeDetection:0});let g=l;return g})();function $x(g){return g?.nodeName==="TD"}function qx(g){let l;return $x(g)?l=g:$x(g.parentNode)?l=g.parentNode:$x(g.parentNode?.parentNode)&&(l=g.parentNode.parentNode),l?.getAttribute("data-mat-row")!=null?l:null}function Wx(g,l,w){return w!==null&&l!==w&&g<w&&g===l}function Zx(g,l,w){return l!==null&&l!==w&&g>=l&&g===w}function Yx(g,l,w,c){return c&&l!==null&&w!==null&&l!==w&&g>=l&&g<=w}function jM(g){let l=g.changedTouches[0];return document.elementFromPoint(l.clientX,l.clientY)}var Rs=class{constructor(l,w){this.start=l,this.end=w}},eg=(()=>{let l=class l{constructor(c,m){this.selection=c,this._adapter=m,this._selectionChanged=new Gi,this.selectionChanged=this._selectionChanged,this.selection=c}updateSelection(c,m){let r=this.selection;this.selection=c,this._selectionChanged.next({selection:c,source:m,oldValue:r})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(c){return this._adapter.isDateInstance(c)&&this._adapter.isValid(c)}};l.\u0275fac=function(m){Su()},l.\u0275prov=Qt({token:l,factory:l.\u0275fac});let g=l;return g})(),Vz=(()=>{let l=class l extends eg{constructor(c){super(null,c)}add(c){super.updateSelection(c,this)}isValid(){return this.selection!=null&&this._isValidDateInstance(this.selection)}isComplete(){return this.selection!=null}clone(){let c=new l(this._adapter);return c.updateSelection(this.selection,this),c}};l.\u0275fac=function(m){return new(m||l)(bt(qo))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac});let g=l;return g})();function jz(g,l){return g||new Vz(l)}var ZM={provide:eg,deps:[[new Qm,new L_,eg],qo],useFactory:jz};var YM=new hi("MAT_DATE_RANGE_SELECTION_STRATEGY");var Xx=7,UM=(()=>{let l=class l{get activeDate(){return this._activeDate}set activeDate(c){let m=this._activeDate,r=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._hasSameMonthAndYear(m,this._activeDate)||this._init()}get selected(){return this._selected}set selected(c){c instanceof Rs?this._selected=c:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(c){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c))}get maxDate(){return this._maxDate}set maxDate(c){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c))}constructor(c,m,r,M,z){this._changeDetectorRef=c,this._dateFormats=m,this._dateAdapter=r,this._dir=M,this._rangeStrategy=z,this._rerenderSubscription=qr.EMPTY,this.activeDrag=null,this.selectedChange=new fi,this._userSelection=new fi,this.dragStarted=new fi,this.dragEnded=new fi,this.activeDateChange=new fi,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Es(null)).subscribe(()=>this._init())}ngOnChanges(c){let m=c.comparisonStart||c.comparisonEnd;m&&!m.firstChange&&this._setRanges(this.selected),c.activeDrag&&!this.activeDrag&&this._clearPreview()}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(c){let m=c.value,r=this._getDateFromDayOfMonth(m),M,z;this._selected instanceof Rs?(M=this._getDateInCurrentMonth(this._selected.start),z=this._getDateInCurrentMonth(this._selected.end)):M=z=this._getDateInCurrentMonth(this._selected),(M!==m||z!==m)&&this.selectedChange.emit(r),this._userSelection.emit({value:r,event:c.event}),this._clearPreview(),this._changeDetectorRef.markForCheck()}_updateActiveDate(c){let m=c.value,r=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(m),this._dateAdapter.compareDate(r,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(c){let m=this._activeDate,r=this._isRtl();switch(c.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,r?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,r?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case 40:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case 36:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case 33:this.activeDate=c.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case 34:this.activeDate=c.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case 13:case 32:this._selectionKeyPressed=!0,this._canSelect(this._activeDate)&&c.preventDefault();return;case 27:this._previewEnd!=null&&!xl(c)&&(this._clearPreview(),this.activeDrag?this.dragEnded.emit({value:null,event:c}):(this.selectedChange.emit(null),this._userSelection.emit({value:null,event:c})),c.preventDefault(),c.stopPropagation());return;default:return}this._dateAdapter.compareDate(m,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),c.preventDefault()}_handleCalendarBodyKeyup(c){(c.keyCode===32||c.keyCode===13)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:c}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let c=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(Xx+this._dateAdapter.getDayOfWeek(c)-this._dateAdapter.getFirstDayOfWeek())%Xx,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(c){this._matCalendarBody._focusActiveCell(c)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:c,value:m}){if(this._rangeStrategy){let r=m?m.rawValue:null,M=this._rangeStrategy.createPreview(r,this.selected,c);if(this._previewStart=this._getCellCompareValue(M.start),this._previewEnd=this._getCellCompareValue(M.end),this.activeDrag&&r){let z=this._rangeStrategy.createDrag?.(this.activeDrag.value,this.selected,r,c);z&&(this._previewStart=this._getCellCompareValue(z.start),this._previewEnd=this._getCellCompareValue(z.end))}this._changeDetectorRef.detectChanges()}}_dragEnded(c){if(this.activeDrag)if(c.value){let m=this._rangeStrategy?.createDrag?.(this.activeDrag.value,this.selected,c.value,c.event);this.dragEnded.emit({value:m??null,event:c.event})}else this.dragEnded.emit({value:null,event:c.event})}_getDateFromDayOfMonth(c){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),c)}_initWeekdays(){let c=this._dateAdapter.getFirstDayOfWeek(),m=this._dateAdapter.getDayOfWeekNames("narrow"),M=this._dateAdapter.getDayOfWeekNames("long").map((z,ie)=>({long:z,narrow:m[ie]}));this._weekdays=M.slice(c).concat(M.slice(0,c))}_createWeekCells(){let c=this._dateAdapter.getNumDaysInMonth(this.activeDate),m=this._dateAdapter.getDateNames();this._weeks=[[]];for(let r=0,M=this._firstWeekOffset;r<c;r++,M++){M==Xx&&(this._weeks.push([]),M=0);let z=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),r+1),ie=this._shouldEnableDate(z),ue=this._dateAdapter.format(z,this._dateFormats.display.dateA11yLabel),ye=this.dateClass?this.dateClass(z,"month"):void 0;this._weeks[this._weeks.length-1].push(new Jf(r+1,m[r],ue,ie,ye,this._getCellCompareValue(z),z))}}_shouldEnableDate(c){return!!c&&(!this.minDate||this._dateAdapter.compareDate(c,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(c,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(c))}_getDateInCurrentMonth(c){return c&&this._hasSameMonthAndYear(c,this.activeDate)?this._dateAdapter.getDate(c):null}_hasSameMonthAndYear(c,m){return!!(c&&m&&this._dateAdapter.getMonth(c)==this._dateAdapter.getMonth(m)&&this._dateAdapter.getYear(c)==this._dateAdapter.getYear(m))}_getCellCompareValue(c){if(c){let m=this._dateAdapter.getYear(c),r=this._dateAdapter.getMonth(c),M=this._dateAdapter.getDate(c);return new Date(m,r,M).getTime()}return null}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setRanges(c){c instanceof Rs?(this._rangeStart=this._getCellCompareValue(c.start),this._rangeEnd=this._getCellCompareValue(c.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(c),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(c){return!this.dateFilter||this.dateFilter(c)}_clearPreview(){this._previewStart=this._previewEnd=null}};l.\u0275fac=function(m){return new(m||l)(Oe(Pr),Oe(Sd,8),Oe(qo,8),Oe(Ds,8),Oe(YM,8))},l.\u0275cmp=kn({type:l,selectors:[["mat-month-view"]],viewQuery:function(m,r){if(m&1&&cr(Ip,5),m&2){let M;bn(M=yn())&&(r._matCalendarBody=M.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName",activeDrag:"activeDrag"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",dragStarted:"dragStarted",dragEnded:"dragEnded",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],standalone:!0,features:[jr,Pn],decls:8,vars:14,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["scope","col"],["aria-hidden","true"],["colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","previewChange","dragStarted","dragEnded","keyup","keydown","label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","startDateAccessibleName","endDateAccessibleName"],[1,"cdk-visually-hidden"]],template:function(m,r){m&1&&(vt(0,"table",0)(1,"thead",1)(2,"tr"),Au(3,Mz,5,2,"th",2,Mu),wt(),vt(5,"tr",3),nn(6,"th",4),wt()(),vt(7,"tbody",5),Vi("selectedValueChange",function(z){return r._dateSelected(z)})("activeDateChange",function(z){return r._updateActiveDate(z)})("previewChange",function(z){return r._previewChanged(z)})("dragStarted",function(z){return r.dragStarted.emit(z)})("dragEnded",function(z){return r._dragEnded(z)})("keyup",function(z){return r._handleCalendarBodyKeyup(z)})("keydown",function(z){return r._handleCalendarBodyKeydown(z)}),wt()()),m&2&&(Ft(3),Du(r._weekdays),Ft(4),Ni("label",r._monthLabel)("rows",r._weeks)("todayValue",r._todayDate)("startValue",r._rangeStart)("endValue",r._rangeEnd)("comparisonStart",r._comparisonRangeStart)("comparisonEnd",r._comparisonRangeEnd)("previewStart",r._previewStart)("previewEnd",r._previewEnd)("isRange",r._isRange)("labelMinRequiredCells",3)("activeCell",r._dateAdapter.getDate(r.activeDate)-1)("startDateAccessibleName",r.startDateAccessibleName)("endDateAccessibleName",r.endDateAccessibleName))},dependencies:[Ip],encapsulation:2,changeDetection:0});let g=l;return g})(),ds=24,Kx=4,GM=(()=>{let l=class l{get activeDate(){return this._activeDate}set activeDate(c){let m=this._activeDate,r=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),XM(this._dateAdapter,m,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(c){c instanceof Rs?this._selected=c:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c)),this._setSelectedYear(c)}get minDate(){return this._minDate}set minDate(c){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c))}get maxDate(){return this._maxDate}set maxDate(c){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c))}constructor(c,m,r){this._changeDetectorRef=c,this._dateAdapter=m,this._dir=r,this._rerenderSubscription=qr.EMPTY,this.selectedChange=new fi,this.yearSelected=new fi,this.activeDateChange=new fi,this._dateAdapter,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Es(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());let m=this._dateAdapter.getYear(this._activeDate)-Qf(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let r=0,M=[];r<ds;r++)M.push(m+r),M.length==Kx&&(this._years.push(M.map(z=>this._createCellForYear(z))),M=[]);this._changeDetectorRef.markForCheck()}_yearSelected(c){let m=c.value,r=this._dateAdapter.createDate(m,0,1),M=this._getDateFromYear(m);this.yearSelected.emit(r),this.selectedChange.emit(M)}_updateActiveDate(c){let m=c.value,r=this._activeDate;this.activeDate=this._getDateFromYear(m),this._dateAdapter.compareDate(r,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(c){let m=this._activeDate,r=this._isRtl();switch(c.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,r?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-Kx);break;case 40:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,Kx);break;case 36:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-Qf(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,ds-Qf(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,c.altKey?-ds*10:-ds);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,c.altKey?ds*10:ds);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(m,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),c.preventDefault()}_handleCalendarBodyKeyup(c){(c.keyCode===32||c.keyCode===13)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:c}),this._selectionKeyPressed=!1)}_getActiveCell(){return Qf(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(c){let m=this._dateAdapter.getMonth(this.activeDate),r=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(c,m,1));return this._dateAdapter.createDate(c,m,Math.min(this._dateAdapter.getDate(this.activeDate),r))}_createCellForYear(c){let m=this._dateAdapter.createDate(c,0,1),r=this._dateAdapter.getYearName(m),M=this.dateClass?this.dateClass(m,"multi-year"):void 0;return new Jf(c,r,r,this._shouldEnableYear(c),M)}_shouldEnableYear(c){if(c==null||this.maxDate&&c>this._dateAdapter.getYear(this.maxDate)||this.minDate&&c<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;let m=this._dateAdapter.createDate(c,0,1);for(let r=m;this._dateAdapter.getYear(r)==c;r=this._dateAdapter.addCalendarDays(r,1))if(this.dateFilter(r))return!0;return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedYear(c){if(this._selectedYear=null,c instanceof Rs){let m=c.start||c.end;m&&(this._selectedYear=this._dateAdapter.getYear(m))}else c&&(this._selectedYear=this._dateAdapter.getYear(c))}};l.\u0275fac=function(m){return new(m||l)(Oe(Pr),Oe(qo,8),Oe(Ds,8))},l.\u0275cmp=kn({type:l,selectors:[["mat-multi-year-view"]],viewQuery:function(m,r){if(m&1&&cr(Ip,5),m&2){let M;bn(M=yn())&&(r._matCalendarBody=M.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],standalone:!0,features:[Pn],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell"]],template:function(m,r){m&1&&(vt(0,"table",0)(1,"thead",1)(2,"tr"),nn(3,"th",2),wt()(),vt(4,"tbody",3),Vi("selectedValueChange",function(z){return r._yearSelected(z)})("activeDateChange",function(z){return r._updateActiveDate(z)})("keyup",function(z){return r._handleCalendarBodyKeyup(z)})("keydown",function(z){return r._handleCalendarBodyKeydown(z)}),wt()()),m&2&&(Ft(4),Ni("rows",r._years)("todayValue",r._todayYear)("startValue",r._selectedYear)("endValue",r._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",r._getActiveCell()))},dependencies:[Ip],encapsulation:2,changeDetection:0});let g=l;return g})();function XM(g,l,w,c,m){let r=g.getYear(l),M=g.getYear(w),z=KM(g,c,m);return Math.floor((r-z)/ds)===Math.floor((M-z)/ds)}function Qf(g,l,w,c){let m=g.getYear(l);return Uz(m-KM(g,w,c),ds)}function KM(g,l,w){let c=0;return w?c=g.getYear(w)-ds+1:l&&(c=g.getYear(l)),c}function Uz(g,l){return(g%l+l)%l}var HM=(()=>{let l=class l{get activeDate(){return this._activeDate}set activeDate(c){let m=this._activeDate,r=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(r,this.minDate,this.maxDate),this._dateAdapter.getYear(m)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(c){c instanceof Rs?this._selected=c:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c)),this._setSelectedMonth(c)}get minDate(){return this._minDate}set minDate(c){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c))}get maxDate(){return this._maxDate}set maxDate(c){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c))}constructor(c,m,r,M){this._changeDetectorRef=c,this._dateFormats=m,this._dateAdapter=r,this._dir=M,this._rerenderSubscription=qr.EMPTY,this.selectedChange=new fi,this.monthSelected=new fi,this.activeDateChange=new fi,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe(Es(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(c){let m=c.value,r=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),m,1);this.monthSelected.emit(r);let M=this._getDateFromMonth(m);this.selectedChange.emit(M)}_updateActiveDate(c){let m=c.value,r=this._activeDate;this.activeDate=this._getDateFromMonth(m),this._dateAdapter.compareDate(r,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(c){let m=this._activeDate,r=this._isRtl();switch(c.keyCode){case 37:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,r?1:-1);break;case 39:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,r?-1:1);break;case 38:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case 40:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case 36:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case 35:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case 33:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,c.altKey?-10:-1);break;case 34:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,c.altKey?10:1);break;case 13:case 32:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(m,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),c.preventDefault()}_handleCalendarBodyKeyup(c){(c.keyCode===32||c.keyCode===13)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:c}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let c=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(m=>m.map(r=>this._createCellForMonth(r,c[r]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(c){return c&&this._dateAdapter.getYear(c)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(c):null}_getDateFromMonth(c){let m=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),c,1),r=this._dateAdapter.getNumDaysInMonth(m);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),c,Math.min(this._dateAdapter.getDate(this.activeDate),r))}_createCellForMonth(c,m){let r=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),c,1),M=this._dateAdapter.format(r,this._dateFormats.display.monthYearA11yLabel),z=this.dateClass?this.dateClass(r,"year"):void 0;return new Jf(c,m.toLocaleUpperCase(),M,this._shouldEnableMonth(c),z)}_shouldEnableMonth(c){let m=this._dateAdapter.getYear(this.activeDate);if(c==null||this._isYearAndMonthAfterMaxDate(m,c)||this._isYearAndMonthBeforeMinDate(m,c))return!1;if(!this.dateFilter)return!0;let r=this._dateAdapter.createDate(m,c,1);for(let M=r;this._dateAdapter.getMonth(M)==c;M=this._dateAdapter.addCalendarDays(M,1))if(this.dateFilter(M))return!0;return!1}_isYearAndMonthAfterMaxDate(c,m){if(this.maxDate){let r=this._dateAdapter.getYear(this.maxDate),M=this._dateAdapter.getMonth(this.maxDate);return c>r||c===r&&m>M}return!1}_isYearAndMonthBeforeMinDate(c,m){if(this.minDate){let r=this._dateAdapter.getYear(this.minDate),M=this._dateAdapter.getMonth(this.minDate);return c<r||c===r&&m<M}return!1}_isRtl(){return this._dir&&this._dir.value==="rtl"}_setSelectedMonth(c){c instanceof Rs?this._selectedMonth=this._getMonthInCurrentYear(c.start)||this._getMonthInCurrentYear(c.end):this._selectedMonth=this._getMonthInCurrentYear(c)}};l.\u0275fac=function(m){return new(m||l)(Oe(Pr),Oe(Sd,8),Oe(qo,8),Oe(Ds,8))},l.\u0275cmp=kn({type:l,selectors:[["mat-year-view"]],viewQuery:function(m,r){if(m&1&&cr(Ip,5),m&2){let M;bn(M=yn())&&(r._matCalendarBody=M.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],standalone:!0,features:[Pn],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"selectedValueChange","activeDateChange","keyup","keydown","label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell"]],template:function(m,r){m&1&&(vt(0,"table",0)(1,"thead",1)(2,"tr"),nn(3,"th",2),wt()(),vt(4,"tbody",3),Vi("selectedValueChange",function(z){return r._monthSelected(z)})("activeDateChange",function(z){return r._updateActiveDate(z)})("keyup",function(z){return r._handleCalendarBodyKeyup(z)})("keydown",function(z){return r._handleCalendarBodyKeydown(z)}),wt()()),m&2&&(Ft(4),Ni("label",r._yearLabel)("rows",r._months)("todayValue",r._todayMonth)("startValue",r._selectedMonth)("endValue",r._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",r._dateAdapter.getMonth(r.activeDate)))},dependencies:[Ip],encapsulation:2,changeDetection:0});let g=l;return g})(),Gz=1,QM=(()=>{let l=class l{constructor(c,m,r,M,z){this._intl=c,this.calendar=m,this._dateAdapter=r,this._dateFormats=M,this._id=`mat-calendar-header-${Gz++}`,this._periodButtonLabelId=`${this._id}-period-label`,this.calendar.stateChanges.subscribe(()=>z.markForCheck())}get periodButtonText(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRange(...this._formatMinAndMaxYearLabels())}get periodButtonDescription(){return this.calendar.currentView=="month"?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():this.calendar.currentView=="year"?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRangeLabel(...this._formatMinAndMaxYearLabels())}get periodButtonLabel(){return this.calendar.currentView=="month"?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView=this.calendar.currentView=="month"?"multi-year":"month"}previousClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?-1:-ds)}nextClicked(){this.calendar.activeDate=this.calendar.currentView=="month"?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,this.calendar.currentView=="year"?1:ds)}previousEnabled(){return this.calendar.minDate?!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate):!0}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(c,m){return this.calendar.currentView=="month"?this._dateAdapter.getYear(c)==this._dateAdapter.getYear(m)&&this._dateAdapter.getMonth(c)==this._dateAdapter.getMonth(m):this.calendar.currentView=="year"?this._dateAdapter.getYear(c)==this._dateAdapter.getYear(m):XM(this._dateAdapter,c,m,this.calendar.minDate,this.calendar.maxDate)}_formatMinAndMaxYearLabels(){let m=this._dateAdapter.getYear(this.calendar.activeDate)-Qf(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),r=m+ds-1,M=this._dateAdapter.getYearName(this._dateAdapter.createDate(m,0,1)),z=this._dateAdapter.getYearName(this._dateAdapter.createDate(r,0,1));return[M,z]}};l.\u0275fac=function(m){return new(m||l)(Oe(tg),Oe(os(()=>Qx)),Oe(qo,8),Oe(Sd,8),Oe(Pr))},l.\u0275cmp=kn({type:l,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],standalone:!0,features:[Pn],ngContentSelectors:Az,decls:13,vars:11,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],[1,"cdk-visually-hidden",3,"id"],["mat-button","","type","button","aria-live","polite",1,"mat-calendar-period-button",3,"click"],["aria-hidden","true"],["viewBox","0 0 10 5","focusable","false","aria-hidden","true",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"click","disabled"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"click","disabled"]],template:function(m,r){m&1&&(wo(),vt(0,"div",0)(1,"div",1)(2,"label",2),hn(3),wt(),vt(4,"button",3),Vi("click",function(){return r.currentPeriodClicked()}),vt(5,"span",4),hn(6),wt(),Wh(),vt(7,"svg",5),nn(8,"polygon",6),wt()(),z_(),nn(9,"div",7),lr(10),vt(11,"button",8),Vi("click",function(){return r.previousClicked()}),wt(),vt(12,"button",9),Vi("click",function(){return r.nextClicked()}),wt()()()),m&2&&(Ft(2),Ni("id",r._periodButtonLabelId),Ft(),Co(r.periodButtonDescription),Ft(),Fn("aria-label",r.periodButtonLabel)("aria-describedby",r._periodButtonLabelId),Ft(2),Co(r.periodButtonText),Ft(),Tn("mat-calendar-invert",r.calendar.currentView!=="month"),Ft(4),Ni("disabled",!r.previousEnabled()),Fn("aria-label",r.prevButtonLabel),Ft(),Ni("disabled",!r.nextEnabled()),Fn("aria-label",r.nextButtonLabel))},dependencies:[$f,qf],encapsulation:2,changeDetection:0});let g=l;return g})(),Qx=(()=>{let l=class l{get startAt(){return this._startAt}set startAt(c){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c))}get selected(){return this._selected}set selected(c){c instanceof Rs?this._selected=c:this._selected=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c))}get minDate(){return this._minDate}set minDate(c){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c))}get maxDate(){return this._maxDate}set maxDate(c){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c))}get activeDate(){return this._clampedActiveDate}set activeDate(c){this._clampedActiveDate=this._dateAdapter.clampDate(c,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(c){let m=this._currentView!==c?c:null;this._currentView=c,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),m&&this.viewChanged.emit(m)}constructor(c,m,r,M){this._dateAdapter=m,this._dateFormats=r,this._changeDetectorRef=M,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new fi,this.yearSelected=new fi,this.monthSelected=new fi,this.viewChanged=new fi(!0),this._userSelection=new fi,this._userDragDrop=new fi,this._activeDrag=null,this.stateChanges=new Gi,this._intlChanges=c.changes.subscribe(()=>{M.markForCheck(),this.stateChanges.next()})}ngAfterContentInit(){this._calendarHeaderPortal=new Tp(this.headerComponent||QM),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(c){let m=c.minDate&&!this._dateAdapter.sameDate(c.minDate.previousValue,c.minDate.currentValue)?c.minDate:void 0,r=c.maxDate&&!this._dateAdapter.sameDate(c.maxDate.previousValue,c.maxDate.currentValue)?c.maxDate:void 0,M=m||r||c.dateFilter;if(M&&!M.firstChange){let z=this._getCurrentViewComponent();z&&(this._changeDetectorRef.detectChanges(),z._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(c){let m=c.value;(this.selected instanceof Rs||m&&!this._dateAdapter.sameDate(m,this.selected))&&this.selectedChange.emit(m),this._userSelection.emit(c)}_yearSelectedInMultiYearView(c){this.yearSelected.emit(c)}_monthSelectedInYearView(c){this.monthSelected.emit(c)}_goToDateInView(c,m){this.activeDate=c,this.currentView=m}_dragStarted(c){this._activeDrag=c}_dragEnded(c){this._activeDrag&&(c.value&&this._userDragDrop.emit(c),this._activeDrag=null)}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}};l.\u0275fac=function(m){return new(m||l)(Oe(tg),Oe(qo,8),Oe(Sd,8),Oe(Pr))},l.\u0275cmp=kn({type:l,selectors:[["mat-calendar"]],viewQuery:function(m,r){if(m&1&&(cr(UM,5),cr(HM,5),cr(GM,5)),m&2){let M;bn(M=yn())&&(r.monthView=M.first),bn(M=yn())&&(r.yearView=M.first),bn(M=yn())&&(r.multiYearView=M.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection",_userDragDrop:"_userDragDrop"},exportAs:["matCalendar"],standalone:!0,features:[Fr([ZM]),jr,Pn],decls:5,vars:2,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content"],[3,"activeDateChange","_userSelection","dragStarted","dragEnded","activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag"],[3,"activeDateChange","monthSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"],[3,"activeDateChange","yearSelected","selectedChange","activeDate","selected","dateFilter","maxDate","minDate","dateClass"]],template:function(m,r){if(m&1&&(Xn(0,Dz,0,0,"ng-template",0),vt(1,"div",1),Xn(2,kz,1,11)(3,Rz,1,6)(4,Pz,1,6),wt()),m&2){let M;Ni("cdkPortalOutlet",r._calendarHeaderPortal),Ft(2),Ur(2,(M=r.currentView)==="month"?2:M==="year"?3:M==="multi-year"?4:-1)}},dependencies:[zx,Ex,UM,HM,GM],styles:['.mat-calendar{display:block;font-family:var(--mat-datepicker-calendar-text-font);font-size:var(--mat-datepicker-calendar-text-size)}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;align-items:center;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0;margin:0 8px;font-size:var(--mat-datepicker-calendar-period-button-text-size);font-weight:var(--mat-datepicker-calendar-period-button-text-weight);--mdc-text-button-label-text-color:var(--mat-datepicker-calendar-period-button-text-color)}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle;fill:var(--mat-datepicker-calendar-period-button-icon-color)}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-datepicker-content .mat-calendar-previous-button:not(.mat-mdc-button-disabled),.mat-datepicker-content .mat-calendar-next-button:not(.mat-mdc-button-disabled){color:var(--mat-datepicker-calendar-navigation-button-icon-color)}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0;color:var(--mat-datepicker-calendar-header-text-color);font-size:var(--mat-datepicker-calendar-header-text-size);font-weight:var(--mat-datepicker-calendar-header-text-weight)}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px;background:var(--mat-datepicker-calendar-header-divider-color)}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px)*-1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let g=l;return g})(),$M={transformPanel:rf("transformPanel",[Pu("void => enter-dropdown",Ru("120ms cubic-bezier(0, 0, 0.2, 1)",J0([yl({opacity:0,transform:"scale(1, 0.8)"}),yl({opacity:1,transform:"scale(1, 1)"})]))),Pu("void => enter-dialog",Ru("150ms cubic-bezier(0, 0, 0.2, 1)",J0([yl({opacity:0,transform:"scale(0.7)"}),yl({transform:"none",opacity:1})]))),Pu("* => void",Ru("100ms linear",yl({opacity:0})))]),fadeInCalendar:rf("fadeInCalendar",[of("void",yl({opacity:0})),of("enter",yl({opacity:1})),Pu("void => *",Ru("120ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)"))])},Hz=0,JM=new hi("mat-datepicker-scroll-strategy",{providedIn:"root",factory:()=>{let g=$t(wl);return()=>g.scrollStrategies.reposition()}});function $z(g){return()=>g.scrollStrategies.reposition()}var qz={provide:JM,deps:[wl],useFactory:$z},eA=(()=>{let l=class l{constructor(c,m,r,M,z,ie){this._elementRef=c,this._changeDetectorRef=m,this._globalModel=r,this._dateAdapter=M,this._rangeSelectionStrategy=z,this._subscriptions=new qr,this._animationDone=new Gi,this._isAnimating=!1,this._actionsPortal=null,this._closeButtonText=ie.closeCalendarLabel}ngOnInit(){this._animationState=this.datepicker.touchUi?"enter-dialog":"enter-dropdown"}ngAfterViewInit(){this._subscriptions.add(this.datepicker.stateChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})),this._calendar.focusActiveCell()}ngOnDestroy(){this._subscriptions.unsubscribe(),this._animationDone.complete()}_handleUserSelection(c){let m=this._model.selection,r=c.value,M=m instanceof Rs;if(M&&this._rangeSelectionStrategy){let z=this._rangeSelectionStrategy.selectionFinished(r,m,c.event);this._model.updateSelection(z,this)}else r&&(M||!this._dateAdapter.sameDate(r,m))&&this._model.add(r);(!this._model||this._model.isComplete())&&!this._actionsPortal&&this.datepicker.close()}_handleUserDragDrop(c){this._model.updateSelection(c.value,this)}_startExitAnimation(){this._animationState="void",this._changeDetectorRef.markForCheck()}_handleAnimationEvent(c){this._isAnimating=c.phaseName==="start",this._isAnimating||this._animationDone.next()}_getSelected(){return this._model.selection}_applyPendingSelection(){this._model!==this._globalModel&&this._globalModel.updateSelection(this._model.selection,this)}_assignActions(c,m){this._model=c?this._globalModel.clone():this._globalModel,this._actionsPortal=c,m&&this._changeDetectorRef.detectChanges()}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(Pr),Oe(eg),Oe(qo),Oe(YM,8),Oe(tg))},l.\u0275cmp=kn({type:l,selectors:[["mat-datepicker-content"]],viewQuery:function(m,r){if(m&1&&cr(Qx,5),m&2){let M;bn(M=yn())&&(r._calendar=M.first)}},hostAttrs:[1,"mat-datepicker-content"],hostVars:5,hostBindings:function(m,r){m&1&&zE("@transformPanel.start",function(z){return r._handleAnimationEvent(z)})("@transformPanel.done",function(z){return r._handleAnimationEvent(z)}),m&2&&(LE("@transformPanel",r._animationState),ss(r.color?"mat-"+r.color:""),Tn("mat-datepicker-content-touch",r.datepicker.touchUi))},inputs:{color:"color"},exportAs:["matDatepickerContent"],standalone:!0,features:[Pn],decls:5,vars:27,consts:[["cdkTrapFocus","","role","dialog",1,"mat-datepicker-content-container"],[3,"yearSelected","monthSelected","viewChanged","_userSelection","_userDragDrop","id","startAt","startView","minDate","maxDate","dateFilter","headerComponent","selected","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName"],[3,"cdkPortalOutlet"],["type","button","mat-raised-button","",1,"mat-datepicker-close-button",3,"focus","blur","click","color"]],template:function(m,r){if(m&1&&(vt(0,"div",0)(1,"mat-calendar",1),Vi("yearSelected",function(z){return r.datepicker._selectYear(z)})("monthSelected",function(z){return r.datepicker._selectMonth(z)})("viewChanged",function(z){return r.datepicker._viewChanged(z)})("_userSelection",function(z){return r._handleUserSelection(z)})("_userDragDrop",function(z){return r._handleUserDragDrop(z)}),wt(),Xn(2,Oz,0,0,"ng-template",2),vt(3,"button",3),Vi("focus",function(){return r._closeButtonFocused=!0})("blur",function(){return r._closeButtonFocused=!1})("click",function(){return r.datepicker.close()}),hn(4),wt()()),m&2){let M;Tn("mat-datepicker-content-container-with-custom-header",r.datepicker.calendarHeaderComponent)("mat-datepicker-content-container-with-actions",r._actionsPortal),Fn("aria-modal",!0)("aria-labelledby",(M=r._dialogLabelId)!==null&&M!==void 0?M:void 0),Ft(),ss(r.datepicker.panelClass),Ni("id",r.datepicker.id)("startAt",r.datepicker.startAt)("startView",r.datepicker.startView)("minDate",r.datepicker._getMinDate())("maxDate",r.datepicker._getMaxDate())("dateFilter",r.datepicker._getDateFilter())("headerComponent",r.datepicker.calendarHeaderComponent)("selected",r._getSelected())("dateClass",r.datepicker.dateClass)("comparisonStart",r.comparisonStart)("comparisonEnd",r.comparisonEnd)("@fadeInCalendar","enter")("startDateAccessibleName",r.startDateAccessibleName)("endDateAccessibleName",r.endDateAccessibleName),Ft(),Ni("cdkPortalOutlet",r._actionsPortal),Ft(),Tn("cdk-visually-hidden",!r._closeButtonFocused),Ni("color",r.color||"primary"),Ft(),Co(r._closeButtonText)}},dependencies:[jS,Qx,zx,$f],styles:[".mat-datepicker-content{display:block;border-radius:4px;background-color:var(--mat-datepicker-calendar-container-background-color);color:var(--mat-datepicker-calendar-container-text-color);box-shadow:var(--mat-datepicker-calendar-container-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-shape)}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content .mat-datepicker-content-container-with-custom-header .mat-calendar{height:auto}.mat-datepicker-content .mat-datepicker-close-button{position:absolute;top:100%;left:0;margin-top:8px}.ng-animating .mat-datepicker-content .mat-datepicker-close-button{display:none}.mat-datepicker-content-container{display:flex;flex-direction:column;justify-content:space-between}.mat-datepicker-content-touch{display:block;max-height:80vh;box-shadow:var(--mat-datepicker-calendar-container-touch-elevation-shadow);border-radius:var(--mat-datepicker-calendar-container-touch-shape);position:relative;overflow:visible}.mat-datepicker-content-touch .mat-datepicker-content-container{min-height:312px;max-height:788px;min-width:250px;max-width:750px}.mat-datepicker-content-touch .mat-calendar{width:100%;height:auto}@media all and (orientation: landscape){.mat-datepicker-content-touch .mat-datepicker-content-container{width:64vh;height:80vh}}@media all and (orientation: portrait){.mat-datepicker-content-touch .mat-datepicker-content-container{width:80vw;height:100vw}.mat-datepicker-content-touch .mat-datepicker-content-container-with-actions{height:115vw}}"],encapsulation:2,data:{animation:[$M.transformPanel,$M.fadeInCalendar]},changeDetection:0});let g=l;return g})(),qM=(()=>{let l=class l{get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.getStartValue():null)}set startAt(c){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c))}get color(){return this._color||(this.datepickerInput?this.datepickerInput.getThemePalette():void 0)}set color(c){this._color=c}get disabled(){return this._disabled===void 0&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(c){c!==this._disabled&&(this._disabled=c,this.stateChanges.next(void 0))}get panelClass(){return this._panelClass}set panelClass(c){this._panelClass=kS(c)}get opened(){return this._opened}set opened(c){c?this.open():this.close()}_getMinDate(){return this.datepickerInput&&this.datepickerInput.min}_getMaxDate(){return this.datepickerInput&&this.datepickerInput.max}_getDateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}constructor(c,m,r,M,z,ie,ue){this._overlay=c,this._ngZone=m,this._viewContainerRef=r,this._dateAdapter=z,this._dir=ie,this._model=ue,this._inputStateChanges=qr.EMPTY,this._document=$t(rn),this.startView="month",this.touchUi=!1,this.xPosition="start",this.yPosition="below",this.restoreFocus=!0,this.yearSelected=new fi,this.monthSelected=new fi,this.viewChanged=new fi(!0),this.openedStream=new fi,this.closedStream=new fi,this._opened=!1,this.id=`mat-datepicker-${Hz++}`,this._focusedElementBeforeOpen=null,this._backdropHarnessClass=`${this.id}-backdrop`,this.stateChanges=new Gi,this._dateAdapter,this._scrollStrategy=M}ngOnChanges(c){let m=c.xPosition||c.yPosition;if(m&&!m.firstChange&&this._overlayRef){let r=this._overlayRef.getConfig().positionStrategy;r instanceof Kf&&(this._setConnectedPositions(r),this.opened&&this._overlayRef.updatePosition())}this.stateChanges.next(void 0)}ngOnDestroy(){this._destroyOverlay(),this.close(),this._inputStateChanges.unsubscribe(),this.stateChanges.complete()}select(c){this._model.add(c)}_selectYear(c){this.yearSelected.emit(c)}_selectMonth(c){this.monthSelected.emit(c)}_viewChanged(c){this.viewChanged.emit(c)}registerInput(c){return this.datepickerInput,this._inputStateChanges.unsubscribe(),this.datepickerInput=c,this._inputStateChanges=c.stateChanges.subscribe(()=>this.stateChanges.next(void 0)),this._model}registerActions(c){this._actionsPortal,this._actionsPortal=c,this._componentRef?.instance._assignActions(c,!0)}removeActions(c){c===this._actionsPortal&&(this._actionsPortal=null,this._componentRef?.instance._assignActions(null,!0))}open(){this._opened||this.disabled||this._componentRef?.instance._isAnimating||(this.datepickerInput,this._focusedElementBeforeOpen=Pb(),this._openOverlay(),this._opened=!0,this.openedStream.emit())}close(){if(!this._opened||this._componentRef?.instance._isAnimating)return;let c=this.restoreFocus&&this._focusedElementBeforeOpen&&typeof this._focusedElementBeforeOpen.focus=="function",m=()=>{this._opened&&(this._opened=!1,this.closedStream.emit())};if(this._componentRef){let{instance:r,location:M}=this._componentRef;r._startExitAnimation(),r._animationDone.pipe(vo(1)).subscribe(()=>{let z=this._document.activeElement;c&&(!z||z===this._document.activeElement||M.nativeElement.contains(z))&&this._focusedElementBeforeOpen.focus(),this._focusedElementBeforeOpen=null,this._destroyOverlay()})}c?setTimeout(m):m()}_applyPendingSelection(){this._componentRef?.instance?._applyPendingSelection()}_forwardContentValues(c){c.datepicker=this,c.color=this.color,c._dialogLabelId=this.datepickerInput.getOverlayLabelId(),c._assignActions(this._actionsPortal,!1)}_openOverlay(){this._destroyOverlay();let c=this.touchUi,m=new Tp(eA,this._viewContainerRef),r=this._overlayRef=this._overlay.create(new Xf({positionStrategy:c?this._getDialogStrategy():this._getDropdownStrategy(),hasBackdrop:!0,backdropClass:[c?"cdk-overlay-dark-backdrop":"mat-overlay-transparent-backdrop",this._backdropHarnessClass],direction:this._dir,scrollStrategy:c?this._overlay.scrollStrategies.block():this._scrollStrategy(),panelClass:`mat-datepicker-${c?"dialog":"popup"}`}));this._getCloseStream(r).subscribe(M=>{M&&M.preventDefault(),this.close()}),r.keydownEvents().subscribe(M=>{let z=M.keyCode;(z===38||z===40||z===37||z===39||z===33||z===34)&&M.preventDefault()}),this._componentRef=r.attach(m),this._forwardContentValues(this._componentRef.instance),c||this._ngZone.onStable.pipe(vo(1)).subscribe(()=>r.updatePosition())}_destroyOverlay(){this._overlayRef&&(this._overlayRef.dispose(),this._overlayRef=this._componentRef=null)}_getDialogStrategy(){return this._overlay.position().global().centerHorizontally().centerVertically()}_getDropdownStrategy(){let c=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".mat-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withLockedPosition();return this._setConnectedPositions(c)}_setConnectedPositions(c){let m=this.xPosition==="end"?"end":"start",r=m==="start"?"end":"start",M=this.yPosition==="above"?"bottom":"top",z=M==="top"?"bottom":"top";return c.withPositions([{originX:m,originY:z,overlayX:m,overlayY:M},{originX:m,originY:M,overlayX:m,overlayY:z},{originX:r,originY:z,overlayX:r,overlayY:M},{originX:r,originY:M,overlayX:r,overlayY:z}])}_getCloseStream(c){let m=["ctrlKey","shiftKey","metaKey"];return fl(c.backdropClick(),c.detachments(),c.keydownEvents().pipe(eo(r=>r.keyCode===27&&!xl(r)||this.datepickerInput&&xl(r,"altKey")&&r.keyCode===38&&m.every(M=>!xl(r,M)))))}};l.\u0275fac=function(m){return new(m||l)(Oe(wl),Oe(yi),Oe(Pc),Oe(JM),Oe(qo,8),Oe(Ds,8),Oe(eg))},l.\u0275dir=Qi({type:l,inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",startView:"startView",color:"color",touchUi:[Jt.HasDecoratorInputTransform,"touchUi","touchUi",pn],disabled:[Jt.HasDecoratorInputTransform,"disabled","disabled",pn],xPosition:"xPosition",yPosition:"yPosition",restoreFocus:[Jt.HasDecoratorInputTransform,"restoreFocus","restoreFocus",pn],dateClass:"dateClass",panelClass:"panelClass",opened:[Jt.HasDecoratorInputTransform,"opened","opened",pn]},outputs:{yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",openedStream:"opened",closedStream:"closed"},features:[xr,jr]});let g=l;return g})(),tA=(()=>{let l=class l extends qM{};l.\u0275fac=(()=>{let c;return function(r){return(c||(c=Ql(l)))(r||l)}})(),l.\u0275cmp=kn({type:l,selectors:[["mat-datepicker"]],exportAs:["matDatepicker"],standalone:!0,features:[Fr([ZM,{provide:qM,useExisting:l}]),so,Pn],decls:0,vars:0,template:function(m,r){},encapsulation:2,changeDetection:0});let g=l;return g})(),Ep=class{constructor(l,w){this.target=l,this.targetElement=w,this.value=this.target.value}},Wz=(()=>{let l=class l{get value(){return this._model?this._getValueFromModel(this._model.selection):this._pendingValue}set value(c){this._assignValueProgrammatically(c)}get disabled(){return!!this._disabled||this._parentDisabled()}set disabled(c){let m=c,r=this._elementRef.nativeElement;this._disabled!==m&&(this._disabled=m,this.stateChanges.next(void 0)),m&&this._isInitialized&&r.blur&&r.blur()}_getValidators(){return[this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]}_registerModel(c){this._model=c,this._valueChangesSubscription.unsubscribe(),this._pendingValue&&this._assignValue(this._pendingValue),this._valueChangesSubscription=this._model.selectionChanged.subscribe(m=>{if(this._shouldHandleChangeEvent(m)){let r=this._getValueFromModel(m.selection);this._lastValueValid=this._isValidValue(r),this._cvaOnChange(r),this._onTouched(),this._formatValue(r),this.dateInput.emit(new Ep(this,this._elementRef.nativeElement)),this.dateChange.emit(new Ep(this,this._elementRef.nativeElement))}})}constructor(c,m,r){this._elementRef=c,this._dateAdapter=m,this._dateFormats=r,this.dateChange=new fi,this.dateInput=new fi,this.stateChanges=new Gi,this._onTouched=()=>{},this._validatorOnChange=()=>{},this._cvaOnChange=()=>{},this._valueChangesSubscription=qr.EMPTY,this._localeSubscription=qr.EMPTY,this._parseValidator=()=>this._lastValueValid?null:{matDatepickerParse:{text:this._elementRef.nativeElement.value}},this._filterValidator=M=>{let z=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(M.value));return!z||this._matchesFilter(z)?null:{matDatepickerFilter:!0}},this._minValidator=M=>{let z=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(M.value)),ie=this._getMinDate();return!ie||!z||this._dateAdapter.compareDate(ie,z)<=0?null:{matDatepickerMin:{min:ie,actual:z}}},this._maxValidator=M=>{let z=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(M.value)),ie=this._getMaxDate();return!ie||!z||this._dateAdapter.compareDate(ie,z)>=0?null:{matDatepickerMax:{max:ie,actual:z}}},this._lastValueValid=!1,this._localeSubscription=m.localeChanges.subscribe(()=>{this._assignValueProgrammatically(this.value)})}ngAfterViewInit(){this._isInitialized=!0}ngOnChanges(c){Zz(c,this._dateAdapter)&&this.stateChanges.next(void 0)}ngOnDestroy(){this._valueChangesSubscription.unsubscribe(),this._localeSubscription.unsubscribe(),this.stateChanges.complete()}registerOnValidatorChange(c){this._validatorOnChange=c}validate(c){return this._validator?this._validator(c):null}writeValue(c){this._assignValueProgrammatically(c)}registerOnChange(c){this._cvaOnChange=c}registerOnTouched(c){this._onTouched=c}setDisabledState(c){this.disabled=c}_onKeydown(c){let m=["ctrlKey","shiftKey","metaKey"];xl(c,"altKey")&&c.keyCode===40&&m.every(M=>!xl(c,M))&&!this._elementRef.nativeElement.readOnly&&(this._openPopup(),c.preventDefault())}_onInput(c){let m=this._lastValueValid,r=this._dateAdapter.parse(c,this._dateFormats.parse.dateInput);this._lastValueValid=this._isValidValue(r),r=this._dateAdapter.getValidDateOrNull(r);let M=!this._dateAdapter.sameDate(r,this.value);!r||M?this._cvaOnChange(r):(c&&!this.value&&this._cvaOnChange(r),m!==this._lastValueValid&&this._validatorOnChange()),M&&(this._assignValue(r),this.dateInput.emit(new Ep(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new Ep(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched()}_formatValue(c){this._elementRef.nativeElement.value=c!=null?this._dateAdapter.format(c,this._dateFormats.display.dateInput):""}_assignValue(c){this._model?(this._assignValueToModel(c),this._pendingValue=null):this._pendingValue=c}_isValidValue(c){return!c||this._dateAdapter.isValid(c)}_parentDisabled(){return!1}_assignValueProgrammatically(c){c=this._dateAdapter.deserialize(c),this._lastValueValid=this._isValidValue(c),c=this._dateAdapter.getValidDateOrNull(c),this._assignValue(c),this._formatValue(c)}_matchesFilter(c){let m=this._getDateFilter();return!m||m(c)}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(qo,8),Oe(Sd,8))},l.\u0275dir=Qi({type:l,inputs:{value:"value",disabled:[Jt.HasDecoratorInputTransform,"disabled","disabled",pn]},outputs:{dateChange:"dateChange",dateInput:"dateInput"},standalone:!0,features:[xr,jr]});let g=l;return g})();function Zz(g,l){let w=Object.keys(g);for(let c of w){let{previousValue:m,currentValue:r}=g[c];if(l.isDateInstance(m)&&l.isDateInstance(r)){if(!l.sameDate(m,r))return!0}else return!0}return!1}var Yz={provide:Vu,useExisting:os(()=>Kb),multi:!0},Xz={provide:ju,useExisting:os(()=>Kb),multi:!0},Kb=(()=>{let l=class l extends Wz{set matDatepicker(c){c&&(this._datepicker=c,this._closedSubscription=c.closedStream.subscribe(()=>this._onTouched()),this._registerModel(c.registerInput(this)))}get min(){return this._min}set min(c){let m=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c));this._dateAdapter.sameDate(m,this._min)||(this._min=m,this._validatorOnChange())}get max(){return this._max}set max(c){let m=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(c));this._dateAdapter.sameDate(m,this._max)||(this._max=m,this._validatorOnChange())}get dateFilter(){return this._dateFilter}set dateFilter(c){let m=this._matchesFilter(this.value);this._dateFilter=c,this._matchesFilter(this.value)!==m&&this._validatorOnChange()}constructor(c,m,r,M){super(c,m,r),this._formField=M,this._closedSubscription=qr.EMPTY,this._validator=up.compose(super._getValidators())}getConnectedOverlayOrigin(){return this._formField?this._formField.getConnectedOverlayOrigin():this._elementRef}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}getThemePalette(){return this._formField?this._formField.color:void 0}getStartValue(){return this.value}ngOnDestroy(){super.ngOnDestroy(),this._closedSubscription.unsubscribe()}_openPopup(){this._datepicker&&this._datepicker.open()}_getValueFromModel(c){return c}_assignValueToModel(c){this._model&&this._model.updateSelection(c,this)}_getMinDate(){return this._min}_getMaxDate(){return this._max}_getDateFilter(){return this._dateFilter}_shouldHandleChangeEvent(c){return c.source!==this}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(qo,8),Oe(Sd,8),Oe(xp,8))},l.\u0275dir=Qi({type:l,selectors:[["input","matDatepicker",""]],hostAttrs:[1,"mat-datepicker-input"],hostVars:6,hostBindings:function(m,r){m&1&&Vi("input",function(z){return r._onInput(z.target.value)})("change",function(){return r._onChange()})("blur",function(){return r._onBlur()})("keydown",function(z){return r._onKeydown(z)}),m&2&&(Oc("disabled",r.disabled),Fn("aria-haspopup",r._datepicker?"dialog":null)("aria-owns",(r._datepicker==null?null:r._datepicker.opened)&&r._datepicker.id||null)("min",r.min?r._dateAdapter.toIso8601(r.min):null)("max",r.max?r._dateAdapter.toIso8601(r.max):null)("data-mat-calendar",r._datepicker?r._datepicker.id:null))},inputs:{matDatepicker:"matDatepicker",min:"min",max:"max",dateFilter:[Jt.None,"matDatepickerFilter","dateFilter"]},exportAs:["matDatepickerInput"],standalone:!0,features:[Fr([Yz,Xz,{provide:Ox,useExisting:l}]),so]});let g=l;return g})(),Kz=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275dir=Qi({type:l,selectors:[["","matDatepickerToggleIcon",""]],standalone:!0});let g=l;return g})(),Jx=(()=>{let l=class l{get disabled(){return this._disabled===void 0&&this.datepicker?this.datepicker.disabled:!!this._disabled}set disabled(c){this._disabled=c}constructor(c,m,r){this._intl=c,this._changeDetectorRef=m,this._stateChanges=qr.EMPTY;let M=Number(r);this.tabIndex=M||M===0?M:null}ngOnChanges(c){c.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(c){this.datepicker&&!this.disabled&&(this.datepicker.open(),c.stopPropagation())}_watchStateChanges(){let c=this.datepicker?this.datepicker.stateChanges:ui(),m=this.datepicker&&this.datepicker.datepickerInput?this.datepicker.datepickerInput.stateChanges:ui(),r=this.datepicker?fl(this.datepicker.openedStream,this.datepicker.closedStream):ui();this._stateChanges.unsubscribe(),this._stateChanges=fl(this._intl.changes,c,m,r).subscribe(()=>this._changeDetectorRef.markForCheck())}};l.\u0275fac=function(m){return new(m||l)(Oe(tg),Oe(Pr),Is("tabindex"))},l.\u0275cmp=kn({type:l,selectors:[["mat-datepicker-toggle"]],contentQueries:function(m,r,M){if(m&1&&Ea(M,Kz,5),m&2){let z;bn(z=yn())&&(r._customIcon=z.first)}},viewQuery:function(m,r){if(m&1&&cr(Fz,5),m&2){let M;bn(M=yn())&&(r._button=M.first)}},hostAttrs:[1,"mat-datepicker-toggle"],hostVars:8,hostBindings:function(m,r){m&1&&Vi("click",function(z){return r._open(z)}),m&2&&(Fn("tabindex",null)("data-mat-calendar",r.datepicker?r.datepicker.id:null),Tn("mat-datepicker-toggle-active",r.datepicker&&r.datepicker.opened)("mat-accent",r.datepicker&&r.datepicker.color==="accent")("mat-warn",r.datepicker&&r.datepicker.color==="warn"))},inputs:{datepicker:[Jt.None,"for","datepicker"],tabIndex:"tabIndex",ariaLabel:[Jt.None,"aria-label","ariaLabel"],disabled:[Jt.HasDecoratorInputTransform,"disabled","disabled",pn],disableRipple:"disableRipple"},exportAs:["matDatepickerToggle"],standalone:!0,features:[xr,jr,Pn],ngContentSelectors:zz,decls:4,vars:6,consts:[["button",""],["mat-icon-button","","type","button",3,"disabled","disableRipple"],["viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true",1,"mat-datepicker-toggle-default-icon"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(m,r){m&1&&(wo(Lz),vt(0,"button",1,0),Xn(2,Nz,2,0,":svg:svg",2),lr(3),wt()),m&2&&(Ni("disabled",r.disabled)("disableRipple",r.disableRipple),Fn("aria-haspopup",r.datepicker?"dialog":null)("aria-label",r.ariaLabel||r._intl.openCalendarLabel)("tabindex",r.disabled?-1:r.tabIndex),Ft(2),Ur(2,r._customIcon?-1:2))},dependencies:[qf],styles:[".mat-datepicker-toggle{pointer-events:auto;color:var(--mat-datepicker-toggle-icon-color)}.mat-datepicker-toggle-active{color:var(--mat-datepicker-toggle-active-state-icon-color)}.cdk-high-contrast-active .mat-datepicker-toggle-default-icon{color:CanvasText}"],encapsulation:2,changeDetection:0});let g=l;return g})();var iA=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({providers:[tg,qz],imports:[ku,Hb,Yb,GS,Wb,Dr,eA,Jx,QM,wp]});let g=l;return g})();var Jz=["input"],e3=["label"],t3=["*"],i3=new hi("mat-checkbox-default-options",{providedIn:"root",factory:rA});function rA(){return{color:"accent",clickAction:"check-indeterminate"}}var pa=function(g){return g[g.Init=0]="Init",g[g.Checked=1]="Checked",g[g.Unchecked=2]="Unchecked",g[g.Indeterminate=3]="Indeterminate",g}(pa||{}),n3={provide:Vu,useExisting:os(()=>Qb),multi:!0},e1=class{},r3=0,nA=rA(),Qb=(()=>{let l=class l{focus(){this._inputElement.nativeElement.focus()}_createChangeEvent(c){let m=new e1;return m.source=this,m.checked=c,m}_getAnimationTargetElement(){return this._inputElement?.nativeElement}get inputId(){return`${this.id||this._uniqueId}-input`}constructor(c,m,r,M,z,ie){this._elementRef=c,this._changeDetectorRef=m,this._ngZone=r,this._animationMode=z,this._options=ie,this._animationClasses={uncheckedToChecked:"mdc-checkbox--anim-unchecked-checked",uncheckedToIndeterminate:"mdc-checkbox--anim-unchecked-indeterminate",checkedToUnchecked:"mdc-checkbox--anim-checked-unchecked",checkedToIndeterminate:"mdc-checkbox--anim-checked-indeterminate",indeterminateToChecked:"mdc-checkbox--anim-indeterminate-checked",indeterminateToUnchecked:"mdc-checkbox--anim-indeterminate-unchecked"},this.ariaLabel="",this.ariaLabelledby=null,this.labelPosition="after",this.name=null,this.change=new fi,this.indeterminateChange=new fi,this._onTouched=()=>{},this._currentAnimationClass="",this._currentCheckState=pa.Init,this._controlValueAccessorChangeFn=()=>{},this._validatorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||nA,this.color=this._options.color||nA.color,this.tabIndex=parseInt(M)||0,this.id=this._uniqueId=`mat-mdc-checkbox-${++r3}`}ngOnChanges(c){c.required&&this._validatorChangeFn()}ngAfterViewInit(){this._syncIndeterminate(this._indeterminate)}get checked(){return this._checked}set checked(c){c!=this.checked&&(this._checked=c,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(c){c!==this.disabled&&(this._disabled=c,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(c){let m=c!=this._indeterminate;this._indeterminate=c,m&&(this._indeterminate?this._transitionCheckState(pa.Indeterminate):this._transitionCheckState(this.checked?pa.Checked:pa.Unchecked),this.indeterminateChange.emit(this._indeterminate)),this._syncIndeterminate(this._indeterminate)}_isRippleDisabled(){return this.disableRipple||this.disabled}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(c){this.checked=!!c}registerOnChange(c){this._controlValueAccessorChangeFn=c}registerOnTouched(c){this._onTouched=c}setDisabledState(c){this.disabled=c}validate(c){return this.required&&c.value!==!0?{required:!0}:null}registerOnValidatorChange(c){this._validatorChangeFn=c}_transitionCheckState(c){let m=this._currentCheckState,r=this._getAnimationTargetElement();if(!(m===c||!r)&&(this._currentAnimationClass&&r.classList.remove(this._currentAnimationClass),this._currentAnimationClass=this._getAnimationClassForCheckStateTransition(m,c),this._currentCheckState=c,this._currentAnimationClass.length>0)){r.classList.add(this._currentAnimationClass);let M=this._currentAnimationClass;this._ngZone.runOutsideAngular(()=>{setTimeout(()=>{r.classList.remove(M)},1e3)})}}_emitChangeEvent(){this._controlValueAccessorChangeFn(this.checked),this.change.emit(this._createChangeEvent(this.checked)),this._inputElement&&(this._inputElement.nativeElement.checked=this.checked)}toggle(){this.checked=!this.checked,this._controlValueAccessorChangeFn(this.checked)}_handleInputClick(){let c=this._options?.clickAction;!this.disabled&&c!=="noop"?(this.indeterminate&&c!=="check"&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this._checked=!this._checked,this._transitionCheckState(this._checked?pa.Checked:pa.Unchecked),this._emitChangeEvent()):!this.disabled&&c==="noop"&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate)}_onInteractionEvent(c){c.stopPropagation()}_onBlur(){Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}_getAnimationClassForCheckStateTransition(c,m){if(this._animationMode==="NoopAnimations")return"";switch(c){case pa.Init:if(m===pa.Checked)return this._animationClasses.uncheckedToChecked;if(m==pa.Indeterminate)return this._checked?this._animationClasses.checkedToIndeterminate:this._animationClasses.uncheckedToIndeterminate;break;case pa.Unchecked:return m===pa.Checked?this._animationClasses.uncheckedToChecked:this._animationClasses.uncheckedToIndeterminate;case pa.Checked:return m===pa.Unchecked?this._animationClasses.checkedToUnchecked:this._animationClasses.checkedToIndeterminate;case pa.Indeterminate:return m===pa.Checked?this._animationClasses.indeterminateToChecked:this._animationClasses.indeterminateToUnchecked}return""}_syncIndeterminate(c){let m=this._inputElement;m&&(m.nativeElement.indeterminate=c)}_onInputClick(){this._handleInputClick()}_onTouchTargetClick(){this._handleInputClick(),this.disabled||this._inputElement.nativeElement.focus()}_preventBubblingFromLabel(c){c.target&&this._labelElement.nativeElement.contains(c.target)&&c.stopPropagation()}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(Pr),Oe(yi),Is("tabindex"),Oe(xo,8),Oe(i3,8))},l.\u0275cmp=kn({type:l,selectors:[["mat-checkbox"]],viewQuery:function(m,r){if(m&1&&(cr(Jz,5),cr(e3,5),cr(Zu,5)),m&2){let M;bn(M=yn())&&(r._inputElement=M.first),bn(M=yn())&&(r._labelElement=M.first),bn(M=yn())&&(r.ripple=M.first)}},hostAttrs:[1,"mat-mdc-checkbox"],hostVars:14,hostBindings:function(m,r){m&2&&(Oc("id",r.id),Fn("tabindex",null)("aria-label",null)("aria-labelledby",null),ss(r.color?"mat-"+r.color:"mat-accent"),Tn("_mat-animation-noopable",r._animationMode==="NoopAnimations")("mdc-checkbox--disabled",r.disabled)("mat-mdc-checkbox-disabled",r.disabled)("mat-mdc-checkbox-checked",r.checked))},inputs:{ariaLabel:[Jt.None,"aria-label","ariaLabel"],ariaLabelledby:[Jt.None,"aria-labelledby","ariaLabelledby"],ariaDescribedby:[Jt.None,"aria-describedby","ariaDescribedby"],id:"id",required:[Jt.HasDecoratorInputTransform,"required","required",pn],labelPosition:"labelPosition",name:"name",value:"value",disableRipple:[Jt.HasDecoratorInputTransform,"disableRipple","disableRipple",pn],tabIndex:[Jt.HasDecoratorInputTransform,"tabIndex","tabIndex",c=>c==null?void 0:ec(c)],color:"color",checked:[Jt.HasDecoratorInputTransform,"checked","checked",pn],disabled:[Jt.HasDecoratorInputTransform,"disabled","disabled",pn],indeterminate:[Jt.HasDecoratorInputTransform,"indeterminate","indeterminate",pn]},outputs:{change:"change",indeterminateChange:"indeterminateChange"},exportAs:["matCheckbox"],standalone:!0,features:[Fr([n3,{provide:ju,useExisting:l,multi:!0}]),xr,jr,Pn],ngContentSelectors:t3,decls:15,vars:19,consts:[["checkbox",""],["input",""],["label",""],["mat-internal-form-field","",3,"click","labelPosition"],[1,"mdc-checkbox"],[1,"mat-mdc-checkbox-touch-target",3,"click"],["type","checkbox",1,"mdc-checkbox__native-control",3,"blur","click","change","checked","indeterminate","disabled","id","required","tabIndex"],[1,"mdc-checkbox__ripple"],[1,"mdc-checkbox__background"],["focusable","false","viewBox","0 0 24 24","aria-hidden","true",1,"mdc-checkbox__checkmark"],["fill","none","d","M1.73,12.91 8.1,19.28 22.79,4.59",1,"mdc-checkbox__checkmark-path"],[1,"mdc-checkbox__mixedmark"],["mat-ripple","",1,"mat-mdc-checkbox-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-label",3,"for"]],template:function(m,r){if(m&1){let M=Ho();wo(),vt(0,"div",3),Vi("click",function(ie){return Ji(M),en(r._preventBubblingFromLabel(ie))}),vt(1,"div",4,0)(3,"div",5),Vi("click",function(){return Ji(M),en(r._onTouchTargetClick())}),wt(),vt(4,"input",6,1),Vi("blur",function(){return Ji(M),en(r._onBlur())})("click",function(){return Ji(M),en(r._onInputClick())})("change",function(ie){return Ji(M),en(r._onInteractionEvent(ie))}),wt(),nn(6,"div",7),vt(7,"div",8),Wh(),vt(8,"svg",9),nn(9,"path",10),wt(),z_(),nn(10,"div",11),wt(),nn(11,"div",12),wt(),vt(12,"label",13,2),lr(14),wt()()}if(m&2){let M=Ss(2);Ni("labelPosition",r.labelPosition),Ft(4),Tn("mdc-checkbox--selected",r.checked),Ni("checked",r.checked)("indeterminate",r.indeterminate)("disabled",r.disabled)("id",r.inputId)("required",r.required)("tabIndex",r.disabled?-1:r.tabIndex),Fn("aria-label",r.ariaLabel||null)("aria-labelledby",r.ariaLabelledby)("aria-describedby",r.ariaDescribedby)("aria-checked",r.indeterminate?"mixed":null)("name",r.name)("value",r.value),Ft(7),Ni("matRippleTrigger",M)("matRippleDisabled",r.disableRipple||r.disabled)("matRippleCentered",!0),Ft(),Ni("for",r.inputId)}},dependencies:[Zu,iM],styles:['.mdc-touch-target-wrapper{display:inline}@keyframes mdc-checkbox-unchecked-checked-checkmark-path{0%,50%{stroke-dashoffset:29.7833385}50%{animation-timing-function:cubic-bezier(0, 0, 0.2, 1)}100%{stroke-dashoffset:0}}@keyframes mdc-checkbox-unchecked-indeterminate-mixedmark{0%,68.2%{transform:scaleX(0)}68.2%{animation-timing-function:cubic-bezier(0, 0, 0, 1)}100%{transform:scaleX(1)}}@keyframes mdc-checkbox-checked-unchecked-checkmark-path{from{animation-timing-function:cubic-bezier(0.4, 0, 1, 1);opacity:1;stroke-dashoffset:0}to{opacity:0;stroke-dashoffset:-29.7833385}}@keyframes mdc-checkbox-checked-indeterminate-checkmark{from{animation-timing-function:cubic-bezier(0, 0, 0.2, 1);transform:rotate(0deg);opacity:1}to{transform:rotate(45deg);opacity:0}}@keyframes mdc-checkbox-indeterminate-checked-checkmark{from{animation-timing-function:cubic-bezier(0.14, 0, 0, 1);transform:rotate(45deg);opacity:0}to{transform:rotate(360deg);opacity:1}}@keyframes mdc-checkbox-checked-indeterminate-mixedmark{from{animation-timing-function:mdc-animation-deceleration-curve-timing-function;transform:rotate(-45deg);opacity:0}to{transform:rotate(0deg);opacity:1}}@keyframes mdc-checkbox-indeterminate-checked-mixedmark{from{animation-timing-function:cubic-bezier(0.14, 0, 0, 1);transform:rotate(0deg);opacity:1}to{transform:rotate(315deg);opacity:0}}@keyframes mdc-checkbox-indeterminate-unchecked-mixedmark{0%{animation-timing-function:linear;transform:scaleX(1);opacity:1}32.8%,100%{transform:scaleX(0);opacity:0}}.mdc-checkbox{display:inline-block;position:relative;flex:0 0 18px;box-sizing:content-box;width:18px;height:18px;line-height:0;white-space:nowrap;cursor:pointer;vertical-align:bottom}.mdc-checkbox[hidden]{display:none}.mdc-checkbox.mdc-ripple-upgraded--background-focused .mdc-checkbox__focus-ring,.mdc-checkbox:not(.mdc-ripple-upgraded):focus .mdc-checkbox__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:100%;width:100%}@media screen and (forced-colors: active){.mdc-checkbox.mdc-ripple-upgraded--background-focused .mdc-checkbox__focus-ring,.mdc-checkbox:not(.mdc-ripple-upgraded):focus .mdc-checkbox__focus-ring{border-color:CanvasText}}.mdc-checkbox.mdc-ripple-upgraded--background-focused .mdc-checkbox__focus-ring::after,.mdc-checkbox:not(.mdc-ripple-upgraded):focus .mdc-checkbox__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-checkbox.mdc-ripple-upgraded--background-focused .mdc-checkbox__focus-ring::after,.mdc-checkbox:not(.mdc-ripple-upgraded):focus .mdc-checkbox__focus-ring::after{border-color:CanvasText}}@media all and (-ms-high-contrast: none){.mdc-checkbox .mdc-checkbox__focus-ring{display:none}}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-checkbox__mixedmark{margin:0 1px}}.mdc-checkbox--disabled{cursor:default;pointer-events:none}.mdc-checkbox__background{display:inline-flex;position:absolute;align-items:center;justify-content:center;box-sizing:border-box;width:18px;height:18px;border:2px solid currentColor;border-radius:2px;background-color:rgba(0,0,0,0);pointer-events:none;will-change:background-color,border-color;transition:background-color 90ms 0ms cubic-bezier(0.4, 0, 0.6, 1),border-color 90ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-checkbox__checkmark{position:absolute;top:0;right:0;bottom:0;left:0;width:100%;opacity:0;transition:opacity 180ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-checkbox--upgraded .mdc-checkbox__checkmark{opacity:1}.mdc-checkbox__checkmark-path{transition:stroke-dashoffset 180ms 0ms cubic-bezier(0.4, 0, 0.6, 1);stroke:currentColor;stroke-width:3.12px;stroke-dashoffset:29.7833385;stroke-dasharray:29.7833385}.mdc-checkbox__mixedmark{width:100%;height:0;transform:scaleX(0) rotate(0deg);border-width:1px;border-style:solid;opacity:0;transition:opacity 90ms 0ms cubic-bezier(0.4, 0, 0.6, 1),transform 90ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-checkbox--anim-unchecked-checked .mdc-checkbox__background,.mdc-checkbox--anim-unchecked-indeterminate .mdc-checkbox__background,.mdc-checkbox--anim-checked-unchecked .mdc-checkbox__background,.mdc-checkbox--anim-indeterminate-unchecked .mdc-checkbox__background{animation-duration:180ms;animation-timing-function:linear}.mdc-checkbox--anim-unchecked-checked .mdc-checkbox__checkmark-path{animation:mdc-checkbox-unchecked-checked-checkmark-path 180ms linear 0s;transition:none}.mdc-checkbox--anim-unchecked-indeterminate .mdc-checkbox__mixedmark{animation:mdc-checkbox-unchecked-indeterminate-mixedmark 90ms linear 0s;transition:none}.mdc-checkbox--anim-checked-unchecked .mdc-checkbox__checkmark-path{animation:mdc-checkbox-checked-unchecked-checkmark-path 90ms linear 0s;transition:none}.mdc-checkbox--anim-checked-indeterminate .mdc-checkbox__checkmark{animation:mdc-checkbox-checked-indeterminate-checkmark 90ms linear 0s;transition:none}.mdc-checkbox--anim-checked-indeterminate .mdc-checkbox__mixedmark{animation:mdc-checkbox-checked-indeterminate-mixedmark 90ms linear 0s;transition:none}.mdc-checkbox--anim-indeterminate-checked .mdc-checkbox__checkmark{animation:mdc-checkbox-indeterminate-checked-checkmark 500ms linear 0s;transition:none}.mdc-checkbox--anim-indeterminate-checked .mdc-checkbox__mixedmark{animation:mdc-checkbox-indeterminate-checked-mixedmark 500ms linear 0s;transition:none}.mdc-checkbox--anim-indeterminate-unchecked .mdc-checkbox__mixedmark{animation:mdc-checkbox-indeterminate-unchecked-mixedmark 300ms linear 0s;transition:none}.mdc-checkbox__native-control:checked~.mdc-checkbox__background,.mdc-checkbox__native-control:indeterminate~.mdc-checkbox__background,.mdc-checkbox__native-control[data-indeterminate=true]~.mdc-checkbox__background{transition:border-color 90ms 0ms cubic-bezier(0, 0, 0.2, 1),background-color 90ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-checkbox__native-control:checked~.mdc-checkbox__background .mdc-checkbox__checkmark-path,.mdc-checkbox__native-control:indeterminate~.mdc-checkbox__background .mdc-checkbox__checkmark-path,.mdc-checkbox__native-control[data-indeterminate=true]~.mdc-checkbox__background .mdc-checkbox__checkmark-path{stroke-dashoffset:0}.mdc-checkbox__native-control{position:absolute;margin:0;padding:0;opacity:0;cursor:inherit}.mdc-checkbox__native-control:disabled{cursor:default;pointer-events:none}.mdc-checkbox--touch{margin:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2)}.mdc-checkbox--touch .mdc-checkbox__native-control{top:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2);right:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2);left:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2);width:var(--mdc-checkbox-state-layer-size);height:var(--mdc-checkbox-state-layer-size)}.mdc-checkbox__native-control:checked~.mdc-checkbox__background .mdc-checkbox__checkmark{transition:opacity 180ms 0ms cubic-bezier(0, 0, 0.2, 1),transform 180ms 0ms cubic-bezier(0, 0, 0.2, 1);opacity:1}.mdc-checkbox__native-control:checked~.mdc-checkbox__background .mdc-checkbox__mixedmark{transform:scaleX(1) rotate(-45deg)}.mdc-checkbox__native-control:indeterminate~.mdc-checkbox__background .mdc-checkbox__checkmark,.mdc-checkbox__native-control[data-indeterminate=true]~.mdc-checkbox__background .mdc-checkbox__checkmark{transform:rotate(45deg);opacity:0;transition:opacity 90ms 0ms cubic-bezier(0.4, 0, 0.6, 1),transform 90ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-checkbox__native-control:indeterminate~.mdc-checkbox__background .mdc-checkbox__mixedmark,.mdc-checkbox__native-control[data-indeterminate=true]~.mdc-checkbox__background .mdc-checkbox__mixedmark{transform:scaleX(1) rotate(0deg);opacity:1}.mdc-checkbox.mdc-checkbox--upgraded .mdc-checkbox__background,.mdc-checkbox.mdc-checkbox--upgraded .mdc-checkbox__checkmark,.mdc-checkbox.mdc-checkbox--upgraded .mdc-checkbox__checkmark-path,.mdc-checkbox.mdc-checkbox--upgraded .mdc-checkbox__mixedmark{transition:none}.mdc-checkbox{padding:calc((var(--mdc-checkbox-state-layer-size) - 18px) / 2);margin:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2)}.mdc-checkbox .mdc-checkbox__native-control[disabled]:not(:checked):not(:indeterminate):not([data-indeterminate=true])~.mdc-checkbox__background{border-color:var(--mdc-checkbox-disabled-unselected-icon-color);background-color:transparent}.mdc-checkbox .mdc-checkbox__native-control[disabled]:checked~.mdc-checkbox__background,.mdc-checkbox .mdc-checkbox__native-control[disabled]:indeterminate~.mdc-checkbox__background,.mdc-checkbox .mdc-checkbox__native-control[data-indeterminate=true][disabled]~.mdc-checkbox__background{border-color:transparent;background-color:var(--mdc-checkbox-disabled-selected-icon-color)}.mdc-checkbox .mdc-checkbox__native-control:enabled~.mdc-checkbox__background .mdc-checkbox__checkmark{color:var(--mdc-checkbox-selected-checkmark-color)}.mdc-checkbox .mdc-checkbox__native-control:enabled~.mdc-checkbox__background .mdc-checkbox__mixedmark{border-color:var(--mdc-checkbox-selected-checkmark-color)}.mdc-checkbox .mdc-checkbox__native-control:disabled~.mdc-checkbox__background .mdc-checkbox__checkmark{color:var(--mdc-checkbox-disabled-selected-checkmark-color)}.mdc-checkbox .mdc-checkbox__native-control:disabled~.mdc-checkbox__background .mdc-checkbox__mixedmark{border-color:var(--mdc-checkbox-disabled-selected-checkmark-color)}.mdc-checkbox .mdc-checkbox__native-control:enabled:not(:checked):not(:indeterminate):not([data-indeterminate=true])~.mdc-checkbox__background{border-color:var(--mdc-checkbox-unselected-icon-color);background-color:transparent}.mdc-checkbox .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background,.mdc-checkbox .mdc-checkbox__native-control:enabled:indeterminate~.mdc-checkbox__background,.mdc-checkbox .mdc-checkbox__native-control[data-indeterminate=true]:enabled~.mdc-checkbox__background{border-color:var(--mdc-checkbox-selected-icon-color);background-color:var(--mdc-checkbox-selected-icon-color)}@keyframes mdc-checkbox-fade-in-background-8A000000FFF4433600000000FFF44336{0%{border-color:var(--mdc-checkbox-unselected-icon-color);background-color:transparent}50%{border-color:var(--mdc-checkbox-selected-icon-color);background-color:var(--mdc-checkbox-selected-icon-color)}}@keyframes mdc-checkbox-fade-out-background-8A000000FFF4433600000000FFF44336{0%,80%{border-color:var(--mdc-checkbox-selected-icon-color);background-color:var(--mdc-checkbox-selected-icon-color)}100%{border-color:var(--mdc-checkbox-unselected-icon-color);background-color:transparent}}.mdc-checkbox.mdc-checkbox--anim-unchecked-checked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background,.mdc-checkbox.mdc-checkbox--anim-unchecked-indeterminate .mdc-checkbox__native-control:enabled~.mdc-checkbox__background{animation-name:mdc-checkbox-fade-in-background-8A000000FFF4433600000000FFF44336}.mdc-checkbox.mdc-checkbox--anim-checked-unchecked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background,.mdc-checkbox.mdc-checkbox--anim-indeterminate-unchecked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background{animation-name:mdc-checkbox-fade-out-background-8A000000FFF4433600000000FFF44336}.mdc-checkbox:hover .mdc-checkbox__native-control:enabled:not(:checked):not(:indeterminate):not([data-indeterminate=true])~.mdc-checkbox__background{border-color:var(--mdc-checkbox-unselected-hover-icon-color);background-color:transparent}.mdc-checkbox:hover .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background,.mdc-checkbox:hover .mdc-checkbox__native-control:enabled:indeterminate~.mdc-checkbox__background,.mdc-checkbox:hover .mdc-checkbox__native-control[data-indeterminate=true]:enabled~.mdc-checkbox__background{border-color:var(--mdc-checkbox-selected-hover-icon-color);background-color:var(--mdc-checkbox-selected-hover-icon-color)}@keyframes mdc-checkbox-fade-in-background-FF212121FFF4433600000000FFF44336{0%{border-color:var(--mdc-checkbox-unselected-hover-icon-color);background-color:transparent}50%{border-color:var(--mdc-checkbox-selected-hover-icon-color);background-color:var(--mdc-checkbox-selected-hover-icon-color)}}@keyframes mdc-checkbox-fade-out-background-FF212121FFF4433600000000FFF44336{0%,80%{border-color:var(--mdc-checkbox-selected-hover-icon-color);background-color:var(--mdc-checkbox-selected-hover-icon-color)}100%{border-color:var(--mdc-checkbox-unselected-hover-icon-color);background-color:transparent}}.mdc-checkbox:hover.mdc-checkbox--anim-unchecked-checked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background,.mdc-checkbox:hover.mdc-checkbox--anim-unchecked-indeterminate .mdc-checkbox__native-control:enabled~.mdc-checkbox__background{animation-name:mdc-checkbox-fade-in-background-FF212121FFF4433600000000FFF44336}.mdc-checkbox:hover.mdc-checkbox--anim-checked-unchecked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background,.mdc-checkbox:hover.mdc-checkbox--anim-indeterminate-unchecked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background{animation-name:mdc-checkbox-fade-out-background-FF212121FFF4433600000000FFF44336}.mdc-checkbox:not(:disabled):active .mdc-checkbox__native-control:enabled:not(:checked):not(:indeterminate):not([data-indeterminate=true])~.mdc-checkbox__background{border-color:var(--mdc-checkbox-unselected-pressed-icon-color);background-color:transparent}.mdc-checkbox:not(:disabled):active .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background,.mdc-checkbox:not(:disabled):active .mdc-checkbox__native-control:enabled:indeterminate~.mdc-checkbox__background,.mdc-checkbox:not(:disabled):active .mdc-checkbox__native-control[data-indeterminate=true]:enabled~.mdc-checkbox__background{border-color:var(--mdc-checkbox-selected-pressed-icon-color);background-color:var(--mdc-checkbox-selected-pressed-icon-color)}@keyframes mdc-checkbox-fade-in-background-8A000000FFF4433600000000FFF44336{0%{border-color:var(--mdc-checkbox-unselected-pressed-icon-color);background-color:transparent}50%{border-color:var(--mdc-checkbox-selected-pressed-icon-color);background-color:var(--mdc-checkbox-selected-pressed-icon-color)}}@keyframes mdc-checkbox-fade-out-background-8A000000FFF4433600000000FFF44336{0%,80%{border-color:var(--mdc-checkbox-selected-pressed-icon-color);background-color:var(--mdc-checkbox-selected-pressed-icon-color)}100%{border-color:var(--mdc-checkbox-unselected-pressed-icon-color);background-color:transparent}}.mdc-checkbox:not(:disabled):active.mdc-checkbox--anim-unchecked-checked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background,.mdc-checkbox:not(:disabled):active.mdc-checkbox--anim-unchecked-indeterminate .mdc-checkbox__native-control:enabled~.mdc-checkbox__background{animation-name:mdc-checkbox-fade-in-background-8A000000FFF4433600000000FFF44336}.mdc-checkbox:not(:disabled):active.mdc-checkbox--anim-checked-unchecked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background,.mdc-checkbox:not(:disabled):active.mdc-checkbox--anim-indeterminate-unchecked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background{animation-name:mdc-checkbox-fade-out-background-8A000000FFF4433600000000FFF44336}.mdc-checkbox .mdc-checkbox__background{top:calc((var(--mdc-checkbox-state-layer-size) - 18px) / 2);left:calc((var(--mdc-checkbox-state-layer-size) - 18px) / 2)}.mdc-checkbox .mdc-checkbox__native-control{top:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2);right:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2);left:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2);width:var(--mdc-checkbox-state-layer-size);height:var(--mdc-checkbox-state-layer-size)}.mdc-checkbox .mdc-checkbox__native-control:enabled:focus:focus:not(:checked):not(:indeterminate)~.mdc-checkbox__background{border-color:var(--mdc-checkbox-unselected-focus-icon-color)}.mdc-checkbox .mdc-checkbox__native-control:enabled:focus:checked~.mdc-checkbox__background,.mdc-checkbox .mdc-checkbox__native-control:enabled:focus:indeterminate~.mdc-checkbox__background{border-color:var(--mdc-checkbox-selected-focus-icon-color);background-color:var(--mdc-checkbox-selected-focus-icon-color)}.mdc-checkbox:hover .mdc-checkbox__ripple{opacity:var(--mdc-checkbox-unselected-hover-state-layer-opacity);background-color:var(--mdc-checkbox-unselected-hover-state-layer-color)}.mdc-checkbox:hover .mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-unselected-hover-state-layer-color)}.mdc-checkbox .mdc-checkbox__native-control:focus~.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-unselected-focus-state-layer-opacity);background-color:var(--mdc-checkbox-unselected-focus-state-layer-color)}.mdc-checkbox .mdc-checkbox__native-control:focus~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-unselected-focus-state-layer-color)}.mdc-checkbox:active .mdc-checkbox__native-control~.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-unselected-pressed-state-layer-opacity);background-color:var(--mdc-checkbox-unselected-pressed-state-layer-color)}.mdc-checkbox:active .mdc-checkbox__native-control~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-unselected-pressed-state-layer-color)}.mdc-checkbox:hover .mdc-checkbox__native-control:checked~.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-selected-hover-state-layer-opacity);background-color:var(--mdc-checkbox-selected-hover-state-layer-color)}.mdc-checkbox:hover .mdc-checkbox__native-control:checked~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-selected-hover-state-layer-color)}.mdc-checkbox .mdc-checkbox__native-control:focus:checked~.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-selected-focus-state-layer-opacity);background-color:var(--mdc-checkbox-selected-focus-state-layer-color)}.mdc-checkbox .mdc-checkbox__native-control:focus:checked~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-selected-focus-state-layer-color)}.mdc-checkbox:active .mdc-checkbox__native-control:checked~.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-selected-pressed-state-layer-opacity);background-color:var(--mdc-checkbox-selected-pressed-state-layer-color)}.mdc-checkbox:active .mdc-checkbox__native-control:checked~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-selected-pressed-state-layer-color)}.mat-mdc-checkbox{display:inline-block;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-checkbox .mdc-checkbox__background{-webkit-print-color-adjust:exact;color-adjust:exact}.mat-mdc-checkbox._mat-animation-noopable *,.mat-mdc-checkbox._mat-animation-noopable *::before{transition:none !important;animation:none !important}.mat-mdc-checkbox label{cursor:pointer}.mat-mdc-checkbox.mat-mdc-checkbox-disabled label{cursor:default;color:var(--mat-checkbox-disabled-label-color)}.mat-mdc-checkbox label:empty{display:none}.cdk-high-contrast-active .mat-mdc-checkbox.mat-mdc-checkbox-disabled{opacity:.5}.cdk-high-contrast-active .mat-mdc-checkbox .mdc-checkbox__checkmark{--mdc-checkbox-selected-checkmark-color: CanvasText;--mdc-checkbox-disabled-selected-checkmark-color: CanvasText}.mat-mdc-checkbox .mdc-checkbox__ripple{opacity:0}.mat-mdc-checkbox-ripple,.mdc-checkbox__ripple{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-checkbox-ripple:not(:empty),.mdc-checkbox__ripple:not(:empty){transform:translateZ(0)}.mat-mdc-checkbox-ripple .mat-ripple-element{opacity:.1}.mat-mdc-checkbox-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%);display:var(--mat-checkbox-touch-target-display)}.mat-mdc-checkbox-ripple::before{border-radius:50%}.mdc-checkbox__native-control:focus~.mat-mdc-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0});let g=l;return g})();var oA=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({imports:[Qb,Dr,Dr]});let g=l;return g})();function a3(g,l){g&1&&nn(0,"div",2)}var s3=new hi("MAT_PROGRESS_BAR_DEFAULT_OPTIONS");var sA=(()=>{let l=class l{constructor(c,m,r,M,z){this._elementRef=c,this._ngZone=m,this._changeDetectorRef=r,this._animationMode=M,this._isNoopAnimation=!1,this._defaultColor="primary",this._value=0,this._bufferValue=0,this.animationEnd=new fi,this._mode="determinate",this._transitionendHandler=ie=>{this.animationEnd.observers.length===0||!ie.target||!ie.target.classList.contains("mdc-linear-progress__primary-bar")||(this.mode==="determinate"||this.mode==="buffer")&&this._ngZone.run(()=>this.animationEnd.next({value:this.value}))},this._isNoopAnimation=M==="NoopAnimations",z&&(z.color&&(this.color=this._defaultColor=z.color),this.mode=z.mode||this.mode)}get color(){return this._color||this._defaultColor}set color(c){this._color=c}get value(){return this._value}set value(c){this._value=aA(c||0),this._changeDetectorRef.markForCheck()}get bufferValue(){return this._bufferValue||0}set bufferValue(c){this._bufferValue=aA(c||0),this._changeDetectorRef.markForCheck()}get mode(){return this._mode}set mode(c){this._mode=c,this._changeDetectorRef.markForCheck()}ngAfterViewInit(){this._ngZone.runOutsideAngular(()=>{this._elementRef.nativeElement.addEventListener("transitionend",this._transitionendHandler)})}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._transitionendHandler)}_getPrimaryBarTransform(){return`scaleX(${this._isIndeterminate()?1:this.value/100})`}_getBufferBarFlexBasis(){return`${this.mode==="buffer"?this.bufferValue:100}%`}_isIndeterminate(){return this.mode==="indeterminate"||this.mode==="query"}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(yi),Oe(Pr),Oe(xo,8),Oe(s3,8))},l.\u0275cmp=kn({type:l,selectors:[["mat-progress-bar"]],hostAttrs:["role","progressbar","aria-valuemin","0","aria-valuemax","100","tabindex","-1",1,"mat-mdc-progress-bar","mdc-linear-progress"],hostVars:10,hostBindings:function(m,r){m&2&&(Fn("aria-valuenow",r._isIndeterminate()?null:r.value)("mode",r.mode),ss("mat-"+r.color),Tn("_mat-animation-noopable",r._isNoopAnimation)("mdc-linear-progress--animation-ready",!r._isNoopAnimation)("mdc-linear-progress--indeterminate",r._isIndeterminate()))},inputs:{color:"color",value:[Jt.HasDecoratorInputTransform,"value","value",ec],bufferValue:[Jt.HasDecoratorInputTransform,"bufferValue","bufferValue",ec],mode:"mode"},outputs:{animationEnd:"animationEnd"},exportAs:["matProgressBar"],standalone:!0,features:[xr,Pn],decls:7,vars:5,consts:[["aria-hidden","true",1,"mdc-linear-progress__buffer"],[1,"mdc-linear-progress__buffer-bar"],[1,"mdc-linear-progress__buffer-dots"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__primary-bar"],[1,"mdc-linear-progress__bar-inner"],["aria-hidden","true",1,"mdc-linear-progress__bar","mdc-linear-progress__secondary-bar"]],template:function(m,r){m&1&&(vt(0,"div",0),nn(1,"div",1),Xn(2,a3,1,0,"div",2),wt(),vt(3,"div",3),nn(4,"span",4),wt(),vt(5,"div",5),nn(6,"span",4),wt()),m&2&&(Ft(),Jl("flex-basis",r._getBufferBarFlexBasis()),Ft(),Ur(2,r.mode==="buffer"?2:-1),Ft(),Jl("transform",r._getPrimaryBarTransform()))},styles:[`@keyframes mdc-linear-progress-primary-indeterminate-translate{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(var(--mdc-linear-progress-primary-half))}100%{transform:translateX(var(--mdc-linear-progress-primary-full))}}@keyframes mdc-linear-progress-primary-indeterminate-scale{0%{transform:scaleX(0.08)}36.65%{animation-timing-function:cubic-bezier(0.334731, 0.12482, 0.785844, 1);transform:scaleX(0.08)}69.15%{animation-timing-function:cubic-bezier(0.06, 0.11, 0.6, 1);transform:scaleX(0.661479)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-secondary-indeterminate-translate{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(var(--mdc-linear-progress-secondary-quarter))}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(var(--mdc-linear-progress-secondary-half))}100%{transform:translateX(var(--mdc-linear-progress-secondary-full))}}@keyframes mdc-linear-progress-secondary-indeterminate-scale{0%{animation-timing-function:cubic-bezier(0.205028, 0.057051, 0.57661, 0.453971);transform:scaleX(0.08)}19.15%{animation-timing-function:cubic-bezier(0.152313, 0.196432, 0.648374, 1.004315);transform:scaleX(0.457104)}44.15%{animation-timing-function:cubic-bezier(0.257759, -0.003163, 0.211762, 1.38179);transform:scaleX(0.72796)}100%{transform:scaleX(0.08)}}@keyframes mdc-linear-progress-primary-indeterminate-translate-reverse{0%{transform:translateX(0)}20%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(0)}59.15%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(var(--mdc-linear-progress-primary-half-neg))}100%{transform:translateX(var(--mdc-linear-progress-primary-full-neg))}}@keyframes mdc-linear-progress-secondary-indeterminate-translate-reverse{0%{animation-timing-function:cubic-bezier(0.15, 0, 0.515058, 0.409685);transform:translateX(0)}25%{animation-timing-function:cubic-bezier(0.31033, 0.284058, 0.8, 0.733712);transform:translateX(var(--mdc-linear-progress-secondary-quarter-neg))}48.35%{animation-timing-function:cubic-bezier(0.4, 0.627035, 0.6, 0.902026);transform:translateX(var(--mdc-linear-progress-secondary-half-neg))}100%{transform:translateX(var(--mdc-linear-progress-secondary-full-neg))}}@keyframes mdc-linear-progress-buffering-reverse{from{transform:translateX(-10px)}}.mdc-linear-progress{position:relative;width:100%;transform:translateZ(0);outline:1px solid rgba(0,0,0,0);overflow-x:hidden;transition:opacity 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}@media screen and (forced-colors: active){.mdc-linear-progress{outline-color:CanvasText}}.mdc-linear-progress__bar{position:absolute;top:0;bottom:0;margin:auto 0;width:100%;animation:none;transform-origin:top left;transition:transform 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-linear-progress__bar-inner{display:inline-block;position:absolute;width:100%;animation:none;border-top-style:solid}.mdc-linear-progress__buffer{display:flex;position:absolute;top:0;bottom:0;margin:auto 0;width:100%;overflow:hidden}.mdc-linear-progress__buffer-dots{background-repeat:repeat-x;flex:auto;transform:rotate(180deg);-webkit-mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");mask-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='xMinYMin slice'%3E%3Ccircle cx='1' cy='1' r='1'/%3E%3C/svg%3E");animation:mdc-linear-progress-buffering 250ms infinite linear}.mdc-linear-progress__buffer-bar{flex:0 1 100%;transition:flex-basis 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-linear-progress__primary-bar{transform:scaleX(0)}.mdc-linear-progress__secondary-bar{display:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__bar{transition:none}.mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{left:-145.166611%}.mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{left:-54.888891%;display:block}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation:mdc-linear-progress-primary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-primary-indeterminate-scale 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation:mdc-linear-progress-secondary-indeterminate-translate 2s infinite linear}.mdc-linear-progress--indeterminate.mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar>.mdc-linear-progress__bar-inner{animation:mdc-linear-progress-secondary-indeterminate-scale 2s infinite linear}[dir=rtl] .mdc-linear-progress:not([dir=ltr]) .mdc-linear-progress__bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]) .mdc-linear-progress__bar{right:0;-webkit-transform-origin:center right;transform-origin:center right}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__primary-bar{animation-name:mdc-linear-progress-primary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--animation-ready .mdc-linear-progress__secondary-bar{animation-name:mdc-linear-progress-secondary-indeterminate-translate-reverse}[dir=rtl] .mdc-linear-progress:not([dir=ltr]) .mdc-linear-progress__buffer-dots,.mdc-linear-progress[dir=rtl]:not([dir=ltr]) .mdc-linear-progress__buffer-dots{animation:mdc-linear-progress-buffering-reverse 250ms infinite linear;transform:rotate(0)}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__primary-bar{right:-145.166611%;left:auto}[dir=rtl] .mdc-linear-progress:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar,.mdc-linear-progress[dir=rtl]:not([dir=ltr]).mdc-linear-progress--indeterminate .mdc-linear-progress__secondary-bar{right:-54.888891%;left:auto}.mdc-linear-progress--closed{opacity:0}.mdc-linear-progress--closed-animation-off .mdc-linear-progress__buffer-dots{animation:none}.mdc-linear-progress--closed-animation-off.mdc-linear-progress--indeterminate .mdc-linear-progress__bar,.mdc-linear-progress--closed-animation-off.mdc-linear-progress--indeterminate .mdc-linear-progress__bar .mdc-linear-progress__bar-inner{animation:none}@keyframes mdc-linear-progress-buffering{from{transform:rotate(180deg) translateX(calc(var(--mdc-linear-progress-track-height) * -2.5))}}.mdc-linear-progress__bar-inner{border-color:var(--mdc-linear-progress-active-indicator-color)}.mdc-linear-progress__buffer-dots{background-color:var(--mdc-linear-progress-track-color)}@media(forced-colors: active){.mdc-linear-progress__buffer-dots{background-color:ButtonBorder}}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress__buffer-dots{background-color:rgba(0,0,0,0);background-image:url("data:image/svg+xml,%3Csvg version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' enable-background='new 0 0 5 2' xml:space='preserve' viewBox='0 0 5 2' preserveAspectRatio='none slice'%3E%3Ccircle cx='1' cy='1' r='1' fill='rgba(244, 67, 54, 0.25)'/%3E%3C/svg%3E")}}.mdc-linear-progress__buffer-bar{background-color:var(--mdc-linear-progress-track-color)}.mdc-linear-progress{height:max(var(--mdc-linear-progress-track-height), var(--mdc-linear-progress-active-indicator-height))}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress{height:4px}}.mdc-linear-progress__bar{height:var(--mdc-linear-progress-active-indicator-height)}.mdc-linear-progress__bar-inner{border-top-width:var(--mdc-linear-progress-active-indicator-height)}.mdc-linear-progress__buffer{height:var(--mdc-linear-progress-track-height)}@media all and (-ms-high-contrast: none),(-ms-high-contrast: active){.mdc-linear-progress__buffer-dots{background-size:10px var(--mdc-linear-progress-track-height)}}.mdc-linear-progress__buffer{border-radius:var(--mdc-linear-progress-track-shape)}.mat-mdc-progress-bar{display:block;text-align:start;--mdc-linear-progress-primary-half: 83.67142%;--mdc-linear-progress-primary-full: 200.611057%;--mdc-linear-progress-secondary-quarter: 37.651913%;--mdc-linear-progress-secondary-half: 84.386165%;--mdc-linear-progress-secondary-full: 160.277782%;--mdc-linear-progress-primary-half-neg: -83.67142%;--mdc-linear-progress-primary-full-neg: -200.611057%;--mdc-linear-progress-secondary-quarter-neg: -37.651913%;--mdc-linear-progress-secondary-half-neg: -84.386165%;--mdc-linear-progress-secondary-full-neg: -160.277782%}.mat-mdc-progress-bar[mode=query]{transform:scaleX(-1)}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-dots,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__secondary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__bar-inner.mdc-linear-progress__bar-inner{animation:none}.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__primary-bar,.mat-mdc-progress-bar._mat-animation-noopable .mdc-linear-progress__buffer-bar{transition:transform 1ms}`],encapsulation:2,changeDetection:0});let g=l;return g})();function aA(g,l=0,w=100){return Math.max(l,Math.min(w,g))}var lA=(()=>{let l=class l{};l.\u0275fac=function(m){return new(m||l)},l.\u0275mod=dn({type:l}),l.\u0275inj=cn({imports:[Dr]});let g=l;return g})();var cA=(()=>{let l=class l{constructor(c){this.http=c}search(c){let m=new tc({fromObject:{apikey:Cd.yandex.rasp.api.key,from:c.from,to:c.to,format:c.format,lang:c.lang,date:c.date,transport_types:c.transport_types.join(","),system:c.system,show_systems:c.show_systems,offset:c.offset.toString(),limit:c.limit.toString(),add_days_mask:c.add_days_mask.toString(),result_timezone:c.result_timezone,transfers:c.transfers.toString()}}),r=`${Cd.yandex.rasp.api.url}${m.toString()}`,M=`${Cd.proxy.url}${r}`;return this.http.get(M)}getCityCode(c){this.http.get("https://corsproxy.io/?https%3A%2F%2Fsuggests.rasp.yandex.net%2Fall_suggests%3Fformat%3Dold%26part%3D%25D0%25BC%25D0%25BE%25D1%2581%25D0%25BA%25D0%25B2%25D0%25B0").subscribe({next:z=>{console.log(z)},error:z=>{console.error(z)}});let r=`${Cd.yandex.rasp.suggests.url}${encodeURIComponent(c)}`,M=`${Cd.proxy.url}${r}`;return this.http.get(M)}};l.\u0275fac=function(m){return new(m||l)(bt(cf))},l.\u0275prov=Qt({token:l,factory:l.\u0275fac,providedIn:"root"});let g=l;return g})();function d3(g,l){if(g&1){let w=Ho();vt(0,"button",21),Vi("click",function(){Ji(w);let m=Rn();return en(m.from="")}),vt(1,"mat-icon"),hn(2,"close"),wt()()}}function u3(g,l){if(g&1){let w=Ho();vt(0,"button",21),Vi("click",function(){Ji(w);let m=Rn();return en(m.to="")}),vt(1,"mat-icon"),hn(2,"close"),wt()()}}function h3(g,l){if(g&1){let w=Ho();vt(0,"li")(1,"mat-checkbox",22),bl("ngModelChange",function(m){let r=Ji(w).$implicit;return _l(r.completed,m)||(r.completed=m),en(m)}),Vi("ngModelChange",function(){Ji(w);let m=Rn();return en(m.updateAllComplete())}),hn(2),wt()()}if(g&2){let w=l.$implicit;Ft(),gl("ngModel",w.completed),Ni("color",w.color),Ft(),Ms(" ",w.name," ")}}function p3(g,l){if(g&1&&(vt(0,"section",23)(1,"section",24)(2,"h3"),hn(3,"Thread"),wt(),vt(4,"p"),hn(5),wt(),vt(6,"p"),hn(7),wt(),vt(8,"p"),hn(9),wt()(),vt(10,"section",25)(11,"h3"),hn(12,"Departure"),wt(),vt(13,"p"),hn(14),W0(15,"date"),wt(),vt(16,"p"),hn(17),wt(),vt(18,"p"),hn(19),wt()(),vt(20,"section",26)(21,"h3"),hn(22,"Arrival"),wt(),vt(23,"p"),hn(24),W0(25,"date"),wt(),vt(26,"p"),hn(27),wt(),vt(28,"p"),hn(29),wt()()()),g&2){let w=l.$implicit;Ft(5),Co(w.thread.title),Ft(2),Co(w.thread.carrier.title),Ft(2),Co(w.thread.transport_type),Ft(5),Co(Z0(15,9,w.departure,"yyyy-MM-dd HH:mm")),Ft(3),Co(w.from.title),Ft(2),Co(w.departure_terminal),Ft(5),Co(Z0(25,12,w.arrival,"yyyy-MM-dd HH:mm")),Ft(3),Co(w.to.title),Ft(2),Co(w.arrival_terminal)}}var dA=(()=>{let l=class l{constructor(c){this.service=c,this.isSearching=!1,this.form={apikey:"",format:"json",lang:"ru_RU",from:"s9600191",to:"c213",date:"",transport_types:["plane","train","suburban","bus","water","helicopter"],system:"yandex",show_systems:"yandex",offset:0,limit:100,add_days_mask:!1,result_timezone:"Europe/Moscow",transfers:!1},this.from="",this.to="",this.date=new Date,this.task={name:"any",completed:!0,color:"primary",subtasks:[{name:"plane",completed:!0,color:"primary"},{name:"train",completed:!0,color:"primary"},{name:"suburban",completed:!0,color:"primary"},{name:"bus",completed:!0,color:"primary"},{name:"water",completed:!0,color:"primary"},{name:"helicopter",completed:!0,color:"primary"}]},this.allComplete=!0,this.segments=[],this.setToday()}updateAllComplete(){this.allComplete=this.task.subtasks!=null&&this.task.subtasks.every(c=>c.completed),this.allComplete&&(this.form.transport_types=["plane","train","suburban","bus","water","helicopter"]),this.syncFormByTasks()}someComplete(){return this.task.subtasks==null?!1:this.task.subtasks.filter(c=>c.completed).length>0&&!this.allComplete}setAll(c){this.allComplete=c,this.task.subtasks!=null&&(this.task.subtasks.forEach(m=>m.completed=c),this.syncFormByTasks())}syncFormByTasks(){this.task.subtasks&&(this.form.transport_types=[],this.task.subtasks.forEach(c=>{c.completed&&(c.name==="plane"||c.name==="train"||c.name==="suburban"||c.name==="bus"||c.name==="water"||c.name==="helicopter")&&this.form.transport_types.push(c.name)}))}swap(){let c=this.form.from;this.form.from=this.form.to,this.form.to=c;let m=this.from;this.from=this.to,this.to=m}search(){this.isSearching=!0,this.from!==""&&this.to!==""&&this.form.transport_types.length>0?this.service.search(this.form).subscribe({next:c=>{this.segments=c.segments,this.isSearching=!1},error:c=>{console.error(c),this.isSearching=!1}}):(console.error("missed some params"),this.isSearching=!1)}setToday(){this.date=new Date,this.setDate()}setTomorrow(){let c=new Date;c.setDate(c.getDate()+1),this.date=c,this.setDate()}setDate(c=this.date){if(this.date===null||this.date===void 0)return;let m=c.getFullYear(),r=String(c.getMonth()+1).padStart(2,"0"),M=String(c.getDate()).padStart(2,"0");this.form.date=`${m}-${r}-${M}`}setFromCode(){let c=this.from;this.service.getCityCode(c).subscribe({next:m=>{this.from=m[1][0][1],this.form.from=m[1][0][0]}})}setToCode(){let c=this.to;this.service.getCityCode(c).subscribe({next:m=>{this.to=m[1][0][1],this.form.to=m[1][0][0]}})}};l.\u0275fac=function(m){return new(m||l)(Oe(cA))},l.\u0275cmp=kn({type:l,selectors:[["app-transport-schedule"]],standalone:!0,features:[Fr([eM()]),Pn],decls:46,vars:13,consts:[["picker",""],[1,"container"],[1,"form"],[1,"form-content"],[1,"from-swap-to"],[1,"form-field"],["matInput","","type","text",3,"ngModelChange","change","ngModel"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"click",4,"ngIf"],["mat-button","","aria-label","swap",1,"swap-input-values",3,"click"],[1,"date-selection"],["mat-button","",3,"click"],["matInput","",3,"ngModelChange","dateChange","matDatepicker","ngModel"],["matIconSuffix","",3,"for"],[1,"transport-input"],[1,"example-list-section"],[1,"example-margin",3,"change","checked","color","indeterminate"],[1,"search-button"],[3,"hidden"],["mode","indeterminate"],[1,"result"],["class","result-plate",4,"ngFor","ngForOf"],["matSuffix","","mat-icon-button","","aria-label","Clear",3,"click"],[3,"ngModelChange","ngModel","color"],[1,"result-plate"],[1,"result-plate-thread"],[1,"result-plate-departure"],[1,"result-plate-arrival"]],template:function(m,r){if(m&1){let M=Ho();vt(0,"section",1)(1,"section",2)(2,"section",3)(3,"section",4)(4,"mat-form-field",5)(5,"mat-label"),hn(6,"From"),wt(),vt(7,"input",6),bl("ngModelChange",function(ie){return Ji(M),_l(r.from,ie)||(r.from=ie),en(ie)}),Vi("change",function(){return Ji(M),en(r.setFromCode())}),wt(),Xn(8,d3,3,0,"button",7),wt(),vt(9,"button",8),Vi("click",function(){return Ji(M),en(r.swap())}),vt(10,"mat-icon"),hn(11,"swap_horiz"),wt()(),vt(12,"mat-form-field",5)(13,"mat-label"),hn(14,"To"),wt(),vt(15,"input",6),bl("ngModelChange",function(ie){return Ji(M),_l(r.to,ie)||(r.to=ie),en(ie)}),Vi("change",function(){return Ji(M),en(r.setToCode())}),wt(),Xn(16,u3,3,0,"button",7),wt()(),vt(17,"section",9)(18,"button",10),Vi("click",function(){return Ji(M),en(r.setToday())}),hn(19,"Today"),wt(),vt(20,"button",10),Vi("click",function(){return Ji(M),en(r.setTomorrow())}),hn(21,"Tomorrow"),wt(),vt(22,"mat-form-field")(23,"mat-label"),hn(24,"Choose a date"),wt(),vt(25,"input",11),bl("ngModelChange",function(ie){return Ji(M),_l(r.date,ie)||(r.date=ie),en(ie)}),Vi("dateChange",function(){return Ji(M),en(r.setDate())}),wt(),nn(26,"mat-datepicker-toggle",12)(27,"mat-datepicker",null,0),wt()(),vt(29,"section",13)(30,"span",14)(31,"mat-checkbox",15),Vi("change",function(ie){return Ji(M),en(r.setAll(ie.checked))}),hn(32),wt()(),vt(33,"span",14)(34,"ul"),Au(35,h3,3,3,"li",null,Mu),wt()()(),vt(37,"section",16)(38,"button",10),Vi("click",function(){return Ji(M),en(r.search())}),hn(39," Search "),vt(40,"mat-icon"),hn(41,"search"),wt(),vt(42,"span",17),nn(43,"mat-progress-bar",18),wt()()()()(),vt(44,"section",19),Xn(45,p3,30,15,"section",20),wt()()}if(m&2){let M=Ss(28);Ft(7),gl("ngModel",r.from),Ft(),Ni("ngIf",r.from),Ft(7),gl("ngModel",r.to),Ft(),Ni("ngIf",r.to),Ft(9),Ni("matDatepicker",M),gl("ngModel",r.date),Ft(),Ni("for",M),Ft(5),Ni("checked",r.allComplete)("color",r.task.color)("indeterminate",r.someComplete()),Ft(),Ms(" ",r.task.name," "),Ft(3),Du(r.task.subtasks),Ft(7),Ni("hidden",!r.isSearching),Ft(3),Ni("ngForOf",r.segments)}},dependencies:[Yu,fM,jb,pM,SM,IM,kb,hp,Mb,Pf,Hb,$f,qf,wM,xM,BM,Uf,iA,tA,Kb,Jx,HE,oA,Qb,jf,lA,sA,$_,qE],styles:["section.container[_ngcontent-%COMP%]{width:100%;min-height:calc(100vh - 48px);max-height:calc(100vh - 48px)}section.container[_ngcontent-%COMP%]   section.form[_ngcontent-%COMP%]{background-color:#fff;display:grid;justify-content:center;width:100%}section.container[_ngcontent-%COMP%]   section.form[_ngcontent-%COMP%]   section.form-content[_ngcontent-%COMP%]{padding:20px}section.container[_ngcontent-%COMP%]   section.form[_ngcontent-%COMP%]   section.form-content[_ngcontent-%COMP%]   section.from-swap-to[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:45%}section.container[_ngcontent-%COMP%]   section.form[_ngcontent-%COMP%]   section.form-content[_ngcontent-%COMP%]   section.from-swap-to[_ngcontent-%COMP%]   button.swap-input-values[_ngcontent-%COMP%]{margin-bottom:16px;max-width:10%;min-width:10%}section.container[_ngcontent-%COMP%]   section.form[_ngcontent-%COMP%]   section.form-content[_ngcontent-%COMP%]   section.from-swap-to[_ngcontent-%COMP%]   button.swap-input-values[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin:0}section.container[_ngcontent-%COMP%]   section.form[_ngcontent-%COMP%]   section.form-content[_ngcontent-%COMP%]   section.date-selection[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:27.5%;margin-bottom:16px;z-index:0}section.container[_ngcontent-%COMP%]   section.form[_ngcontent-%COMP%]   section.form-content[_ngcontent-%COMP%]   section.date-selection[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:45%}section.container[_ngcontent-%COMP%]   section.form[_ngcontent-%COMP%]   section.form-content[_ngcontent-%COMP%]   section.search-button[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}section.container[_ngcontent-%COMP%]   section.result[_ngcontent-%COMP%]{width:calc(100% - 10px);overflow-y:visible;overflow-x:hidden;padding:5px}section.container[_ngcontent-%COMP%]   section.result[_ngcontent-%COMP%]   section.result-plate[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-bottom:5px;border-top:1px solid lightgray}section.container[_ngcontent-%COMP%]   section.result[_ngcontent-%COMP%]   section.result-plate[_ngcontent-%COMP%]   section[_ngcontent-%COMP%]{width:calc(30% - 5px);display:grid;align-items:start;gap:2px}"]});let g=l;return g})();var uA=[{path:"polygon-editor",component:IS},{path:"transport-schedule",component:dA},{path:"**",redirectTo:"polygon-editor",pathMatch:"full"},{path:"",redirectTo:"polygon-editor",pathMatch:"full"}];var m3="@",f3=(()=>{let l=class l{constructor(c,m,r,M,z){this.doc=c,this.delegate=m,this.zone=r,this.animationType=M,this.moduleImpl=z,this._rendererFactoryPromise=null,this.scheduler=$t(PE,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-72N236NG.js")).catch(m=>{throw new fr(5300,!1)}).then(({\u0275createEngine:m,\u0275AnimationRendererFactory:r})=>{this._engine=m(this.animationType,this.doc,this.scheduler);let M=new r(this.delegate,this._engine,this.zone);return this.delegate=M,M})}createRenderer(c,m){let r=this.delegate.createRenderer(c,m);if(r.\u0275type===0)return r;typeof r.throwOnSyntheticProps=="boolean"&&(r.throwOnSyntheticProps=!1);let M=new t1(r);return m?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(z=>{let ie=z.createRenderer(c,m);M.use(ie)}).catch(z=>{M.use(r)}),M}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};l.\u0275fac=function(m){Su()},l.\u0275prov=Qt({token:l,factory:l.\u0275fac});let g=l;return g})(),t1=class{constructor(l){this.delegate=l,this.replay=[],this.\u0275type=1}use(l){if(this.delegate=l,this.replay!==null){for(let w of this.replay)w(l);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(l,w){return this.delegate.createElement(l,w)}createComment(l){return this.delegate.createComment(l)}createText(l){return this.delegate.createText(l)}get destroyNode(){return this.delegate.destroyNode}appendChild(l,w){this.delegate.appendChild(l,w)}insertBefore(l,w,c,m){this.delegate.insertBefore(l,w,c,m)}removeChild(l,w,c){this.delegate.removeChild(l,w,c)}selectRootElement(l,w){return this.delegate.selectRootElement(l,w)}parentNode(l){return this.delegate.parentNode(l)}nextSibling(l){return this.delegate.nextSibling(l)}setAttribute(l,w,c,m){this.delegate.setAttribute(l,w,c,m)}removeAttribute(l,w,c){this.delegate.removeAttribute(l,w,c)}addClass(l,w){this.delegate.addClass(l,w)}removeClass(l,w){this.delegate.removeClass(l,w)}setStyle(l,w,c,m){this.delegate.setStyle(l,w,c,m)}removeStyle(l,w,c){this.delegate.removeStyle(l,w,c)}setProperty(l,w,c){this.shouldReplay(w)&&this.replay.push(m=>m.setProperty(l,w,c)),this.delegate.setProperty(l,w,c)}setValue(l,w){this.delegate.setValue(l,w)}listen(l,w,c){return this.shouldReplay(w)&&this.replay.push(m=>m.listen(l,w,c)),this.delegate.listen(l,w,c)}shouldReplay(l){return this.replay!==null&&l.startsWith(m3)}};function hA(g="animations"){return $0("NgAsyncAnimations"),Eu([{provide:V_,useFactory:(l,w,c)=>new f3(l,w,c,g),deps:[rn,tb,yi]},{provide:xo,useValue:g==="noop"?"NoopAnimations":"BrowserAnimations"}])}var pA={providers:[YI(uA),hA(),rI()]};var gA=["*"];var g3=["tabListContainer"],_3=["tabList"],b3=["tabListInner"],y3=["nextPaginator"],v3=["previousPaginator"];var x3=["mat-tab-nav-bar",""],w3=["mat-tab-link",""];var i1="mdc-tab-indicator--active",mA="mdc-tab-indicator--no-transition",n1=class{constructor(l){this._items=l}hide(){this._items.forEach(l=>l.deactivateInkBar())}alignToElement(l){let w=this._items.find(m=>m.elementRef.nativeElement===l),c=this._currentItem;if(w!==c&&(c?.deactivateInkBar(),w)){let m=c?.elementRef.nativeElement.getBoundingClientRect?.();w.activateInkBar(m),this._currentItem=w}}},C3=(()=>{let l=class l{constructor(){this._elementRef=$t(zi),this._fitToContent=!1}get fitInkBarToContent(){return this._fitToContent}set fitInkBarToContent(c){this._fitToContent!==c&&(this._fitToContent=c,this._inkBarElement&&this._appendInkBarElement())}activateInkBar(c){let m=this._elementRef.nativeElement;if(!c||!m.getBoundingClientRect||!this._inkBarContentElement){m.classList.add(i1);return}let r=m.getBoundingClientRect(),M=c.width/r.width,z=c.left-r.left;m.classList.add(mA),this._inkBarContentElement.style.setProperty("transform",`translateX(${z}px) scaleX(${M})`),m.getBoundingClientRect(),m.classList.remove(mA),m.classList.add(i1),this._inkBarContentElement.style.setProperty("transform","")}deactivateInkBar(){this._elementRef.nativeElement.classList.remove(i1)}ngOnInit(){this._createInkBarElement()}ngOnDestroy(){this._inkBarElement?.remove(),this._inkBarElement=this._inkBarContentElement=null}_createInkBarElement(){let c=this._elementRef.nativeElement.ownerDocument||document,m=this._inkBarElement=c.createElement("span"),r=this._inkBarContentElement=c.createElement("span");m.className="mdc-tab-indicator",r.className="mdc-tab-indicator__content mdc-tab-indicator__content--underline",m.appendChild(this._inkBarContentElement),this._appendInkBarElement()}_appendInkBarElement(){this._inkBarElement;let c=this._fitToContent?this._elementRef.nativeElement.querySelector(".mdc-tab__content"):this._elementRef.nativeElement;c.appendChild(this._inkBarElement)}};l.\u0275fac=function(m){return new(m||l)},l.\u0275dir=Qi({type:l,inputs:{fitInkBarToContent:[Jt.HasDecoratorInputTransform,"fitInkBarToContent","fitInkBarToContent",pn]},features:[xr]});let g=l;return g})();var fA=Ba({passive:!0}),T3=650,E3=100,I3=(()=>{let l=class l{get selectedIndex(){return this._selectedIndex}set selectedIndex(c){let m=isNaN(c)?0:c;this._selectedIndex!=m&&(this._selectedIndexChanged=!0,this._selectedIndex=m,this._keyManager&&this._keyManager.updateActiveItem(m))}constructor(c,m,r,M,z,ie,ue){this._elementRef=c,this._changeDetectorRef=m,this._viewportRuler=r,this._dir=M,this._ngZone=z,this._platform=ie,this._animationMode=ue,this._scrollDistance=0,this._selectedIndexChanged=!1,this._destroyed=new Gi,this._showPaginationControls=!1,this._disableScrollAfter=!0,this._disableScrollBefore=!0,this._stopScrolling=new Gi,this.disablePagination=!1,this._selectedIndex=0,this.selectFocusedIndex=new fi,this.indexFocused=new fi,z.runOutsideAngular(()=>{Cu(c.nativeElement,"mouseleave").pipe(Wr(this._destroyed)).subscribe(()=>{this._stopInterval()})})}ngAfterViewInit(){Cu(this._previousPaginator.nativeElement,"touchstart",fA).pipe(Wr(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("before")}),Cu(this._nextPaginator.nativeElement,"touchstart",fA).pipe(Wr(this._destroyed)).subscribe(()=>{this._handlePaginatorPress("after")})}ngAfterContentInit(){let c=this._dir?this._dir.change:ui("ltr"),m=this._viewportRuler.change(150),r=()=>{this.updatePagination(),this._alignInkBarToSelectedTab()};this._keyManager=new zb(this._items).withHorizontalOrientation(this._getLayoutDirection()).withHomeAndEnd().withWrap().skipPredicate(()=>!1),this._keyManager.updateActiveItem(this._selectedIndex),this._ngZone.onStable.pipe(vo(1)).subscribe(r),fl(c,m,this._items.changes,this._itemsResized()).pipe(Wr(this._destroyed)).subscribe(()=>{this._ngZone.run(()=>{Promise.resolve().then(()=>{this._scrollDistance=Math.max(0,Math.min(this._getMaxScrollDistance(),this._scrollDistance)),r()})}),this._keyManager.withHorizontalOrientation(this._getLayoutDirection())}),this._keyManager.change.subscribe(M=>{this.indexFocused.emit(M),this._setTabFocus(M)})}_itemsResized(){return typeof ResizeObserver!="function"?Cs:this._items.changes.pipe(Es(this._items),Ta(c=>new rs(m=>this._ngZone.runOutsideAngular(()=>{let r=new ResizeObserver(M=>m.next(M));return c.forEach(M=>r.observe(M.elementRef.nativeElement)),()=>{r.disconnect()}}))),$h(1),eo(c=>c.some(m=>m.contentRect.width>0&&m.contentRect.height>0)))}ngAfterContentChecked(){this._tabLabelCount!=this._items.length&&(this.updatePagination(),this._tabLabelCount=this._items.length,this._changeDetectorRef.markForCheck()),this._selectedIndexChanged&&(this._scrollToLabel(this._selectedIndex),this._checkScrollingControls(),this._alignInkBarToSelectedTab(),this._selectedIndexChanged=!1,this._changeDetectorRef.markForCheck()),this._scrollDistanceChanged&&(this._updateTabScrollPosition(),this._scrollDistanceChanged=!1,this._changeDetectorRef.markForCheck())}ngOnDestroy(){this._keyManager?.destroy(),this._destroyed.next(),this._destroyed.complete(),this._stopScrolling.complete()}_handleKeydown(c){if(!xl(c))switch(c.keyCode){case 13:case 32:if(this.focusIndex!==this.selectedIndex){let m=this._items.get(this.focusIndex);m&&!m.disabled&&(this.selectFocusedIndex.emit(this.focusIndex),this._itemSelected(c))}break;default:this._keyManager.onKeydown(c)}}_onContentChanges(){let c=this._elementRef.nativeElement.textContent;c!==this._currentTextContent&&(this._currentTextContent=c||"",this._ngZone.run(()=>{this.updatePagination(),this._alignInkBarToSelectedTab(),this._changeDetectorRef.markForCheck()}))}updatePagination(){this._checkPaginationEnabled(),this._checkScrollingControls(),this._updateTabScrollPosition()}get focusIndex(){return this._keyManager?this._keyManager.activeItemIndex:0}set focusIndex(c){!this._isValidIndex(c)||this.focusIndex===c||!this._keyManager||this._keyManager.setActiveItem(c)}_isValidIndex(c){return this._items?!!this._items.toArray()[c]:!0}_setTabFocus(c){if(this._showPaginationControls&&this._scrollToLabel(c),this._items&&this._items.length){this._items.toArray()[c].focus();let m=this._tabListContainer.nativeElement;this._getLayoutDirection()=="ltr"?m.scrollLeft=0:m.scrollLeft=m.scrollWidth-m.offsetWidth}}_getLayoutDirection(){return this._dir&&this._dir.value==="rtl"?"rtl":"ltr"}_updateTabScrollPosition(){if(this.disablePagination)return;let c=this.scrollDistance,m=this._getLayoutDirection()==="ltr"?-c:c;this._tabList.nativeElement.style.transform=`translateX(${Math.round(m)}px)`,(this._platform.TRIDENT||this._platform.EDGE)&&(this._tabListContainer.nativeElement.scrollLeft=0)}get scrollDistance(){return this._scrollDistance}set scrollDistance(c){this._scrollTo(c)}_scrollHeader(c){let m=this._tabListContainer.nativeElement.offsetWidth,r=(c=="before"?-1:1)*m/3;return this._scrollTo(this._scrollDistance+r)}_handlePaginatorClick(c){this._stopInterval(),this._scrollHeader(c)}_scrollToLabel(c){if(this.disablePagination)return;let m=this._items?this._items.toArray()[c]:null;if(!m)return;let r=this._tabListContainer.nativeElement.offsetWidth,{offsetLeft:M,offsetWidth:z}=m.elementRef.nativeElement,ie,ue;this._getLayoutDirection()=="ltr"?(ie=M,ue=ie+z):(ue=this._tabListInner.nativeElement.offsetWidth-M,ie=ue-z);let ye=this.scrollDistance,Je=this.scrollDistance+r;ie<ye?this.scrollDistance-=ye-ie:ue>Je&&(this.scrollDistance+=Math.min(ue-Je,ie-ye))}_checkPaginationEnabled(){if(this.disablePagination)this._showPaginationControls=!1;else{let c=this._tabListInner.nativeElement.scrollWidth>this._elementRef.nativeElement.offsetWidth;c||(this.scrollDistance=0),c!==this._showPaginationControls&&this._changeDetectorRef.markForCheck(),this._showPaginationControls=c}}_checkScrollingControls(){this.disablePagination?this._disableScrollAfter=this._disableScrollBefore=!0:(this._disableScrollBefore=this.scrollDistance==0,this._disableScrollAfter=this.scrollDistance==this._getMaxScrollDistance(),this._changeDetectorRef.markForCheck())}_getMaxScrollDistance(){let c=this._tabListInner.nativeElement.scrollWidth,m=this._tabListContainer.nativeElement.offsetWidth;return c-m||0}_alignInkBarToSelectedTab(){let c=this._items&&this._items.length?this._items.toArray()[this.selectedIndex]:null,m=c?c.elementRef.nativeElement:null;m?this._inkBar.alignToElement(m):this._inkBar.hide()}_stopInterval(){this._stopScrolling.next()}_handlePaginatorPress(c,m){m&&m.button!=null&&m.button!==0||(this._stopInterval(),gE(T3,E3).pipe(Wr(fl(this._stopScrolling,this._destroyed))).subscribe(()=>{let{maxScrollDistance:r,distance:M}=this._scrollHeader(c);(M===0||M>=r)&&this._stopInterval()}))}_scrollTo(c){if(this.disablePagination)return{maxScrollDistance:0,distance:0};let m=this._getMaxScrollDistance();return this._scrollDistance=Math.max(0,Math.min(m,c)),this._scrollDistanceChanged=!0,this._checkScrollingControls(),{maxScrollDistance:m,distance:this._scrollDistance}}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(Pr),Oe(Cp),Oe(Ds,8),Oe(yi),Oe(Nn),Oe(xo,8))},l.\u0275dir=Qi({type:l,inputs:{disablePagination:[Jt.HasDecoratorInputTransform,"disablePagination","disablePagination",pn],selectedIndex:[Jt.HasDecoratorInputTransform,"selectedIndex","selectedIndex",ec]},outputs:{selectFocusedIndex:"selectFocusedIndex",indexFocused:"indexFocused"},features:[xr]});let g=l;return g})();var S3=new hi("MAT_TABS_CONFIG");var M3=0,r1=(()=>{let l=class l extends I3{get fitInkBarToContent(){return this._fitInkBarToContent.value}set fitInkBarToContent(c){this._fitInkBarToContent.next(c),this._changeDetectorRef.markForCheck()}get animationDuration(){return this._animationDuration}set animationDuration(c){let m=c+"";this._animationDuration=/^\d+$/.test(m)?c+"ms":m}get backgroundColor(){return this._backgroundColor}set backgroundColor(c){let m=this._elementRef.nativeElement.classList;m.remove("mat-tabs-with-background",`mat-background-${this.backgroundColor}`),c&&m.add("mat-tabs-with-background",`mat-background-${c}`),this._backgroundColor=c}constructor(c,m,r,M,z,ie,ue,ye){super(c,M,z,m,r,ie,ue),this._fitInkBarToContent=new ua(!1),this.stretchTabs=!0,this.disableRipple=!1,this.color="primary",this.disablePagination=ye&&ye.disablePagination!=null?ye.disablePagination:!1,this.fitInkBarToContent=ye&&ye.fitInkBarToContent!=null?ye.fitInkBarToContent:!1,this.stretchTabs=ye&&ye.stretchTabs!=null?ye.stretchTabs:!0}_itemSelected(){}ngAfterContentInit(){this._inkBar=new n1(this._items),this._items.changes.pipe(Es(null),Wr(this._destroyed)).subscribe(()=>{this.updateActiveLink()}),super.ngAfterContentInit()}ngAfterViewInit(){this.tabPanel,super.ngAfterViewInit()}updateActiveLink(){if(!this._items)return;let c=this._items.toArray();for(let m=0;m<c.length;m++)if(c[m].active){this.selectedIndex=m,this._changeDetectorRef.markForCheck(),this.tabPanel&&(this.tabPanel._activeTabId=c[m].id);return}this.selectedIndex=-1,this._inkBar.hide()}_getRole(){return this.tabPanel?"tablist":this._elementRef.nativeElement.getAttribute("role")}};l.\u0275fac=function(m){return new(m||l)(Oe(zi),Oe(Ds,8),Oe(yi),Oe(Pr),Oe(Cp),Oe(Nn),Oe(xo,8),Oe(S3,8))},l.\u0275cmp=kn({type:l,selectors:[["","mat-tab-nav-bar",""]],contentQueries:function(m,r,M){if(m&1&&Ea(M,o1,5),m&2){let z;bn(z=yn())&&(r._items=z)}},viewQuery:function(m,r){if(m&1&&(cr(g3,7),cr(_3,7),cr(b3,7),cr(y3,5),cr(v3,5)),m&2){let M;bn(M=yn())&&(r._tabListContainer=M.first),bn(M=yn())&&(r._tabList=M.first),bn(M=yn())&&(r._tabListInner=M.first),bn(M=yn())&&(r._nextPaginator=M.first),bn(M=yn())&&(r._previousPaginator=M.first)}},hostAttrs:[1,"mat-mdc-tab-nav-bar","mat-mdc-tab-header"],hostVars:17,hostBindings:function(m,r){m&2&&(Fn("role",r._getRole()),Jl("--mat-tab-animation-duration",r.animationDuration),Tn("mat-mdc-tab-header-pagination-controls-enabled",r._showPaginationControls)("mat-mdc-tab-header-rtl",r._getLayoutDirection()=="rtl")("mat-mdc-tab-nav-bar-stretch-tabs",r.stretchTabs)("mat-primary",r.color!=="warn"&&r.color!=="accent")("mat-accent",r.color==="accent")("mat-warn",r.color==="warn")("_mat-animation-noopable",r._animationMode==="NoopAnimations"))},inputs:{fitInkBarToContent:[Jt.HasDecoratorInputTransform,"fitInkBarToContent","fitInkBarToContent",pn],stretchTabs:[Jt.HasDecoratorInputTransform,"mat-stretch-tabs","stretchTabs",pn],animationDuration:"animationDuration",backgroundColor:"backgroundColor",disableRipple:[Jt.HasDecoratorInputTransform,"disableRipple","disableRipple",pn],color:"color",tabPanel:"tabPanel"},exportAs:["matTabNavBar","matTabNav"],standalone:!0,features:[xr,so,Pn],attrs:x3,ngContentSelectors:gA,decls:13,vars:8,consts:[["previousPaginator",""],["tabListContainer",""],["tabList",""],["tabListInner",""],["nextPaginator",""],["aria-hidden","true","type","button","mat-ripple","","tabindex","-1",1,"mat-mdc-tab-header-pagination","mat-mdc-tab-header-pagination-before",3,"click","mousedown","touchend","matRippleDisabled","disabled"],[1,"mat-mdc-tab-header-pagination-chevron"],[1,"mat-mdc-tab-link-container",3,"keydown"],[1,"mat-mdc-tab-list",3,"cdkObserveContent"],[1,"mat-mdc-tab-links"],["aria-hidden","true","type","button","mat-ripple","","tabindex","-1",1,"mat-mdc-tab-header-pagination","mat-mdc-tab-header-pagination-after",3,"mousedown","click","touchend","matRippleDisabled","disabled"]],template:function(m,r){if(m&1){let M=Ho();wo(),vt(0,"button",5,0),Vi("click",function(){return Ji(M),en(r._handlePaginatorClick("before"))})("mousedown",function(ie){return Ji(M),en(r._handlePaginatorPress("before",ie))})("touchend",function(){return Ji(M),en(r._stopInterval())}),nn(2,"div",6),wt(),vt(3,"div",7,1),Vi("keydown",function(ie){return Ji(M),en(r._handleKeydown(ie))}),vt(5,"div",8,2),Vi("cdkObserveContent",function(){return Ji(M),en(r._onContentChanges())}),vt(7,"div",9,3),lr(9),wt()()(),vt(10,"button",10,4),Vi("mousedown",function(ie){return Ji(M),en(r._handlePaginatorPress("after",ie))})("click",function(){return Ji(M),en(r._handlePaginatorClick("after"))})("touchend",function(){return Ji(M),en(r._stopInterval())}),nn(12,"div",6),wt()}m&2&&(Tn("mat-mdc-tab-header-pagination-disabled",r._disableScrollBefore),Ni("matRippleDisabled",r._disableScrollBefore||r.disableRipple)("disabled",r._disableScrollBefore||null),Ft(10),Tn("mat-mdc-tab-header-pagination-disabled",r._disableScrollAfter),Ni("matRippleDisabled",r._disableScrollAfter||r.disableRipple)("disabled",r._disableScrollAfter||null))},dependencies:[Zu,PS],styles:[".mdc-tab{min-width:90px;padding-right:24px;padding-left:24px;display:flex;flex:1 0 auto;justify-content:center;box-sizing:border-box;margin:0;padding-top:0;padding-bottom:0;border:none;outline:none;text-align:center;white-space:nowrap;cursor:pointer;-webkit-appearance:none;z-index:1}.mdc-tab::-moz-focus-inner{padding:0;border:0}.mdc-tab[hidden]{display:none}.mdc-tab--min-width{flex:0 1 auto}.mdc-tab__content{display:flex;align-items:center;justify-content:center;height:inherit;pointer-events:none}.mdc-tab__text-label{transition:150ms color linear;display:inline-block;line-height:1;z-index:2}.mdc-tab__icon{transition:150ms color linear;z-index:2}.mdc-tab--stacked .mdc-tab__content{flex-direction:column;align-items:center;justify-content:center}.mdc-tab--stacked .mdc-tab__text-label{padding-top:6px;padding-bottom:4px}.mdc-tab--active .mdc-tab__text-label,.mdc-tab--active .mdc-tab__icon{transition-delay:100ms}.mdc-tab:not(.mdc-tab--stacked) .mdc-tab__icon+.mdc-tab__text-label{padding-left:8px;padding-right:0}[dir=rtl] .mdc-tab:not(.mdc-tab--stacked) .mdc-tab__icon+.mdc-tab__text-label,.mdc-tab:not(.mdc-tab--stacked) .mdc-tab__icon+.mdc-tab__text-label[dir=rtl]{padding-left:0;padding-right:8px}.mdc-tab-indicator{display:flex;position:absolute;top:0;left:0;justify-content:center;width:100%;height:100%;pointer-events:none;z-index:1}.mdc-tab-indicator__content{transform-origin:left;opacity:0}.mdc-tab-indicator__content--underline{align-self:flex-end;box-sizing:border-box;width:100%;border-top-style:solid}.mdc-tab-indicator__content--icon{align-self:center;margin:0 auto}.mdc-tab-indicator--active .mdc-tab-indicator__content{opacity:1}.mdc-tab-indicator .mdc-tab-indicator__content{transition:250ms transform cubic-bezier(0.4, 0, 0.2, 1)}.mdc-tab-indicator--no-transition .mdc-tab-indicator__content{transition:none}.mdc-tab-indicator--fade .mdc-tab-indicator__content{transition:150ms opacity linear}.mdc-tab-indicator--active.mdc-tab-indicator--fade .mdc-tab-indicator__content{transition-delay:100ms}.mat-mdc-tab-ripple{position:absolute;top:0;left:0;bottom:0;right:0;pointer-events:none}.mat-mdc-tab-header{display:flex;overflow:hidden;position:relative;flex-shrink:0}.mdc-tab-indicator .mdc-tab-indicator__content{transition-duration:var(--mat-tab-animation-duration, 250ms)}.mat-mdc-tab-header-pagination{-webkit-user-select:none;user-select:none;position:relative;display:none;justify-content:center;align-items:center;min-width:32px;cursor:pointer;z-index:2;-webkit-tap-highlight-color:rgba(0,0,0,0);touch-action:none;box-sizing:content-box;background:none;border:none;outline:0;padding:0}.mat-mdc-tab-header-pagination::-moz-focus-inner{border:0}.mat-mdc-tab-header-pagination .mat-ripple-element{opacity:.12;background-color:var(--mat-tab-header-inactive-ripple-color)}.mat-mdc-tab-header-pagination-controls-enabled .mat-mdc-tab-header-pagination{display:flex}.mat-mdc-tab-header-pagination-before,.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-after{padding-left:4px}.mat-mdc-tab-header-pagination-before .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-after .mat-mdc-tab-header-pagination-chevron{transform:rotate(-135deg)}.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-before,.mat-mdc-tab-header-pagination-after{padding-right:4px}.mat-mdc-tab-header-rtl .mat-mdc-tab-header-pagination-before .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-header-pagination-after .mat-mdc-tab-header-pagination-chevron{transform:rotate(45deg)}.mat-mdc-tab-header-pagination-chevron{border-style:solid;border-width:2px 2px 0 0;height:8px;width:8px;border-color:var(--mat-tab-header-pagination-icon-color)}.mat-mdc-tab-header-pagination-disabled{box-shadow:none;cursor:default;pointer-events:none}.mat-mdc-tab-header-pagination-disabled .mat-mdc-tab-header-pagination-chevron{opacity:.4}.mat-mdc-tab-list{flex-grow:1;position:relative;transition:transform 500ms cubic-bezier(0.35, 0, 0.25, 1)}._mat-animation-noopable .mat-mdc-tab-list{transition:none}._mat-animation-noopable span.mdc-tab-indicator__content,._mat-animation-noopable span.mdc-tab__text-label{transition:none}.mat-mdc-tab-links{display:flex;flex:1 0 auto}[mat-align-tabs=center]>.mat-mdc-tab-link-container .mat-mdc-tab-links{justify-content:center}[mat-align-tabs=end]>.mat-mdc-tab-link-container .mat-mdc-tab-links{justify-content:flex-end}.mat-mdc-tab-link-container{display:flex;flex-grow:1;overflow:hidden;z-index:1;border-bottom-style:solid;border-bottom-width:var(--mat-tab-header-divider-height);border-bottom-color:var(--mat-tab-header-divider-color)}.mat-mdc-tab-nav-bar.mat-tabs-with-background>.mat-mdc-tab-link-container,.mat-mdc-tab-nav-bar.mat-tabs-with-background>.mat-mdc-tab-header-pagination{background-color:var(--mat-tab-header-with-background-background-color)}.mat-mdc-tab-nav-bar.mat-tabs-with-background.mat-primary>.mat-mdc-tab-link-container .mat-mdc-tab-link .mdc-tab__text-label{color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-nav-bar.mat-tabs-with-background.mat-primary>.mat-mdc-tab-link-container .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-nav-bar.mat-tabs-with-background:not(.mat-primary)>.mat-mdc-tab-link-container .mat-mdc-tab-link:not(.mdc-tab--active) .mdc-tab__text-label{color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-nav-bar.mat-tabs-with-background:not(.mat-primary)>.mat-mdc-tab-link-container .mat-mdc-tab-link:not(.mdc-tab--active) .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-nav-bar.mat-tabs-with-background>.mat-mdc-tab-link-container .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-nav-bar.mat-tabs-with-background>.mat-mdc-tab-link-container .mat-mdc-focus-indicator::before,.mat-mdc-tab-nav-bar.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-nav-bar.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-mdc-focus-indicator::before{border-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-nav-bar.mat-tabs-with-background>.mat-mdc-tab-link-container .mat-ripple-element,.mat-mdc-tab-nav-bar.mat-tabs-with-background>.mat-mdc-tab-link-container .mdc-tab__ripple::before,.mat-mdc-tab-nav-bar.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-ripple-element,.mat-mdc-tab-nav-bar.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mdc-tab__ripple::before{background-color:var(--mat-tab-header-with-background-foreground-color)}.mat-mdc-tab-nav-bar.mat-tabs-with-background>.mat-mdc-tab-link-container .mat-mdc-tab-header-pagination-chevron,.mat-mdc-tab-nav-bar.mat-tabs-with-background>.mat-mdc-tab-header-pagination .mat-mdc-tab-header-pagination-chevron{color:var(--mat-tab-header-with-background-foreground-color)}"],encapsulation:2});let g=l;return g})(),o1=(()=>{let l=class l extends C3{get active(){return this._isActive}set active(c){c!==this._isActive&&(this._isActive=c,this._tabNavBar.updateActiveLink())}get rippleDisabled(){return this.disabled||this.disableRipple||this._tabNavBar.disableRipple||!!this.rippleConfig.disabled}constructor(c,m,r,M,z,ie){super(),this._tabNavBar=c,this.elementRef=m,this._focusMonitor=z,this._destroyed=new Gi,this._isActive=!1,this.disabled=!1,this.disableRipple=!1,this.tabIndex=0,this.id=`mat-tab-link-${M3++}`,this.rippleConfig=r||{},this.tabIndex=parseInt(M)||0,ie==="NoopAnimations"&&(this.rippleConfig.animation={enterDuration:0,exitDuration:0}),c._fitInkBarToContent.pipe(Wr(this._destroyed)).subscribe(ue=>{this.fitInkBarToContent=ue})}focus(){this.elementRef.nativeElement.focus()}ngAfterViewInit(){this._focusMonitor.monitor(this.elementRef)}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete(),super.ngOnDestroy(),this._focusMonitor.stopMonitoring(this.elementRef)}_handleFocus(){this._tabNavBar.focusIndex=this._tabNavBar._items.toArray().indexOf(this)}_handleKeydown(c){(c.keyCode===32||c.keyCode===13)&&(this.disabled?c.preventDefault():this._tabNavBar.tabPanel&&(c.keyCode===32&&c.preventDefault(),this.elementRef.nativeElement.click()))}_getAriaControls(){return this._tabNavBar.tabPanel?this._tabNavBar.tabPanel?.id:this.elementRef.nativeElement.getAttribute("aria-controls")}_getAriaSelected(){return this._tabNavBar.tabPanel?this.active?"true":"false":this.elementRef.nativeElement.getAttribute("aria-selected")}_getAriaCurrent(){return this.active&&!this._tabNavBar.tabPanel?"page":null}_getRole(){return this._tabNavBar.tabPanel?"tab":this.elementRef.nativeElement.getAttribute("role")}_getTabIndex(){return this._tabNavBar.tabPanel?this._isActive&&!this.disabled?0:-1:this.disabled?-1:this.tabIndex}};l.\u0275fac=function(m){return new(m||l)(Oe(r1),Oe(zi),Oe(Bb,8),Is("tabindex"),Oe(Bf),Oe(xo,8))},l.\u0275cmp=kn({type:l,selectors:[["","mat-tab-link",""],["","matTabLink",""]],hostAttrs:[1,"mdc-tab","mat-mdc-tab-link","mat-mdc-focus-indicator"],hostVars:11,hostBindings:function(m,r){m&1&&Vi("focus",function(){return r._handleFocus()})("keydown",function(z){return r._handleKeydown(z)}),m&2&&(Fn("aria-controls",r._getAriaControls())("aria-current",r._getAriaCurrent())("aria-disabled",r.disabled)("aria-selected",r._getAriaSelected())("id",r.id)("tabIndex",r._getTabIndex())("role",r._getRole()),Tn("mat-mdc-tab-disabled",r.disabled)("mdc-tab--active",r.active))},inputs:{active:[Jt.HasDecoratorInputTransform,"active","active",pn],disabled:[Jt.HasDecoratorInputTransform,"disabled","disabled",pn],disableRipple:[Jt.HasDecoratorInputTransform,"disableRipple","disableRipple",pn],tabIndex:[Jt.HasDecoratorInputTransform,"tabIndex","tabIndex",c=>c==null?0:ec(c)],id:"id"},exportAs:["matTabLink"],standalone:!0,features:[xr,so,Pn],attrs:w3,ngContentSelectors:gA,decls:5,vars:2,consts:[[1,"mdc-tab__ripple"],["mat-ripple","",1,"mat-mdc-tab-ripple",3,"matRippleTrigger","matRippleDisabled"],[1,"mdc-tab__content"],[1,"mdc-tab__text-label"]],template:function(m,r){m&1&&(wo(),nn(0,"span",0)(1,"div",1),vt(2,"span",2)(3,"span",3),lr(4),wt()()),m&2&&(Ft(),Ni("matRippleTrigger",r.elementRef.nativeElement)("matRippleDisabled",r.rippleDisabled))},dependencies:[Zu],styles:['.mat-mdc-tab-link{-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-decoration:none;background:none;font-family:var(--mat-tab-header-label-text-font);font-size:var(--mat-tab-header-label-text-size);letter-spacing:var(--mat-tab-header-label-text-tracking);line-height:var(--mat-tab-header-label-text-line-height);font-weight:var(--mat-tab-header-label-text-weight)}.mat-mdc-tab-link .mdc-tab-indicator__content--underline{border-color:var(--mdc-tab-indicator-active-indicator-color)}.mat-mdc-tab-link .mdc-tab-indicator__content--underline{border-top-width:var(--mdc-tab-indicator-active-indicator-height)}.mat-mdc-tab-link .mdc-tab-indicator__content--underline{border-radius:var(--mdc-tab-indicator-active-indicator-shape)}.mat-mdc-tab-link:not(.mdc-tab--stacked){height:var(--mdc-secondary-navigation-tab-container-height)}.mat-mdc-tab-link:not(:disabled).mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab-link:not(:disabled):hover.mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab-link:not(:disabled):focus.mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab-link:not(:disabled):active.mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab-link:disabled.mdc-tab--active .mdc-tab__icon{fill:currentColor}.mat-mdc-tab-link:not(:disabled):not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab-link:not(:disabled):hover:not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab-link:not(:disabled):focus:not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab-link:not(:disabled):active:not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab-link:disabled:not(.mdc-tab--active) .mdc-tab__icon{fill:currentColor}.mat-mdc-tab-link.mdc-tab{flex-grow:0}.mat-mdc-tab-link:hover .mdc-tab__text-label{color:var(--mat-tab-header-inactive-hover-label-text-color)}.mat-mdc-tab-link:focus .mdc-tab__text-label{color:var(--mat-tab-header-inactive-focus-label-text-color)}.mat-mdc-tab-link.mdc-tab--active .mdc-tab__text-label{color:var(--mat-tab-header-active-label-text-color)}.mat-mdc-tab-link.mdc-tab--active .mdc-tab__ripple::before,.mat-mdc-tab-link.mdc-tab--active .mat-ripple-element{background-color:var(--mat-tab-header-active-ripple-color)}.mat-mdc-tab-link.mdc-tab--active:hover .mdc-tab__text-label{color:var(--mat-tab-header-active-hover-label-text-color)}.mat-mdc-tab-link.mdc-tab--active:hover .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-active-hover-indicator-color)}.mat-mdc-tab-link.mdc-tab--active:focus .mdc-tab__text-label{color:var(--mat-tab-header-active-focus-label-text-color)}.mat-mdc-tab-link.mdc-tab--active:focus .mdc-tab-indicator__content--underline{border-color:var(--mat-tab-header-active-focus-indicator-color)}.mat-mdc-tab-link.mat-mdc-tab-disabled{opacity:.4;pointer-events:none}.mat-mdc-tab-link.mat-mdc-tab-disabled .mdc-tab__content{pointer-events:none}.mat-mdc-tab-link.mat-mdc-tab-disabled .mdc-tab__ripple::before,.mat-mdc-tab-link.mat-mdc-tab-disabled .mat-ripple-element{background-color:var(--mat-tab-header-disabled-ripple-color)}.mat-mdc-tab-link .mdc-tab__ripple::before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;opacity:0;pointer-events:none;background-color:var(--mat-tab-header-inactive-ripple-color)}.mat-mdc-tab-link .mdc-tab__text-label{color:var(--mat-tab-header-inactive-label-text-color);display:inline-flex;align-items:center}.mat-mdc-tab-link .mdc-tab__content{position:relative;pointer-events:auto}.mat-mdc-tab-link:hover .mdc-tab__ripple::before{opacity:.04}.mat-mdc-tab-link.cdk-program-focused .mdc-tab__ripple::before,.mat-mdc-tab-link.cdk-keyboard-focused .mdc-tab__ripple::before{opacity:.12}.mat-mdc-tab-link .mat-ripple-element{opacity:.12;background-color:var(--mat-tab-header-inactive-ripple-color)}.mat-mdc-tab-header.mat-mdc-tab-nav-bar-stretch-tabs .mat-mdc-tab-link{flex-grow:1}.mat-mdc-tab-link::before{margin:5px}@media(max-width: 599px){.mat-mdc-tab-link{min-width:72px}}'],encapsulation:2,changeDetection:0});let g=l;return g})();function A3(g,l){if(g&1&&(vt(0,"a",5,1),hn(2),wt()),g&2){let w=l.$implicit,c=Ss(1);Ni("routerLink",w.link)("active",c.isActive),Ft(2),Ms(" ",w.label," ")}}var _A=(()=>{let l=class l{constructor(c){this.router=c,this.title="test-angular-1",this.activeLinkIndex=-1,this.navLinks=[{label:"Polygon editor",link:"./polygon-editor",index:0},{label:"Transport schedule",link:"./transport-schedule",index:1}]}ngOnInit(){this.router.events.subscribe(()=>{this.activeLinkIndex=this.navLinks.indexOf(this.navLinks.find(c=>c.link==="."+this.router.url))})}};l.\u0275fac=function(m){return new(m||l)(Oe(cp))},l.\u0275cmp=kn({type:l,selectors:[["app-root"]],standalone:!0,features:[Pn],decls:5,vars:2,consts:[["tabPanel",""],["rla","routerLinkActive"],["mat-tab-nav-bar","","fitInkBarToContent","",3,"tabPanel"],["mat-tab-link","","routerLinkActive","",3,"routerLink","active",4,"ngFor","ngForOf"],["mat-tab-nav-panel",""],["mat-tab-link","","routerLinkActive","",3,"routerLink","active"]],template:function(m,r){if(m&1&&(vt(0,"nav",2),Xn(1,A3,3,3,"a",3),wt(),vt(2,"section",4,0),nn(4,"router-outlet"),wt()),m&2){let M=Ss(3);Ni("tabPanel",M),Ft(),Ni("ngForOf",r.navLinks)}},dependencies:[Wv,r1,o1,$_,_b,ZI],styles:["nav[_ngcontent-%COMP%]{position:sticky;top:0;left:0;right:0;z-index:1;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);background-color:#fffc}"]});let g=l;return g})();hI(_A,pA).catch(g=>console.error(g));
